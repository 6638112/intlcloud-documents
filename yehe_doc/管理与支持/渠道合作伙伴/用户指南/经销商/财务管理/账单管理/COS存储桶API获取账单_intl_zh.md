## COS存储桶API获取账单

第一步：完成存储桶的创建、存储桶的授权，详情请查看[账单存至COS存储桶](https://intl.cloud.tencent.com/document/product/1085/48340)。

第二步：申请API访问腾讯云的key。

1. 登录 [这里](https://console.intl.cloud.tencent.com/cam/capi)。

2. 点击**Create Key**创建一个新的Key，需填写手机验证码。

![image-20220705141223303](/Users/crystaljingtan/Library/Application Support/typora-user-images/image-20220705141223303.png)

第三步：API获取账单压缩包名称

>!以下两步参考示例代码

1. [API文档](https://intl.cloud.tencent.com/document/product/436/30614)

2. 使用上述列出文件列表的api，支持前缀、路径过滤

3. 根据列表中的文件及约定好的命名规则提取需要下载的文件列表（文件命名请参考示例）

   | 存储桶文件类型                                    | 文件命名                                          | 文件格式 | 上传时间            | 备注                                                         |
   | ------------------------------------------------- | ------------------------------------------------- | -------- | ------------------- | ------------------------------------------------------------ |
   | 日明细账单（包含伙伴自用账单+代替子客支付的账单） | 200020475883-20210810-bill_details.zip            | ZIP      | 2021-08-11 15:45:00 | Day+1上午3点（每月1日出账日为20点），新增的账单明细会存储到 COS 存储 Bucket 中。解压后包含1个CSV文件，如果明细量级超过excel最大行数，会拆成多个CSV文件，如下图。 |
   | 月明细账单（包含伙伴自用账单+代替子客支付的账单） | 200018967974-202201-by_used_time-bill_details.zip | ZIP      | 2021-08-11 15:45:00 | 每月2号，更新一份完整的上月账单明细。解压后包含1个CSV文件，如果明细量级超过excel最大行数，会拆成多个CSV文件，如下图。 |
   
   ![img](https://docimg9.docs.qq.com/image/rAc1LAyuGHpSf-teducK8w?w=275&h=102&_type=png)

第四步：API下载压缩包

1. [API文档](https://intl.cloud.tencent.com/document/product/436/7753)

2. 使用上述下载api下载文件到本地，传入参数（要下载的文件名、本地路径）

3. 自行编写解压读取csv代码

>?
>1、存储桶账单字段说明，请参考[账单详情](https://intl.cloud.tencent.com/document/product/1085/43050)。
>2、建议每月3日调用接口，获取上月月明细账单。不是最终的本月账单费用，仅供参考。
>3、明细账单费用最多支持8位小数，资源ID账单展示的费用为四舍五入后保留2位小数的费用，实际从账户扣费时按2位小数进行扣费（即扣到分）。
>4、如果需要区分自用账单、子客账单，可通过UIN过滤区分。