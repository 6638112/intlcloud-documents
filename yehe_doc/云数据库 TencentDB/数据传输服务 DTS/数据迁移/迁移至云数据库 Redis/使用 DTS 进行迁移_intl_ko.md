## DTS 소개
Tencent Cloud DTS(Data Transmission Service)는 데이터 마이그레이션, 데이터 동기화, 데이터 구독이 통합된 데이터베이스 데이터 전송 서비스입니다. 서비스 중단 없이 간편하게 데이터베이스를 마이그레이션할 수 있으며, 실시간 동기화 채널을 이용해 원격 재해 복구가 가능한 고가용성 데이터베이스 아키텍처를 손쉽게 구축할 수 있습니다. 또한 데이터베이스 구독에서 제공하는 CDB의 실시간 증분 업데이트 데이터를 통해 비즈니스 수요에 따라 자유롭게 증분 데이터를 소비할 수 있습니다. 현재 DTS for Redis는 다양한 네트워크 시나리오, 다양한 버전의 Redis 데이터 마이그레이션을 지원합니다.

| 용어 | 설명 |
|---------|---------|
| 원본 인스턴스 | 마이그레이션의 원본 인스턴스 |
| 타깃 인스턴스 | 마이그레이션의 타깃 인스턴스로, 사용자가 구매한 TencentDB for Redis |
| CVM 자체구축 | 사용자가 Tencent Cloud 서버에 배포한 Redis 서비스 |
| 공용 네트워크 자체구축 | 사용자가 공인 네트워크에서 배포한 Redis 서비스 |

## 마이그레이션 지원 설명
>?싱글 버전 마이그레이션 메모리 버전(클러스터 구성)의 호환성 문제는 [싱글 버전 마이그레이션 클러스터 버전 설명](https://intl.cloud.tencent.com/document/product/239/37594)을 참조하십시오.

#### 지원 기능
- 데이터 마이그레이션: DTS 마이그레이션 서비스는 데이터를 클라우드로 한꺼번에 마이그레이션할 수 있습니다.
- 데이터 동기화: DTS 마이그레이션 서비스는 전체 마이그레이션 + 증분 동기화 방식을 통해 데이터를 실시간으로 클라우드에 동기화합니다.

#### 지원 버전
- DTS 마이그레이션 서비스를 지원하는 버전은 Redis 2.8, 3.0, 3.2, 4.0, 5.0입니다.
- 지원하는 구성은 단일 노드, redis cluster, codis, twemproxy가 있습니다.
- 마이그레이션 권한 요구사항: DTS 마이그레이션 데이터는 SYNC 혹은 PSYNC 명령어를 지원하는 원본 인스턴스가 필요합니다.

#### 지원 네트워크
DTS 마이그레이션 서비스는 공용 네트워크, CVM 자체구축, DC, VPN 액세스, CCN 시나리오 등 일반적인 네트워크 마이그레이션의 데이터 마이그레이션과 데이터 동기화를 지원합니다.

#### 지원 시나리오
- 클라우드 업로드 마이그레이션: 전통적인 IDC의 Redis에서 TencentDB for Redis로의 마이그레이션을 지원해 효율적인 업무와 간편한 클라우드 업로드 마이그레이션을 돕습니다.
- 클라우드에서 마이그레이션 자체구축: 본인의 Tencent Cloud 혹은 다른 클라우드에서 가상 컴퓨터로 자체구축한 Redis 서비스를 Tencent Cloud로 마이그레이션할 수 있습니다.
- 다른 클라우드 벤더 Redis 서비스 마이그레이션: 다른 클라우드 벤더가 제공하는 Redis 데이터를 Tencent Cloud로 마이그레이션할 수 있습니다. 전제 조건은 클라우드 벤더가 SYNC 혹은 PSYNC의 명령 권한을 제공하는 것입니다.
- 클라우드 인스턴스 간 마이그레이션: 클라우드 인스턴스 간 데이터 마이그레이션 진행 혹은 실시간 동기화를 지원합니다. 지원 버전은 다음과 같습니다.
  
<table>
<caption></caption>
<tr>
<th style="width:130px;position:relative;text-align:left;padding:5px px;font-weight:00;" valign="top">
<div style="position:absolute;width:1px;height:140px;top:0;left:0;background-color: #d9d9d9;display:block;transform:rotate(-66deg);transform-origin:top;valign=top;"></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;타깃 인스턴스<br>원본 인스턴스
</th>
</div>
</th>
<th style="background-color:#f2f2f2;">2.8 메모리 버전(표준 구성)</th>
<th style="background-color:#f2f2f2;">4.0 메모리 버전(표준 구성)</th>
<th style="background-color:#f2f2f2;">4.0 메모리 버전(클러스터 구성)</th>
<th style="background-color:#f2f2f2;">5.0 메모리 버전(표준 구성)</th>
<th style="background-color:#f2f2f2;">5.0 메모리 버전(클러스터 구성)</th>
</tr>
<tr>
<td style="background-color:#f2f2f2;">2.8 메모리 버전(표준 구성)</td>
<td>&#10003;</td>
<td>&#10003;</td>
<td>&#10003;</td>
<td>&#10003;</td>
<td>&#10003;</td>
</tr>
<tr>
<td style="background-color:#f2f2f2;">4.0 메모리 버전(표준 구성)</td>
<td>x</td>
<td>&#10003;</td>
<td>&#10003;</td>
<td>&#10003;</td>
<td>&#10003;</td>
</tr>
<tr>
<td style="background-color:#f2f2f2;">4.0 메모리 버전(클러스터 구성)</td>
<td>x</td>
<td>&#10003;</td>
<td>&#10003;</td>
<td>&#10003;</td>
<td>&#10003;</td>
</tr>
<tr>
<td style="background-color:#f2f2f2;">5.0 메모리 버전(표준 구성)</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>&#10003;</td>
<td>&#10003;</td>
</tr>
<tr>
<td style="background-color:#f2f2f2;">5.0 메모리 버전(클러스터 구성)</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>&#10003;</td>
<td>&#10003;</td>
</tr>
</table>

#### 마이그레이션 제한
- 마이그레이션의 효율을 보장하기 위해 CVM 자체구축 인스턴스 마이그레이션은 리전 간 마이그레이션을 지원하지 않습니다.
- 공인 네트워크 인스턴스 마이그레이션 시, 외부 네트워크에서 원본 인스턴스를 액세스할 수 있는지 확인해야 합니다.
- 마이그레이션 작업 진행은 정상 실행되고 있는 인스턴스만 허용됩니다. 비밀번호를 초기화하지 않았거나 다른 작업이 진행중인 인스턴스는 마이그레이션을 할 수 없습니다.
- 타깃 인스턴스는 데이터가 없는 빈 인스턴스여야 하며, 마이그레이션 중에는 타깃 인스턴스가 읽기 전용으로 설정되어 쓰기 작업을 할 수 없습니다.
- 마이그레이션 성공 시, 서비스측에서 데이터 인증 후 오픈 소스 인스턴스의 연결을 끊고 타깃 인스턴스 연결로 전환할 수 있습니다.

## 마이그레이션 과정
### 1. 마이그레이션 작업 생성
1) [DTS 콘솔](https://console.cloud.tencent.com/dts)에 로그인해 데이터 마이그레이션 페이지에서 [마이그레이션 작업 생성]을 클릭합니다.
2) '링크 리전'에서 상응하는 리전을 선택하고 [0달러 구매]를 클릭합니다.

### 2. 작업 설정
- 작업 이름: 작업 이름을 지정합니다.
- 예약 실행: 마이그레이션 작업 시작 시간을 지정합니다.
>?
> - 예약된 작업 수정, 검증 통과 후에는 다시 [예약 실행]을 클릭해야 작업이 예약 시간에 실행됩니다.
> - 작업이 실행 예약 시간을 지났을 경우에는 예약 실행이 즉시 실행으로 바뀝니다. [즉시 실행]을 클릭하면 작업을 즉시 실행할 수 있습니다.

### 3. 소스 라이브러리와 타깃 라이브러리 설정
CVM의 Redis 인스턴스를 예로 공인 네트워크 인스턴스 마이그레이션을 설명하면 다음과 같습니다.

| 필드 | 설명 | 비고 | 필수 |
|---------|---------|---------|---------|
| 작업 명칭 | 마이그레이션 작업의 명칭 |사용자의 작업 관리 편의성 | 예 |
| CVM 인스턴스(인스턴스 ID/내부 IP) |원본 Redis 인스턴스가 소재한 Tencent Cloud 서버 ID와 내부 네트워크 IP |마이그레이션 작업은 CVM 인스턴스 ID에 따라 진행되며, CVM 실행 상황 및 CVM 내부 네트워크 IP를 확인 | 예 |
| 포트 | 원본 인스턴스 포트 번호 |마이그레이션 작업으로 원본 인스턴스 서비스 액세스 여부 | 예 |
| 비밀번호 | 원본 인스턴스 비밀번호 | 원본 인스턴스 서비스 액세스 시 auth 인증 있음 | 아니오 |
| 데이터베이스 인스턴스 ID | 타깃 인스턴스 ID |데이터를 타깃 인스턴스와 동기화 | 예 |

**클러스터 버전 마이그레이션 설명**
DTS 서비스는 Redis 클러스터 버전 마이그레이션을 지원합니다. Redis Cluster, Codis나 twemproxy 아키텍처의 클러스터 솔루션 모두 DTS 작업 생성의 노드 정보에 있기만 하면 원본 클러스터의 모든 샤드 노드 주소 및 비밀번호를 노드 정보에 입력하기만 하면 됩니다. 원본 인스턴스의 서비스 액세스에 영향을 주지 않도록 원본 인스턴스의 사본 노드에서 데이터 마이그레이션을 진행하는 것을 권장합니다. DTS는 암호 없는 마이그레이션을 지원하며, 마이그레이션 입력 정보는 다음을 참조하십시오.
![](https://main.qcloudimg.com/raw/c08aad1d17a1cc39b1ae4cf978c4194b.png)

### 4. 마이그레이션 작업 실행
1) 네트워크 연결성 테스트에 성공하면 [저장]을 클릭합니다.
2) DTS 서비스가 마이그레이션 작업 점검을 시작합니다. 마이그레이션 조건 충족 시 마이그레이션 작업을 실행할 수 있습니다.
3) 작업 실행 후, 작업 상황이 [검증 중]으로 바뀝니다. 작업은 매개변수 검증을 1회 추가 진행하며, 검증 기간 동안은 작업 취소, 작업 조회, 검증 현황 조회만 할 수 있습니다.
4) 매개변수 검증 성공 후 데이터 마이그레이션을 시작합니다.
데이터 동기화 단계에서는 데이터 오프셋, 원본 인스턴스, 타깃 인스턴스 키 변화 상황이 표시됩니다.

### 5. 마이그레이션 알람 설정
DTS 서버에서는 마이그레이션 작업의 오류를 즉시 알 수 있도록 마이그레이션 중단 알람을 지원합니다. 마이그레이션 알람 설정 과정은 다음과 같습니다.
1) [Cloud Monitoring 콘솔](https://console.cloud.tencent.com/monitor/policylist)에 로그인해 왼쪽 메뉴에서 [Alarm Configuration]>[Alarm Policy] 페이지를 선택합니다.
2. [Create]를 클릭해 새 정책을 생성하고 알람 정책을 설정합니다.
 - 정책 유형: [데이터 전송 서비스]>[자체구축 마이그레이션]을 선택합니다.
 - 알람 대상: 모니터링이 필요한 DTS 작업을 선택하고 [트리거 조건]과 [알람 대상]을 선택해 알람 설정을 완료합니다.
![](https://main.qcloudimg.com/raw/7b3769a436ce417c9ff6b34c9b56eb4d.png)

### 6. 마이그레이션 작업 완료 
동기화를 끊기 전에 타깃 인스턴스에서 데이터를 인증할 수 있습니다. 인증에 문제가 없을 시 마이그레이션 작업을 완료할 수 있습니다.
소스 인스턴스와 타깃 인스턴스 키가 일치할 경우, [완료]를 클릭해 확인하면 데이터 동기화를 완료할 수 있습니다.

