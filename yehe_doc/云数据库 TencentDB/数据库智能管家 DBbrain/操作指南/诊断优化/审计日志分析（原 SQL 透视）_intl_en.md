## Introduction
The audit log analysis (formerly SQL insight) feature can carry out in-depth SQL analysis for a database instance. It can statistically analyze, sample, and aggregate all SQL statements and their execution information (source, number of executions, execution duration, result set, scan set, etc.) based on the audit logs generated by the database within a specified time period.

The audit log analysis feature analyzes the SQL performance based on the execution plan result, comprehensive resource consumption, sizes of scan set and result set, and index usage rationality of the aggregated SQL statements. Then, it provides optimization suggestions for poorly performing SQL statements by taking into account the index conditions and database/table design. This document describes how to perform full SQL analysis and view analysis details.
>Currently, audit log analysis is supported only for TencentDB for MySQL (excluding the Basic Edition).

## Prerequisites
The instance needs to have the database audit feature enabled. Otherwise, the following error will be displayed when you create an SQL insight task. You can click **Quick Activation** to enable and configure database SQL audit.
![](https://main.qcloudimg.com/raw/fc001ac870f1bed1cb301c29baaca47f.png)


## Directions
### SQL view
Log in to the [DBbrain Console](https://console.cloud.tencent.com/dbbrain/slow-sql), select **Diagnosis and Optimization** on the left sidebar, and select **Audit Log Analysis** at the top. For insight view, you can select and display QPS or the number of slow queries.
![](https://main.qcloudimg.com/raw/21b1e34c82b6c0ef06e5f4e7bf2673cc.png)

### Creating a task
1. Select your desired time period and click **Create Audit Task** on the top-right corner of the view.
![](https://main.qcloudimg.com/raw/c9a4dc3cdd01a63bd53f462cea371e00.png)
2. Select the task start time and duration and click **Confirm**.
![](https://main.qcloudimg.com/raw/b0911cf6aef7468545afaf9cb8488758.png)
3. After the task is created, you can view the analysis result and delete the task in the task list. Click **View SQL Analysis** in the **Operation** column to access the SQL analysis page.
![](https://main.qcloudimg.com/raw/2705cd5537d5bb6b96955dc840b4b2d2.png)

### SQL analysis
1. On the SQL analysis page, you can display the view by SQL Type, Host, User, or SQL Code and specify a time period to expand the view and view data at specific points in time. The aggregated details and execution information (including the number of executions, the total, maximum, and minimum delay, and the total, maximum, and minimum number of affected rows) of SQL statements in the specified time period are displayed in the table below.
 - If you select a time period and stretch it in the table, the SQL data will change accordingly, and only the SQL analysis result of the selected time period will be displayed.
 - You can select “SQL Type” or click a legend to filter SQL data that will change accordingly in the table. For example, if you want to view only SELECT requests, you can click other legends to gray them out.
![](https://main.qcloudimg.com/raw/c480b9f9c0dfd9569f9110e1aa9fa99d.png)
2. Click the SQL template on the target row, and the SQL statement details will be displayed on the right.
 - On the analysis page, you can view and copy specific SQL statements and optimize them based on the provided optimization suggestion or description.
 ![](https://main.qcloudimg.com/raw/d27d1b775ffe5774b56703a15618ef2e.png)
 - On the statistics page, you can view the statistical analysis and execution duration track of the specified SQL statement type by Host, User, or SQL Code.
 ![](https://main.qcloudimg.com/raw/6af044530cc937e920f21a620972d6fc.png)

