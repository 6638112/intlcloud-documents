有意性と拡張性を有したデータベースは元のシステムの負荷対応能力を迅速に向上させるのに役立ちます。同等のデータベース規模でMySQLを適切に使用すれば、データベースの同時発生能力を向上させ、タスクの毎秒アクセス数をより高めるのに貢献します。

## 1. 自分に合ったデータベース設定の選択

### 1.1 データベースバージョンの選択
クラウドデータベースMySQLは現在、以前のMySQLの5.5、5.6、5.7バージョンと完全な互換性を有していますが、5.6またはそれより高いバージョンの選択をお勧めします。これらはより安定したデータベースコアを有し、5.5およびこれより古いバージョンの設計を最適化、改良してシステム性能を高め、多くの新しい魅力ある特性を提供しています。

このドキュメントではMySQL 5.7を例に新バージョンの特性をご紹介します。MySQL 5.7は一般的に認められた性能の高さ、信頼性の高さ、使いやすさを有しています。優れた点と新しい特性は次の通りです。

- **生データのJSONサポート**
MySQL 5.7はデータタイプを新規追加し、MySQLのテーブルにストレージしているJSONフォーマットのデータを使用するのに用います。生のJSONデータタイプのサポートには主に以下の利点があります。
 - ドキュメントチェック：JSONルールに適合したデータセクションのみ、タイプがJSONとして列に書き込まれます。そのため、自動でJSON言語をチェックするのと同じです。
 - 高効率アクセス：1つのJSONタイプの列にJSONドキュメントをストレージするとき、データは完全なテキストとしてストレージされることはありません。データは実際には最適化された後にバイナリフォーマットでストレージされ、その対象メンバーといくつかのグループの要素に迅速にアクセスしやすくなっています。
 - 性能の向上：JSONタイプ列のデータにインデックスを作成してquery性能を向上させることができます。この種のインデックスはバーチャルの列の上で作成した「関数インデックス」で実現できます。
 - 利便性：JSONタイプ列が追加した内部ネットワーク言語についてSQL言語の中でドキュメントクエリを非常に自然に集めることができます。例えば、features，featureは1つのJSONフィールドです：
```
 SELECT feature->"$.properties.STREET" AS property_street FROM features WHERE id = 121254;
```
MySQL 5.7を使うと、最適な関係とドキュメントの範例を1つのツールでシームレスに混合でき、異なるアプリと使用中の案件において関係するタイプの範例またはドキュメント型の範例の中で最適な範例を応用することができます。これによってMySQLユーザーの応用範囲を広げてくれます。
- **SYS Schema**
MySQL SYS Schemaは一連のオブジェクト（ビュー、ストレージプロセス、ストレージ方法、テーブルとトリガー）からなる1つのdatabase schemaです。Performance SchemaおよびINFORMATION_SCHEMAの各種テーブルで監視データリソースをストレージし、便利で読みやすく、DBAおよび開発者は使いやすい方でアクセスできます。
MySQL SYS SchemaのデフォルトはMySQL 5.7に含まれ、ダイジェストビューで以下に列挙したよくある問題にお応えします。
 - データベースサービスのリソースを所有するのは誰ですか。
 - データベースサーバーへのアクセス数が最多のマスターはどれですか。
 - インスタンスのメモリはどこに行ったのですか。
- **InnoDB関連修正**
 - - InnoDBのオンライン操作（Online DDL）：MySQLを再起動することなく、Buffer Pool sizeを動的に調整してニーズの変化に対応できます。現在、InnoDBもオンラインでInnoDBのUNDOログとテーブル空間を自動で消去することができます。大きな空間を共有するテーブルファイル（ibdata1）のよくある問題の原因を解消してくれます。最後に、MySQL 5.7はインデックスの再命名とvarcharサイズの修正をサポートします。この2つの操作は以前のバージョンではインデックスとテーブルを再作成する必要がありました。
 - InnoDB生データ分類区：MySQL 5.7 InnoDBに分類区の生データサポートが含まれます。InnoDBの生データ分類区は負荷を減らし、90％に達するメモリのニーズを減少させます。
 - InnoDBキャッシュのウォームアップ：MySQLが再起動したとき、InnoDBはキャッシュプールで最もホットなデータの25%を自動保存します。キャッシュしたデータを予め読み出したり、予め取り込むどんな作業も必要ありません。MySQLの再起動によって性能が劣化することを心配する必要もありません。

MySQL 5.7のその他の最適化と新しい特性については[MySQL公式資料](https://dev.mysql.com/doc/refman/5.7/en/mysql-nutshell.html)をご参照ください。

### 1.2 インスタンス規格の選択（データベースメモリ）
現在MySQLは単独のCPUオプションを提供しておりません。CPUはメモリ仕様を基に比率に応じて割り当てています。ご自身の業務の特徴に合わせて対応するデータベースの仕様をご購入いただけます。各インスタンスには詳細な標準化テストを実施し、マシン選択の際の性能比較に便宜を図っています。
ただし、以下の点にご注意ください。Sysbench標準化テストがすべてのタスクケースを表しているわけではありません。MySQLでタスクを正式に稼働させる前にデータベースにストレステストを実施し、MySQLのお客様のタスクユースケースでのパフォーマンスをよりよくご理解いただくことをお勧めします。[MySQL性能説明](https://intl.cloud.tencent.com/document/product/236/8842)をご参照ください。

メモリはインスタンスのコア指標の1つで、アクセス速度はディスクよりも遥かに速くなっています。通常では、メモリのキャッシュデータが増えるほどデータベースの反応も速くなります。メモリが小さく、データが一定量を超えた場合、ディスク上に更新されます。新しいリクエストでこのデータに再度アクセスして、ディスクからメモリを読み取り、ディスクのIOを消耗すると、データベースの反応は遅くなります。

**読み取りの同時発生が多い、または読み出しレイテンシーにセンシティブなタスクについては、データベースの性能を維持するため、メモリ仕様が小さすぎるものは選択しないことをお勧めします。**

### ハードディスクの選択（データベースストレージ空間）
クラウドデータベースMySQLインスタンスのハードディスク空間はMySQLのデータディレクトリしか含まれておらず、binlog、relaylog、undolog、errorlog、slowlogログ空間は含まれていません。書き込まれたデータ量がインスタンスディスク容量を超える時は、アップグレードしていない場合、インスタンスがロックされることがあります。このためハードディスク容量を選択購入するときは、将来の一定期間内に考えられるデータ量から一定の冗長を考慮して多めに確保して、ハードディスクの容量不足からインスタンスのロックまたは頻繁なアップグレードがないようにします。

### 1.4 お客様に適したデータコピー方式の選択
クラウドデータベースMySQLは非同期、準同期、強制同期の3種類のコピー方式があります。[データベースインスタンスのコピー方式](http://intl.cloud.tencent.com/document/product/236/7913)をご参照ください。タスク書き込み時のレイテンシーまたはデータベース性能に関心がある場合は、非同期コピー方式の選択をお勧めします。

### 1.5 クラウドデータベースの高可用性
クラウドデータベースMySQLを採用したマスター、スレーブM-M（ダブルマスター構造）の高可用性構造、そのマスター、スレーブ間のデータ同期はbinlogログの方式に基づきます。同時にインスタンスをどのような時間点にでも復元させることもサポートします。この機能はバックアップとログの運用に依拠する必要があります。このため、通常ではバックアップ復旧システムの構築、またはその他の追加費用によってインスタンスの高可用性を確保する必要はありません。

### 1.6 クラウドデータベースの拡張性
クラウドデータベースMySQLのデータベースバージョン、メモリ/ハードディスクの仕様はいずれもオンラインの動的なホットアップグレードをサポートしています。アップグレード中はタスクを中断しません。タスク量の増加によるデータベースのボトルネックを心配する必要はありません。

### 1.7 CVMとMySQLの連携使用
通常、購入後にCVMとMySQLを合わせて使用する際は[CVMでMySQLにアクセス](https://intl.cloud.tencent.com/document/product/236/3130)をご参照ください。

## 2. 読み取り専用インスタンスを読み取り拡張として使用
よくあるインターネットタスクで、データベースの読み書き比率は通常4:1から10:1の間です。このタスクのケースでは、データベースの読み出し負荷は書き込み負荷よりもはるかに高くなります。性能のボトルネックが発生した場合の一般的な解決方法は読み取り負荷を増加させることです。
MySQL読み取り専用インスタンスは読み取り拡張ソリューションを提供します。[読み取り専用インスタンス](http://intl.cloud.tencent.com/document/product/236/7270)をご参照ください。
読み取り専用インスタンスは異なるタスクの読み取り専用アクセスにも応用できます。例えば、主インスタンスがオンラインタスクで読み書きアクセスを行っていると、読み取り専用インスタンスは内部タスクまたはデータ分析プラットフォームに読み取り専用クエリを提供します。

## 3. クラウドデータベースの災害復旧プラン
クラウドデータベースMySQLは[災害復旧インスタンス](https://intl.cloud.tencent.com/document/product/236/7272) を提供し、ワンクリックで都市をまたいだリモートデータベースの災害復旧の構築をサポートします。

災害復旧インスタンスを使用すると、複数のリージョン間の異なるデータセンターの相互冗長性を実現できます。1か所のデータセンターで故障が発生したか、または不可抗力の事由によりサービス提供ができないときに、その他のデータセンターに迅速に切り替えることができます。災害復旧インスタンスはTencentの内部ネットワーク専用ラインを使ってデータの同期をとっており、MySQLのカーネルレベルのコピーの最適化によって、災害下における同期レイテンシーがタスクにもたらす影響を可能な限り排除し、他リージョンでタスクロジックの準備が整った状況下では、秒単位で他の災害復旧に切り替えます。

## 4. 2リージョン、3か所のセンタープラン
クラウドデータベースMySQLの使用は、画面で簡単に数ステップ設定するだけで2リージョン、3センターのプランを実現できます。
- MySQLと同一都市の強制一致クラスターを購入し、[マルチアベイラビリティーゾーンのデプロイ](http://intl.cloud.tencent.com/document/product/236/8459)（グレースケール開放）を選択することで、1リージョン、2センターの能力を提供します。
- このクラスターは他リージョンでの災害復旧ノードを追加し、2リージョン、3センターの構造を実現できます。

## 5. 災害復旧インスタンスでユーザーに最寄りの接続を提供
災害復旧インスタンスはマスター、スレーブM-M（ダブルマスターフレームワーク）の高可用性構造を同様に備え、同時に読み取り専用アクセス能力を提供します。このため、クロスリージョンのユーザーが最寄りタスクに接続する必要があるケースでは、安心して災害復旧インスタンスをお使いいただけます。
