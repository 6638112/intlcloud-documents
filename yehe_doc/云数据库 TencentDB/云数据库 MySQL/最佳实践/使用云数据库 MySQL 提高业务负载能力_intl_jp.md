優れたパフォーマンスとスケーラビリティを備えたデータベースは、既存のシステムの負荷能力を迅速に向上させるのに役立ちます。同等のデータベース規模でMySQLを適切に使用すると、データベースの同時実行性を向上させ、タスクの毎秒アクセス数をより高めるのに貢献します。

## 1. 適切なデータベース設定を選択

### 1.1 データベースのバージョンを選択
TencentDB for MySQLは現在、ネイティブMySQLと完全に互換性のあるバージョン5.5、5.6、5.7、および8.0を提供しています。、5.6またはそれより高いバージョンの選択をお勧めします。これらはより安定したデータベースカーネルを有し、5.5およびこれより古いバージョンの設計を最適化してシステムパフォーマンスを向上させ、多くの新しい魅力ある特性を提供しています。

このドキュメントではMySQL 5.7を例に新バージョンの機能をご紹介します。MySQL 5.7は一般的に認められた性能の高さ、信頼性の高さ、使いやすさを有しています。優れた点と新しい特性は次の通りです。

- **ネイティブJSONサポート**
MySQL 5.7はデータタイプを新規追加し、MySQLテーブルにストレージしているJSONフォーマットのデータを使用するのに用います。ネイティブJSONサポートには主に以下の利点があります。
 - ドキュメントチェック：JSONルールに適合したデータセグメントのみ、タイプがJSONとして列に書き込まれます。そのため、自動でJSON言語をチェックするのと同じです。
 - 高効率アクセス：1つのJSONタイプの列にJSONドキュメントをストレージするとき、データは完全なテキストとしてストレージされることはありません。データは実際には最適化されたバイナリ形式でストレージされ、オブジェクトメンバーと配列要素にすばやくアクセスできます。
 - パフォーマンス向上：JSONタイプ列のデータにインデックスを作成してクエリのパフォーマンスを向上させることができます。この種のインデックスは仮想列に作成された「関数インデックス」を通じて実現できます。
 - 利便性：JSONタイプの列に添付されたインライン構文は、「機能」などのSQLステートメントのドキュメントクエリに自然に統合できます。「機能」はJSONフィールドです。
```
 SELECT feature->"$.properties.STREET" AS property_street FROM features WHERE id = 121254;
```
MySQL 5.7を使用すると、最適な関係とドキュメントの範例を1つのツールでシームレスに統合でき、異なるアプリケーションやユースケースで最適な範例を応用することができます。これによってアプリケーションの範囲が大幅に広がります。
- **SYS Schema**
MySQL SYS Schemaは一連のオブジェクト（ビュー、ストレージプロセス、ストレージ方法、テーブルとトリガー）からなるデータベーススキーマです。Performance SchemaおよびINFORMATION_SCHEMAの各種テーブルで監視データリソースをストレージし、便利で読みやすく、DBAおよび開発者は使いやすい方でアクセスできます。　　
MySQL SYS SchemaはMySQL 5.7にデフォルトで含まれており、概要ビューで以下に列挙したよくある問題にお応えします。
 - データベースサービスのすべてのリソースを何が占めていますか。
 - 最も頻繁にデータベースサーバーにアクセスするCVMインスタンスはどれですか。
 - インスタンスのメモリはどのように使用されますか。
- **InnoDB関連修正**
 - InnoDBのオンライン操作（Online DDL）：MySQLを再起動することなく、Buffer Pool sizeを動的に調整してビジネスニーズの変化に対応できます。現在、InnoDBもオンラインでInnoDBのUNDOログとテーブル空間を自動で消去することができます。これにより、大きな共有テーブルスペースファイル（ibdata1）のよくある問題の原因を解消してくれます。さらに、MySQL 5.7はインデックスの再命名とvarcharサイズの変更をサポートしています。この2つの操作は以前のバージョンではインデックスとテーブルを再作成する必要がありました。
 - InnoDB Native Partitioning： MySQL 5.7からは、InnoDB Native Partitioningがサポートされるようになります。InnoDB ネイティブパーティションは負荷を減らし、メモリ使用量を最大90％削減できます。
 - InnoDB バッファープールのプリフェッチ：MySQLが再起動すると、InnoDBはバッファープールで最もホットな上位のデータの25%を自動保存します。これにより、データキャッシュをプリロードまたはプリフェッチする必要がなくなり、MySQLの再起動によって性能が劣化することを心配する必要もありません。

MySQL 5.7のその他の最適化と新しい特性については、[MySQLの公式ドキュメント](https://dev.mysql.com/doc/refman/5.7/en/mysql-nutshell.html)をご参照ください。

### 1.2 インスタンス仕様を選択（データベースメモリ）
現在MySQLは単独のCPUオプションを提供しておりません。CPUはメモリ仕様を基に比率に応じて割り当てています。ご自身の業務の特徴に合わせて対応するデータベースの仕様をご購入いただけます。各インスタンスには詳細な標準化テストを実施し、マシン選択の際の性能比較に便宜を図っています。
ただし、以下の点にご注意ください。Sysbench標準化テストがすべてのビジネスシナリオを表しているわけではありません。MySQLでインスタンスを正式に稼働させる前にデータベースにストレステストを実施し、MySQLのお客様のビジネスシナリオでのパフォーマンスをよりよくご理解いただくことをお勧めします。 詳細については、[MySQL性能説明](https://intl.cloud.tencent.com/document/product/236/8842)をご参照ください。

メモリはインスタンスのコア指標の1つで、アクセス速度はディスクよりも遥かに速くなっています。通常では、メモリにキャッシュされるデータが多いほど、データベースの応答も速くなります。メモリが小さく、保存されたデータが一定量を超えた場合、過剰なデータがディスクに保存されます。新しいリクエストがこのデータに再度アクセスすると、データがディスクからメモリに読み込まれ、ディスクIOが消費され、データベースの応答は遅くなります。

**読み取りの同時実行数が多い、または読み取り遅延の影響を受けやすいビジネスでは、データベースの性能を維持するため、より高いメモリ仕様を選択することをお勧めします。**　　

### ハードディスクを選択（データストレージ容量）
TencentDB for MySQLインスタンスのディスク空間には、MySQLデータディレクトリしか含まれておらず、binlog、relaylog、undolog、errorlog、slowlogなどのログは含まれません。書き込まれたデータ量がインスタンスのディスク容量を超える時は、インスタンスがアップグレードされない場合、インスタンスがロックされることがあります。このため、ディスクを購入するときは、将来的なデータ量の増加を考慮に入れて、より大きなディスク容量を選択することをお勧めします。ハードディスクの容量不足からインスタンスのロックまたは頻繁なアップグレードがないようにします。　　　

### 1.4 適切なデータ複製モードを選択
TencentDB for MySQLは、同期、非同期、準同期の3種類のレプリケーションモードを提供します。詳細については、[データベースインスタンスのレプリケーションモード](http://intl.cloud.tencent.com/document/product/236/7913)をご参照ください。ビジネスが書き込みレイテンシやデータベースパフォーマンスに敏感な場合は、非同期レプリケーションモードを選択することをお勧めします。

### 1.5 TencentDBの高可用性
TencentDB for MySQLはマスター/スレーブM-M（マスター/マスターアーキテクチャ）の高可用性アーキテクチャを採用します。そのマスター、スレーブ間のデータ同期はbinlogを通じて実現されます。さらに、データベースは、バックアップとログに依存する過去の任意の時点にロールバックできます。このため、通常ではバックアップと復元システムの構築、またはその他の追加費用によってインスタンスの高可用性を確保する必要はありません。

### 1.6 TencentDBの拡張性
TencentDB for MySQLのデータベースバージョン、メモリ/ディスク仕様はいずれもオンラインの動的なホットアップグレードをサポートしています。アップグレード中はタスクを中断しません。タスク量の増加によるデータベースのボトルネックを心配する必要はありません。

### 1.7 CVMとMySQLの連携使用
通常、購入後にCVMとMySQLの両方を一緒に使用する必要があります。詳細については、[CVMからTencentDB for MySQLへのアクセス](https://intl.cloud.tencent.com/document/product/236/3130)をご参照ください。

## 2. 読み取り専用インスタンスを読み取り拡張として使用
よくあるインターネットベースのビジネスでは、データベースの読み取り/書き込みの比率は通常4:1から10:1の間です。このビジネスシナリオでは、データベースの読み取り負荷は書き込み負荷よりもはるかに高くなります。パフォーマンスのボトルネックが発生した場合の一般的な解決方法は読み取り負荷を増加させることです。
MySQL読み取り専用インスタンスは読み取り拡張ソリューションを提供します。詳細については、[読み取り専用インスタンス](http://intl.cloud.tencent.com/document/product/236/7270)をご参照ください。
読み取り専用インスタンスは異なるビジネスでの読み取り専用アクセスにも応用できます。例えば、マスターインスタンスがオンラインビジネスの読み取り/書き込みアクセスを行っていると、読み取り専用インスタンスは内部ビジネスまたはデータ分析プラットフォームに読み取り専用クエリを提供します。

## 3.  TencentDBの災害復旧計画
TencentDB for MySQLは、[ディザスタリカバリインスタンス](https://intl.cloud.tencent.com/document/product/236/7272) を提供し、データベースのリモート災害復旧をすばやく構築するのに役立ちます。

ディザスタリカバリインスタンスを使用すると、複数のリージョン間の異なるデータセンターの相互冗長性を実現できます。1か所のデータセンターで故障が発生したか、または不可抗力の事由によりサービス提供ができない場合、サービスを別のデータセンターにすばやく切り替えることができます。ディザスタリカバリインスタンスはTencentの内部ネットワーク専用ラインを使ってデータの同期をとっており、MySQLのカーネルレベルのコピーの最適化によって、災害下における同期レイテンシーがタスクにもたらす影響を可能な限り排除し、他リージョンでビジネスロジックの準備が整った状況下では、秒単位での災害復旧を実現できます。

## 4. 2-region-3-DCスキーム
TencentDB for MySQLの使用は、画面で簡単に数ステップ設定するだけで2リージョン、3センターのスキームを構成できます。
- MySQLと同一都市の強整合性クラスターを購入し、[マルチアベイラビリティーゾーンのデプロイ](http://intl.cloud.tencent.com/document/product/236/8459)（内部テスト中）を選択することで、1-region-2-DC能力を提供します。
- このクラスターはリモート災害復旧ノードを追加して、2-region-3-DCアーキテクチャを構築できます。

## 5. ディザスタリカバリインスタンスを使用して、ユーザーにローカルアクセスを提供
ディザスタリカバリインスタンスはマスター/スレーブM-M（マスター/マスターアーキテクチャ）の高可用性アーキテクチャを同様に備え、同時に読み取り専用アクセス能力を提供します。このため、クロスリージョンのユーザーが最寄りタスクにアクセスする必要があるケースでは、安心してディザスタリカバリインスタンスをお使いいただけます。
