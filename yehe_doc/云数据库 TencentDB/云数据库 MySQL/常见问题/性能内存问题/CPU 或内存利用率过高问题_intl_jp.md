### CPUの使用率が高すぎる
#### 原因
MySQLの使用中、CPUの使用率が高すぎて100％を超える時さえあるのは、データベースに低効率のSQL、または行ロックの競合が大量にあることに大きく関係します。通常は低効率のSQLが多くあることに起因します。行ロックの競合が出現する確率は非常に低いです。

#### リスク
MySQL CPUの使用率が長時間100％である場合、データベースの全体性能に甚大な影響が出て、極端な場合、インスタンスがHANGする状況が生じます。インスタンスHANGの状況をHAが検出してから、ユーザー業務の可用性が高まるように、マスターとスレーブを切り替えます。切り替え中に使用できない時が短時間生じることがあります。通常、インスタンスが使用できない状況は60秒以下です。タスクのピーク時にマスターとスレーブを切り替えると、タスクの安定性と連続性に影響します。
CPUリソース不足によるタスクへの影響を避けるために、CPU使用率が高いインスタンスを事前にタスク上で最適化するか、またはCPUリソースのアップグレードをお勧めします。インスタンスにマスター、スレーブの切り替えが生じたとき秒単位のシャットダウンが生じます。長時間接続のためにはアプリケーションに再接続機能を備えておく必要があります。

#### ソリューション
MySQL CPUの使用率が高すぎるのは、多くの場合SQLの効率が低いことと関係があり、基本的には低効率のSQLを最適化することで多くの問題を解決できます。
MMySQLスロークエリタイム（long_query_time）のデフォルト値は10sですが、性能問題が生じるとき、スロークエリタイムがない場合は、そのパラメータを1sに調整し、タスクサイクル内の同タイムを再度観察して最適化することをお勧めします。パラメータを調整しても、タスクサイクルに依然としてスロークエリタイムがあらわれず、CPU使用率が高い場合は、CPU設定をアップグレードしてデータベース全体の性能を向上させることをお勧めします。

### メモリ使用率が高い
#### 原因
クラウドデータベースMySQLのメモリは重要なパラメータ性能であって、SQLの低効率によるリクエスト、最適化待ちのデータベースによって、メモリ使用率が100％を超えるほど高くなることがよくあります。

#### リスク
低効率SQLリクエストおよび最適化待ちデータベースによってメモリの使用率が増加する問題は、MySQLの高可用性バージョンのデータベースを使用している場合、重大時にはメモリのOOMでマスター、スレーブを切り替えます。その切り替え中はタスクが短時間使用できません。インスタンスが使えない時間は通常では60秒以下です。タスクのピーク時にマスターとスレーブを切り替えると、タスクの安定性と連続性に影響します。
メモリ使用率が高いことによるタスクへの影響を回避するため、事前にメモリ使用率が高いインスタンスのタスクの最適化を図るか、メモリ領域のアップグレードをお勧めします。インスタンスにマスター、スレーブの切り替えが生じたとき秒単位のシャットダウンが生じます。長時間接続のためにはアプリケーションに再接続機能を備えておく必要があります。

#### ソリューション
MySQLのメモリは主にglobalクラスの共有メモリとsessionクラスのプライベートメモリの2つに分かれます。
- 共有メモリはインスタンス作成時に割り当てられたメモリ領域で、すべての接続を共有します。
- プライベートメモリはMySQLサーバーに接続するたびに、各自のキャッシュを割り当てるために使用します。
一部の特殊なSQLまたはフィールドタイプは単一のスレッドが複数のキャッシュに割り当てられるようにしています。このためOOM例外が生じるのは、接続したそれぞれのプライベートメモリが原因です。メモリ使用率が高くなるリスクは、データベース接続数の制限と低効率SQLを最適化することで低減されます。MySQLのメモリ使用率がまだ高い場合は、メモリ設定をアップグレードすることでデータベース全体の同時進行量と安定性を引き上げることができます。メモリパラメータの詳細は[メモリ割り当ての問題](https://intl.cloud.tencent.com/document/product/236/31922)をご参照ください。

>?
>- アップグレード中はタスクの正常使用に影響はありません。アップグレードの完了後に切り替え、わずかに秒単位のシャットダウンがある場合はタスクに再接続システムがあるか確認してください。
>- 現在、MySQLコンソールではメモリパラメータの修正をサポートしません。innodb_buffer_pool_sizeの設定が小さいと、ディスクへの書き込み負荷が大きすぎることにより、データベースの全体性能に影響を与えることがあります。
>- MySQLメモリまたはCPUリソースの不足がタスクの正常動作にもたらす影響を回避するために、現在のネットワークインスタンスにリソースのアラームポリシーを設定して、事前にリソース不足の問題を特定してください。詳細は[アラームサービス](http://intl.cloud.tencent.com/document/product/248/6126)をご参照ください。
