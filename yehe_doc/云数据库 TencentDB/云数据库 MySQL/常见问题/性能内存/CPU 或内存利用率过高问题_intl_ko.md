### CPU의 과도한 이용률
#### 원인
MySQL 사용 시 CPU 이용률이 과도하게 높거나 100%를 초과하는 경우, 데이터베이스의 저효율 SQL 또는 대량의 행 잠금 충돌과 밀접한 관련이 있습니다. 일반적으로 저효율 SQL로 인해 행 잠금 충돌이 일어날 확률은 매우 낮습니다.

#### 리스크
MySQL CPU 이용률이 100%인 상태로 장시간 유지되면 데이터베이스의 성능이 심각하게 저하될 수 있으며, 심한 경우 인스턴스가 정지될 수도 있습니다. HA가 인스턴스 정지를 감지하면 사용자 작업의 고가용성을 확보하기 위해 마스터/슬레이브 전환이 트리거됩니다. 마스터/슬레이브 전환 과정에서 일시적으로 인스턴스를 사용할 수 없는데, 시간은 보통 60초 이내입니다. 작업 피크 시간에 마스터/슬레이브 전환이 진행되면 작업의 안정성과 연속성에 심각한 영향을 끼칠 수 있습니다.
CPU 리소스 부족으로 인해 작업에 지장이 가지 않도록 CPU 이용률이 높은 인스턴스를 사전에 최적화하거나 CPU 리소스를 업그레이드하시길 권장합니다. 인스턴스의 마스터/슬레이브 전환 시 몇 초의 끊김이 발생할 수 있으므로, 장기간 연결을 위해 재연결 메커니즘이 가능한 애플리케이션을 구비하십시오.

#### 솔루션
MySQL CPU의 과도한 이용률은 대개 저효율 SQL과 관련이 있습니다. 따라서 저효율 SQL 최적화로 대부분의 문제를 해결할 수 있습니다.
MySQL 슬로우 쿼리 시간(long_query_time)의 기본값은 10s입니다. 성능 문제로 슬로우 쿼리가 작동하지 않으면 해당 매개변수를 1s로 입력한 뒤 작업 주기 동안 슬로우 쿼리를 다시 모니터링하여 최적화하십시오. 매개변수 조정 이후에도 작업 주기 동안 슬로우 쿼리가 작동하지 않고 CPU 이용률이 과도하게 높다면, CPU 설정을 업그레이드하여 데이터베이스 자체의 성능을 향상하는 것이 좋습니다.

### 메모리의 과도한 이용률
#### 원인
TencentDB for MySQL 메모리는 핵심 성능 매개변수입니다. 저효율 SQL 요청과 데이터베이스 최적화 작업 대기로 인해 이용률이 과도하게 높아지거나 100%를 초과하는 경우가 자주 발생합니다.

#### 리스크
저효율 SQL 요청 및 데이터베이스 최적화 작업 대기로 인해 메모리 이용률이 상승할 때, MySQL의 이중 노드와 3중 노드 데이터베이스 사용 시 심각할 경우 메모리 OOM을 트리거하여 마스터/슬레이브 전환이 일어날 수 있습니다. 마스터/슬레이브 전환 과정에서 일시적으로 인스턴스를 사용할 수 없는데, 시간은 보통 60초 이내입니다. 작업 피크 시간에 마스터/슬레이브 전환이 진행되면 작업의 안정성과 연속성에 심각한 영향을 끼칠 수 있습니다.
메모리의 이용률이 과도하게 높아 작업에 지장이 되지 않도록, 메모리 이용률이 높은 인스턴스를 사전에 최적화하거나 메모리 용량을 업그레이드하시길 권장합니다. 인스턴스의 마스터/슬레이브 전환 시 몇 초의 끊김이 발생할 수 있으므로, 장기간 연결을 위해 재연결 메커니즘이 가능한 애플리케이션을 구비하십시오.

#### 솔루션
MySQL 메모리는 global 레벨의 공유 메모리와 session 레벨의 전용 메모리로 구분합니다.
- 공유 메모리는 인스턴스 생성 시 할당되는 메모리 용량으로, 모든 연결이 공유합니다.
- 전용 메모리는 MySQL 서버 연결 시 할당되는 개별 캐시입니다.
일부 특수 SQL이나 필드는 단일 스레드가 캐시를 여러 번 할당하므로, OOM 이상 경고가 나타날 경우 그 원인은 각 연결의 전용 메모리에 있습니다. 데이터베이스 연결 수 제한 및 저효율 SQL 최적화를 통해 과도한 메모리 이용률로 인한 리스크를 낮출 수 있습니다. MySQL의 메모리 이용률이 여전히 높다면 메모리 설정 업그레이드를 통해 데이터베이스의 전체 동시 접속량을 늘리고 안정성을 향상시킬 수 있습니다. 메모리 매개변수에 대한 자세한 설명은 [메모리 할당 문제](https://intl.cloud.tencent.com/document/product/236/31922)를 참조하십시오.

>?
>- 업그레이드 중에도 정상적인 작업이 가능합니다. 단, 업그레이드 종료 후 전환 과정에서 몇 초의 끊김이 발생할 수 있으므로 재연결 메커니즘을 구비하시기 바랍니다.
>- 현재 MySQL 콘솔은 메모리 매개변수 수정 기능을 지원하지 않습니다. innodb_buffer_pool_size를 지나치게 작게 설정할 경우, 디스크 쓰기 부하가 높아져 데이터베이스의 성능이 저하될 수 있습니다.
>- MySQL 메모리 또는 CPU 리소스 부족으로 인해 정상적인 작업이 불가능한 상황을 방지하려면 현재 네트워크의 인스턴스에 적절한 리소스 알람 정책을 설정하십시오. 리소스 부족에 대한 잠재적 리스크를 미리 알 수 있습니다. 자세한 내용은 [알람 서비스](https://intl.cloud.tencent.com/zh/document/product/248/6126)를 참조하십시오.
