### CPU의 높은 사용률
#### 원인
MySQL 사용 시 CPU 사용률이 현저하게 높아 100%를 초과한 경우, 데이터베이스의 SQL 효율이 낮거나 행 잠금의 지나친 충돌로 인한 경우가 많습니다. 과도한 저효율 SQL이 행 잠금 충돌 확률을 낮추기 때문입니다.

#### 리스크
MySQL CPU 사용률이 장시간 100%에 이르면 데이터베이스의 성능이 저하될 수 있으며, 심한 경우 인스턴스가 정지될 수도 있습니다. HA가 인스턴스 정지를 감지하면 사용자 비즈니스의 고가용성을 확보하기 위해 마스터/슬레이브 스위치가 트리거됩니다. 마스터/슬레이브 스위치 과정에서 일시적으로 서비스를 사용할 수 없으나 인스턴스 미실행 시간은 통상 60초를 초과하지 않습니다. 비즈니스 피크 시점에 마스터/슬레이브 스위치의 발생으로 비즈니스의 안정성과 연속성이 떨어질 수 있습니다.
CPU 리소스 부족으로 인해 비즈니스에 지장이 가지 않도록 CPU 사용률이 높은 인스턴스에 대해 사전에 비즈니스 최적화를 하거나 CPU 리소스 업그레이드를 권장합니다. 인스턴스의 마스터/슬레이브 스위치로 몇 초의 끊김이 발생할 수 있으니 장기간 연결을 위해서는 재연결 메커니즘을 탑재한 애플리케이션을 구비하십시오.

#### 솔루션
MySQL CPU의 사용률이 높게 나타나는 것은 대개 SQL의 효율이 낮기 때문입니다. 따라서 저효율의 SQL 최적화로 대부분의 문제를 해결할 수 있습니다.
MySQL 슬로우 쿼리 시간(long_query_time)의 기본값은 10s입니다. 성능 문제가 발생하여 슬로우 쿼리가 작동하지 않으면 해당 매개변수를 1s로 입력한 뒤 비즈니스 주기에서 발생하는 슬로우 쿼리를 관찰하고 최적화하십시오. 매개변수 조정 이후에도 비즈니스 주기에서 슬로우 쿼리가 작동하지 않고 CPU 사용률이 높다면 CPU 설정 업그레이드를 통해 데이터베이스의 전체 성능을 향상시키는 것이 좋습니다.

### 메모리의 높은 사용률
#### 원인
TencentDB for MySQL 메모리는 핵심 성능 매개변수로, 저효율 SQL의 요청과 데이터베이스 최적화 작업 대기로 인해 사용률이 100% 이상으로 높아질 수 있습니다.

#### 리스크
저효율 SQL 요청 및 데이터베이스 최적화 작업 대기로 인해 메모리 사용률이 높아지면, 고가용성 버전 MySQL 데이터베이스를 사용할 경우 메모리 OOM을 트리거하여 마스터/슬레이브 스위치가 작동합니다. 마스터/슬레이브 스위치 과정에서 일시적으로 서비스를 사용할 수 없으나 인스턴스 미실행 시간은 통상 60초를 초과하지 않습니다. 비즈니스 피크 시점에 마스터/슬레이브 스위치의 발생으로 비즈니스의 안정성과 연속성이 떨어질 수 있습니다.
높은 메모리 사용률로 비즈니스에 지장이 가지 않도록 메모리 사용률이 높은 인스턴스에 대해 사전에 비즈니스 최적화를 하거나 메모리 용량을 업그레이드하십시오. 인스턴스의 마스터/슬레이브 스위치로 몇 초의 끊김이 발생할 수 있으니 장기간 연결을 위해서는 재연결 메커니즘을 탑재한 애플리케이션을 구비하십시오.

#### 솔루션
MySQL 메모리는 global 레벨의 공유 메모리와 session 레벨의 전용 메모리로 구분합니다.
- 공유 메모리는 인스턴스 생성과 동시에 할당되는 메모리 용량으로, 모든 액세스에 공유됩니다.
- 전용 메모리는 MySQL 서버 연결 시 할당되는 개별 캐시입니다.
일부 특수 SQL 또는 필드는 단일 스레드가 다수의 캐시를 할당해 OOM 오류가 발생할 수 있습니다. 이는 연결한 전용 메모리가 원인으로, 데이터베이스 연결 수 제한 및 저효율 SQL 최적화로 메모리 사용률의 과도한 상승 리스크를 낮출 수 있습니다. 그래도 MySQL의 메모리 사용률이 높다면 메모리 설정 업그레이드를 통해 데이터베이스의 전반적인 동시 접속량 및 안정성을 향상시킬 수 있습니다. 상세한 메모리 매개변수 설명은 [메모리 할당 문제](https://intl.cloud.tencent.com/document/product/236/31922)를 참조하십시오.

>?
>- 업그레이드 시에도 비즈니스를 정상적으로 이용할 수 있습니다. 단, 업그레이드 종료 후 변환 과정에서 몇 초 간의 끊김이 발생하므로 재연결 메커니즘을 구비하십시오.
>- 현재 MySQL 콘솔은 메모리 매개변수 수정 기능을 지원하지 않습니다. innodb_buffer_pool_size 설정이 지나치게 작은 경우 디스크 부하가 높아져 데이터베이스의 전체 성능이 저하될 수 있습니다.
>- 현재 네트워크의 인스턴스 구성 리소스에 알람 정책을 적용하면 리소스 부족을 사전에 인지할 수 있으므로 MySQL 메모리 또는 CPU 리소스 부족으로 인한 비즈니스 이용 장애를 방지할 수 있습니다. 자세한 내용은 [알람 서비스](http://intl.cloud.tencent.com/document/product/248/6126)를 참조하십시오.
