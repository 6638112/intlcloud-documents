### CPUの使用率が高すぎる
#### 原因
MySQLの使用中、CPUの使用率が高すぎて100％を超える時さえあるのは、データベースに非効率的なSQL文、または行ロックの競合が大量にあることに大きく関係します。通常は非効率的なSQL文が多くあることに起因します。行ロックの競合が出現する確率は非常に低いです。

#### リスク
MySQLのCPUの使用率が長時間100％である場合、データベースの全体性能に甚大な影響が出て、極端な場合、インスタンスがハングする場合があります。 HAモニターがこのような問題を検出すると、ユーザー業務の可用性が高まるように、マスターとスレーブを切り替えます。切り替え中に使用できない時が短時間生じることがあります。通常、インスタンスが使用できない状況は60秒以下です。ビジネスのピーク時にマスターとスレーブを切り替えると、ビジネスの安定性と継続性に影響します。
CPUリソース不足によるビジネスへの影響を避けるために、CPU使用率が高いインスタンスを事前に最適化するか、またはCPUリソースをアップグレードすることをお勧めします。マスターインスタンスとスレーブインスタンスを切り替えると、数秒間の短い中断が発生する場合があります。長時間接続のためにはアプリケーションに再接続機能を備えておく必要があります。

#### ソリューション
MySQLのCPUの使用率が高すぎるのは、多くの場合SQLの効率が低いことと関係があり、基本的には低効率のSQLを最適化することで多くの問題を解決できます。
MySQLスロークエリ時間（long_query_time）のデフォルト値は10sですが、パフォーマンスの問題が発生した後、スロークエリが見つからない場合は、そのパラメータ値を1sに調整し、ビジネスサイクルにスロークエリがあるかどうかを確認し、ある場合はそれに応じてスロークエリを最適化することをお勧めします。パラメータを調整した後、スロークエリが見つからないのにCPU使用率が高いままである場合は、データベースの全体的なパフォーマンスを向上させるためにCPU設定をアップグレードすることをお勧めします。

### メモリ使用率が高すぎる
#### 原因
メモリは、TencentDB forMySQLの重要なパフォーマンスパラメータです。非効率的なSQLの存在と最適化待ちのデータベースによって、メモリ使用率が100％を超えるほど高くなることがよくあります。

#### リスク
高可用性エディションのMySQLデータベースで上記の問題が発生した場合、マスター/スレーブの切替えをトリガーする可能性があります。その切り替え中はビジネスが短時間使用できません。インスタンスが使えない時間は通常では60秒以下です。ビジネスのピーク時にマスターとスレーブを切り替えると、ビジネスの安定性と継続性に影響します。
メモリ使用率が高いことによるビジネスへの影響を回避するため、事前にメモリ使用率が高いインスタンスを事前に最適化するか、メモリサイズを増やすことをお勧めします。マスターインスタンスとスレーブインスタンスを切り替えると、数秒間の短い中断が発生する場合があります。長時間接続のためにはアプリケーションに再接続機能を備えておく必要があります。

#### ソリューション
MySQLのメモリは主にグローバル共有メモリとセッションレベルのプライベートメモリの2つに分かれます。
- 共有メモリはインスタンス作成時に割り当てられたメモリ領域で、すべての接続を共有します。
- プライベートメモリは、MySQLサーバーへの接続時にシステムによって割り当てられます。
一部の特殊なSQLまたはフィールドタイプでは、キャッシュが単一のスレッドに繰り返し割り当てられる場合があります。したがって、すべてのOOM例外は、各接続のプライベートメモリによって発生します。データベース接続数を制限し、非効率的なSQLを最適化することで、メモリ使用率が高くなるリスクを軽減できます。MySQLのメモリ使用率がまだ高い場合は、メモリ設定をアップグレードすることでデータベース全体の同時実行性と安定性を向上させることができます。メモリパラメータの詳細については、[メモリ割り当ての問題](https://intl.cloud.tencent.com/document/product/236/31922)をご参照ください。　

>?
>- アップグレード中はビジネスの正常使用に影響はありません。アップグレードの完了後に切り替え、数秒間の短い中断が発生する場合があります。ビジネスに再接続メカニズムがあることを確認してください。
>- 現在、MySQLコンソールではメモリパラメータの修正をサポートしません。innodb_buffer_pool_sizeの設定が小さいと、ディスクへの書き込み負荷が大きすぎることにより、データベースの全体性能に影響を与えることがあります。
>- MySQLメモリまたはCPUリソースの不足がビジネスの正常動作にもたらす影響を回避するために、現在のネットワークインスタンスに適切なリソースアラームポリシーを設定してください。そうすることで、潜在的なリソース不足を事前に特定できます。詳細については、[アラームサービス](http://intl.cloud.tencent.com/document/product/248/6126)をご参照ください。
