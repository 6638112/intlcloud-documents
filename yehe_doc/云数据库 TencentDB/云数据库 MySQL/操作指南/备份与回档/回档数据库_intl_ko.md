## 작업 시나리오
TencentDB for MySQL은 사용자의 어떤 데이터도 수정하지 않으며, 사용자 개인의 이유로 데이터가 훼손되면 스스로 롤백하여 복구할 수 있습니다. 롤백 툴을 사용하여 Tencent Cloud 플랫폼의 데이터베이스 혹은 테이블을 롤백할 수 있으며, 롤백은 데이터 백업+로그 백업(binlog)을 기반으로 실시간 데이터를 롤백합니다.

TencentDB for MySQL 롤백은 이미지 및 실시간 흐름을 통해 주기적으로 재구축됩니다. CDB 혹은 테이블을 지정한 시간으로 롤백하며, 전체 데이터 시간 샤딩이 일치하도록 유지합니다. 롤백하는 동안에는 기존 데이터베이스 혹은 테이블의 액세스에 영향을 미치지 않으며, 롤백 작업 시 신규 데이터베이스 혹은 테이블이 기존 인스턴스에 생성됩니다. 롤백을 완료하면 사용자는 기존 데이터베이스 혹은 테이블, 새로 생성한 데이터베이스 혹은 테이블을 확인할 수 있습니다.


## 기능 원리
롤백은 최근의 '콜드 스탠바이 + 해당하는 binlog'를 기반으로 지정한 시간에 롤백합니다.
![](https://main.qcloudimg.com/raw/56699dba58319c212d93c38c6adabbae.png)
1. 콜드 스탠바이 시스템은 매일 MySQL 슬레이브의 데이터를 콜드 스탠바이 시스템으로 내보냅니다.
2. 롤백 시에는 먼저 롤백 시스템에서 롤백 인스턴스 하나를 신청한 다음, 콜드 스탠바이 시스템의 콜드 스탠바이 데이터를 내보내 임시 인스턴스(롤백 방식에 따라 다른 데이터를 가져옵니다)에 가져옵니다.
3. 롤백 인스턴스와 MySQL 마스터 인스턴스에 마스터/슬레이브 관계를 설정하고, 롤백할 시간과 DB 테이블을 설정합니다.
4. 롤백한 후의 DB 테이블을 MySQL 마스터 인스턴스에 복사합니다.

## 기능 제한
- 마스터 인스턴스만 롤백할 수 있으며, 읽기 전용 인스턴스와 재해 복구 인스턴스의 롤백은 지원하지 않습니다.
- 현재는 지정한 DB 테이블만 롤백할 수 있으며, 롤백한 후의 DB 테이블은 원래의 인스턴스(이름 변경해야 함)로 다시 입력됩니다. 또한, 전체 인스턴스 롤백은 지원하지 않습니다.

## 주의 사항
- 롤백 기능은 자동 백업 설정의 백업 주기, 보관 일수와 관련되어, 보관 일수와 백업 주기 내의 데이터 백업+로그 백업(binlog) 롤백을 제공합니다. 백업 주기 설정에 관한 내용은 [MySQL 데이터 자동 백업](https://intl.cloud.tencent.com/document/product/236/37796)을 참조 바랍니다. 데이터 보안을 위해 자동 백업 설정의 백업 주기는 일주일에 최소 2회 MySQL 백업으로 설정합니다.
- 롤백할 DB 테이블이 존재하지 않거나 삭제되었다면, 먼저 데이터베이스에 로그인하여 DB 테이블을 생성한 다음, 콘솔에서 다시 롤백해야 합니다.
- 롤백 이전의 콜드 스탠바이 백업에 해당 테이블이 없다면 재해 복구에 실패합니다.

## 작업 순서

1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인한 후, Instance List에서 롤백할 하나 혹은 그 이상의 인스턴스를 선택하고, [더 많은 조작>[롤백]을 선택합니다.
>?
>- 하나의 인스턴스만 롤백할 경우, 인스턴스 관리 페이지 오른쪽 상단의 [롤백]을 클릭합니다.
>- 한 APPID에서는 롤백 작업을 5개까지 동시에 요청할 수 있습니다.
>
![](https://main.qcloudimg.com/raw/85f08362342f02fb27ded34a487b4090.png)
2. 롤백 페이지에서 롤백 DB 테이블을 선택하고, [Next step: set the rollback time and database table name]을 클릭합니다.
   - 	일반: 해당 인스턴스의 백업 전량을 가져온 다음, 선택한 라이브러리 및 테이블을 롤백합니다. 해당 롤백 모드는 무제한이지만, 롤백 속도가 다소 느릴 수 있습니다.
   - 	고속: 전량 백업+라이브러리 레벨별 binlog, 서로 다른 DB 간의 작업이 있는 상황에서 관련 DB를 동시에 선택하지 않으면 롤백에 실패하게 됩니다.
   - 	초고속: 전량 백업+테이블 레벨별 binlog, 서로 다른 테이블 간의 작업이 있는 상황에서 관련 테이블을 동시에 선택하지 않으면 롤백에 실패하게 됩니다.
>?
>- 현재는 이름이 숫자, 알파벳, 언더바로 구성된 DB 테이블만 롤백할 수 있습니다. DB 테이블 이름에 다른 특수 문자가 있다면 롤백할 수 없습니다.
>- 지정한 DB 테이블 롤백 모드에서 한 인스턴스는 라이브러리 혹은 테이블을 500개까지만 동시에 롤백할 수 있습니다.
>- 롤백 시 binlog를 실행할 때, 다른 DB 테이블이 포함되어 복합적인 작업이 되면 SQL 명령이 실패할 수 있습니다.
>- 롤백 시 binlog를 실행할 때, 테이블에 외래 키 등의 제약이 발생하면 SQL 명령이 실패할 수 있습니다.
>
![](https://main.qcloudimg.com/raw/6cb2fa4d3e8b0d795bd5bf19f8d69d86.png)
3. 롤백한 후의 DB 테이블 이름과 롤백 시간을 설정하고 [롤백]을 클릭합니다.
>?
>- 각 인스턴스에 롤백 시간은 하나만 설정할 수 있습니다.
>- 일괄 롤백 시간을 설정하면, 모든 DB 테이블에 일괄 롤백 시간이 적용됩니다.
>- 단일 테이블 롤백 시간을 설정하면, DB 테이블에 각각 설정한 롤백 시간이 적용됩니다.
>- 롤백한 후의 DB 테이블 이름은 64비트 이내의 영어, 숫자, 소수점(.), 붙임표(-), 언더바(\_), $로만 구성될 수 있습니다.
>
![](https://main.qcloudimg.com/raw/62377981b147bdb453d79631b3557d12.png)
5. 제출에 성공하면 [작업 로그]>[롤백 로그] 페이지로 돌아가 롤백 진행 상황을 확인할 수 있으며, [상세 보기]를 클릭하여 실시간 롤백 로그를 조회할 수 있습니다.
![](https://main.qcloudimg.com/raw/b5206b3c23d532553fb54dfc4fe7bfd0.png)
6. 롤백을 완료하면 [데이터베이스 관리]>[데이터베이스 리스트] 페이지의 기존 인스턴스에서 롤백한 DB 테이블을 확인할 수 있습니다.
![](https://main.qcloudimg.com/raw/9b939d9a6a7da59092df0051f452b5cd.png)

