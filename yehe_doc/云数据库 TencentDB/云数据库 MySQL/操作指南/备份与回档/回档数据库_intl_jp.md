
## 操作シナリオ
TencentDB for MySQLがユーザーのデータを変更することは一切ありません。ユーザーの個人的な理由によるデータの破損は、ロールバックを行って修復することができます。ロールバック機能を使用して、Tencent Cloudプラットフォームのデータベースまたはテーブルに対してロールバック操作を行うことができます。ロールバックはデータバックアップ + ログバックアップ（binlog）に基づき、リアルタイムにデータのロールバックを行うことができます。

TencentDB for MySQLのロールバックは、定期的なミラーリングとリアルタイムのフロー再構築により、クラウドデータベースまたはテーブルを指定した時間にロールバックし、すべてのデータのタイムスライスが一致することを保証することができます。その間、元のデータベースまたはテーブルのアクセスは影響を受けません。ロールバック操作により、新しいデータベースまたはテーブルが元のインスタンスに生じます。ロールバック完了後、ユーザーは元のデータベースまたはテーブル、および新しいデータベースまたはテーブルを確認することができます。

## 機能原理
ロールバックは、直近のコールドバックアップ+ 対応するbinlogに基づき、指定された時点にロールバックします。
![](https://main.qcloudimg.com/raw/56699dba58319c212d93c38c6adabbae.png)

1. コールドバックアップシステムは、MySQL待機マシンからコールドバックアップシステムに、毎日データをエクスポートします。
2. ロールバック時は、まずロールバックシステムから1台のロールバックインスタンスを申請し、次にコールドバックアップシステムからコールドバックアップデータをエクスポートし、それを臨時インスタンスへインポートします（ロールバック方式により異なるデータをインポート）。
3. ロールバックインスタンスとMySQLマスターインスタンスはマスター/バックアップ関係を構築します。ロールバックを行う時間とデータベーステーブルを設定します。
4. ロールバック後のデータベーステーブルをMySQLマスターインスタンスにコピーします。

## 機能制限
- マスターインスタンスのロールバックのみサポートし、読み取り専用インスタンスおよびディザスタリカバリインスタンスはサポートしていません。
- 現在、指定したデータベーステーブルのロールバックのみサポートし、ロールバック後のデータベーステーブルはソースインスタンス（リネームが必要）に書き戻されます。インスタンス全体のロールバックはサポートしていません。

## 注意事項
- ロールバック機能は、自動バックアップに設定されたバックアップサイクルと保持日数に関連付けられ、保持日数に基づき、バックアップサイクル内のデータバックアップ + ログバックアップ（binlog）のロールバックを提供します。バックアップサイクルの設定については、[MySQLデータの自動バックアップ](https://intl.cloud.tencent.com/document/product/236/37796)をご参照ください。データの安全性を確保するために、自動バックアップに設定されたバックアップサイクル中は、1週間に少なくとも2回以上MySQLをバックアップするように設定してください。
- ロールバックが必要なデータベーステーブルが存在しないか、または誤って削除された場合は、まずデータベースにログインし、データベーステーブルを作成してから、コンソールを使用してロールバックする必要があります。
- ロールバック前のコールドバックアップにこのテーブルがない場合、ディザスタリカバリは失敗する恐れがあります。

## 操作手順
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストで、ロールバックが必要な1つまたは複数のインスタンスを選択し、「操作」列の【更なる操作】>【ロールバック】を選択します。
>?
>- ロールバックするインスタンスが1つのみの場合は、インスタンス管理画面に進み、右上隅の【ロールバック】をクリックします。
>- 同一のAPPIDで、同時に5回のロールバックタスクを行うことができます。
>
2. ロールバック画面で、ロールバックデータベーステーブルを選択し、【次へ：ロールバック時間の設定とデータベーステーブル名】をクリックします。
   - 	普通：このインスタンスのフルバックアップをインポートし、選択中のデータベース、テーブルをロールバックします。このロールバックモードに制限はありませんが、ロールバックの速度は遅めです。
   - 	高速：フルバックアップ+データベースレベルのbinlog。データベースをまたがる操作があり、かつ関連するデータベースが同時に選択されていない場合、ロールバックが失敗することがあります。
   - 	超高速：フルバックアップ+テーブルレベルのbinlog。テーブルをまたがる操作があり、かつ関連するテーブルが同時に選択されていない場合、ロールバックが失敗することがあります。
>?
>- 数字、アルファベット、アンダーラインおよびその組み合わせを名称とするデータベーステーブルのロールバックのみを、現在サポートしています。その他の特殊文字をデータベーステーブル名に使用することは、現時点ではサポートしていません。
>- 指定したデータベーステーブルをロールバックできるモードでは、同一インスタンスで500個までのデータベースまたはテーブルを同時にロールバックすることができます。
>- ロールバックがbinlogを実行する時に、その他のデータベーステーブルの複合操作に関わる場合、SQLステートメントが失敗することがあります。
>- ロールバックがbinlogを実行する時に、テーブルが外部キーなどの制約に関わる場合、SQLステートメントが失敗することがあります。
>
![](https://main.qcloudimg.com/raw/6cb2fa4d3e8b0d795bd5bf19f8d69d86.png)
3. ロールバック後のデータベーステーブル名およびロールバック時間を設定し、【ロールバック】をクリックします。
>?
>- インスタンスごとに1つのロールバック時間のみ設定できます。
> - 一括ロールバック時間の設定を選択した場合、すべてのデータベーステーブルは一括ロールバック時間を基準とします。
> - 単一テーブルのロールバック時間の設定を選択した場合、データベーステーブルはそれぞれ設定したロールバック時間を基準とします。
>- ロールバック後のデータベーステーブル名は、64桁以内の英文字、数字、小数点（.）、ハイフン（-）、アンダーライン（\_）、$のみをサポートします。
>
![](https://main.qcloudimg.com/raw/62377981b147bdb453d79631b3557d12.png)


4. 送信成功後、【操作ログ】>【ロールバックログ】画面に戻り、ロールバックの進捗状況を確認できます。【詳細の表示】をクリックすると、リアルタイムにロールバックログを確認できます。
![](https://main.qcloudimg.com/raw/b5206b3c23d532553fb54dfc4fe7bfd0.png)

5. ロールバック完了後、【データベース管理】>【データベースリスト】画面を選択すると、元のインスタンス中にロールバック後の新しいデータベーステーブルを見ることができます。
![](https://main.qcloudimg.com/raw/9b939d9a6a7da59092df0051f452b5cd.png)

