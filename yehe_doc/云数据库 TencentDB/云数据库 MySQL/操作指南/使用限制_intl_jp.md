## データ量制限
リソースの有限性から、ユーザーの性能に影響しないように、TencentDB for MySQLは各種タイプのMySQLインスタンスにデータ量制限を設けました。このドキュメントでは、大量のデータ数におけるMySQLの単一インスタンスおよび単一テーブルの使用による影響について技術的な角度からご紹介します。

**データ量の多いインスタンス**：クラウドデータベースのデフォルトのストレージエンジンはInnoDBです。インスタンスのデータおよびインデックスページがいずれもInnoDBのcache、bufferにキャッシュされるとき、MySQLインスタンスは大規模な同時アクセスをサポートできます。インスタンスに含まれているデータが多すぎる場合、cache、bufferのデータが頻繁に出し入れされて、MySQLのパフォーマンスボトルネックが即座にIOに転送され、アクセス処理量が大幅に低下します（例：あるクラウドデータベースインスタンスは本来8000回／秒のアクセスをサポートできる、データ量がcache、bufferの大きさの倍になると、700回／秒前後のアクセスしかサポートできなくなる）。


**データ量の多いテーブル**：単一テーブルに含まれるデータが多すぎる場合、単一テーブルリソースへのMySQLは管理コスト（データ、インデックスなど）が変更され、テーブルの処理効率に直接影響します。例えば、1つのトランザクションテーブル（InnoDB）のデータ量が5GBに達してからは、更新操作のレイテンシは明らかに増大します。タスクの反応時間に直接影響し、そうなった場合、分割したテーブルをマイグレーションしてこの問題を緩和するしかなくなります。


>単一インスタンスのテーブル数量が100万個を超過すると、テーブルのバックアップ、監視、アップグレードに失敗することがあります。同時にデータベースの監視にも影響します。テーブル数を適切に規定し、単一インスタンステーブル数が100万個を超えないよう制御してください。

## 接続数の制限
MySQLインスタンスへの最大接続数は、MySQLのシステム変数max_connectionsで指定されます。MySQLインスタンス接続数がmax_connectionsを超えると、新しい接続はできなくなります。
クラウドデータベースのデフォルトでの接続数は[コンソール](https://console.cloud.tencent.com/cdb)のパラメータ設定画面で確認できます。ユーザーはニーズに応じてmax_connectionsの値を自分で調整できます。しかし、接続数が増えれば、システムリソースは消費されていきます。接続数が実際のシステムの負荷許容能力の範囲を超えると、システムサービスの質に必ず影響します。
max_connectionsの詳細については、[MySQL公式ドキュメント](https://dev.mysql.com/doc/)をご参照ください。

## MySQLクライアントバージョンの制限
CVMシステムに付属したMySQLクライアント端末とlibライブラリを使用して、TencentDBインスタンスに接続することをお勧めします。

### スロークエリについての説明
- Linux CVMを使用する開発者は、クラウドデータベースのエクスポートツールからスロークエリログを取得することができます。詳細については、 [バックアップファイルとログのダウンロード](https://intl.cloud.tencent.com/document/product/236/31910)をご参照ください。
- Windows CVMを使用する開発者は、現在一時的に、スロークエリログを直接取得できません。必要な場合は、[チケットを提出](https://console.cloud.tencent.com/workorder/category)し弊社に連絡のうえスロークエリログファイルを取得してください。

### クラウドデータベースのbinlog保存期間の説明
TencentDB for MySQLのbinlogファイルは7日～732日まで保存できます。デフォルトでは7日です（自動バックアップ設定で日数を設定できます）。ログバックアップ日数はデータバックアップ日数以下でなければいけません。 
binlogは保存時間が長すぎるか、または増加が速すぎると、バックアップ領域が大きくなり、バックアップ領域がシステムが割り当てた領域を一旦超えてしまうと、追加のバックアップ領域費用が生じることがあります。

### 文字セットの説明
クラウドデータベースとMySQLデータベースは同じで、デフォルトの文字セットエンコーディング形式はLATIN1、つまりISO-8859-1コードフォーマットです。
クラウドデータベースはデフォルト文字セットエンコーディングの設定をサポートしますが、テーブル作成時にはテーブルのコードを明確に指定し、接続時には接続コードを指定することをお勧めします。そうすることで、アプリケーションの移植性がより良くなります。
MySQL文字セットの関連リソースについては、[MySQL公式ドキュメント](https://dev.mysql.com/doc/)をご参照ください。

クラウドデータベースの文字セットを変更する手順は次のとおりです。
1. 以下のステートメントを実行して、TencentDBインスタンスのデフォルトの文字セットエンコーディングを変更できます。
```
SET @@global.character_set_client = utf8;
SET @@global.character_set_results = utf8;
SET @@global.character_set_connection = utf8;
SET @@global.character_set_server = utf8;
```
ステートメントの実行後、このうちの@@global.character_set_server 等は、約10分で永続化のためにローカルファイルに自動的に同期されますが、他の3つの変数は同期されません。設定された値は、移行または再起動後も変更されません。
2. 以下のステートメントを実行することで現在接続している文字セットエンコーディングを変更できます。
```
SET @@session.character_set_client = utf8;
SET @@session.character_set_results = utf8;
SET @@session.character_set_connection = utf8;
```
または
```
SET names utf8;
```
3. PHPプログラムについて、以下の関数によって現在接続している文字セットエンコーディングを設定できます。
```
bool mysqli::set_charset(string charset);
```
または
```
bool mysqli_set_charset(mysqli link, string charset);
```
4. Javaプログラムについては、以下の方式によって現在接続している文字セットエンコーディングを設定できます。
```
jdbc:mysql://localhost:3306/dbname?useUnicode=true&characterEncoding=UTF-8
```

### 操作制限
1. MySQLインスタンスが有するアカウント情報と権限は修正しないでください。修正すると、一部のクラスターサービスが利用できなくなる場合があります。
2. データベースとテーブルを作成するときは、InnoDBエンジンを統一して使用することをお勧めします。これにより、高アクセスサポートの能力面でインスタンスのパフォーマンスが良くなります。
3. マスターとスレーブの関係を変更または終了しないでください。この操作をした場合、ホットバックアップを失効させる恐れがあります。

### テーブル名の制限
中国語によるテーブル名はサポートしていません。テーブル作成時には注意してください。中国語によるテーブル名の場合、ロールバック、アップグレードなどのフローが失敗することがあります。

## 注意事項
### データベースアカウントの権限
TencentDB for MySQLは、スーパーユーザー権限を提供しなくなりました。 スーパーユーザー権限が必要になって、初めて修正するパラメータは[コンソール](https://console.cloud.tencent.com/cdb)のパラメータ設定機能および[チケット提出](https://console.cloud.tencent.com/workorder/category)2種類の方式で修正できます。


### ネットワークの選択
VPCを使用することをお勧めします。VPCでは、ネットワークセグメントのパーティション、IPアドレスおよびルーティングポリシーをカスタマイズすることができます。基本ネットワークに比べると、VPCはカスタムネットワーク構成が必要なシナリオに適しています。VPCおよび基本ネットワークの比較については[ネットワークの管理](https://intl.cloud.tencent.com/document/product/215/31807)をご参照ください。

