MySQL 인스턴스에 연결할 수 없는 문제가 발생한다면, 어떻게 해결해야 하나요?
본 문서는 연결 불가에 관련된 시나리오와 그에 맞는 솔루션을 소개합니다.

<span id = "wfljcjwt"></span>
## 연결 불가 관련 시나리오
### 네트워크 유형 불일치
CVM 인스턴스와 MySQL 인스턴스의 네트워크 유형이 다른 경우 CVM에서 내부 네트워크를 통해 MySQL 인스턴스에 연결할 수 없습니다.

#### CVM 인스턴스는 사설 네트워크(VPC), MySQL 인스턴스는 기본 네트워크를 사용할 경우
- **솔루션1(추천)**: MySQL 인스턴스의 기본 네트워크를 VPC로 변경합니다. 자세한 내용은 [네트워크 변경](https://intl.cloud.tencent.com/document/product/236/31915)을 참조 바랍니다.
>!
>- 변경한 후에는 두 인스턴스 모두 동일한 VPC 네트워크에 있어야만 내부 네트워크로 통신할 수 있습니다.
>- 기본 네트워크를 VPC 네트워크로 변경한 후에는 다시 되돌릴 수 없습니다.
>- VPC 네트워크 연결은 변경 즉시 적용되며, 24시간 후에 기존의 액세스 IP는 유효하지 않게 되도록 기본 설정되어 있습니다. 기존 IP 주소의 회수 시간을 0시간으로 설정하면 네트워크 변경 후 바로 회수되므로, 해당 인스턴스와 관련된 인스턴스와의 연결을 확보하기 위해 관련 인스턴스를 바로 VPC 네트워크로 이동하시기 바랍니다.
- **솔루션2**: 기본 네트워크인 CVM 인스턴스를 재구매합니다(CVM 인스턴스는 VPC에서 기본 네트워크로의 마이그레이션을 지원하지 않음). 단, 기본 네트워크보다 VPC가 더 안전하므로, VPC 네트워크를 사용하시길 권장합니다.

- **솔루션3**: CVM 인스턴스에서 MySQL 인스턴스의 외부 네트워크 연결 주소를 사용하여 MySQL 인스턴스에 연결합니다. 이런 방식은 성능, 보안성, 안정성이 모두 좋지 않으므로, VPC 네트워크를 사용하시길 권장합니다.

#### CVM 인스턴스는 기본 네트워크, MySQL 인스턴스는 사설 네트워크(VPC)를 사용할 경우
- **솔루션1(추천)**: CVM 인스턴스를 기본 네트워크에서 VPC 네트워크로 마이그레이션합니다. 자세한 작업 방식은 [VPC 서비스 전환](https://intl.cloud.tencent.com/document/product/213/20278)을 참조 바랍니다.
>!  
>- 변경한 후에는 두 인스턴스 모두 동일한 VPC 네트워크에 있어야만 내부 네트워크로 통신할 수 있습니다.
>- 마이그레이션하기 전에 내부/외부 네트워크의 CLB 및 ENI를 수동으로 바인딩 해제하고, 주 ENI의 보조 IP를 릴리스한 다음 마이그레이션 후 다시 바인딩하시기 바랍니다.
>- 마이그레이션 과정 중 인스턴스를 재시작해야 하므로 다른 작업은 진행하지 마시길 바랍니다.
>- 마이그레이션 후 인스턴스의 실행 상태, 내부 네트워크 연결 및 원격 로그인이 정상적으로 작동하는지 확인합니다.
>- 기본 네트워크를 VPC 네트워크로 변경한 후에는 다시 되돌릴 수 없으며, CVM을 VPC 네트워크로 변경한 후에는 다른 기본 네트워크의 클라우드 서비스와 통신할 수 없습니다.
- **솔루션2**: [클래식 네트워크 사용하기](https://intl.cloud.tencent.com/document/product/215/31807)

- **솔루션3**: CVM 인스턴스에서 MySQL 인스턴스의 외부 네트워크 연결 주소를 사용하여 MySQL 인스턴스에 연결합니다. 이런 방식은 성능, 보안성, 안정성이 모두 좋지 않으므로, VPC 네트워크를 사용하시길 권장합니다.

<span id = "dybt"></span>
### 리전 불일치
CVM 인스턴스와 MySQL 인스턴스가 동일한 VPC 네트워크를 사용하고 있어도, 리전이 서로 다르면 CVM 인스턴스를 내부 네트워크를 통해 MySQL 인스턴스에 바로 연결할 수 없습니다.

- **솔루션1**: MySQL 인스턴스와 동일한 계정을 사용하고, 같은 리전 내에서 VPC가 동일한 CVM 인스턴스로 연결을 진행합니다.

- **솔루션2**: CVM 인스턴스에서 MySQL 인스턴스의 외부 네트워크 연결 주소를 사용하여 MySQL 인스턴스에 연결합니다. 이런 방식은 성능, 보안성, 안정성이 모두 좋지 않으므로, VPC 네트워크를 사용하시길 권장합니다.

<span id = "sywlbt"></span>
### VPC 불일치
기본적으로 CVM 인스턴스와 MySQL 인스턴스의 네트워크 유형이 모두 VPC 네트워크이고, 양자 모두 동일 VPC 네트워크에 있어야만 내부 네트워크로 통신할 수 있습니다. 만약 VPC가 다를 경우 다음의 솔루션으로 문제를 해결할 수 있습니다.
- **솔루션1(추천)**: MySQL 인스턴스를 CVM 인스턴스가 위치한 VPC 네트워크로 마이그레이션합니다. 자세한 내용은 [네트워크 변경](https://intl.cloud.tencent.com/document/product/236/31915)을 참조 바랍니다.
- **솔루션2**: 두 VPC 네트워크 사이에 [피어링 연결]https://intl.cloud.tencent.com/document/product/553)을 합니다.
위의 솔루션을 사용하지 않는다면, 서로 다른 VPC 네트워크에 있는 CVM과 MySQL은 공용 네트워크를 통해서만 통신할 수 있습니다. 이런 방식은 성능, 보안성 및 안정성이 떨어집니다.

<span id = "aqzpzyw"></span>
### 보안 그룹 설정 오류
CVM 인스턴스 및 MySQL 인스턴스의 보안 그룹 설정에 오류가 있다면, 내부 또는 외부 네트워크를 통해 CVM 인스턴스를 MySQL 인스턴스에 바로 연결할 수 없습니다.

#### CVM 인스턴스의 보안 그룹 설정 오류
CVM 인스턴스를 통해 MySQL 인스턴스에 연결하고 싶다면, CVM의 보안 그룹에 Outbound rule을 설정해야 합니다. **Outbound rule의 타깃 설정이 0.0.0.0/0이 아니고 프로토콜 포트가 ALL이 아니라면** MySQL 인스턴스의 IP 및 포트를 아웃바운드 규칙에 추가해야 합니다.
1. [보안 그룹 콘솔](https://console.cloud.tencent.com/cvm/securitygroup)에 로그인하고, 보안 그룹명을 클릭하여 CVM에 바인딩된 보안 그룹의 상세 페이지로 이동합니다.
2. [Outbound rule] 페이지를 선택하고, [Add a Rule]을 클릭합니다.
'Type'은 MySQL(3306)을 선택하고, 'Target'에는 MySQL의 IP 주소(세그먼트)를 입력한 다음, 'Policy'에는 Allow를 선택합니다.

#### MySQL 인스턴스의 보안 그룹 설정 오류
지정된 CVM 인스턴스를 MySQL 인스턴스에 연결하려면 MySQL 인스턴스의 보안 그룹에 인바운드 룰을 설정해야 합니다. **인바운드 룰의 원본 설정이 0.0.0.0/0이 아니고 프로토콜 포트가 ALL이 아니라면** CVM 인스턴스의 IP 및 포트를 인바운드 룰에 추가해야 합니다. 
1. [보안 그룹 콘솔](https://console.cloud.tencent.com/cvm/securitygroup)에 로그인하고, 보안 그룹명을 클릭하여 MySQL 인스턴스에 바인딩된 보안 그룹의 상세 페이지로 이동합니다.
2. [Inbound rule] 페이지를 선택하고, [Add a Rule]을 클릭합니다.
액세스를 허용할 IP 주소(세그먼트) 및 개방이 필요한 포트 정보(MySQL 내부 네트워크 포트)를 입력하고, 포트 개방을 허용합니다.
'Type'은 MySQL(3306)을 선택하고, 'Source'는 CVM의 IP 주소(세그먼트)를 입력한 다음, 'Policy'에는 Allow를 선택합니다.
>!  
>- MySQL 내부 네트워크의 기본 포트는 3306이지만, 그와 동시에 사용자 정의 포트도 지원합니다. 기본 포트 번호를 수정했다면, 보안 그룹에서 MySQL의 새로운 포트 정보를 다시 개방해야 합니다.
>- 보안 그룹의 인바운드 룰은 MySQL 인스턴스의 3306 포트를 개방해야 합니다.

<span id = "sjkzhzjpzyw"></span>  
### 데이터베이스 계정 호스트 설정 오류
데이터베이스 계정에 구체적인 호스트 주소를 지정했다면 다른 주소로는 MySQL 인스턴스에 연결할 수 없습니다.

TencentDB for MySQL 콘솔에서 데이터베이스 계정이 승인한 호스트 주소를 수정하면 데이터베이스에 대한 연결을 제한하여 연결 보안을 향상할 수 있습니다.

1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인한 뒤, 인스턴스 리스트에서 인스턴스 이름 혹은 '작업' 열의 [관리]를 클릭하여 인스턴스 관리 페이지로 이동합니다.
2. [데이터베이스 관리]>[계정 관리] 페이지에서 호스트를 수정할 계정을 찾은 다음, '작업' 열에서 [더 보기]>[호스트 수정]을 선택합니다.
3. 팝업된 호스트 수정 대화 상자에서 새로운 호스트 주소를 입력하고, [확인]을 클릭하면 계정이 승인한 호스트 주소가 즉시 수정됩니다.
>?호스트 주소는 IP 형식의 주소를 지원하며, %(IP 범위를 제한하지 않음을 의미)값의 입력도 지원합니다. 여러 호스트는 구분 문자로 구분하며, 구분 부호, 줄 바꿈 부호, 스페이스 및 '; , |' 를 지원합니다.
> - 예시1: %는 IP 범위를 제한하지 않으며, 모든 IP 주소의 클라이언트가 해당 계정으로 데이터베이스에 연결하도록 허용함을 의미합니다.
> - 예시2: 10.5.10.%를 입력하는 건 IP 범위가 10.5.10.% 내인 클라이언트만 해당 계정을 사용하여 데이터베이스에 연결할 수 있음을 의미합니다.


<span id = "wllxvpdff"></span>
## 네트워크 유형/VPC 판단 방법
내부 네트워크 주소를 통해 CDB에 연결하려면, CVM과 MySQL의 계정이 동일해야 하고, 동일한 VPC 내(동일한 리전)에 있거나 기본 네트워크가 동일해야 합니다.
>?
> CVM과 MySQL의 계정이 동일해야 합니다.
>- 인스턴스 리스트의 '네트워크' 필드에 모두 '기본 네트워크' 또는 'VPC'라고 표시되면, CVM 및 MySQL의 네트워크가 동일한 유형임을 의미합니다.
>- 인스턴스 리스트의 '네트워크' 필드에 모두 동일한 'VPC'(동일한 리전 보장)가 표시되면, CVM 및 MySQL가 동일한 VPC임을 의미합니다.
>
- **CVM 네트워크 유형/VPC 조회**: [CVM 콘솔](https://console.cloud.tencent.com/cvm/instance)에 로그인하여, 인스턴스 리스트에서 '네트워크'를 조회합니다.
![](https://main.qcloudimg.com/raw/ce2550045bc286172f841f4fcceb0cc4.png)
- **MySQL 네트워크 유형/동일 VPC 조회**: [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인하여, 인스턴스 리스트에서 '네트워크'를 조회합니다.
![](https://main.qcloudimg.com/raw/2cc5396f1b3f8af2028d75ae642a5126.png)

