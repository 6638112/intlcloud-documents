## 機能の説明
この機能は主にデータファイルの大きなテーブルを削除し、IOのジッターを防止するために用いられます。

DROP TABLEは、元のデータベースファイル(.ibd)を新しい臨時ファイルに再命名して、成功が返されます。臨時ファイルはinnodb_async_drop_tmp_dirにより指定されるディレクトリに保存され、バックグラウンドでバッチでtruncateします。truncateされるファイルサイズはinnodb_async_truncate_sizeによって制御されます。テーブルの非同期削除機能の有効化はinnodb_async_truncate_work_enabledパラメータによって制御されます。

この機能はユーザーにより操作する必要はなく、カーネルにより自動的に実行されます。テーブル削除の際に、他のディレクトリでテーブルのデータファイルにハード接続を作成することで実現できます。drop table実行後、このファイルのハード接続のみが削除されます。その後、バックグラウンドスレッドのスキャンによってハード接続のディレクトリの中に削除すべきファイルがあると分かり次第、先ほどdropされたテーブルデータファイルをバックグラウンドで自動的にtruncateします。

## サポートするバージョン
- カーネルバージョン MySQL 5.6 20190203以降
- カーネルバージョン MySQL 5.7 20190203以降
- カーネルバージョン MySQL 8.0 20200630以降

## ユースケース
この機能は削除しようとするテーブルデータファイルが非常に大きいケースに適しています。

## 利用説明
- innodb_async_truncate_work_enabledをONに設定すると、DROP TABLEが非同期方式に変更されます。デフォルトではOFFになっています。
- truncateするたびのファイルの大きさはinnodb_async_truncate_sizeによって制御されます。
- [innodb_fast_ddl](https://intl.cloud.tencent.com/document/product/236/43489)パラメータをオンにすると、大きなテーブルの非同期削除能力がより効果的になります。

| パラメータ名                             | 動的 | タイプ   | デフォルト | パラメータ値範囲                        | 説明                            |
| ---------------------------------- | ---- | ------ | ---- | ------------------------- | ------------------------------ |
| innodb_async_truncate_work_enabled | Yes  | string |  OFF   | ON/OFF      | 大きなテーブルの非同期削除をオンにするかどうか          |
| innodb_async_truncate_size         | Yes  | int    | 5.7、20210630およびそれ以前のバージョンでは、デフォルト値は128<br>5.7、20211030およびそれ以降のバージョンでは、デフォルト値は64  | 5.7、20210630およびそれ以前のバージョンでは、範囲は128MB - 2048MB<br>5.7、20211030およびそれ以降のバージョンでは、範囲は16MB - 256MB | 非同期DROP TABLEのバックエンドでの毎回のtruncateファイルのサイズ、単位はMB |

