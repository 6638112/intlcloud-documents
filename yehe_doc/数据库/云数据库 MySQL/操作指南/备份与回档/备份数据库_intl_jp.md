データを喪失または破損させないために、自動バックアップまたは手動バックアップによってデータベースをバックアップできます。

## バックアップ概要
### バックアップ方式
TencentDB for MySQLの2ノード、3ノードは、**自動バックアップ**と**手動バックアップ**の2種類の方式に対応してデータベースをバックアップします。

### バックアップタイプ
TencentDB for MySQLの2ノード、3ノードは次の2種類のバックアップタイプに対応します。
- **物理バックアップ**。物理データの完全なコピー（自動バックアップと手動バックアップの両方をサポート）。
- **論理バックアップ**。SQLステートメントのバックアップ（手動バックアップをサポート）。
>?
>- 物理バックアップ復元方式は、 xbstreamを用いてアンパックする必要があります。操作の詳細は[[物理バックアップによるデータベースの復元](https://intl.cloud.tencent.com/document/product/236/31910)をご参照ください。
- 単一インスタンスのテーブル数が100万を超えた場合は、バックアップがエラーになる恐れがあり、データベースの監視にも影響を与えます。そのために、単一インスタンスのテーブル数が100万を超えないようにテーブルの数を適切に管理してください。
>- Memoryエンジンテーブルのデータがメモリ内に保存されているため、Memoryエンジンへの物理バックアップができません。データが喪失しないように、MemoryエンジンテーブルをInnoDBテーブルに変換することをお勧めします。
>- インスタンスにプライマリキーのないテーブルが大量にある場合は、バックアップに失敗し、インスタンスの高可用性にも影響することがあります。プライマリキーのないテーブルにプライマリキーまたはセカンダリインデックスを速やかに作成してください。

| 物理バックアップの優位性 | 論理バックアップのリスク |
|---------|---------|
| <li>バックアップが速い。<li>ストリーム式バックアップと圧縮に対応。<li>バックアップの成功率が高い。<li>復旧が容易で効率が良い。<li>バックアップに基づいて行う結合操作、例えばROの追加、ディザスタリカバリの追加がより速くなる。<li>物理バックアップが完了する平均時間が論理バックアップの1/8前後に短縮。<li>物理バックアップインポート速度が論理バックアップより10倍前後速まる。| <li>復旧時には、SQLの実行とインデックス構築が必要で、復旧時間は長くかかる。<li>バックアップ速度は遅く、データ量が多い状況ではそれが極めて顕著。<li>バックアップのプロセスで、インスタンスにストレスが生じ、マスターマシンとスレーブマシンの遅延が大きくなることがある。<li>浮動小数点数の精度情報を喪失することがある。<li>各種の問題（エラービューなど）があることから、バックアップのエラーを招くことがある。<li>バックアップに依存して行う結合操作、例えば、ROの追加、ディザスタリカバリの追加が遅くなる。 |

### バックアップオブジェクト
| データバックアップ | ログバックアップ |
|---------|---------|
| MySQL 2ノード、3ノード：<li>自動バックアップは全量の物理バックアップに対応します。<li>手動バックアップは全量の物理バックアップ、全量の論理バックアップと単一データベース、単一テーブルの論理バックアップに対応します。<li>自動バックアップと手動バックアップはともに圧縮とダウンロードに対応します。 | データベースのbinlogログファイルバックアップはMySQL 2ノード、3ノードに対応します。<li>ログファイルはインスタンスバックアップのキャパシティを占用します。<li>ログファイルはダウンロードには対応しますが、圧縮には対応しません。<li>ログファイルの保持期間を設定できます。|

## 注意事項
- TencentDB for MySQLの自動バックアップは2019年2月26日から、物理バックアップのみ対応します。自動バックアップの設定は、デフォルトでは物理バックアップ方式となり、論理バックアップを提供することはありません。既存の論理バックアップとして自動的にバックアップされたインスタンスは、自動的に物理バックアップに切り替わります。
この切り替えがトランザクションアクセスに影響することはありません。自動バックアップの使用習慣に影響することはあります。論理バックアップが必要な場合、 [TencentDB for MySQLコンソール](https://console.cloud.tencent.com/cdb) の手動バックアップ方式を使用するか、または [API呼び出し](https://intl.cloud.tencent.com/document/product/236/15844) により論理バックアップを生成できます。
- 論理バックアップ、物理バックアップに関わらず、どちらのファイルも圧縮されるため、一部のダウンロードファイルは使用できません。手動論理バックアップのバックアップ部分のデータベーステーブルの機能で代替できます。 [手動バックアップ](#manual-backup)をご参照ください。
- インスタンスバックアップファイル占用バックアップキャパシティについては、バックアップキャパシティを適切に使用してください。バックアップキャパシティが無料制限を超えたものには課金されます。 [バックアップスペース課金説明](https://intl.cloud.tencent.com/document/product/236/32344)をご参照ください。
- トランザクションがピークでないときにバックアップを選択することをお勧めします。
- 必要なバックアップファイルが保持期間を過ぎて削除されることがないように、必要なバックアップファイルは速やかにローカルにダウンロードしてください。
- テーブルのロックがバックアップを失敗させることがないように、バックアップ中はDDL操作を禁止します。
- 単一ノードのMySQLインスタンスはデータベースのバックアップをサポートしていません。

## MySQLデータの自動バックアップ
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストページでインスタンス名をクリックして管理ページに入り、**バックアップの復旧**>**自動バックアップの設定**を選択します。
![](https://main.qcloudimg.com/raw/69fed1aac393a518bd8cc2ad1fea550f.png)
2. ポップアップバックアップ設定ダイアログボックスで各バックアップパラメータを選択して、**OK**をクリックします。パラメータの説明は次のとおりです。
>?
>- [ロールバック機能](https://intl.cloud.tencent.com/document/product/236/7276) は、バックアップサイクルとバックアップ保持日数内のデータバックアップ+ ログバックアップ（binlog）を基準にしています。自動バックアップ頻度と保持日数を短縮すると、インスタンスデータのロールバック期間の範囲に影響します。バックアップの設定は十分に検討してください。
>例えば、バックアップサイクルを月曜と木曜、保持日数を7日間に設定すると、7日以内（データバックアップとログの有効バックアップの実際の保存期間）の任意の時点でロールバックできます。
>- 自動バックアップしたものは手動で削除することはできませんが、バックアップ保持期間を設定して、期限がきたら自動削除することができます。
>
<table>
<thead><tr><th>パラメータ</th><th>説明</th></tr></thead>
<tbody>
<tr>
<td>バックアップサイクル</td><td>データを保護するため、1週間に2回以上はバックアップするよう設定してください。デフォルトでは、月曜から日曜までとなっています。</td></tr>
<tr>
<td>バックアップ期間</td><td><ul><li>デフォルト期間はシステムが自動分配するバックアップ実施時間。<li>カスタマイズして時間帯を選択できます。トランザクションがピークでない期間を設定することをお勧めします。バックアップの実施時間はバックアップが開始する時間であり、バックアップが終了する時間を表すものではありません。<br>例えば、02:00～06:00を選択すると、システムは02:00 ～ 06:00の範囲内のある時点でバックアップを実施します。具体的な実施時間はバックエンドのバックアップポリシーとバックアップシステム状況に依存します。</td></tr>
<tr>
<td>データバックアップ保持期間</td><td>データバックアップファイルは3日～1830日まで保持できます。デフォルトは7日です。</td></tr>
<tr>
<td>ログバックアップ保持期間</td><td>ログバックアップファイルは3日～1830日間保持されます。デフォルトは7日です。<strong>ログバックアップ日数はデータバックアップ日数より少なくする必要があります。</strong></td></tr>
</tbody></table>
<img src="https://main.qcloudimg.com/raw/a371d4ba960264aa5630b59a3bfe5096.png"  style="margin:0;">

## [MySQLデータの手動バックアップ](id:manual-backup)
手動バックアップ機能では、ユーザーが自らバックアップタスクを実行することができます。
>?
>- 手動バックアップは、全データの物理バックアップ、全データの論理バックアップ、単一データおよび単一テーブルの論理バックアップをサポートします。
>- 手動バックアップはバックアップリストでバックアップキャパシティを手動で削除、リリースして、キャパシティの浪費と占用を回避します。手動で削除しない限り、保持され続けます。
>- インスタンスは毎日の自動バックアップタスク実行中は、手動でバックアップを行うことはできません。
>
1. インスタンスリストページで、インスタンス名をクリックして管理ページに入り、**バックアップの復旧**>**手動バックアップ**タブを選択します。
2. ポップアップしたバックアップ設定ダイアログボックスで、バックアップ方式とオブジェクトを選択して**OK**をクリックします。
![](https://main.qcloudimg.com/raw/a16e644f51756b6a98597945e45329cd.png)
>?論理バックアップ下での単一データベースバックアップまたは単一テーブルバックアップである場合、左側の**データベーステーブルの選択**からバックアップするデータベースまたはデータテーブルをチェックして、データベースまたはテーブルを右側のリストに追加してください。データベースがまだない場合は、データベースまたはテーブルを先に作成してください。
>
![](https://main.qcloudimg.com/raw/76924e2c76ac348b68ed113d679d6907.png)

## よくあるご質問
#### 1. バックアップ保持期間が過ぎたバックアップは、まだダウンロードや元に戻すことができますか。
期限がきた後のバックアップセットは自動で削除され、ダウンロードも元に戻すこともできません。
- 必要に応じて、バックアップ保持期間を適切に設定するか、または[MySQLコンソール](https://console.cloud.tencent.com/cdb)でバックアップファイルをローカルにダウンロードすることをお勧めします。
- コンソールでインスタンスデータを手動でバックアップすることによって、手動バックアップを保持し続けることもできます。
>?手動バックアップは、バックアップキャパシティを占用することもあります。バックアップキャパシティを適切に使用して、予定外の費用が生じないようにしてください。

#### 2. バックアップは手動で削除できますか。
- 自動バックアップしたものは手動で削除することはできませんが、バックアップ保持期間を設定して、期限がきたら自動削除することができます。 
- 手動バックアップは、 [MySQLコンソール](https://console.cloud.tencent.com/cdb) のバックアップリストで手動で削除することができ、手動で削除しない限り、保持され続けます。

#### 3. データとログのバックアップは停止できますか。
停止できませんが、 [MySQLコンソール](https://console.cloud.tencent.com/cdb) を使用して、バックアップの頻度を減らし、使用することがない手動バックアップデータを削除して、バックアップキャパシティの使用量を抑えることができます。

#### 4. どうやってバックアップキャパシティのオーバーヘッドを減らしますか。
- 今後使用しない手動バックアップデータを削除します（手動バックアップは [MySQLコンソール](https://console.cloud.tencent.com/cdb) のインスタンス管理ページ>バックアップ復旧ページで削除します）。 
- コアトランザクションではないデータの自動バックアップ頻度を引き下げます（コンソールでバックアップサイクルとバックアップ保持期間を調整できます。1週間にバックアップ2回以上）。
>?[ロールバック機能](https://intl.cloud.tencent.com/document/product/236/7276) は、バックアップサイクルとバックアップ保持日数内のデータバックアップ+ ログバックアップ（binlog）を基準にしています。自動バックアップ頻度と保持日数を短縮すると、インスタンスデータのロールバック期間の範囲に影響します。バックアップの設定は十分に検討してください。
>
- コアトランザクションではないデータバックアップとログバックアップの保持期間を短縮します（7日間のバックアップ保持期間で、すでに多くのシナリオの需要は満たしています）。

| トランザクションシナリオ            | バックアップ保持期間                                                 |
| -------------------- | ------------------------------------------------------------ |
| コアトランザクション             | 7日～1830日を推奨                                              |
| 非コア、非データタイプのトランザクション             | 7日を推奨                                              |
| アーカイブ業務             | データバックアップ保持期間を7日に設定して、実際のトランザクションのニーズに応じてデータを手動でバックアップし、使用後は速やかに削除することをお勧めします |
| テスト業務             | データバックアップ保持期間を7日に設定して、実際のトランザクションのニーズに応じてデータを手動でバックアップし、使用後は速やかに削除することをお勧めします |

