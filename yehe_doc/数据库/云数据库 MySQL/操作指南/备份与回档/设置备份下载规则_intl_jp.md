
TencentDB for MySQLインスタンスのバックアップファイルは、デフォルトではパブリックネットワークまたはプライベートネットワークを通じてダウンロードできますが、ダウンロードを制限する必要がある場合は、ダウンロード設定によって調整を行うことができます。
>?
>- データベースバックアップダウンロード設定を現在サポートするリージョン：
>広州、上海、北京、深圳、成都、重慶、南京、中国香港、北京金融、上海金融、深圳金融、トロント、シンガポール、シリコンバレー、フランクフルト、ソウル、ムンバイ、バンコク、モスクワ、東京。
>- バックアップダウンロード設定機能のアクティブ化方法：
>  - 2021年11月9日より前にこの機能を使用したい場合は、[チケットを提出](https://console.cloud.tencent.com/workorder/category) してアクティブ化できます。
>  - 2021年11月9日以降、この機能は全ネットワークユーザーに開放されます。

## バックアップダウンロードルールの設定
1. [MySQLコンソール]](https://console.cloud.tencent.com/cdb)にログインし、左側のナビゲーションで**データベースのバックアップ**ページを選択し、上部でリージョンを選択します。
2. **ダウンロード設定**ページを選択すると、対応するリージョンのバックアップ設定情報が表示されます。**編集**をクリックし、ダウンロード制限条件を設定します。
>?パブリックネットワークからのダウンロードはデフォルトでオンになっています。パブリックネットワークからのダウンロードがオンである場合、パブリックネットワークとプライベートネットワークのどちらからでもバックアップをダウンロードできます。
>
![](https://qcloudimg.tencent-cloud.cn/raw/530fbf3e6c93eea06ff23e112cad84c0.png)
3. ポップアップ画面でダウンロードの詳細を設定し、**OK**をクリックします。
   - パブリックネットワークからのダウンロード：
     - オン：パブリックネットワークからのダウンロードがオンになっている場合、ダウンロード条件の設定はできません。
     - オフ：パブリックネットワークからのダウンロードがオフの場合は、ダウンロード条件を設定できます。設定条件にはIP、VPCが含まれます。
   - ダウンロード条件の設定：
     - 条件に対応する条件値が空であれば、その条件を使用して制限を行わないことを表します。
     - IPアドレス条件値は`,`を使用して分割します。
     - IP条件はIPアドレスとIPアドレス帯を条件値としてサポートします。
     - IP、VPC条件がどちらも空の場合、プライベートネットワークからのダウンロードは制限されません。
![](https://qcloudimg.tencent-cloud.cn/raw/7e0a4a48af62fdd643259f8902fcd95f.png)
4. 設定が完了すると、**ダウンロード設定**ページが返され、発効の条件を確認できるようになります。
![](https://qcloudimg.tencent-cloud.cn/raw/cb4ac45dcde8a57610b0eaec9075c6cb.png)

## サブアカウントへのバックアップダウンロードルール設定使用の権限承認
デフォルトの状態では、サブアカウントにMySQLデータベースのバックアップダウンロードルールを設定する権利はありません。ユーザーはポリシーを作成して、サブアカウントにバックアップダウンロードルールの設定を許可する必要があります。

[CAM](https://intl.cloud.tencent.com/document/product/598/10583)（Cloud Access Management、CAM）は、Tencent Cloudが提供するWebサービスであり、主にユーザーがTencent Cloudアカウントのリソースへのアクセス権限を安全に管理するのに役立ちます。CAMを使用すると、ユーザー（グループ）を作成、管理、および廃棄でき、ID管理とポリシー管理を介して、Tencent Cloudリソースの使用が許可されるユーザーを指定し、制御できます。

CAMを使用する場合は、ポリシーを1人のユーザーまたは1組のユーザーグループと関連付けて、指定されたリソースを使用して指定されたタスクを完了することを許可または拒否できます。CAMポリシーのより詳細な基本情報については、[ポリシー構文](https://intl.cloud.tencent.com/document/product/598/10603)をご参照ください。

### サブアカウントの権限承認
1. ルートアカウントで[CAMコンソール](https://console.cloud.tencent.com/cam)にログインし、ユーザーリストで対応するサブユーザーを選択して、**承認**をクリックします。
![img](https://qcloudimg.tencent-cloud.cn/raw/89d7cf063bd376a0cc4f4db0c78e7e56.png)
2. ポップアップしたダイアログボックスで、**QcloudCDBFullAccessクラウドデータベース（CDB）全読み取り/書き込みアクセス権限**プリセットポリシーを選択し、**OK**をクリックして、サブユーザーの権限承認を完了します。
![](https://qcloudimg.tencent-cloud.cn/raw/0819ca9a1a81fc00968f0a263dc7727e.png)

### ポリシー文法
MySQLデータベースのバックアップダウンロードルール設定のCAMポリシーについての説明は以下のとおりです。
```
{
       "version":"2.0",
       "statement":
       [
          {
             "effect":"effect",
             "action":["action"],
             "resource":["resource"]
            }
       ] 
}
```
- **バージョンversion**：入力必須項目であり、現時点では"2.0"のみを認めています。
- **ステートメント statement**：1つか複数の権限の詳細情報を説明することに使われます。この要素にはeffect、action、resource等いくつかの他の要素の権限または権限セットが含まれます。1つのポリシーには1つのstatement要素しかありません。
- **影響effect**：入力必須項目であり、ステートメントによる結果が「許可」であるか「明示的な拒否」であるかを説明します。allow（許可）とdeny（明示的な拒否）という2種類の状況が含まれています。
- **アクションaction**：入力必須項目であり、許可する、または拒否するアクションを説明することに使われます。アクションはAPI（nameプレフィックス）または機能セット（permidプレフィックスが付いた特定のAPIセット）を指定できます。
- **リソース resource**：入力必須項目であり、権限承認の具体的データを説明します。

### APIの操作
CAMポリシーステートメントの中で、CAMをサポートしているすべてのサービスから、任意のAPI操作を指定できます。データベース監査については、name/cdb:というプレフィックスが付いたAPIをご使用ください。1つのステートメントの中で複数の操作を指定したい場合は、下記のようにコンマで区切ってください：
```
"action":["name/cdb:action1","name/cdb:action2"]
```
ワイルドカードで複数のアクションを指定することも可能です。例えば、下記のとおり先頭が 「Describe」で始まるすべてのアクションを指定することが可能です。
```
"action":["name/cdb:Describe*"]
```

### リソースパス
リソースパスの一般的な形式は次のとおりです。
```
qcs::service_type::account:resource
```
- service_type：製品の略称です。ここではcdb。
- account：リソース所有者のルートアカウント情報です。例えばuin/326xxx46。
- resource：製品の具体的なリソース詳細です。各MySQLインスタンス（instanceId）が1つのリソースです。

例：
```
 "resource": ["qcs::cdb::uin/326xxx46:instanceId/cdb-kfxxh3"]
```
このうち、cdb-kfxxh3はMySQLインスタンスリソースのIDで、ここではCAMポリシーステートメント中のリソースresourceです。

### 事例
以下の例はCAMの使用方法のみを示したものです。MySQLデータベースのバックアップダウンロードルール設定の完全なAPIについては、[APIドキュメント](https://intl.cloud.tencent.com/document/product/236/43327)をご参照ください。
```
{
       "version":"2.0",
       "statement":
       [
          {
             "effect":"allow",
             "action": ["name/cdb: ModifyBackupDownloadRestriction"],
             "resource": ["*"]
            }
       ]
}
```

### MySQLデータベースのバックアップダウンロードルール設定ポリシーのカスタマイズ
1. ルートアカウントで[CAMコンソール](https://console.cloud.tencent.com/cam/policy)にログインし、ポリシーリストで、**カスタムポリシーの新規作成**をクリックします。
![img](https://qcloudimg.tencent-cloud.cn/raw/4ddc463dc28ee48b9dd63d862fa41ea1.png)
2. ポップアップしたダイアログボックスで、**ポリシージェネレーターで作成**を選択します。
3. サービスおよび操作の選択画面で、各項目の設定を選択し、ステートメントの追加をクリックした後、次のステップをクリックします。
   - サービス(Service)：**TencentDB for MySQL**を選択します。
   - アクション(Action)：MySQLデータベースのバックアップダウンロードルール設定のAPIを選択します。[APIドキュメント](https://intl.cloud.tencent.com/document/product/236/43327)をご参照ください。
   - リソース(Resource)：[リソース記述法](https://intl.cloud.tencent.com/document/product/598/10606)をご参照ください。`*`を入力し、所在リージョンのMySQLインスタンスのバックアップダウンロードルールが設定可能であることを示します。
![](https://qcloudimg.tencent-cloud.cn/raw/5372ae1d2ac16ff63b63fbf175f3fccf.png)
4. ポリシー編集画面で、命名仕様に従い、「ポリシー名」（例えばBackupDownloadRestriction）と「説明」を入力後、**完了**をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/3c5454e0da412c0e12beebb4b045979d.png)
5. ポリシーリストに戻ると、作成したカスタムポリシーを確認することができます。
![](https://qcloudimg.tencent-cloud.cn/raw/d242b34c0b9cad83d130444d84e205e0.png)

