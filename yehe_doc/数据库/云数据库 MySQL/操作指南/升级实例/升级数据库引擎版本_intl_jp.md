
## ユースケース
このドキュメントでは、MySQLエンジンをバージョンアップする場合、コンソールを使ってバージョンアップする方法について説明します。
TencentDB for MySQLは、下記データベースエンジンのバージョンアップをサポートします：
- MySQL 5.5からMySQL 5.6へのバージョンアップ
- MySQL 5.6からMySQL 5.7へのバージョンアップ

>?
>- データベースエンジンのバージョンのダウングレードはサポートしていません。
>- メジャーバージョンを跨ぐアップグレードはサポートされていません。例えば、 MySQL5.5のインスタンスをMySQL 5.7 またはそれ以降のバージョンにアップグレードする場合、先にインスタンスをMySQL 5.6にアップグレードしてください。
>- 現在 MySQL 5.7からMySQL 8.0へのバージョンアップはサポートしていません。 
>- 単一ノードクラウドディスクバージョンのインスタンスは、エンジンバージョンのアップグレードをサポートしていません。

## [バージョンアップのルール](id:shengjiguize)
- `create table …  as select …`の文法をサポートしません。
-  TencentDB for MySQL 5.6/5.7のマスタースレーブ同期は、 GTIDに基づき実現され、デフォルトでは InnoDBエンジンのみがサポートされています。
-  MySQL5.5バージョンからMySQL 5.6にアップグレードするとき、最新の完全バックアップは論理コールドバックアップである場合、アップグレード中に、 MyISAMエンジンのテーブルはInnoDBに変換されます。**アップグレードする前にMyISAMを InnoDBに変換することをお勧めします**。
- アップグレードの実行中に、MySQL は slow\_log テーブルをクリアします。ログ情報を保持するには、メジャーバージョンのアップグレードを実行する前にログ内容を保存しておいてください。
- **バージョンアップするインスタンスが他のインスタンス（マスターインスタンス、読取専用インスタンスなど）に関連付けられている場合、データレプリケーションの一致性を確保するために、合わせてバージョンアップします**。
-  MySQLバージョンのアップグレードを実行する場合、データを移行する必要があります。そのために、アップグレードに長い時間がかかるので、しばらくお待ちください。この作業期間中、サービスは中断されることなく継続して利用できます。
- バージョンアップ完了時に、インスタンスの切り替え（即ち、MySQLデータベースの接続が数秒間切断される）が発生します。プログラムの自動再接続機能を有効にし、また、インスタンスのメンテナンスを実行可能な時間を選択して切り替えを実行することをお勧めします。メンテナンス時間については、 [インスタンスのメンテナンス時間設定](https://cloud.tencent.com/document/product/236/10929)をご参照ください。
- 単一インスタンスのテーブル数が100万を超えた場合は、アップグレードのエラーになる恐れがあり、データベースへの監視にも影響を与えます。そのために、単一インスタンスのテーブル数が100万を超えないようにテーブルの数を適切に管理してください。

## 操作手順
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb/)にログインし、インスタンスリストで、アップグレードする必要があるインスタンスを選択して、**操作**列の選択**その他**>**バージョンのアップグレード**を選択します。
>?MySQL 8.0をより高いバージョンにアップグレードすることはできません。
>
2. ポップアップされたダイアログボックスで、必要なデータベースバージョンを選択し、**アップグレード**をクリックします。
データベースバージョンのアップグレードを実行する場合、データを移行する必要があります。アップグレードが完了する際に、MySQLデータベースの接続が数秒間で切断されます。アップグレードを実行する場合、切り替え時間を**メンテナンス時間帯**に指定することで、インスタンスのアップグレード完了後の次の**メンテナンス時間帯**に切り替え作業を実行します。
>!切り替え時間を**メンテナンス時間帯**に指定した場合、データベース仕様のアップグレードが完了した後にすぐ切り替え作業を実行せず、インスタンスの**メンテナンス時間帯**に切り替え作業を開始するまで同期を保持します。そのために、インスタンス全体のアップグレードを完了するには、時間がかかる可能性があります。
>
![](https://qcloudimg.tencent-cloud.cn/raw/5fd7b83457ffb0cab80112ad32e8e0be.png)

## よくあるご質問
#### アップグレード前に、TencentDB for MySQL はデータの自動バックアップを行いますか？
TencentDB for MySQLは毎日リアルタイムにデュアルマシンによるホットバックアップを行い、データバックアップ + ログバックアップ(binlog)をベースに、7日間 - 1830日間のデータロスのない復旧をサポートします。

#### クラウドデータベースをMySQL 5.7 からMySQL 5.6 にダウングレードできますか？
ダウングレードはサポートしていません。MySQL 5.6 バージョンが必要な場合は、先ず MySQL 5.7のインスタンスを廃棄/返品し、その後再び MySQL 5.6 インスタンスを購入することになります。ご不便をおかけしますが、どうかご了承ください。

#### アップグレード実行中に、マスター／スレーブ遅延の問題は起きませんか？
マスターインスタンスをアップグレードするとデータの比較が行われ、マスター／スレーブ遅延が発生する可能性があります。

#### バージョンのアップグレード完了時にインスタンスの切り替えが発生すると、TencentDB for MySQL インスタンスの正常な使用に影響しませんか？
インスタンスのアップグレードの正常なプロセスがお客様のご利用に影響することはありませんが、インスタンスの接続時に秒単位の瞬断が発生します。自動で再接続する機能をプログラミングし、インスタンスがメンテナンス可能な時間帯を選んで切り替えを行うことをお勧めします。

#### TencentDB for MySQLのバージョンアップにはどのくらい時間がかかりますか？アップグレードの進捗はどこで確認できますか？
データベースのアップグレードの時間は、現在のデータベースのデータ量の大きさやデータレプリケーションなどと関係します。よって具体的な時間を示すことはできません。
- TencentDB for MySQLのバージョンのアップグレードをする場合、データを移行する必要があります。通常かなり時間がかかりますので、しばらくお待ちください。この作業中、業務は影響を受けることはなく、アクセス可能です。

#### インスタンスがずっと「切り替えを待ってアップグレードされます」の状態になっているのはなぜですか？
切り替え時間に**メンテナンス時間帯に切り替え**を選択したためと思われます。インスタンスはアップグレード完了後、メンテナンス時間帯に切り替え操作を行います。
直ちに切り替えたい場合は、インスタンスリストの**操作**列で**今すぐ切り替え**をクリックします。切り替えには秒単位の瞬断がありますので、業務に再接続機能が備わっていることを確認してください。


