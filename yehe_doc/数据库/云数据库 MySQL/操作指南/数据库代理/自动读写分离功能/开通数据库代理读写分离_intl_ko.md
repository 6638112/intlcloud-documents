[자동 읽기/쓰기 분리 소개](https://intl.cloud.tencent.com/document/product/236/42050)에 설명된 데이터베이스 프록시 읽기/쓰기 분리 기능을 사용하면 자동으로 쓰기 요청을 원본 인스턴스로 포워딩하고 읽기 요청을 읽기 전용 인스턴스로 포워딩하도록 애플리케이션에서 데이터베이스 프록시 주소를 구성할 수 있습니다.

본문은 TencentDB for MySQL 읽기/쓰기 분리 기능을 활성화/비활성화하는 방법을 설명합니다.

## 전제 조건
- 인스턴스가 원본 인스턴스입니다.
- 인스턴스에 [데이터베이스 프록시 활성화](https://intl.cloud.tencent.com/document/product/236/42052)가 완료되어 있어야 합니다.
- 인스턴스에 [읽기 전용 인스턴스 생성](https://intl.cloud.tencent.com/document/product/236/7270)이 완료되어 있어야 합니다.

## 읽기/쓰기 분리 활성화
1. [TencentDB for MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인합니다.
2. 페이지 상단의 영역을 선택하고 대상 인스턴스의 **작업** 열에서 ID 또는 **관리**를 클릭하여 인스턴스 관리 페이지로 이동합니다.
3. 인스턴스 관리 페이지의 **데이터베이스 프록시** 탭에서 **읽기/쓰기 분리** 탭을 선택하고 **지금 활성화**를 클릭합니다.
![](https://main.qcloudimg.com/raw/b07508f045b727ca63c294b707159474.png)
4. 팝업 창에서 해당 구성 항목을 설정하고 **확인**을 클릭합니다.
>!
>- 실행 중인 원본 및 읽기 전용 인스턴스만 데이터베이스 프록시에 추가할 수 있습니다.
>- 현재 원격 RO와 딜레이된 RO 인스턴스는 데이터베이스 프록시에 마운트 할 수 없습니다.
>
   - **지연된 읽기 전용 인스턴스 제거**: 제거 정책 활성화 여부를 지정합니다. 읽기 전용 인스턴스에서 복제 예외(예: 복제 지연 또는 중단)가 발생하면 데이터베이스 프록시는 일시적으로 읽기/쓰기 분리에서 인스턴스를 제거합니다. 지연 임계값은 기본적으로 10초이며 하나 이상의 읽기 전용 인스턴스를 유지해야 합니다.
>?설정된 지연 임계값 및 최소 읽기 전용 인스턴스는 새 연결에 대해서만 적용됩니다.
   - **지연 임계값**: 읽기 전용 인스턴스가 원본 인스턴스의 데이터를 동기화할 때 허용되는 최대 지연 시간을 지정합니다. 읽기 전용 인스턴스의 지연이 이 임계값을 초과하면 가중치에 관계없이 읽기 요청이 인스턴스로 전달되지 않습니다. 값은 1보다 크거나 같은 정수여야 합니다.
     - 읽기 전용 인스턴스의 지연 시간이 임계값을 초과하면 인스턴스가 제거되고 제거 후 가중치가 자동으로 0으로 설정되며 시스템에서 알람을 보냅니다(‘데이터베이스 프록시에 마운트된 노드 제거’ 알람을 먼저 구독해야 하며, 설정은 [알람 정책(Cloud Monitoring)](https://intl.cloud.tencent.com/document/product/236/8457)을 참고 하십시오).
     - 지연 시간이 임계값 아래로 떨어지면 인스턴스가 데이터베이스 프록시에 다시 배치됩니다. 지연된 읽기 전용 인스턴스 제거의 활성화 여부에 관계없이 인스턴스 장애로 인해 제거된 읽기 전용 인스턴스는 복구될 때 데이터베이스 프록시에 다시 합류합니다.
     - 최소 읽기 전용 인스턴스를 설정한 후, 데이터베이스 프록시가 라우팅되는 읽기 전용 인스턴스의 수가 설정된 값보다 작다는 것을 발견하면 읽기/쓰기 분리의 인스턴스 수가 설정 값보다 크거나 같을 때까지 비정상적인 읽기 전용 인스턴스를 읽기/쓰기 분리에 추가합니다.
>   !읽기 전용 라이브러리에서 치명적인 장애(예: 시스템 다운)가 발생할 경우, 최소 보류 수량은 치명적인 장애가 발생한 인스턴스에 대하여 작용하지 못합니다.
   - **최소 읽기 전용 인스턴스**: 읽기 전용 그룹에 유지해야 하는 최소 인스턴스 수입니다. 읽기 전용 그룹의 인스턴스가 적으면 인스턴스가 지연 임계값을 초과하더라도 제거되지 않습니다.
   - **읽기 가중치 할당**: 읽기 가중치를 인스턴스에 할당합니다. 시스템에서 할당 또는 사용자 지정을 선택할 수 있습니다. 각 가중치는 0 - 100 사이의 정수여야 합니다.
    - 데이터베이스 프록시 1.3.1 이전 버전의 경우: 읽기 전용 인스턴스의 가중치가 0인 경우 데이터베이스 프록시는 인스턴스에 연결하지 않습니다. 가중치가 0에서 다른 값으로 변경되면 가중치는 새 연결에만 적용됩니다.
    - 데이터베이스 프록시 버전 1.3.1 이상의 경우: 지정된 연결 주소에서 사용 가능한 모든 읽기 전용 인스턴스의 가중치가 0인 경우 데이터베이스 프록시는 예외가 발생할 때 여전히 사용 가능한 읽기 전용 노드가 계속 유지되도록 기본적으로 이러한 모든 가중치를 1로 늘립니다.
   - **장애 조치**: 장애 조치 활성화 여부를 설정합니다. 활성화 후 데이터베이스 프록시 장애로 인해 데이터베이스 연결이 실패하면 데이터베이스 프록시의 액세스 주소가 액세스를 위해 원본 인스턴스에 연결됩니다. 데이터베이스 프록시가 복구되면 데이터베이스 프록시에 다시 연결됩니다.
>?구성된 장애 조치 기능은 새 연결에 대해서만 적용됩니다. 
   - **새로 추가된 읽기 전용 인스턴스에 적용**: 이 매개변수를 활성화 또는 비활성화합니다. 활성화된 후 새 읽기 전용 인스턴스를 구입하면 자동으로 데이터베이스 프록시에 추가됩니다.
     - 읽기 가중치 할당이 시스템 할당으로 설정된 경우 새로 구매한 읽기 전용 인스턴스는 사양에 따라 기본 가중치가 할당됩니다.
     - 할당 읽기 가중치가 사용자 지정으로 설정된 경우 새로 구입한 읽기 전용 인스턴스가 읽기 전용 그룹에 추가되면 해당 가중치는 기본적으로 0이 되며 데이터베이스 프록시의 읽기/쓰기 분리 구성에서 수정할 수 있습니다.
   ![](https://main.qcloudimg.com/raw/f2eb858b2b37fd134913738b243a17e8.png)

## 페이지 표시
데이터베이스 프록시의 읽기/쓰기 분리 기능이 활성화되면 **읽기/쓰기 분리** 탭에서 기본 정보 및 읽기/쓰기 분리 아키텍처 다이어그램을 볼 수 있습니다. 오른쪽에 있는 버튼을 클릭하여 구성을 조정하고 기능을 비활성화할 수도 있습니다.
![](https://main.qcloudimg.com/raw/098c9fae971719881b6d20eee6ba0e73.png)

## 읽기/쓰기 분리 비활성화
1. [TencentDB for MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인합니다.
2. 페이지 상단의 영역을 선택하고 대상 인스턴스의 **작업** 열에서 ID 또는 **관리**를 클릭하여 인스턴스 관리 페이지로 이동합니다.
3. 인스턴스 관리 페이지의 **데이터베이스 프록시** 탭에서 **읽기/쓰기 분리** 탭을 선택하고 우측의 **읽기/쓰기 분리 비활성화**를 클릭합니다.
![](https://qcloudimg.tencent-cloud.cn/raw/efa07dc1350c2fc9dc878914e22aef05.png)
