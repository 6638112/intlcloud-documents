[데이터베이스 프록시 읽기/쓰기 분리](https://intl.cloud.tencent.com/document/product/236/42050) 기능을 통해 응용 프로그램에 데이터베이스 프록시 주소를 설정하면 쓰기 요청을 자동으로 원본 인스턴스로 포워딩하고 읽기 요청을 자동으로 각 읽기 전용 인스턴스로 포워딩할 수 있습니다. 

본문은 TencentDB for MySQL 읽기/쓰기 분리 기능을 활성화/비활성화하는 방법을 설명합니다.

## 전제 조건
- 인스턴스가 원본 인스턴스입니다.
- 인스턴스에 [데이터베이스 프록시 활성화](https://intl.cloud.tencent.com/document/product/236/42052)가 완료되어 있어야 합니다.
- [읽기 전용 인스턴스 생성](https://intl.cloud.tencent.com/document/product/236/7270)이 완료되어 있어야 합니다.

## 읽기/쓰기 분리 활성화
1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인합니다.
2. 위에서 리전을 선택하고 인스턴스 ID 또는 **작업**열의 **관리**를 클릭하여 인스턴스 관리 페이지로 이동합니다.
3. 인스턴스 관리 페이지의 **데이터베이스 프록시** 페이지에서 **읽기/쓰기 분리** 페이지를 선택하고 **지금 활성화**를 클릭합니다.
![](https://main.qcloudimg.com/raw/b07508f045b727ca63c294b707159474.png)
4. 팝업 창에서 관련 설정을 선택하고 **확인**을 클릭합니다.
>!
>- 실행 상태에 있는 원본 및 읽기 전용 인스턴스만 데이터베이스 프록시에 추가할 수 있습니다.
>- 현재 원격 RO와 딜레이 RO는 데이터베이스 프록시에 마운트 할 수 없습니다.
>
   - **읽기 전용 인스턴스 딜레이 제거**: 제거 정책 실행 여부. 읽기 전용 인스턴스에서 복사 이상 경고가 발생(복사 딜레이, 복사 중단)할 경우, 데이터베이스 프록시는 읽기 전용 인스턴스의 읽기/쓰기 분리를 일시적으로 삭제합니다. 딜레이 제거 임계값의 기본 설정은 10초이며, 읽기 전용 인스턴스의 최소 보관 수량은 1개 입니다.
>?읽기 전용 인스턴스 제거 임계값과 최소 보관 수량을 설정하면 새롭게 연결된 것에 한해서만 설정이 적용이 됩니다.
   - **딜레이 제거 임계값**: 읽기 전용 인스턴스가 원본 인스턴스의 데이터를 동기화할 때 허용되는 최대 지연 시간을 지정합니다. 읽기 전용 인스턴스의 지연이 이 임계값을 초과하면 가중치에 관계없이 읽기 요청이 인스턴스로 전달되지 않습니다. 값은 1 이상의 정수여야 합니다.
     - 만약 읽기 전용 인스턴스 딜레이가 임계값을 초과할 경우 삭제되며, 삭제된 인스턴스의 가중치는 0으로 자동 설정되고 시스템은 사용자에게 알람을 발송합니다(먼저 ‘데이터베이스 프록시 마운트 노드 제거’ 알람을 구독해야 하며, 설정에 관하여는 [알람 정책](https://intl.cloud.tencent.com/document/product/236/8457)을 참고 바랍니다.)
     - 읽기 전용 인스턴스의 딜레이가 임계값보다 작을 경우 다시 새롭게 데이터베이스 프록시에 추가됩니다. 동시에 딜레이 제거 기능 활성화 여부에 상관 없이 읽기 전용 인스턴스의 장애가 제거 되어 복구 되면, 복구된 인스턴스도 다시 새롭게 데이터베이스 프록시에 추가됩니다.
     - 읽기 전용 최소 보관 수량 설정을 통해 데이터베이스 프록시가 현재 라우팅 중인 읽기 전용 인스턴스가 설정한 값보다 작은 것을 발견 시, 오류가 난 읽기 전용 인스턴스를 읽기 전용 인스턴스 개수가 최소 보관 수량에 만족할 때까지 읽기/쓰기 분리로 이동시킵니다.
>!읽기 전용 라이브러리에서 치명적인 장애(예: 시스템 다운)가 발생할 경우, 최소 보류 수량은 치명적인 장애가 발생한 인스턴스에 대하여 작용하지 못합니다.
   - **읽기 전용 인스턴스 최소 보관 수**: 보장되어야 하는 인스턴스 하한치로, 현재 읽기 전용 인스턴스 수가 해당 하한치와 같거나 적고, 딜레이 시간이 임계값을 초과하면 현재의 읽기 전용 인스턴스는 제거되지 않습니다.
   - **읽기 가중치 할당**: 인스턴스에 읽기 가중치를 할당하며, 시스템에서 자동으로 할당하거나 사용자 정의를 선택할 수 있으며 가중치 할당 범위는 0 - 100까지의 정수입니다. 가중치 할당 설정 읽기 후 모든 연결에 즉시 적용됩니다.
     - 데이터베이스 프록시는 가중치 설정에 따라 읽기 요청의 트래픽을 할당합니다. 예를 들어, 2개의 읽기 전용 데이터베이스의 가중치가 각각 10과 20인 경우, 읽기 요청 트래픽은 1:2의 비율로 할당됩니다.
     - 여기서 가중치는 쓰기 요청이 가중치 계산에 참여하지 않고 원본 데이터베이스로 직접 라우팅되기 때문에 읽기 요청 가중치만을 나타냅니다. 예를 들어 클라이언트가 10개의 쓰기 명령문과 10개의 읽기 명령문을 보내고 원본 및 읽기 전용 인스턴스 가중치의 비율이 1:1인 경우 원본 인스턴스는 10개의 쓰기 명령문과 5개의 읽기 명령문을 수신하고 읽기 전용 인스턴스는 5개의 읽기 문만 받습니다.
     - 시스템에 의해 할당을 선택하면 시스템이 인스턴스의 CPU 및 메모리 사양에 따라 자동으로 가중치를 할당하며 이 경우 원본 인스턴스의 가중치만 설정할 수 있습니다.
     - 읽기 전용 인스턴스의 가중치가 0인 경우 데이터베이스 프록시는 인스턴스에 연결하지 않습니다. 가중치가 0에서 다른 값으로 변경되면 가중치는 새 연결에만 적용됩니다.
   - **장애 조치**: 장애 조치 활성화 여부를 설정합니다. 활성화하면 데이터베이스 프록시 장애로 인한 데이터베이스 연결 실패 시 데이터베이스 프록시의 액세스 주소가 원본 인스턴스에 연결되어 액세스됩니다. 데이터베이스 프록시가 복구되면 데이터베이스 프록시에 다시 연결됩니다.
>?장애 조치 설정 후 새로운 연결에 한해서만 설정 적용됩니다. 
   - **읽기 전용 인스턴스 자동 추가**: 활성화 여부를 설정합니다. 활성화 후 새로운 읽기 전용 인스턴스를 구매하면 데이터베이스 프록시에 자동으로 추가됩니다.
     - 시스템에서 자동으로 읽기 가중치를 할당할 경우 구매한 읽기 전용 인스턴스에 규격 크기에 따라 기본 가중치를 할당합니다.
     - 읽기 가중치가 사용자 정의인 경우 구매한 읽기 전용 인스턴스의 가중치는 기본적으로 0이며, 데이터베이스 프록시 읽기/쓰기 분리의 설정 변경을 통해 수정할 수 있습니다.
![](https://main.qcloudimg.com/raw/f2eb858b2b37fd134913738b243a17e8.png)

## 페이지 표시
데이터베이스 프록시 읽기/쓰기 분리 기능이 활성화된 후 **읽기/쓰기 분리** 페이지에서 기본 정보 및 읽기/쓰기 분리 아키텍처 다이어그램을 조회할 수 있으며 오른쪽 버튼으로 읽기/쓰기 분리 기능을 다시 설정 변경 및 비활성화할 수 있습니다.
![](https://main.qcloudimg.com/raw/098c9fae971719881b6d20eee6ba0e73.png)

## 읽기/쓰기 분리 비활성화
1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인합니다.
2. 위에서 리전을 선택하고 인스턴스 ID 및 **작업** 열에서 **관리**를 클릭하여 인스턴스 관리 페이지로 이동합니다.
3. 인스턴스 관리 페이지의 **데이터베이스 프록시** 페이지에서 **읽기/쓰기 분리** 페이지를 선택하고 우측의 **읽기/쓰기 분리 비활성화**를 클릭합니다.
![](https://qcloudimg.tencent-cloud.cn/raw/efa07dc1350c2fc9dc878914e22aef05.png)
