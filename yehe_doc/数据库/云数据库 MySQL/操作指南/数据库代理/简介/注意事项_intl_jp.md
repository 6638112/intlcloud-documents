この文書では、TencentDB for MySQLデータベースプロキシの注意事項について説明します。

- プロキシ接続アドレスを使用する場合、トランザクション分割が有効になっていない場合、トランザクションリクエストはすべてマスターインスタンスにルーティングされます。

- データベースプロキシの設定は、アベイラビリティーゾーンをまたぐことをサポートします。選択可能なアベイラビリティーゾーンの数は、現在のリージョンでの選択可能なアベイラビリティーゾーンの数に関連しており、最大3つのアベイラビリティーゾーンを選択できます。選択可能なアベイラビリティーゾーンの数が1つの場合、現在のリージョンでの選択可能なアベイラビリティーゾーンの数は1つのみです。

- データベースプロキシアクセスアドレスを複数作成できます。その数は、データベースプロキシノードの数と同じです。つまり、ノード数と同じ数のデータベースプロキシアクセスアドレスを作成できます。

- プロキシ接続アドレスを使用して読み取り/書き込み分離を行う場合、非トランザクション読み取りの整合性は保証されません。業務上に読み取り整合性の要件がある場合、トランザクションにカプセル化するか、Hint構文を使用することができます。

- プロキシ接続アドレスを使用する場合、show processlistはすべてのノードの結果をマージして返します。

- prepareステートメントの場合、データベースプロキシは最初にすべてのノードにprepareを送信し、executeリクエストが到達した時点で、prepareステートメントのタイプに従ってexecuteのルートを決定します。書き込みステートメントをprepareした場合、execute時にメインデータベースに送信されます。prepareがトランザクション外の読み取りステートメントである場合は、読み取り専用インスタンスに送信されます。

 - 業務をデータベースプロキシに接続すると、プロキシはマスターインスタンスおよび設定されているすべての読み取り専用インスタンスに接続します。データベースプロキシ自体には最大接続数はありません。接続数の制限は、主にバックエンドデータベースインスタンスの最大接続数によって決まります（マスターインスタンスと読み取り専用インスタンスの最大接続数の最小値は、ビジネスパフォーマンスに影響を与えます）。

- データベースプロキシが有効になった後、読み取り専用インスタンスを追加したか、または読み取り専用インスタンスを再起動した場合、新しい接続リクエストのみが新しい読み取り専用インスタンスまたは再起動された読み取り専用インスタンスにルーティングされます。概要または[パフォーマンス監視](https://www.tencentcloud.com/document/product/236/42055)から、各プロキシノードのパフォーマンス指標を確認できます。各プロキシノード間の接続数がアンバランスな場合、再度CLBによって接続を切断できます。

- データベースプロキシの各機能の対応バージョン：
 - アベイラビリティーゾーンをまたぐ機能：プロキシバージョンが1.3.1以降であることを確認してください。
 - 接続時のしきい値の保存：プロキシバージョンが1.2.1以降であることを確認してください。
 - 接続プール機能：プロキシバージョンが1.2.1以降であることを確認してください。
 - トランザクション分割機能：プロキシバージョンが1.3.1以降であることを確認してください。
 - 新しく追加された接続アドレス機能：プロキシバージョンが1.3.1以降であることを確認してください。
 >?データベースプロキシバージョンのアップグレード手順の詳細については、[データベースプロキシカーネルバージョンのアップグレード](https://www.tencentcloud.com/document/product/236/45627)をご参照ください。

