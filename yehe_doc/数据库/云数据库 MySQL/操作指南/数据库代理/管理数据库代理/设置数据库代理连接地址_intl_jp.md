ここでは、TencentDB for MySQLコンソールを介してデータベースプロキシ接続アドレスを設定する方法をご紹介します。

データベースプロキシ接続アドレスは、元のデータベースの接続アドレスから独立しています。データベースプロキシアドレスを介したすべてのリクエストは、プロキシクラスターを介して中継され、データベースのマスターノードとスレーブノードにアクセスし、読み取り/書き込み分離を行います。読み取りリクエストは読み取り専用インスタンスに転送され、マスターデータベースの負荷が軽減されます。
TencentDB for MySQLは、データベースプロキシを有効化した後、デフォルトでデータベースプロキシ接続アドレスを提供します。データベースプロキシ接続アドレスを追加したり、データベースプロキシ接続アドレスを変更したり、データベースプロキシ接続アドレスを削除したりすることもできます。

##  前提条件
［データベースプロキシのアクティブ化］(https://www.tencentcloud.com/document/product/236/42052)が完了していること。

## データベースプロキシ接続アドレスの変更
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストで、プロキシを有効化したマスターインスタンスを選択し、インスタンスIDまたは**操作**の列の**管理**をクリックし、インスタンス管理ページに進みます。
2. インスタンス管理ページで、**データベースプロキシ**ページを選択し、**接続アドレス**の対応する**プライベートネットワークアクセスアドレス**の後に<img src="https://main.qcloudimg.com/raw/be716b5360d5256a9d5e816e29872ec1.png"  style="margin:0;">アイコンをクリックします。
![](https://main.qcloudimg.com/raw/63015c402bdd31e04e2597af84013a74.png)
3. ポップアップしたダイアログボックスで、プロキシアドレスを修正した後、**OK**をクリックします。
>!プライベートネットワークアドレスの修正は、アクセス中のデータベース業務に影響を与える恐れがあるため、オフピーク時に修正することをお勧めします。業務に再接続メカニズムが備わっていることを確認してください。
>
![](https://main.qcloudimg.com/raw/982fd53d880ab1a6d4f8df0372a99613.png)

## データベースプロキシ接続アドレスの追加
>?
>- 有効化されたデータベースプロキシには、ノードと同じ数の接続アドレスがあります。
>- データベースプロキシが有効化されると、デフォルトで接続アドレスが作成されます。
>
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストで、プロキシを有効化したマスターインスタンスを選択し、インスタンスIDまたは**操作**の列の**管理**をクリックし、インスタンス管理ページに進みます。
2. インスタンス管理ページで、**データベースプロキシ**ページを選択し、**接続アドレス**の後に**アクセスアドレスの追加**をクリックします。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/iVTk464_19.png)
3. 新しく作成された接続ウィンドウで、次の構成を完了し、**OK**をクリックします。
**手順1：ネットワークの構成**
<table>
<thead><tr><th>パラメータ</th><th>説明</th></tr></thead>
<tbody><tr>
<td>ネットワーク</td>
<td>データベースプロキシのネットワークを選択します。Virtual Private Cloud（VPC）のみサポートします。IPの自動アサインまたはIPの指定を選択することをサポートします。</td></tr>
<tr>
<td>セキュリティグループ</td>
<td>デフォルトで選択されたセキュリティグループは、マスターインスタンスと一致しています。必要に応じて、既存のセキュリティグループを選択するか、新しいセキュリティグループを作成することもできます。複数のセキュリティグループをサポートします。<blockquote class="rno-document-tips rno-document-tips-notice">    <div class="rno-document-tips-body">        <i class="rno-document-tip-icon"></i>        <div class="rno-document-tip-title">注意</div>        <div class="rno-document-tip-desc"><p>データベースプロキシにアクセスするには、セキュリティポリシーの構成を有効化し、プライベートネットワークアクセスポートをインターネットにオープンする必要があります（現在のプライベートネットワークポートは3306です）。具体的には<a href="https://intl.cloud.tencent.com/document/product/236/14470">MySQLセキュリティグループの構成をご参照ください</a>。</p></div>    </div></blockquote></td></tr>
<tr>
<td>備考</td>
<td>これは必須ではなく、新しく追加したデータベースプロキシ接続アドレスについてコメントすることができます。</td></tr>
</tbody></table>
<b>手順2：ポリシーの構成</b>
<table>
<thead><tr><th>パラメータ</th><th>説明</th></tr></thead>
<tbody><tr>
<td>読み取り/書き込み属性</td>
<td>このプロキシアクセスアドレスの読み取り/書き込み属性を選択し、読み取り/書き込み分離または読み取り専用の選択をサポートします。</td></tr>
<tr>
<td>読み取り専用インスタンスのディレー削除</td>
<td>読み取り専用インスタンスのディレー削除ポリシーを設定します。このオプションを有効にすると、ディレー削除のしきい値と読み取り専用インスタンスの最小予約数を設定できます。このオプションが有効かどうかに関係なく、読み取り専用インスタンスに障害が発生すると、削除とリカバーが試行されます。<ul><li>ディレー削除のしきい値：1以上の整数を秒単位で入力します。</li><li>読み取り専用インスタンスの最小予約数：この数は、マスターインスタンスが所有する読み取り専用インスタンスの数に関連しています。0に設定すると、すべての読み取り専用ノードが削除されると、読み取り専用インスタンスが再び参加するまで、すべてのアクセスがマスターインスタンスに転送されます。</li></ul></td></tr>
<tr>
<td>接続プールのステータス</td>
<td>接続プール機能は、主に短い接続サービスで頻繁に新しい接続を確立することによるインスタンスの負荷を軽減するために使用されます。。このオプションを有効にすると、サポートされている接続プールタイプを選択できます。現在、デフォルトでセッションレベルの接続プールのみサポートします。</td></tr>
<tr>
<td>トランザクションの分割</td>
<td>有効化するかどうかを設定します。有効化すると、読み取りと書き込みは1つのトランザクションで実行するために別のインスタンスに分割され、読み取りリクエストは読み取り専用インスタンスに転送され、マスターインスタンスの負荷を軽減します。</td></tr>
<tr>
<td>読み取りウェイトのアサイン</td>
<td>システムによる自動アサインまたはカスタマイズの選択をサポートします。データベースプロキシを有効化するときに複数のアベイラビリティゾーンを構成した場合、異なるアベイラビリティゾーンのプロキシノードを介してデータベースにアクセスするためのウェイトを個別に構成することをサポートします。</td></tr>
<tr>
<td>フェイルオーバー（読み取り/書き込みの属性は読み取り/書き込み分離です)</td>
<td>有効化するかどうかを設定します。有効化すると、データベースプロキシに故障が発生した場合、接続アドレスはマスターインスタンスにルーティングされます。</td></tr>
<tr>
<td>読み取り専用インスタンスの自動追加</td>
<td>有効化するかどうかを設定します。有効化すると、新しい読み取り専用インスタンスを購入する場合は、データベースプロキシに自動的に追加されます。<ul><li>読み取りウェイトがシステムによって自動的にアサインされると、新しく購入した読み取り専用インスタンスは、サイズのデフォルトのウェイトに従ってアサインされます。</li><li>読み取りウェイトをカスタマイズすると、新しく購入した読み取り専用インスタンスのウェイトは、参加時にデフォルトで0になり、データベースプロキシページの接続アドレスの下にある構成の調整で変更できます。</li></ul></td></tr>
</tbody></table>

## データベースプロキシ接続アドレスの削除
>?データベースプロキシの下に複数のプロキシ接続アドレスがある場合、不要な接続アドレスの削除をサポートしますが、最後のアドレスの削除をサポートしません。
>
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストで、プロキシを有効化したマスターインスタンスを選択し、インスタンスIDまたは**操作**の列の**管理**をクリックし、インスタンス管理ページに進みます。
2. インスタンス管理ページで、**データベースプロキシ**ページを選択し、**接続アドレス**の下でターゲットアドレスを見つけて**閉じる**クリックします。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/7FDj373_20.png)
3. ポップアップしたダイアログボックスで、**OK**をクリックします。

