## 概要
MySQLでは、透過的データ暗号化（TDE）機能を提供しています。TDEとは、データの透過的暗号化/復号化を指します。TDEは、データファイルに対するリアルタイムなI/O暗号化と復号化をサポートしています。データをディスクに書き込む前に暗号化して、ディスクからメモリに読み込む時に復号するため、静的データ暗号化におけるコンプライアンス要件を満たすことができます。

## 制限条件
- インスタンスタイプはMySQL 5.7またはMySQL 8.0である必要があります。
- Key Management Service（KMS）が有効になっている必要があります。有効になっていない場合は、データ暗号化を有効にする際に、ガイダンスに従って有効化してください。
- KMSのキー権限が承認されている必要があります。未承認の場合は、データ暗号化を有効にする際に、ガイダンスに従って権限承認を行ってください。
- アカウントを操作するにはQcloudAccessForMySQLRoleの権限が必要です。権限がない場合は、データ暗号化を有効にする際に、ガイダンスに従って権限承認を行ってください。
>?
>- 暗号化に使用するキーは[Key Management Service(KMS)](https://intl.cloud.tencent.com/document/product/1030/32774)によって生成および管理されます。MySQLでは暗号化に必要なキーおよび証明書を提供しません。
>- TDEは、別途料金が発生することはありませんが、KMSは別途料金が発生することがあります。詳細については、[料金概要](https://intl.cloud.tencent.com/document/product/1030/31966)をご参照ください。
- 料金滞納状態のアカウントでは、KMSからキーを取得できず、遷移やアップデートなどのタスクが正常に行われない場合があります。詳細については、[料金滞納](https://intl.cloud.tencent.com/document/product/1030/31968)をご参照ください。

## 注意事項
- 権限承認関係を取り消した後にリスタートすると、MySQLデータベースが使用できなくなる場合があります。
- TDE暗号化機能を有効化した後に無効化することはできません。
- TDE暗号化機能を有効化した後、ユーザーはデータをローカルにリカバーするには、先にデータの復号を行う必要があります。
- TDE暗号化機能を有効にすると、静的データの安全性を向上させることができますが、暗号化されたデータベースにアクセスする場合の読み取り/書き込みパフォーマンスに影響を与えるおそれがあります。TDE暗号化機能の有効化は実際の状況に応じて選択してください。
- ディザスタリカバリインスタンスのデータ同期の失敗を防ぐため、マスターインスタンスがディザスタリカバリインスタンスにアソシエイトされている場合、マスターインスタンスでデータ暗号化をスムーズに利用するためには、手動でディザスタリカバリインスタンスのTDE暗号化機能を有効化する必要があります。
- KMSシステムにアクセスできず、インスタンスの遷移に失敗するおそれがあるため、TDE暗号化機能を有効化すると、アカウントの残高が0以上であることを確認してください。
- TDE暗号化機能を有効化すると、CPUリソースの消費が増加する場合があります。


## 操作手順
### TDE暗号化機能の有効化
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストからインスタンスID、または**操作**列の**管理**をクリックして、管理ページに進んでください。
2. **データ暗号化**ページを選択し、**暗号化状態**のスイッチをクリックしてください。
>!
>- データ暗号化機能が有効になっているインスタンスは、物理バックアップを使用して他のサーバー上の自作データベースへのリカバーをサポートしません。
>- データ暗号化は有効化した後に終了することはできません。
>
![](https://main.qcloudimg.com/raw/bc032cee3e68506b77c044622e8c029f.png)
3. ポップアップしたダイアログボックスで、KMSサービスのアクティブ化とKMSキーの権限承認を行い、キーを選択した後、**暗号化**をクリックしてください。
   - **Tencent Cloudが自動的に生成したキーを使用する**を選択すると、Tencent Cloudがキーを自動的に生成します。
    ![](https://main.qcloudimg.com/raw/d54abe36c8e392c09b39045f0b7a5b95.png)
   - **既存のカスタマイズキーを使用する**を選択すると、ご自身で作成したキーを選択できます。
>?カスタマイズキーがない場合は、**作成に進む**をクリックし、KMSコンソールでキーを作成してください。詳細については、[キーの作成](https://intl.cloud.tencent.com/document/product/1030/31971)をご参照ください。
>
![](https://main.qcloudimg.com/raw/39d442d9620f36c1d57b55a409e6f9e2.png)


### データテーブルの暗号化
TDE暗号化機能を有効にした後、ユーザーはデータを暗号化するには、MySQLのテーブルに対し次のDDL操作を実行する必要があります。
- テーブルの作成時にテーブルを暗号化する場合は、次のコマンドを実行してください。
```
CREATE TABLE t1 (c1 INT) ENCRYPTION=’Y’;
```
- 作成済みのテーブルを暗号化する場合は、次のコマンドを実行してください。
```
ALTER TABLE t1 ENCRYPTION=’Y’;
```

### データテーブルの復号化
TDE暗号化機能を有効にした後、ユーザーはデータを復号するには、MySQLのテーブルに対し次のDDL操作を実行する必要があります。
暗号化されたテーブルを復号する場合は、次のコマンドを実行してください。
```
ALTER TABLE t1 ENCRYPTION=’N’;
```

