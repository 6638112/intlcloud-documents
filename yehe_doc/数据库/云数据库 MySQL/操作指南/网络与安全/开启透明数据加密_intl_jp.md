## 操作ケース
MySQLは、透過的なデータ暗号化（Transparent Data Encryption、TDE）機能を提供します。透過的な暗号化とはデータの暗号化と復号化操作がユーザーに対して透明であり、データファイルのリアルタイムI/O暗号化と復号化をサポートし、データがディスクに書き込まれる前に暗号化を実行し、ディスクからメモリに読み込まれるときに復号化することで、静的データ暗号化のコンプライアンス要件を満たすことができます。

## 制限条件
- インスタンスタイプはMySQL 5.7である必要があります。
- 暗号鍵管理サービスKMSがすでに有効になっています。無効状態になっている場合、データ暗号化を有効にするときにガイドに従ってKMSを有効にしてください。
- KMSにキー権限が付与されています。権限が付与されていない場合、データ暗号化を有効にするときにガイドに従って権限を付与してください。
- 操作アカウントにはQcloudAccessForMySQLRoleの権限が必要です。権限がない場合は、データ暗号化を有効にするときにガイドに従って権限を付与してください。
>?暗号化に使用されるキーは、[キー管理サービスKMS](https://intl.cloud.tencent.com/document/product/1030/32774)によって生成および管理されます。MySQLは、暗号化に必要なキーおよび証明書を提供しません。

## 注意事項
- 権限付与関係を取り消した後、再起動するとMySQLデータベースが使用できなくなります。
- TDE暗号化機能を有効にした後は無効にできません。
- TDE暗号化機能が有効になっている場合、ユーザーがデータをローカルに復元するには、まずデータを復号化する必要があります。
- TDE暗号化機能を有効にすると、静的データのセキュリティが向上しますが、暗号化データベースへの読み取りと書き込みのパフォーマンスに影響を与える可能性があります。TDE暗号化機能を有効にするには、状況に合わせて選択してください。
- マスターインスタンスが災害復旧インスタンスと関連付られている場合、災害復旧インスタンスのTDE暗号化機能を能動的に有効にして、データの暗号化を利用できます。さもなければ、災害復旧インスタンスのデータ同期失敗につながります。

## 操作手順
### TDE暗号化機能を有効にする
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストのページでインスタンス名または「操作」カラムの【管理】をクリックすると、インスタンス管理画面に入ります。
2. 【データ暗号化】ページを選択し、【暗号化ステータス】の後のスイッチをクリックします。
>!
>- データ暗号化機能が有効になっているインスタンスは、物理バックアップを使用して別のホスト上の自己構築データベースにリストアすることはサポートされていません。
>- データ暗号化を有効にすると、無効にすることができません。
>
![](https://main.qcloudimg.com/raw/bc032cee3e68506b77c044622e8c029f.png)
3. 表示されたダイアログで、KMSサービスを有効にし、KMSキー権限を付与します。キーを選択したら、【暗号化】をクリックします。
  - 【Tencent Cloudで自動生成されたキーを使用する】を選択すると、Tencent Cloudで自動的にキーが生成されます。
    ![](https://main.qcloudimg.com/raw/d54abe36c8e392c09b39045f0b7a5b95.png)
  - 【既存のカスタムキーを使用する】を選択すると、自分で作成したキーを選択できます。
  >?カスタムキーがない場合は、【作成する】をクリックしてキー管理システムコンソールでキーを作成します。詳細については[キーの作成](https://intl.cloud.tencent.com/document/product/1030/31971)をご参照ください。
  >
  ![](https://main.qcloudimg.com/raw/39d442d9620f36c1d57b55a409e6f9e2.png)


### データテーブルの暗号化
TDE暗号化機能が有効になっている場合、ユーザーはMySQLのテーブルに対して次のDDL操作を実行してデータを暗号化する必要があります。
- テーブルの作成時にテーブルを暗号化する場合は、次のコマンドを実行してください。
```
CREATE TABLE t1 (c1 INT) ENCRYPTION=’Y’;
```
- 作成したテーブルを暗号化する場合は、次のコマンドを実行してください。
```
ALTER TABLE t1 ENCRYPTION=’Y’;
```

### データテーブルの復号化
データ暗号化機能が有効になっている場合、データ復号化には、ユーザーがMySQLのテーブルに対して次のDDL操作を実行する必要があります。
暗号化されたテーブルを復号化する場合は、次のコマンドを実行してください。
```
ALTER TABLE t1 ENCRYPTION=’N’;
```
