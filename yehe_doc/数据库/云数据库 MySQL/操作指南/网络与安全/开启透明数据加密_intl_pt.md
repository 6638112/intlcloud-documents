## Visão geral
O TencentDB for MySQL vem com o recurso de criptografia de dados transparente (TDE). A criptografia transparente significa que a criptografia e a descriptografia de dados são transparentes para os usuários. A TDE permite a criptografia e a descriptografia de arquivos de dados de E/S em tempo real. Ele criptografa os dados antes de serem gravados no disco e descriptografa os dados quando são lidos na memória a partir do disco, o que atende aos requisitos de conformidade da criptografia de dados estáticos.

## Limites
- A versão do banco de dados deve ser MySQL 5.7 ou 8.0.
- O Key Management Service (KMS) deve estar ativado. Para isso, você pode seguir as instruções fornecidas durante o processo de ativação da TDE.
- As permissões de chave do KMS devem ser concedidas. Para isso, você pode seguir as instruções fornecidas durante o processo de ativação da TDE.
- Sua conta precisa da permissão `QcloudAccessForMySQLRole`. Para isso, você pode seguir as instruções fornecidas durante o processo de ativação da TDE.
>?As chaves usadas para criptografia são geradas e gerenciadas por [KMS](https://intl.cloud.tencent.com/document/product/1030/32774). O TencentDB for MySQL não fornece chaves ou certificados necessários para criptografia.
- Se sua conta tiver pagamentos em atraso, você não poderá obter chaves do KMS, o que pode causar falhas nas tarefas de migração e atualização de instâncias. Para obter mais informações, consulte [Notas sobre atrasos](https://intl.cloud.tencent.com/document/product/1030/31968).

## Observações
- Uma vez revogada a autorização, os bancos de dados MySQL ficarão inacessíveis ao reiniciar.
- Depois de ativar a TDE, você não pode desativá-lo.
- Depois que a TDE estiver ativada, você precisará descriptografar os dados antes de restaurá-los em um banco de dados local.
- A TDE aumenta a segurança de dados estáticos enquanto compromete o desempenho de leitura/gravação de bancos de dados criptografados. Portanto, use o recurso com base em suas necessidades reais.
- Se um nó mestre estiver associado a uma instância de recuperação de desastres, a TDE deverá ser habilitada no nó de recuperação de desastres. Caso contrário, a sincronização de dados da instância de recuperação de desastres poderá falhar.
- Após habilitar a TDE, o saldo da sua conta deve ser maior ou igual a zero. Caso contrário, a migração da instância pode falhar, pois o KMS está inacessível.
- Após a habilitação da TDE, mais recursos da CPU serão consumidos.


## Instruções
### Ativação da TDE
1. Faça login no [console do TencentDB for MySQL](https://console.cloud.tencent.com/cdb). Na lista de instâncias, clique em um ID de instância ou em **Manage (Gerenciar)** na coluna **Operation (Operação)** para acessar a página de gerenciamento da instância.
2. Na guia **Data Encryption (Criptografia de dados)**, ative a opção **Encryption Status (Status da criptografia)**.
>!
>- Uma instância com TDE habilitada não pode ser restaurada de um backup físico para um banco de dados autocriado em outro servidor.
>- Depois de ativar a TDE, você não pode desativá-la.
>
![](https://main.qcloudimg.com/raw/bc032cee3e68506b77c044622e8c029f.png)
3. Na caixa de diálogo pop-up, ative o KMS, conceda as permissões de chave KMS, selecione uma chave e clique em **Encrypt (Criptografar)**.
  - Se você selecionar **Use key auto-generated by Tencent Cloud (Usar chave gerada automaticamente pela Tencent Cloud)**, a chave será gerada automaticamente pela Tencent Cloud.
    ![](https://main.qcloudimg.com/raw/d54abe36c8e392c09b39045f0b7a5b95.png)
  - Se você selecionar **Use existing custom key (Usar chave personalizada existente)**, poderá selecionar uma chave criada por você.
>?Se não houver chaves personalizadas, clique em **go to create (criar)** para criar chaves no console KMS. Para mais informações, consulte [Criação de chave](https://intl.cloud.tencent.com/document/product/1030/31971).
>
![](https://main.qcloudimg.com/raw/39d442d9620f36c1d57b55a409e6f9e2.png)


### Criptografia de uma tabela
Depois de habilitar a TDE, você pode criptografar uma tabela de uma instância MySQL executando as instruções DDL de exemplo na tabela.
- Para criptografar uma tabela na criação, execute a seguinte instrução:
```
CREATE TABLE t1 (c1 INT) ENCRYPTION=’Y’;
```
- Para criptografar uma tabela existente, execute a seguinte instrução:
```
ALTER TABLE t1 ENCRYPTION=’Y’;
```

### Descriptografando uma tabela
Depois de habilitar a TDE, você pode descriptografar uma tabela de uma instância MySQL executando a instrução DDL de exemplo na tabela.
Para descriptografar uma tabela criptografada, execute a seguinte instrução:
```
ALTER TABLE t1 ENCRYPTION=’N’;
```
