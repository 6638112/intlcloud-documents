
## 작업 시나리오
데이터 일관성 검증 동안 DTS는 원본 데이터베이스와 대상 데이터베이스 간의 테이블 데이터를 비교하고 비교 결과와 불일치 세부 정보를 출력하여 비즈니스 컷오버 시간을 결정합니다. 데이터 일관성 검증 작업은 독립적이며 원본 데이터베이스 또는 기타 DTS 작업의 일반 비즈니스에 영향을 미치지 않습니다.

데이터 일관성 검증 작업은 자동으로 트리거되거나 수동으로 생성할 수 있습니다.

- 자동 트리거, 마이그레이션 작업을 구성할 때 **데이터 일관성 확인**에 **전체 마이그레이션 객체 확인**을 선택하면 후속 작업이 **동기화 증분** 단계로 진행될 때 일관성 검증 작업이 자동으로 트리거됩니다.
- 수동 생성, DTS 작업 단계가 **동기화 증분**으로 진행되면 일관성 검증 작업을 수동으로 생성하며, 여러 차례 생성할 수 있습니다.

## 주의 사항
- 데이터 일관성 검증 중에는 원본 데이터베이스에서 선택한 객체와 대상 데이터베이스로 마이그레이션된 객체만 비교합니다. 마이그레이션 중에 대상 데이터베이스에 데이터를 쓰는 경우 작성된 데이터는 일관성 검증에 포함되지 않습니다.
- 데이터 일관성 검증 작업은 원본 데이터베이스의 부하를 증가시킬 수 있습니다. 따라서 사용량이 적은 시간에 이러한 작업을 수행해야 합니다.
- 데이터 일관성 검증 작업은 반복적으로 실행할 수 있지만 하나의 DTS 인스턴스는 한 번에 하나의 작업만 시작할 수 있습니다.
- 데이터 일관성 검증 작업이 완료되기 전에 DTS 작업 **완료** 또는 **종료**를 선택하면 확인 작업이 실패합니다.
- 일관성 검증은 원본 데이터베이스에 새 데이터베이스 `__tencentdb__`를 생성하고 이 데이터베이스 아래에 CheckSum 테이블을 입력해야 하므로 원본 데이터베이스가 읽기 전용일 때 일관성 검증은 건너뜁니다. 

## 제한
현재 검증 작업은 DDL 작업에서 감지할 수 없습니다. 마이그레이션 중에 원본 데이터베이스에서 DDL 작업을 수행하면 확인 결과가 실제 데이터와 일치하지 않으며 정확한 비교 결과를 얻으려면 다른 확인 작업을 시작해야 합니다.

## 일관성 검증 작업 자동 트리거

[데이터 마이그레이션 작업](https://console.cloud.tencent.com/dts/migration)의 **마이그레이션 옵션 설정 및 마이그레이션 객체 선택** 페이지에서  **데이터 일관성 확인**에 **전체 마이그레이션 객체 확인**을 선택하면 후속 작업이 **동기화 증분** 단계로 진행될 때 일관성 검증 작업이 자동으로 트리거됩니다.
> ?이 경우 전체 데이터 및 모든 데이터베이스 정보가 기본적으로 검증됩니다. 검증 객체를 필터링하려면 데이터 일관성 검증 작업을 수동으로 생성하십시오.

 

## 일관성 검증 작업 수동 생성

1. [DTS 콘솔](https://console.cloud.tencent.com/dts/migration)에 로그인합니다.
2. **데이터 마이그레이션** 페이지에서 대상 마이그레이션 작업을 선택하고 **작업** 열에서 **자세히** > **데이터 일관성 검증 작업 생성**을 클릭합니다.
3. **데이터 일관성 검증 생성**을 클릭합니다.
>?데이터 일관성 검증 생성을 클릭합니다. 데이터 일관성 검증 작업은 해당 DTS 작업이 **증분 동기화** 단계에 있는 경우에만 생성할 수 있습니다. 버튼이 회색으로 표시되면 DTS 작업 상태가 요구 사항을 충족하지 않는 것입니다. 예를 들어 작업이 **증분 동기화** 단계에 들어가지 않았거나 실패했거나 종료되었습니다.
>
![](https://qcloudimg.tencent-cloud.cn/raw/ee3616aae11c9f83adf25c902db03c09.png)
4. 팝업 창에서 **확인**을 클릭합니다.
<img src="https://qcloudimg.tencent-cloud.cn/raw/7f8dfed208808b5fd3fb3805541becaf.png" style="zoom:50%;" />
5. 데이터 일관성 검증 매개변수를 구성한 후 **데이터 비교 시작**을 클릭합니다.
 - 객체 검증: **모든 마이그레이션 객체** 또는 **사용자 지정**을 선택합니다.
 - 데이터베이스 정보: **인덱스**, **샤드 키**(원본 및 대상 데이터베이스가 모두 샤딩된 클러스터인 경우) 또는 **데이터베이스 및 테이블**을 선택하여 검증합니다.
 - 데이터 검증: 행 개수 검증 옵션은 원본 데이터베이스와 대상 데이터베이스의 데이터 행 수를 비교합니다. 콘텐츠 검증 옵션은 원본 및 대상 데이터베이스의 데이터 내용을 비교합니다.
 - 샘플링 비율: 데이터 양이 많은 시나리오에서 검증을 위해 모든 데이터를 추출하면 원본 데이터베이스의 부하가 증가할 수 있습니다. 콘텐츠 검증을 선택하면 비즈니스 상황에 따라 적절한 비율을 설정하여 비교를 위해 일정 비율의 데이터를 추출할 수 있습니다.
![](https://qcloudimg.tencent-cloud.cn/raw/33f22832c023c6e5c823482cba5ae8fe.png)

## 데이터 일관성 검증 결과 조회
1. 마이그레이션 작업 홈페이지의 **마지막 검증 결과** 열에서 일관성 여부에 관계없이 검증 결과를 볼 수 있으며 **더 보기**를 클릭하여 검증 세부 정보 페이지로 들어갈 수 있습니다.
![](https://qcloudimg.tencent-cloud.cn/raw/c43043ec0d950c05a9703f173c8659e9.png)   
2. **조회**를 클릭하면 검증 결과를 볼 수 있습니다.
![](https://qcloudimg.tencent-cloud.cn/raw/d29df913b865c78894eb626162540a2c.png)
**데이터가 일관되면 결과는 다음과 같습니다.**
![](https://qcloudimg.tencent-cloud.cn/raw/d3240dd21121889c53285e590fc32b13.png)<br>
**데이터가 일치하지 않으면 결과는 다음과 같습니다.**  

