## 툴 소개
[redis-port 다운로드(Linux 64비트)](https://redis-doc-2020-1254408587.cos.ap-guangzhou.myqcloud.com/redis-port.tgz)

redis-port는 오픈 소스 그룹으로 Redis 노드 간의 데이터베이스 동기화, 데이터 가져오기, 데이터 내보내기에 사용하며 Redis의 버전 간의 데이터 마이그레이션을 지원합니다. 다음과 같은 툴을 제공합니다.
- redis-sync: Redis 인스턴스 간의 데이터 마이그레이션을 지원합니다.
- redis-restore: Redis의 백업 파일(RDB)을 지정 Redis 인스턴스로 가져오기를 지원합니다.
- redis-dump: Redis의 데이터를 RDB 형식으로 백업할 파일을 지원합니다.
- redis-decode: Redis 백업 파일(RDB)를 읽기 가능한 파일로 리졸브합니다.

## 호환 버전
- 원본 Redis 2.8, 3.0, 3.2, 4.0 버전을 지원합니다.
- 객체 인스턴스 Redis 2.8, 3.0, 3.2, 4.0 버전과 Redis 메모리 버전, CKV 버전 등 클라우드 데이터베이스의 모든 버전을 지원합니다.


## redis-sync 를 사용해 온라인 마이그레이션
**redis-sync 툴 마이그레이션 원리**
- 툴은 2개의 모듈로 나뉩니다. 원본 인스턴스 동기화 데이터를 복제 노드로 시뮬레이션하고, 복제한 데이터를 입력 명령어로 변환해 객체 인스턴스에 업데이트합니다.
- 데이터 복사는 모두 동기화 단계와 증분 동기화 단계, 2단계로 나뉘어집니다.

**매개변수 설명**:
- -n: 동시 입력한 작업 수량은 설정하지 않거나 CPU 코어 수량의 2배로 설정하시는 것을 권합니다.
- -m: 인스턴스 주소, 형식은 `"password"@ip:port`이며, 비밀번호 인증 면제 형식은 `ip:port`입니다.
- -t: 객체 인스턴스 주소, 형식은 `"password"@ip:port`, 비밀번호 인증 면제 형식은 `ip:port`입니다.
- --tmpfile=FILE: 임시 파일 명칭
- --tmpfile-size=SIZW: 임시 파일 최대 길이
- --help: 도움말 명령어 조회

**예시**:
```
./redis-sync -m 127.0.0.1:6379 -t "xxx2018"@10.0.5.8:6379
```

**출력 로그**: 

```
[root@VM_5_16_centos bin]# ./redis-sync -m 127.0.0.1:6379 -t "xxx2018"@10.0.5.8:6379
2019/02/21 09:56:00 sync.go:76: [INFO] sync: master = "127.0.0.1:6379", target = "xxx2018@10.0.5.8:6379"
2019/02/21 09:56:01 sync.go:103: [INFO] +
2019/02/21 09:56:01 sync.go:109: [INFO] sync: runid = "f63e2ad58e2fcc15c8cc122f15778389a012c1a4", offset = 18576271
2019/02/21 09:56:01 sync.go:110: [INFO] sync: rdb file = 9063349 (8.64mb)
2019/02/21 09:56:01 sync.go:208: [INFO] sync: (r/f,s/f,s) = (read,rdb.forward,rdb.skip/rdb.forward,rdb.skip)
2019/02/21 09:56:02 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(1703936/71754,0/0,0) ~ (1.62mb/-,-/-,-) ~ speed=(1.62mb/71754,0/0,0)
2019/02/21 09:56:03 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(3407872/153850,0/0,0) ~ (3.25mb/-,-/-,-) ~ speed=(1.62mb/82096,0/0,0)
2019/02/21 09:57:54 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(80487526/411969,0/1587212,0) ~  (76.76mb/-,-/-,-) ~ speed=(0/0,0/0,0)
```

**사용 설명**:
- 객체 인스턴스의 필요 db 수량이 원본 인스턴스의 db 수량보다 많지 않으면 마이그레이션에 실패합니다.
- 마이그레이션 중 네트워크가 중단되거나 다른 원인으로 끊기면 우선 객체 인스턴스를 비운 후 다시 마이그레이션을 진행해야 합니다. 그렇지 않을 경우 오손 데이터가 나타날 수 있습니다.
- 마이그레이션 진행도는 로그에 "sync: rdb = 9063349 - [100.00%]"로 표시됩니다. 해당 내용은 모든 데이터 동기화가 완료되었음을 의미하며, 증분 데이터 동기화가 진행중일 경우 "speed=(0/0,0/0,0)"는 증분 데이터 동기화가 완료되었음을 표시합니다.
- 마이그레이션을 중지하려면 Ctrl+C 명령어 혹은 다른 방식으로 툴을 실행해 데이터 동기화를 정지할 수 있습니다.

## redis-restore를 사용하여 데이터 가져오기
redis-restore 툴은 Redis의 백업 파일(RDB)을 지정 Redis 인스턴스로 가져옵니다. 동시에 AOF 파일과 Redis 2.8, 3.0, 3.2, 4.0 버전의 RDB 형식 파일 가져오기도 지원합니다.

**매개변수 설명**:
- -n: 동시 입력한 작업 수량은 설정하지 않거나 CPU 코어 수량의 2배로 설정하시는 것을 권합니다.
- -i: RDB 파일 경로
- -t: 객체 인스턴스 주소, 형식은 `"password"@ip:port`, 비밀번호 인증 면제 형식은 `ip:port`입니다.
- -a: AOF 파일 경로
- --db=DB: 백업 파일 가져오기 Redis 객체 인스턴스의 DB ID는 원본 인스턴스 DB ID와 일치해야 합니다.
- --unixtime-in-milliseconds=EXPR: 데이터 가져오기의 동시 업데이트 키 만료 시간 값
- --help: 도움말 명령어 조회

**예시**:
```
./redis-restore dump.rdb -t 127.0.0.1:6379
```


## redis-dump 백업 데이터 사용
redis-dump는 Redis의 데이터를 RDB 파일로 백업을 지원하며, 동시에 AOF 증분 데이터 백업도 가능합니다.
>?Tencent Cloud TencentDB for Redis는 redis-dump를 사용한 툴 백업을 지원하지 않습니다. Redis 데이터베이스 콘솔 혹은 API를 사용해 데이터 백업과 다운로드를 진행하거나, redis-dump 툴을 사용해 자체구축한 Redis 인스턴스를 사용할 수 있습니다.

**매개변수 설명**:
- -n: 동시 입력한 작업 수량은 설정하지 않거나 CPU 코어 수량의 2배로 설정하시는 것을 권합니다.
- -m: Redis 인스턴스 주소, 형식은 `"password"@ip:port`이며, 비밀번호 인증 면제 형식은 `ip:port`입니다.
- -o: 백업 출력의 RDB 파일 경로입니다.
- -a: 백업 출력의 AOF 파일 경로입니다.
- --help: 도움말 조회

**예시**:
```
./redis-dump  127.0.0.1:6379 -o dump.rdb
```

