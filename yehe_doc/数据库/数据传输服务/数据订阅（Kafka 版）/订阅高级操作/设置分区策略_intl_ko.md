## 작업 시나리오

여러 Kafka 파티션을 사용하는 경우 파티션 정책을 설정하여 관련 비즈니스 데이터를 동일한 파티션으로 라우팅하여 소비된 데이터를 더 쉽게 처리할 수 있습니다. DTS는 테이블 이름, 테이블 이름+기본 키 또는 열로 분할을 지원하고 해시 규칙에 따라 구독 데이터를 각 Kafka 파티션으로 라우팅합니다.

- Kafka 파티션 정책 - 테이블 이름 기준: 원본 데이터베이스에서 구독 데이터를 테이블 이름으로 파티션합니다. 이 정책을 사용하면 동일한 테이블 이름을 가진 데이터가 동일한 Kafka 파티션에 기록됩니다. 데이터 소비 중 동일한 테이블의 데이터 변경 사항은 항상 순차적으로 가져옵니다.

- Kafka 파티션 정책 - 테이블 이름+기본 키 기준: 원본 데이터베이스에서 구독 데이터를 테이블 이름과 기본 키로 파티션합니다. 이 정책은 자주 액세스하는 데이터에 적합합니다. 이 정책을 사용하면 자주 액세스하는 데이터를 테이블 이름과 기본 키별로 테이블에서 다른 파티션으로 분산하여 동시 소비 효율성을 향상시킵니다.

- 사용자 정의 파티션 정책: 먼저 정규식을 통해 구독 데이터의 데이터베이스 및 테이블 이름을 일치시킵니다. 그런 다음 일치하는 데이터는 테이블 이름, 테이블 이름+기본 키 또는 열별로 분할됩니다.

![](https://qcloudimg.tencent-cloud.cn/raw/8940837bcb9f2de49a1affe29d260acd.png)

## Kafka 파티션 정책

#### 테이블 이름 기준

원본 데이터베이스에 데이터가 변경되면 변경된 데이터가 구독 Topic에 기록됩니다. **테이블 이름 기준**을 선택하면 동일한 테이블 이름의 구독 데이터가 동일한 Kafka 파티션에 기록됩니다. 데이터 소비 중에는 동일한 테이블의 데이터 변경 사항을 항상 순차적으로 가져오도록 보장할 수 있습니다.

<img src="https://qcloudimg.tencent-cloud.cn/raw/808946984e2c89dc3509771720349853.png" style="zoom:70%;" />

#### 테이블 이름+기본 키 기준

테이블 이름 기준을 선택하면 자주 액세스하는 테이블의 데이터가 동일한 Kafka 파티션에 기록되므로 파티션에 큰 부담이 됩니다. **테이블 이름+기본 키 기준**을 선택하여 이러한 데이터를 다른 파티션에 배포하여 동시 소비 효율성을 높일 수 있습니다.
<img src="https://qcloudimg.tencent-cloud.cn/raw/72e0850f0cbfd203bb279a2b2ba86e46.png" style="zoom:70%;" />

## 사용자 지정 파티션 정책

사용자 지정 분할 정책을 사용하면 먼저 정규식을 통해 데이터베이스 및 테이블 이름을 일치시킵니다. 그런 다음 일치하는 데이터는 테이블 이름, 테이블 이름+기본 키 또는 열별로 분할됩니다.

#### 매칭 규칙

- 데이터베이스, 테이블 및 테이블 이름 매칭 규칙은 RE2 정규식을 지원합니다. 구체적인 구문은 [구문](https://github.com/google/re2/wiki/Syntax)을 참고하십시오.
- 데이터베이스/테이블 이름 매칭 규칙은 정규식을 기반으로 **데이터베이스/테이블 이름**과 매칭합니다. 데이터베이스 또는 테이블 이름을 정확히 매칭시키려면 `test` 테이블의 경우 `^test$`와 같이 시작 및 종료 기호를 추가해야 합니다.
- 열 이름 매칭 규칙은 대소문자를 구분하지 않고 `==`를 통해 열을 찾습니다.
- 먼저 데이터 매칭을 위해 사용자 지정 분할 정책이 사용됩니다. 누락된 경우 구성된 Kafka 파티션 정책에 따라 데이터가 매칭됩니다. 사용자 지정 분할 정책이 여러 개인 경우 위에서 아래로 하나씩 매칭됩니다.

#### 테이블 이름 기준

데이터베이스 이름 매칭에 `^A$`를 입력하고 테이블 이름 매칭에 `^test$`를 입력합니다. **테이블 이름 기준**을 선택하면 데이터베이스 `A`에 있는 `test` 테이블의 구독 데이터가 동일한 파티션에 기록됩니다. 매칭되지 않는 다른 테이블의 데이터는 Kafka 파티션 정책에 설정된 정책에 따라 작성됩니다.

![](https://qcloudimg.tencent-cloud.cn/raw/59cce1a9687a81650c4a9e8a2a864a84.png)

#### 테이블 이름+기본 키 기준

데이터베이스 이름 매칭에 `^A$`를 입력하고 테이블 이름 매칭에 `^test$`를 입력합니다. **테이블 이름+기본 키 기준**을 선택하면 데이터베이스 `A`에 있는 `test` 테이블의 구독 데이터가 기본 키로 다른 파티션에 무작위로 기록되고 동일한 기본 키를 가진 데이터 레코드가 결국 동일한 파티션에 기록됩니다. 다른 매칭되지 않는 테이블의 데이터는 Kafka 파티션 정책에 설정된 정책에 따라 작성됩니다.

![](https://qcloudimg.tencent-cloud.cn/raw/2467ca7289a9c6ce6c278afda5b803e1.png)

#### 열 기준

데이터베이스 이름 매칭에 `^A$`, 테이블 이름 매칭에 `^test$`, 사용자 지정 파티션 열에 `class`를 입력합니다. **열 기준**을 선택하면 데이터베이스 `A`에 있는 `test` 테이블의 `class` 열에 등록된 데이터가 무작위로 다른 파티션에 기록됩니다. 다른 매칭되지 않는 열/테이블의 데이터는 Kafka 파티션 정책에 설정된 정책에 따라 작성됩니다.

![](https://qcloudimg.tencent-cloud.cn/raw/eb193883cc0e6ad85e7630bd3e206a20.png)

