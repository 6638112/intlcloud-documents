데이터 전송 서비스(DTS)는 binlog를 기반으로 하는 증분 데이터 구독 기능을 제공합니다. 간단한 몇 가지 작업을 거치면 CDB TencentDB의 증분 업데이트 데이터를 구독할 수 있습니다.
1. [DTS 콘솔](https://console.cloud.tencent.com/dts/dss?rid=1&page=1&pagesize=20)에서 TencentDB 인스턴스의 구독 채널을 구입 및 생성합니다.
2. DTS 데이터 구독 SDK를 사용해 구독 채널을 연결하고 증분 데이터를 소비합니다.

## 구독 원리
데이터 구독은 시뮬레이션을 통해 데이터베이스에서 마스터 데이터베이스로 해당하는 binlog 콘텐츠를 가져와 분석합니다. 아키텍처는 다음과 같이 binlog를 분석해 구독 채널에서 설정한 DB 테이블에 따라 분석을 진행합니다. 이는 마스터 데이터베이스에는 거의 영향을 미치지 않습니다.
![](https://main.qcloudimg.com/raw/683946179562ed3261f8f69e15f2a389.png)

- 기본적으로 최근 1일까지 구독한 콘텐츠를 보관합니다.
- 인스턴스 단위로 구독하면 신규 DB 테이블도 원래 구독 채널에 표시되므로 구독 채널에 신규 설정 작업을 할 필요가 없습니다.
- 데이터베이스 단위로 구독하면 해당 DB의 신규 테이블도 원래 구독 채널에 표시되므로 구독 채널에 신규 설정 작업을 할 필요가 없습니다. 아래 방안에서 신규 데이터베이스가 필요할 경우, 신규 설정 작업을 진행해야 합니다.
- 데이터 구독 서비스는 현재 TencentDB for MySQL 5.6, MySQL 5.7을 지원합니다.
- 현재 데이터 구독은 뷰, 트리거와 외래 키를 지원하지 않습니다.
- 데이터 구독을 처음 설정할 시, 자동으로 관련 binlog_row_image와 binlog_format 매개변수를 조정합니다. 매개변수를 조정한 후에는 데이터 구독이 자동으로 인스턴스의 기존 연결을 kill함으로써 매개변수를 즉시 적용합니다. 또한 데이터 구독은 flush tables를 실행하여 구독 데이터의 테이블 구조를 획득할 수 있습니다. 이는 사용자의 데이터베이스 요청에 영향을 미칠 수 있으며, 비즈니스에 대한 영향을 확인해야 합니다.

## 작업 순서
### 1단계: 데이터 구독 채널 생성
1. [DTS 콘솔](https://console.cloud.tencent.com/dts/dss)에 로그인한 뒤 왼쪽 메뉴에서 [데이터 구독]을 선택해 [데이터 구독 생성]을 클릭합니다.
2. 데이터 구독 생성 페이지에서 적합한 구성을 선택하고 [즉시 구매]를 클릭합니다.
3. 활성화 성공 후, 데이터 구독 리스트로 돌아가 [초기화 설정]을 클릭하면 구매한 데이터 구독 채널의 초기화 설정을 할 수 있습니다.
4. 설정 페이지에서 원본 TencentDB 인스턴스를 선택하고 [다음 단계]를 클릭합니다.
![](https://main.qcloudimg.com/raw/35e57fe036eb66f5f6b679de3ebd2cf0.png)
5. 필요한 동기화 유형 및 DB 테이블을 선택합니다.
 - 데이터 구독의 데이터 대상은 데이터베이스와 테이블로 세분화되며, 사용자가 특정 데이터베이스 또는 테이블 구독을 선택할 수 있습니다.
 - 데이터 구독 유형은 데이터 업데이트, 구조 업데이트, 전체 인스턴스로 세분화됩니다.
 데이터 업데이트 및 구독 대상만 선택한 경우, insert, delete, update의 3가지 데이터 변경 내용만 구독할 수 있습니다.
 구조 업데이트(DDL)를 구독하려면 동기화 유형에서 구조 변경을 선택해야 합니다. 구조 변경을 구독하면 DTS가 전체 TencentDB 인스턴스의 모든 구조 업데이트를 가져옵니다. 사용자는 SDK를 사용해 필요한 데이터를 필터링해야 합니다.
 전체 인스턴스의 즉시 데이터 업데이트+구조 업데이트를 선택합니다.
![](https://main.qcloudimg.com/raw/92a2e19ad825bcc07ec03fb3258f4cb6.png)
6. 구독 대상과 유형을 확인한 후, [실행]을 클릭하면 구독 채널을 실행합니다.

### 2단계: 소비 시간 시작점 수정
DTS는 소비 프로세스 중 언제든 소비 시간 시작점을 수정할 수 있도록 지원합니다. 소비 시간 시작점이 수정되면 다운 스트리밍 SDK에서 가져온 증분 데이터는 수정된 소비 시간 시작점에서 시작됩니다.
>?DTS는 현재 콘솔의 소비 포인트 수정만 지원하며, SDK의 소비 포인트 지정은 지원하지 않습니다.

수정 순서는 다음과 같습니다.
1. SDK 소비 프로세스를 중단합니다.
[데이터 구독](https://console.cloud.tencent.com/dts/dss) 리스트에서 구독 ID 또는 '작업'열의 [구독 상세 보기]를 클릭해 구독 상세 페이지로 이동합니다. '소비자 출처(IP)'가 없음이면, 프로세스가 중지됩니다.
2. 소비 시간 시작점을 수정합니다.
[데이터 구독](https://console.cloud.tencent.com/dts/dss) 리스트에서 커서를 구독 소비 시간 시작점으로 이동하면 '소비 시간 시작점 수정' 아이콘이 나타납니다. 아이콘을 클릭해 수정 페이지로 들어가십시오.
>?수정된 소비 시간 시작점은 구독 채널의 데이터 범위 내에 있어야 합니다.
>
![](https://main.qcloudimg.com/raw/6136783707136c9c186ef5fec6e696bf.png)
3. SDK 소비 프로세스를 재시작합니다.
소비 시간 시작점을 수정한 뒤 로컬 SDK 소비 프로세스를 다시 시작할 수 있습니다. 이때 SDK는 수정된 소비 포인트에서부터 증분 데이터 구독을 시작합니다.

### 3단계: 구독 대상 수정
DTS는 구독 소비 중 구독 대상 동적 증가 또는 감소를 지원합니다.
- 구독 대상이 추가되면 구독 채널은 수정이 완료된 후의 현재 시간부터 신규 구독 대상의 증분 데이터를 풀링합니다.
- 구독 대상이 줄어들면 수정이 완료된 후 SDK는 이 대상의 데이터를 구독할 수 없습니다.

수정 순서는 다음과 같습니다.
1. [데이터 구독](https://console.cloud.tencent.com/dts/dss) 리스트에서 '작업'열의 [더보기]>[구독 대상 수정]을 선택해 구독 설정 페이지로 이동합니다.
2. 구독 설정 페이지에서 구독 객체를 수정하고 [저장]을 클릭합니다.
![](https://main.qcloudimg.com/raw/313fa9d664d86404be47d8832f825422.png)

### 4단계: SDK로 데이터 소비
[SDK 사용 가이드](https://intl.cloud.tencent.com/document/product/571/8776)를 참조 바랍니다.

## 구독 사례
[해당 구독 테이블의 변동을 로컬 파일로 풀링](https://intl.cloud.tencent.com/document/product/571/34107)
[해당 구독 테이블의 변동을 Redis로 풀링](https://intl.cloud.tencent.com/document/product/571/34106)
[해당 구독 테이블의 변동을 Kafka로 풀링](https://intl.cloud.tencent.com/document/product/571/16856)
