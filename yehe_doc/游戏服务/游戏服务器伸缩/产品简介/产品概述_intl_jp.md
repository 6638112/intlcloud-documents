Game Server Elastic-scaling（GSE）は、ゲーム専用のサーバーホスティングサービスを提供し、ステートフルなゲームサービスのデプロイとスケールイン・スケールアウトをサポートします。サービス検知、効率的で柔軟なサーバースケーリング、最寄りのスケジューリング機能が利用できます。安定かつ低遅延のマルチプレーヤーゲームのデプロイ環境をすぐに構築できるように開発者を支援するほか、メンテナンスコストを大幅に削減します。また、Unreal、Unityエンジンをサポートし、C#、C++およびgRPCがサポートするすべての言語のserveフレームワークのデプロイと実行が可能です。FPS、MOBA、ターン制、MMORPG、テーブルゲームのバトルスーツ、メッセージプッシュなど状態保持が必要なシナリオに適用されます。



## 製品アーキテクチャ 
Game Server Elastic-scalingはゲームコードパッケージに実行環境を提供します。その環境ではサービス検知、スケールイン・アウト、マルチリージョンへのデプロイ、最寄りのスケジューリング、開発者がサービスフレームでGSEのServerSDKを統合することができます。クライアントはAPIを通じてゲームサーバーをリクエストすると、GSEは、アクセスに最適なゲームサーバーをクライアントに提供します。

![全体的なアーキテクチャ](https://main.qcloudimg.com/raw/363390d57a27cac0a9b8adc3d4935a2f.png)


## 製品機能 

### プログラムのデプロイとアップデート 

#### プログラムのデプロイ
開発者はGSEを通じてプログラムコードパッケージのアップロードと依存ができます。GSEはプログラムをサービスフリート（fleet）にデプロイし、構成に従い起動します。

#### ノンストップのアップデート
ゲームシナリオは一般的にアップデートを停止しますが、GSEはエイリアスシステムにより、ノンストップのアップデートを実現します。

####A/Bテスト
簡単にA/B Testを実現または終了します。



### サーバーインスタンス管理 

### Auto Scaling 
- 1日サイクルでAuto Scalingをします。GSEはサービスインスタンスのタイプとスケーリング範囲の設定が可能です。インスタンスはその範囲内でスケーリングされます。毎日ゲームへのアクセスにはピークとオフピークがあります。通常、正午と夕方はサーバーインスタンスの数はピークとなり、夜中は、サーバーインスタンスの数は最低になります。GSEは、毎日絶えずサーバーアクセス数に応じて自動スケーリングを実行します。 
- ステートフルなスケールイン：GSEはプロセス実行中のインタンスを減らさず、低ロードでスケールインがトリガーされた場合、そのゲームプロセスがサーバーのスケールインを実行していることを通知し、新しいゲームサーバーセッションがサーバーにアサインされるのをブロックします。しかし、強制的にインスタンスを減らすことはありませんので、クライアントの接続は可能です。ゲームプロセスが終了コマンドを出す前に、プロセス停止とサーバー回収がトリガーされることはありません。


#### マルチリージョンにデプロイ
GSEは、マルチリージョンへのデプロイをサポートします。複数のエリアでサーバーフリートを構築し、それらでサーバーフリートのキューを構築しました。キューをリクエストする場合、システムが正常に実行している地域のサーバーフリートを自動選択し、ゲームクライアントがアクセスできるようにします。開発者は手動でフリートの優先順位を調整できます。ある地域で不具合が発生すると、短時間内にその他の地域に切り換わります。

#### グローバルリリース 
GSEは上海、北米を始め、多くのエリアにデプロイします。


### プロセスマネジメント 
#### プロセス起動  
GSEは、プロセスの起動パス、起動パラメーター、並列処理が可能なプロセス数に従うことにより、プロセスを開始します。

#### プロセスの準備  
プロセスの起動後、APIを呼び出してGSEにプロセスの準備が整ったことを通知すると、アクセスできるようになります。

#### プロセス健康診断  
GSEは定期的に健康診断を行います。プロセスが不健康だと、プロセスを遮断します。遮断されたプロセスが呼び出し元にアサインされることはありません。

#### プロセス終了  
- GSEがスケールインを必要としたり、健康診断が通過しなかったりすると、プロセスの終了を通知します。プロセスは終了するかどうかを選択できます。プロセスがすぐに終了しなかった場合、GSEはページ構成の保護ポリシーに基づきプロセスを取り扱います。
- またプロセスは主体的にAPIを呼び出してGSEに終了を通知することができます。

### ゲームサーバーセッション管理
GSEゲームサーバーセッションの管理とアサイン。業務からみると、ゲームサーバーセッションはゲームの対局を表わし、広義ではサービスを意味します。バックグラウンドプログラムからみると、ゲームサーバーセッションは1つのプロセスに対応し、GSEは構成に基づき先にプロセスを起動します。通常1つのプロセスが1個のゲームサービスセッションに対応します。クライアントはTencentCloud APIを通じて、クライアントにゲームサーバーセッション1個をアサインするようリクエストします。GSEは、ゲームサーバーセッションをアイドル状態のプロセスにアサインします。

####ゲームサーバーセッション開始    
呼び出し元がゲームサーバーセッションをリクエストすると、GSEは、アイドル状態かつ健常なプロセスをアサインして、ゲームサーバーセッションを開始します。

#### ゲームサーバーセッション終了  
ゲームサーバーセッションにプレイヤーがいないとき、またはゲームサーバーセッションが不健康なとき、ゲームサーバーセッションは主体的または受動的に終了します。終了前には、ログを保存します。これにより、開発者は問題に対処しやすくなります。

#### 最寄りのゲームサーバーセッションのアサイン  
GSEはネットワークディレーに基づき、プレイヤーから一番近い地域を選択して、プレイヤーにアサインできます。

#### サーバーは使用可能なゲームサーバーセッション割合に基づいてスケーリングを実行します。  
ゲームサーバーフリートでは、多様なスケールイン・アウトの条件としてゲームサーバーセッションバッファーを構成できます。ゲームサーバーセッションバッファーは、使用可能なゲームセッションの割合です。


### 監視とログ 
システムは、サーバーインスタンス（CVM）の監視、ゲームサーバーセッションの監視、操作ログを提供します。
