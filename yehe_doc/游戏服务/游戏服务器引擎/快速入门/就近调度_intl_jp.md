## 操作シナリオ
このドキュメントで、ゲームサーバーキューを通じた最寄りのスケジューリングの実現方法について主にガイドします。
## 前提条件 
- 上海とシリコンバレーの2個のサーバーフリートを作成します。操作手順：
  - [ビギナー向け例](https://intl.cloud.tencent.com/document/product/1055/37401) 操作完了までの最初の3つの手順：【ワンクリックでデモパッケージをアップロード】、【ワンクリックでサーバーフリートを作成】、【ゲームサーバーセッションの作成】をクリックし、最後に【完了】をクリックします。
- サーバーフリート1作成済み（上海地区）。
![](https://main.qcloudimg.com/raw/e9240bad9dc778191158a37dba941908.png)
- サーバーフリート2作成済み（米国地区）。
![](https://main.qcloudimg.com/raw/a22c7cb934124b91728523e56d42f3fc.png)

## 操作手順

### ゲームサーバーキューの作成

1. [GSEコンソール](https://console.cloud.tencent.com/gse)にログインし、左側のメニュー【ゲームサーバーキュー】をクリックして、ゲームサーバーキューページに入ります。
2. 左上のサービス地域を選択して、【新規作成】をクリックします。
3. ゲームサーバーキューの新規作成ページに入り、基本情報を記入します。
  - 識別子：有効な識別子を入力します。アルファベットのみが有効です。この例では「dispatchingnearby」と記入します。
  - タイムアウト時間をアサイン：ゲームサーバーセッションリクエストが複数エリアで待機できる最長時間を入力します。最大値は600秒です。この例では30秒で構成します。
4. ディレーポリシーを記入 
 - 最初の10秒で待機しているすべてのプレイヤーとの遅れが80ms以内のサーバーフリートを検出します。  
 - 次の10s（計20s）で待機しているすべてのプレイヤーとの遅れが100ms内のサーバーフリートを検出します。
 - 残りのタイムアウト時間の10s（= 30s - 10s - 10s）で待機しているすべてのプレイヤーとの遅れが150ms内のサーバーフリートを検出します。 
5. ターゲットが作成済みのサーバーフリート1（上海地区）とサーバーフリート2（米国地区）を選択します。
6. 【確定】をクリックすると、ゲームサーバーキューの作成は完了です。
![](https://main.qcloudimg.com/raw/24e976209f4592336cc4cbb4255e8cbc.png)

### キューを使用したゲームサーバーセッション配置開始について
「ゲームサーバーセッション配置開始」TencentCloud APIを通じて、ゲームサーバーセッションをサーバーフリートのプロセスに配置します。コードの中でTencentCloud APIを呼び出します。この例では [TencentCloud APIデバッグ](https://console.cloud.tencent.com/api/explorer?Product=gse&Version=2019-11-12&Action=StartGameServerSessionPlacement&SignVersion=) を通じてショートカットで作成します。

>?パラメータ説明の入力
>- Regionは地域です。この例では「華東地区（上海）」を選択します。
>- PlacementIdはゲームサーバーセッションのデプロイを開始する唯一の識別子です。この例では1と記入します。
>- GameServerSessionQueueNameはゲームサーバーセッションキューの名称です。この例では「dispatchingnearby」と記入します。
>- MaximumPlayerSessionCountはゲームサーバーセッションに同時に接続できる最大プレイヤー数です。この例では2を記入します。
>- DesiredPlayerSessions.Nはプレイヤーのゲームセッション情報です。このうちPlayerIdは、プレイヤーセッションと関連付ける唯一のプレイヤーマークです。この例では2セットを追加し、それぞれ1、2と記入します。
>- PlayerLatencies.Nはプレイヤーのディレーです。このうちPlayerIdはプレイヤーID、RegionIdentifierはディレーに関わるエリアの名称、LatencyInMillisecondsはミリ秒レベルのディレーのことです。この例では4セットを追加します。それぞれ[1，ap-shanghai，100]、[1，na-siliconvalley，50]、[2，ap-shanghai，60]、[2，na-siliconvalley，80]を記入します。

![](https://main.qcloudimg.com/raw/d0ef6f4ac7bcee9f340eecd53ae690cc.png)
![](https://main.qcloudimg.com/raw/d1e1c237f022a451afc4e0f9c598f5fe.png)
![](https://main.qcloudimg.com/raw/6d3d71aa4c6173ae78112727ac12abec.png)

#### ディレーポリシースケジューリング結果評価：

プレイヤー2人が目標アドレスに到達するまでのディレー状況 
- player1のディレーは、上海までは100ms、シリコンバレーまでは50msです。
- player2のディレーは、上海までは60ms、シリコンバレーまでは80msです。

ディレーポリシーでは、最初の10秒ですべてのプレイヤーのディレーが80ms内のサーバーを検出するように構成されています。このため、ゲームサーバーセッションはシリコンバレーまでスケジューリングします。

**API呼び出し後のテスト結果：**
ゲームサーバーセッションは、サーバーフリート2（米国地区）までスケジューリングします。
![](https://main.qcloudimg.com/raw/ee9c2397d8159b1fa4a8cb4964a0a8e6.png)



