## 설정 시나리오

도메인 원본 서버의 기본 정보, 원본 요청 프로토콜, 호스트 헤더 등의 정보를 원본 서버 설정 모듈에서 수정할 수 있습니다.


## 설정 가이드

### 주 원본 서버 설정

[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하여 메뉴에서 [도메인 관리]를 선택한 뒤, 도메인 오른쪽의 [관리]를 클릭하면 도메인 설정 페이지로 이동할 수 있습니다. 그중 첫 번째 메뉴의 도메인 기본 정보 하단에서 원본 서버 설정 모듈을 확인할 수 있습니다.
![img](https://main.qcloudimg.com/raw/524f3c9aa2f9f2017d53409ee610bb5b.png)
**원본 서버 유형**
외부 원본 서버: 안정적으로 실행되는 서비스 서버(즉 원본 서버)를 보유하고 있다면, 해당하는 IP 주소 리스트 혹은 도메인을 입력하여 원본 서버로 사용할 수 있습니다.
[객체 스토리지(COS)](https://intl.cloud.tencent.com/product/cos): 리소스가 Tencent Cloud의 COS에 저장되어 있다면, 특정 bucket을 원본 서버로 직접 선택할 수 있습니다.

**원본 프로토콜**
CDN 가속 노드가 사용자의 원본 서버에 Origin-pull할 때 사용하는 프로토콜로, HTTP 혹은 HTTPS를 사용합니다.

원본 서버 설정에서 도메인의 원본 프로토콜을 HTTP, HTTPS 혹은 원본 따라가기로 변경할 수 있습니다.

- **HTTP Origin-pull**: HTTP, HTTPS로 엑세스 시 모두 HTTP를 사용하여 Origin-pull합니다.
- **HTTPS Origin-pull**: HTTP, HTTPS 액세스 시 모두 HTTPS를 사용하여 Origin-pull합니다.
- **프로토콜 따르기**: HTTP 요청에는 HTTP를 사용하여, HTTPS 요청에는 HTTPS를 사용하여 Origin-pull합니다.

> !
> - HTTPS로 Origin-pull하는 상황이 존재하는 경우, 원본 서버는 반드시 HTTPS 액세스를 지원해야 하며, 그렇지 않을 경우 Origin-pull에 실패할 수 있습니다.
> - 현재 인증서 관리 페이지에서 해당 항목의 설정을 변경한 뒤, 다시 마이그레이션할 수 있습니다.



**원본 서버 주소**
<table>
<thead>
<tr>
<td style="width:80px">외부 원본</td>
<td style="padding-bottom:0px;padding-top:15px"><ul><li>여러 개의 원본 서버 IP(한 줄에 하나씩) 또는 하나의 도메인을 입력할 수 있습니다.
  <br><strong>멀티 IP 폴링 Origin-pull: </strong>멀티 IP 원본 서버(한 줄에 하나씩) 채우기 및 폴링을 지원합니다. CDN이 원본 서버의 점검 기능을 기본으로 활성화합니다. 한 IP의 Origin-pull 실패가 일정 임계 값을 초과하면 더는 해당 IP 주소에 Origin-pull하지 않으며, 일정 시간 동안 차단한 후 자동 복구합니다. <br>IPv6 원본 서버 베타 테스트 자격을 획득했으며, 도메인 추가 작업 시 IPv6 원본 서버를 활성화했을 경우 IPv6의 IP 원본 서버 1개를 채울 수 있습니다. <br><strong>도메인 Origin-pull: </strong>도메인을 원본 서버로 단독 설정할 수 있습니다. 이때 도메인은 서비스 가속 도메인과 일치하지 않아야 합니다. (현재 IPv6 도메인의 Origin-pull은 지원하지 않습니다.) <br><li> 포트(0 - 65535)와 가중치(1 - 100) 추가 설정 지원: 원본 서버:포트:가중치(포트 생략 가능: 원본 서버::가중치)<br><strong>주의: </strong>원본 프로토콜이 HTTPS 및 프로토콜을 따르는 경우, 443 포트 설정만 지원하거나 포트 설정이 지원되지 않습니다. <br><li>원본 서버 주소는 최대 511자까지 입력할 수 있습니다. </td></ul>
</tr>
</thead>
<tbody><tr>
<td>COS 원본</td>
<td>클라우드 스토리지에서 bucket 1개를 원본 서버로 선택할 경우 개인 버킷 액세스 활성화가 지원됩니다. </td>
</tr>
</tbody></table>




**호스트 헤더**
CDN 노드가 Origin-pull 할 때 원본 서버에서 액세스한 사이트 도메인, 즉 Origin-pull 도메인입니다. 가속 도메인으로 삼도록 기본 설정되어 있습니다. 와일드카드 서브도메인에 액세스하면 와일드카드 서브도메인으로 기본 설정되며, 실제 호스트 헤더는 액세스 도메인이 됩니다. 실제 비즈니스 상황에 따라 수정할 수 있습니다(주의: COS 원본의 경우 수정 불가). 자세한 설정 예시는 [Origin-pull 도메인 설정](https://intl.cloud.tencent.com/document/product/228/6289)을 참조 바랍니다.

> ?원본 서버 주소와 호스트 헤더의 차이는 다음과 같습니다.
> - 원본 서버 주소: 원본 서버 주소는 Origin-pull 시 요청된 구체적인 IP 주소를 결정합니다.
> - 호스트 헤더: 호스트 헤더는 Origin-pull 요청 시 액세스하는 해당 IP 주소의 구체적인 사이트를 결정합니다.

### 핫 백업 원본 서버 설정

귀하의 액티브 원본 서버를 백업 원본 서버로 추가할 수 있으며, 모든 원본 요청은 액티브 원본 서버에 먼저 액세스합니다. 4XX/5XX 에러 코드 출력, 링크 타임아웃, 프로토콜 비호환 등의 상황에서는 다시 핫 백업 원본 서버에 Origin-pull하여 리소스를 가져오므로, Origin-pull의 높은 가용성을 보장합니다.

핫 백업 원본 서버의 원본 서버 주, 호스트 헤더를 개별적으로 설정할 수 있습니다.
![img](https://main.qcloudimg.com/raw/4d2ba172412182eb87ba40149775689f.png)

>! 액티브 원본 서버가 IPv6 원본 서버를 활성화했을 경우, 핫 백업 원본 서버를 추가할 수 없습니다.

### 리전 특수 설정

사용자의 가속 도메인 서비스 지역이 글로벌 가속이며, 국제 트래픽 발생을 방지하기 위해 가속 도메인의 각 서비스 지역마다 원본 서버를 다르게 설정하려는 경우, 아래의 [특수 설정 추가]을 클릭하여 설정할 수 있습니다.
![img](https://main.qcloudimg.com/raw/d4a7a61ed28daa2c3eb0febf02ca931c.png)
다른 Origin-pull 정책이 필요한 지역을 선택한 뒤, 해당되는 원본 서버 정보를 입력하면 됩니다.

>!
> - 현재는 지역 특수 설정을 추가한 후 직접 삭제할 수 없습니다.
> - 지역 특수 설정이 기본 설정과 완전히 일치하는 경우 설정이 자동 병합되므로, 이러한 설정 방식을 통해 지역 특수 설정을 삭제할 수 있습니다.

## 설정 예시
[](id:exp)
### Origin-pull 도메인 설정

CDN 원본 서버의 설정이 아래와 같고, 가속 도메인 `www.test.com`의 설정이 아래와 같은 경우,
![img](https://main.qcloudimg.com/raw/ec2e007bb32723f7dd12aac17524c8af.png)
사용자의 액세스 경로는 다음과 같습니다.
사용자가 `http://www.test.com/test.txt` 리소스에 액세스할 때 CDN 노드에 해당 리소스가 아직 캐싱되지 않았다면, CDN 노드의 Origin-pull은 `www.abc.com` 도메인에 대한 리졸브를 진행합니다. 이를 통해 획득한 원본 서버 주소가 `1.1.1.1`이라고 가정할 때, `1.1.1.1` 서버에 액세스하며 그에 속한 웹 사이트인 `www.def.com` 경로에서 test.txt 파일을 찾아 사용자에게 반환합니다.

### 리전 특수 설정

Tencent Cloud CDN 원본 서버의 설정이 아래와 같고, 가속 도메인 `www.test.com`의 설정이 아래와 같은 경우,
![img](https://main.qcloudimg.com/raw/e9104ca2b0e38c62bdffb022a933b2b9.png)
실제 Origin-pull 시나리오는 다음과 같습니다.

1. 중국 내 사용자가 `http://www.test.com/test.txt` 파일에 액세스할 때 중국 내 노드에 해당 리소스가 아직 캐싱되지 않았다면, 서버 `1.1.1.1`에 요청하여 웹 사이트 `1.test.com`에서 test.txt 파일을 찾습니다. 만약 해당 리소스가 있으면 바로 사용자에게 반환하고, 없으면 2단계를 진행합니다.
2. CDN의 중국 내 노드가 액티브 원본 서버로 Origin-pull에 실패하여 리소스를 찾지 못했을 경우, 서버 `2.2.2.2`에 요청하여 웹 사이트 `1.test.com`에서 test.txt 파일을 찾아 사용자에게 반환 및 캐싱합니다.
3. 이때 중국 외 사용자 역시 `http://www.test.com/test/txt` 파일에 액세스하였고 중국 외 노드에 해당 리소스가 아직 캐싱되지 않았을 경우, 서버 `3.3.3.3`에 요청하여 웹 사이트 `3.test.com`에서 test.txt 파일을 찾습니다. 만약 해당 리소스가 있으면 바로 사용자에게 반환하고, 없으면 4단계를 진행합니다.
4. CDN의 중국 외 노드가 중국 외 액티브 원본 서버로 Origin-pull에 실패하여 리소스를 찾지 못했을 경우, 서버 `4.4.4.4`에 요청하여 웹 사이트 `4.test.com`에서 test.txt 파일을 찾아 사용자에게 반환 및 캐싱합니다.
