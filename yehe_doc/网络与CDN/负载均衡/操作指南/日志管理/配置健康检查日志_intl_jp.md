ヘルスチェックログを確認したい場合は、まずログをCloud Log Service（CLS）に保存し、CLSで確認する必要があります。CLBはヘルスチェックログのCLSへの保存をサポートしており、分単位でのログレポートおよびオンラインマルチルール検索が可能です。ヘルスチェックでの異常の原因をトラブルシューティングし、問題を迅速に特定する上で役立ちます。

<dx-alert infotype="explain" title="">
ヘルスチェックログ機能は現在ベータ版テスト段階です。ご利用を希望される場合は、[チケット申請](https://console.tencentcloud.com/workorder/category)を提出してください。
</dx-alert>

ヘルスチェックログ機能にはログレポート、ログのストレージと照会があります。
- ログレポート：業務の転送を優先的に保障した後にログレポートを保障します。
- ログのストレージと照会：現在使用中のストレージサービスに基づいてサービス品質保証（SLA）を提供します。

## 制限事項
- CLBのレイヤー4、レイヤー7プロトコルはどちらもヘルスチェックログのCLSへの設定をサポートしています。
- CLBによるヘルスチェックログのCLSへの保存設定機能は無料です。ユーザーにはCLSの料金のみがかかります。
- この機能をサポートしているのはCLB（旧「アプリケーション型CLB」）インスタンスタイプのみです。従来型CLBインスタンスタイプはサポートしていません。
- この機能をサポートしているのはIPバージョンがIPv4およびIPv6 NAT64のインスタンスのみです。IPv6バージョンのインスタンスは現時点ではサポートしていません。
- この機能は現在一部のリージョンでのみサポートしています。実際にサポートするリージョンはコンソールのサポートリージョンに準じます。


## ステップ1：ロール権限の追加[](id:step1)
CLSをアクティブ化していない場合は、先にCLSのアクティブ化を行ってからロール権限を追加してください。
1. [CLBコンソール](https://console.cloud.tencent.com/clb)にログインし、左側ナビゲーションバーの**ヘルスチェックログ**をクリックします。
2. 「ヘルスチェックログ」ページで**今すぐアクティブにする**をクリックし、ポップアップしたダイアログボックスで**権限を承認してアクティブにする**をクリックします。
<img src="" width="50%"/>
3. [CAMコンソール](https://console.cloud.tencent.com/cam/role)にリダイレクトし、「ロール管理」ページで**権限承認に同意**をクリックします。

## ステップ2：ログセットとログトピックの作成 [](id:step2)
ヘルスチェックログをCLSに保存するよう設定したい場合は、先にログセットとログトピックを作成する必要があります。
ログセットとログトピックを作成済みの場合は、スキップして[ステップ3](#step3)から操作を開始することができます。
1. [CLBコンソール](https://console.cloud.tencent.com/clb)にログインし、左側ナビゲーションバーの**ヘルスチェックログ**をクリックします。
2. **ヘルスチェックログ**ページの左上隅で所属リージョンを選択し、**ログセット情報**のエリアで**ログセットの作成**をクリックします。
3. ポップアップした**ログセットの作成**ダイアログボックスで保存期間を設定し、**保存**をクリックします。
4. **ヘルスチェックログ**ページの**ログトピック**のエリアで**ログトピックの新規作成**をクリックします。
5. ポップアップした**ログトピックの追加**ダイアログボックスで、ストレージタイプとログの保存期間を選択した後、左側のCLBインスタンスを選択して右側のリストに追加し、**保存**をクリックします。
>?
>- ストレージタイプには標準ストレージと低頻度ストレージがあります。詳細については、[ストレージタイプの概要](https://www.tencentcloud.com/document/product/614/42003)をご参照ください。
>- ログの保存は永久保存および固定期間での保存をサポートしています。
>- ログトピックを新規作成する際は、CLBインスタンスを追加するかどうかを選択できます。ログトピックリストの右側の**操作**列で**管理**をクリックすると、CLBインスタンスを再度追加できます。各CLBインスタンスは1つのログトピックにのみ追加できます。
>- 1つのログセットに複数のログトピック（Topic）を作成することができます。さまざまなCLBログをさまざまなログトピックに保存することが可能であり、これらのログトピックにはデフォルトで「CLB」の表示が付帯します。
>
![]()
6. （オプション）ヘルスチェックログを無効化したい場合は、ログトピックリストの右側の**操作**列で**停止**をクリックし、ログの配信を停止します。


## ステップ3：ヘルスチェックログの確認[](id:step3)
CLBはヘルスチェックログの変数をキー値とするインデックスを自動的に設定しているため、手動でインデックスを設定する必要はありません。検索分析によってそのままヘルスチェックログの照会を行うことができます。
1. [CLBコンソール](https://console.cloud.tencent.com/clb)にログインし、左側ナビゲーションバーの**ヘルスチェックログ**をクリックします。
2. 「ヘルスチェックログ」ページの左上隅で所属リージョンを選択し、「ログトピック」エリアで右側の「操作」列の**検索**をクリックし、[CLSコンソール](https://console.cloud.tencent.com/cls/search)にリダイレクトします。
3. CLSコンソールで、左側ナビゲーションバーの**検索分析**をクリックします。
4. **検索分析**ページの入力ボックスに検索分析語を入力し、時間範囲を選択して**検索分析**をクリックすると、CLBがCLSに送信したヘルスチェックログを検索できます。
>?検索構文の詳細については、[構文とルール](https://intl.cloud.tencent.com/document/product/614/37803)をご参照ください。
>


## ヘルスチェックログの形式と説明
### ログ形式
```	
[$protocol][$rsport][$rs_vpcid][$vport][$vpcid][$time][$vip][$rsip][$status][$domain][$url]
```

### ログ変数の説明
<table class="table"><thead><tr><th>変数名</th><th>説明</th><th>フィールドタイプ</th></tr></thead>
<tbody>
<tr><td>protocol</td><td> プロトコルタイプ（HTTP/HTTPS/SPDY/HTTP2/WS/WSS）です。</td><td>text</td></tr>
<tr><td>rsport</td><td>バックエンドRSポートです。</td><td>long</td></tr>
<tr><td>rs_vpcid</td><td>バックエンドRSの属するVPC IDです。パブリックネットワークCLBのvip_vpcidは-1です。</td><td>long</td></tr>
<tr><td>vport</td><td>CLBのVPort、すなわちリスニングポートです。</td><td>long</td></tr>
<tr><td>vpcid</td><td>CLB VIPの属するVPC IDです。パブリックネットワークCLBのvip_vpcidは-1です。</td><td>long</td></tr>
<tr><td>time</td><td>アクセスの時刻とタイムゾーンです。例えば「01/Jul/2019:11:11:00 +0800」の場合、最後の「+0800」は属するタイムゾーンがUTCの8時間後、すなわち北京時間であることを表します。</td><td>text</td></tr>
<tr><td>vip</td><td>CLBのVIPです。 </td><td>text</td></tr>
<tr><td>rsip</td><td>バックエンドRSのIPアドレスです。</td><td>text</td></tr>
<tr><td>status</td><td>現在のヘルスチェックステータス：<ul><li>true：正常を表します。</li><li>false：異常を表します。</li></ul></td><td>text</td></tr>
<tr><td>domain</td><td>ヘルスチェックドメイン名です。リスナーがレイヤー4リスナーの場合はヘルスチェックドメイン名はなく、このパラメータは空となります。</td><td>text</td></tr>
<tr><td>url</td><td>ヘルスチェックURLです。リスナーがレイヤー4リスナーの場合はヘルスチェックURLはなく、このパラメータは空となります。</td><td>text</td></tr>
</tbody></table>

##  関連ドキュメント
[CLSクイックスタート](https://intl.cloud.tencent.com/document/product/614/31592)
