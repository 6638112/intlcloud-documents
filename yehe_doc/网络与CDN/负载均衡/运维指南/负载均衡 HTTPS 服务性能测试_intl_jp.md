
## 1. ロードバランサCLBのHTTPS機能の説明
Tencent Cloud CLBロードバランサは、プロトコルスタックおよびサーバーのハイレベルな最適化により、HTTPSパフォーマンスの大幅な向上を実現しました。またTencentは海外事業者との提携によって証明書にかかるコストを大きく削減しました。Tencent Cloud CLBは次のような点でお客様のビジネスに大きなメリットをもたらします。
1. HTTPSを使用してもClientのアクセス速度を低下させません。
2. クラスター内の単一サーバーのSSL暗号化復号パフォーマンスは65000cpsのフルハンドシェイクに達します。これはハイパフォーマンスCPUの少なくとも3.5倍アップに相当します。サーバーのコストを削減することで、業務運営およびトラフィック急増時のサービス機能を大幅に引き上げ、コンピューティング型の攻撃防御機能を増強します。
3. マルチプロトコルのオフロードと変換をサポートし、業務上でクライアントのさまざまなプロトコルに対応するための負荷を減らすことができます。業務バックエンドがHTTP1.1をサポートしていれば、 HTTP2、SPDY、SSL3.0、TLS1.2などの各バージョンのプロトコルを使用できます。
4. SSL証明書の申請、モニタリング、更新をワンストップで行えます。国際的な証明書認証局であるcomodo、symantecとの間で協議と提携を行い、証明書申請フローの大幅な短縮とコスト削減を実現しました。
5. CC攻撃防止およびWAF機能を有します。スロー攻撃、高頻度ターゲット攻撃、SQLインジェクション、トロイの木馬などのアプリケーション層攻撃を有効に排除します。

## 2. テストの目的
HTTPSサービスにはID認証、情報の暗号化と完全性チェックなどのメリットがありますが、新たに追加されたSSLプロトコルによってセキュアな通信を実現しようとすると、必然的にある程度のパフォーマンスロスが発生し、それには主にレイテンシーの増加や暗号化と復号によるCPUリソースの消費などが含まれます。ここではTencent CloudのHTTPSサービスの、SSL暗号化・復号状況下での限界パフォーマンスデータをテストし、ユーザーが従来型のHTTPSパフォーマンスデータとの比較と参照を行えるようにご提供します。

## 3. テスト環境
- ストレステストツール：wrk 4.0.2
- Tencent Cloud基本サービス環境：Nginx 1.1.6_1.9.9 + Openssl 1.0.2h
- NginxをインストールしたマシンのOS情報：Linux TENCENT64.site 3.10.94-1-tlinux2-0036.tl2 #1 SMP Thu Jan 21 03:40:59 CST 2016 x86_64 x86_64 x86_64 GNU/Linux
- その他のストレスサーバーのOS：Linux TENCENT64.site 2.6.32.43-tlinux-1.0.17-default #1 SMP Tue Nov 17 18:03:12 CST 2015 x86_64 x86_64 x86_64 GNU/Linux

## 4. WebServerクラスターのテストスキーム
Tencent Cloud httpsサービスの限界パフォーマンステストに必要な負荷は単一のストレスサーバーでは十分に送信できないため、複数台のストレスサーバーから送信する必要があります。テストには3つの部分が含まれます。
1. ストレスサーバークラスター。http/https負荷を送信し、単一のストレスサーバーのストレステスト結果を出力するために用います。
2. 中央制御サーバー。ストレスサーバークラスターの起動と終了を同期制御し、各サーバーのストレスデータを取得し、まとめて出力します。
3. テストサーバー。 Tencent Cloud HTTPSサービスをホストしたクラウドマシンであり、WebServerパフォーマンスをテストします。ページを直接返し、upstream接続を必要としません。
接続関係は次のとおりです。

![](https://mc.qcloudimg.com/static/img/180044320ba540f396a06925d8f07bbd/CLB-OPS+Guidelines-Load+Balancer+HTTPS+Service+Performance+Test.jpg)

## 5. HTTPS WebServerパフォーマンステストデータ

| 接続タイプ | Session cache | パケット(bytes) | 暗号スイート | パフォーマンス(qps) |
|---------|---------|---------|---------|---------|
| 長時間 | オン | 230 | ECDHE-RSA-AES128-GCM-SHA256 | 296241 |
| 短時間 | オフ | 230 | ECDHE-RSA-AES128-GCM-SHA256 | 65630 |

## 6. CLB HTTPS機能テストの結論
上の表のように、Tencent CloudのHTTPSサービスはSSL暗号化・復号をサポートしています。バックエンドには複数のサーバークラスターがあり、1つのクラスター内の1台のCVMのフルハンドシェイクにおけるパフォーマンスは65000 qpsに達し、長時間接続の場合は約300000qpsに達することが可能です。

一般的に、HTTPSプロトコルはSSLプロトコルを使用するため、少なくとも1回のフルハンドシェイクのプロセスが追加され、2 × RTTのレイテンシーが増加します。また、SSLの対称/非対称暗号化は大量のCPUリソースを消費します。RSAの復号能力はHTTPS接続における難しい課題です。

Tencent Cloud CLBのHTTPSサービスを使用すると、ユーザーはSSLの暗号化・復号のために単独でサービスをデプロイする必要がなく、Tencent Cloudからの追加料金も発生しません。ユーザーは強力な業務ホスティング機能と攻撃防御機能を手軽に手に入れることが可能です。
