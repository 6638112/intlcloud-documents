## 작업 시나리오

본 문서는 Linux CVM이 CPU 및 메모리 점유율이 높음으로 인해 로그인할 수 없는 등의 문제를 진단하는 방법과 솔루션에 대해 소개합니다.

## 작업 순서

### 로그인 및 시스템 부하 조회

1. 실제 수요에 따라 다양한 로그인 방식을 선택하여 CVM에 로그인합니다.
	- 3rd party 소프트웨어를 통해 Linux CVM에 원격 로그인 합니다.
	>!  Linux CVM이 CPU 고부하 상태일 때 로그인할 수 없는 상황이 발생할 수 있습니다.
	>
	- **VNC 방식**으로 CVM에 로그인합니다.
	즉, “[CVM 콘솔](https://console.cloud.tencent.com/cvm)에 로그인하고 > 우측 작업 표시줄의 [Log In]을 클릭한 후 > VNC 방식을 선택하여 CVM에 로그인합니다”.
	>! Linux CVM은 CPU 고부하 상태일 때 콘솔에서 정상 로그인할 수 있습니다.
	>
2. 다음 명령어를 실행하여 시스템 부하를 조회합니다. `%CPU` 열과  `%MEM` 열을 조회하여 리소스 점유율이 높은 프로세스를 확인합니다.
```
top
```

### 프로세스 종료 작업

1. 리소스 점유율을 분석하고 종료해야 하는 프로세스 PID를 기록합니다.
2. ` k `를 입력합니다.
3. 종료해야 하는 프로세스의 PID를 입력하고 **Enter**를 눌러 종료합니다. 아래 그림 참조
여기서는 PID가 23인 프로세스의 종료를 예로 듭니다.
![](//mc.qcloudimg.com/static/img/61cd74354cf2b4d2a80a83528a500f5c/image.png)
>! **Enter**를 누른 후 `kill PID 23 with signal [15]:`가 나타나면, 계속해서 **Enter** 를 눌러 기본 값 설정을 유지합니다.
>
4. 조작 성공 후 인터페이스에 ` Send pid 23 signal [15/sigterm] 라는 알림 메시지가 나타나며, **Enter**를 눌러 확인합니다.

### CPU 유휴상태이지만 고부하인 상황 처리

#### 문제 설명

load average는 CPU 부하를 평가하는 것으로, 그 값이 높을수록 해당 작업 큐가 더 길고 실행 대기 중인 작업이 더 많음을 뜻합니다.
top 모니터링을 통해 본 결과, 다음 그림과 같이 CPU는 유휴상태이지만 load average는 매우 높습니다.
![](//mc.qcloudimg.com/static/img/4ddf663a68ee602d8cf8075d88edccf6/image.png)
 
#### 처리 방법
 
다음 명령어를 실행하여 프로세스 상태를 조회하고 D 상태 프로세스의 존재 여부를 점검합니다. 아래 그림 참조
```
ps -axjf
```
![](//mc.qcloudimg.com/static/img/32420d3fe022b57d85120c941705dbf6/image.png)
 >? D 상태는 중단 불가의 수면 상태를 가리킵니다. 해당 상태의 프로세스는 킬 될 수 없고, 자체로 나갈 수도 없습니다. D 상태의 프로세스가 많이 나타나면 해당 프로세스의 종속 리소스를 복구하거나 시스템을 재시작하여 해결할 수 있습니다.
 >


### kswapd0 프로세스의 높은 CPU 점유 처리

#### 문제 설명

Linux 시스템은 페이징 메커니즘을 통해 메모리를 관리함과 동시에 디스크의 일부를 버츄얼 메모리로 구분합니다. kswapd0은 Linux 시스템 버츄얼 메모리 관리에서 페이지 교환을 담당하는 프로세스입니다. 시스템 메모리가 부족할 때 kswapd0은 빈번하게 페이지 교환 작업을 진행합니다. 페이지 교체 작업은 CPU 리소스를 많이 소모하므로 해당 프로세스가 지속해서 높은 점유율로 CPU 리소스를 차지합니다.
 
#### 처리 방법

1. 다음 명령어를 실행하여 kswapd0 프로세스를 찾습니다.
```
top
```
2. kswapd0 프로세스 상태를 모니터링합니다.
비수면 상태가 지속되고 실행 시간이 비교적 긴 동시에 지속해서 높은 점유율로 CPU 리소스 차지하면 [3단계](#kswapd0_step3)를 실행하여 메모리의 점유율을 조회하시기 바랍니다.
3. <span id="kswapd0_step3"> `free`, `ps` 등 명령어를 실행하여 시스템 내 프로세스의 메모리 점유율을 조회합니다.</span>
메모리 점유율 상황에 따라 시스템을 재시작하거나, 안전하지만 불필요한 프로세스를 종료합니다.

kswapd0 프로세스의 문제가 여전히 존재할 경우, [CPU 사용률이 지나치게 높음(Linux 시스템)](https://intl.cloud.tencent.com/document/product/213/14634)을 참조하여 진단할 수 있습니다.
