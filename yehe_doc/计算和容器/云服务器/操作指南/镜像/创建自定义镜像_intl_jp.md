## ユースケース
Tencent Cloudが提供するパブリックイメージを使用するだけでなく、カスタムイメージを作成することもできます。カスタムイメージを作成すると、Tencent Cloudコンソール上で、このイメージと同一の構成のTencent Cloud CVMインスタンスをすぐに作成することができます。


<dx-alert infotype="explain" title="">
イメージ下位層がCloud Block Storageスナップショットサービスを使用しています：
 - カスタムイメージを作成する場合、デフォルトでイメージに関連付けられたスナップショットが作成されます。カスタムイメージを保持すると一定のスナップショット料金が発生します。詳細については[スナップショットの料金概要]（](https://intl.cloud.tencent.com/document/product/362/32415)をご参照ください。
</dx-alert>




## 注意事項

- 各リージョンは、最大10個のカスタムイメージをサポートします。
- Linuxインスタンスにデータディスクがあっても、システムディスクのカスタムイメージしか作成しない場合、`/etc/fstab`にデータディスクの設定が含まれていないことを確認してください。設定があると、そのイメージで作成したインスタンスは正常に起動できなくなります。
- 作成プロセスは10分以上かかりますが、具体的な時間はインスタンスのデータサイズによって異なります。業務への影響を避けるためには、事前に関連準備を行ってください。
- ベアメタル型CVMは現時点ではコンソールおよびAPIを使用してのカスタムイメージ作成をサポートしていません。CVMで作成を行ってください。
- Windowsインスタンスがドメインにアクセスし、ドメインアカウントを使用する必要がある場合は、カスタムイメージを作成する前に、Sysprep操作を実行し、インスタンスがドメインにアクセスした後のSIDが一意になるようにしてください。詳細については[Sysprepを使用してCVMがドメインにアクセスした後のSIDの一意を実現する](https://intl.cloud.tencent.com/document/product/213/35876)をご参照ください。

## 操作手順
<dx-tabs>
::: コンソールを利用したインスタンスからの作成

#### インスタンスのシャットダウン（オプション）
1. [CVMコンソール](https://console.cloud.tencent.com/cvm)にログインし、対応するインスタンスのシャットダウンが必要かどうかを確認します。
<dx-alert infotype="notice" title="">
2018年7月以降にパブリックイメージを元に作成されたインスタンス（システムディスクはCBS）はオンラインイメージ制作（インスタンスをシャットダウンせずにイメージを制作すること）をサポートしています。これ以外でのインスタンスは、インスタンスをシャットダウンしてからイメージを制作し、イメージが現在のインスタンスデプロイ環境と完全に一致するようにしてください。
</dx-alert>
  - 必要である場合は、引き続き手順を実行します。
  - 必要でない場合は、 [カスタムイメージ制作](#createOS)手順を実行してください。
2. インスタンスの管理画面で、実際に使用されているビューモードに従って操作します。
  -**リストビュー**：インスタンスが配置されている行の右側の**さらに表示** > **インスタンスのステータス** > **シャットダウン**を選択します。下図に示すとおりです：
![](https://main.qcloudimg.com/raw/cc0bb1c82b96cca94cb7c1c011b664a7.png)
  - **タブビュー**：下図に示すように、インスタンス詳細ページで**シャットダウン**を選択します。
![](https://qcloudimg.tencent-cloud.cn/raw/bd0d10a80c75a653adee564105a9820b.png)


#### カスタムイメージの制作[](id:createOS)
1. インスタンスの管理画面で、実際に使用されているビューモードに従って操作します。
   -**リストビュー**：**さらに表示** > **イメージの作成**を選択します。下図に示すとおりです：
   ![](https://main.qcloudimg.com/raw/8e3fc28e1a0b1e9e337ff72e34a9fd01.png)
   -**タブビュー**：右上隅の**その他のアクション** > **イメージの作成**を選択します。下図に示すとおりです：
   ![](https://qcloudimg.tencent-cloud.cn/raw/27d7f6f19bc115c501bb1157ebe37cab.png)
2. ポップアップした「カスタムイメージ制作」ウィンドウで、次の情報を参考に設定します。
  - **イメージ名**と**イメージの説明**：名称と説明をカスタマイズします。
  - **タグ**：必要に応じてタグを追加し、リソース分類、検索および集約に使用することができます。詳細な情報については [タグ](https://intl.cloud.tencent.com/document/product/651/13334)をご参照ください。
<dx-alert infotype="explain" title="">
システムディスクおよびデータディスクを含むカスタムイメージのみ作成するには、[チケットを提出](https://console.intl.cloud.tencent.com/workorder/category)して、機能の有効化を申請してください。 
</dx-alert>
3. **イメージ制作**をクリックします。
左側ナビゲーションバーの **[イメージ](https://console.cloud.tencent.com/cvm/image)**をクリックすると、「イメージ」ページでイメージの作成状況を確認することができます。


#### カスタムイメージを利用したインスタンスの作成（オプション）
下図に示すように、イメージの作成が完了したら、イメージリストから作成したイメージを選択し、それが配置されている行の右側の**インスタンス作成**をクリックすると、以前と同じイメージのサーバーを購入できます。
![](https://main.qcloudimg.com/raw/2d64df77d16b3c26d275770e03a1caf1.png)

:::
::: \sAPI\sを利用した作成
CreateImageインターフェースを使用してカスタムイメージを作成することができます。詳細については、[イメージ作成API](https://intl.cloud.tencent.com/document/product/213/33276)をご参照ください。
:::
</dx-tabs>

## ベストプラクティス

### データディスク上のデータ移行

新しいインスタンスを起動する同時に、元のインスタンスデータディスクのデータを保持する必要がある場合、最初にデータディスクの[スナップショット](https://intl.cloud.tencent.com/document/product/362/31638)を作成してください。新しいインスタンスを起動する時に、このデータディスクのスナップショットを利用して新しいクラウドデータディスクを作成します。
詳細については、[スナップショットを使用してクラウドディスクの作成](https://intl.cloud.tencent.com/document/product/362/5757)をご参照ください。
