## 操作シナリオ
Tencent Cloudが提供するパブリックイメージを使用するだけでなく、カスタムイメージを作成することもできます。カスタムイメージを作成すると、Tencent Cloudコンソール上で、このイメージと同一の構成のTencent Cloud CVMインスタンスをすぐに作成することができます。


<dx-alert infotype="explain" title="">
イメージ下位層がCloud Block Storageスナップショットサービスを使用しているため：

 - カスタムイメージを作成する場合、デフォルトでイメージに関連付けられたスナップショットが作成されます。カスタムイメージを保持すると一定のスナップショット料金が発生します。詳細については[スナップショットの料金概要](https://intl.cloud.tencent.com/document/product/362/32415)をご参照ください。
  </dx-alert>




## 注意事項

- 現時点では各リージョンにつき10のカスタムイメージがサポートされています。
- 次のディレクトリ/ファイルはクリアされます。
 - `/var/log/`  
 - `/root/.bash_history、/home/ubuntu/.bash_history`（Ubuntuシステム）
- Linuxインスタンスのカスタムイメージを作成する際は、`/etc/fstab`にデータディスク構成が含まれていないことを確認してください。含まれている場合、このイメージを使用して作成されたインスタンスは正常に起動しません。カスタムイメージを作成したLinuxインスタンスにデータディスクをマウントしている場合、`/etc/fstab`に構成したデータディスクの関連設定をコメントアウトまたは削除する必要があります。
- 作成にかかる時間は10分またはそれ以上が必要です。具体的な時間はインスタンスのデータ量によって変わります。業務に影響しないよう、事前に必要な準備を行ってください。
- ベアメタル型CVMは現時点ではコンソールおよびAPIを使用してのカスタムイメージ作成をサポートしていません。CVMで作成を行ってください。
- Windowsインスタンスがドメインにアクセスし、ドメインアカウントを使用する必要がある場合は、カスタムイメージを作成する前に、Sysprep操作を実行し、インスタンスがドメインにアクセスした後のSIDが一意になるようにしてください。詳細については[Sysprepを使用してCVMがドメインにアクセスした後のSIDの一意を実現する](https://intl.cloud.tencent.com/document/product/213/35876)をご参照ください。

## 操作手順
<dx-tabs>
::: コンソールを利用したインスタンスからの作成

#### インスタンスのシャットダウン（オプション）
1. [CVMコンソール](https://console.cloud.tencent.com/cvm)にログインし、対応するインスタンスのシャットダウンが必要かどうかを確認します。
<dx-alert infotype="notice" title="">
2018年7月以降にパブリックイメージを元に作成されたインスタンス（システムディスクはCBS）はオンラインイメージ制作（インスタンスをシャットダウンせずにイメージを制作すること）をサポートしています。これ以外でのインスタンスは、インスタンスをシャットダウンしてからイメージを制作し、イメージが現在のインスタンスデプロイ環境と完全に一致するようにしてください。
</dx-alert>
  - 必要である場合は、引き続き手順を実行します。
  - 必要でない場合は、 [カスタムイメージ制作](#createOS)手順を実行してください。
2. インスタンスの管理画面で、実際に使用されているビューモードに従って操作します。
    -**リストビュー**：インスタンスが配置されている行の右側の**さらに表示** > **インスタンスのステータス** > **シャットダウン**を選択します。下図のとおりです。
    ![シャットダウン](https://main.qcloudimg.com/raw/cc0bb1c82b96cca94cb7c1c011b664a7.png)
    -**タブビュー**：インスタンスが配置されている行の右側の**さらに表示** > **インスタンスのステータス** > **シャットダウン**を選択します。下図のとおりです。
    ![シャットダウン](https://qcloudimg.tencent-cloud.cn/raw/bd0d10a80c75a653adee564105a9820b.png)


#### カスタムイメージの制作[](id:createOS)
1. インスタンスの管理画面で、実際に使用されているビューモードに従って操作します。
   -**リストビュー**：**さらに表示** > **イメージの作成**を選択します。下図のとおりです。
   ![](https://main.qcloudimg.com/raw/8e3fc28e1a0b1e9e337ff72e34a9fd01.png)
   -**タブビュー**：右上隅の**その他のアクション** > **イメージの作成**を選択します。下図のとおりです。
   ![](https://qcloudimg.tencent-cloud.cn/raw/27d7f6f19bc115c501bb1157ebe37cab.png)
2. ポップアップした「カスタムイメージ制作」ウィンドウで、次の情報を参考に設定します。
  - **イメージ名**と**イメージの説明**：名称と説明をカスタマイズします。
  - **システムディスクイメージのみ作成**：インスタンスがシステムディスクのみ備えている場合、このオプションは出現しません。インスタンスがデータディスクを備えている場合、必要に応じてチェックを入れてください。
     - チェックありの場合、インスタンスシステムディスクイメージのみ作成します。
     - チェックなしの場合、インスタンスがデータディスクを備えていれば、データディスクスナップショットも同時に作成します。
3. **イメージ制作**をクリックします。
左側ナビゲーションバーの **[イメージ](https://console.cloud.tencent.com/cvm/image)**をクリックすると、「イメージ」ページでイメージの作成状況を確認することができます。


#### カスタムイメージを利用したインスタンスの作成（オプション）
下図に示すように、イメージの作成が完了したら、イメージリストから作成したイメージを選択し、それが配置されている行の右側の**インスタンス作成**をクリックすると、以前と同じイメージのサーバーを購入できます。
![](https://main.qcloudimg.com/raw/2d64df77d16b3c26d275770e03a1caf1.png)

:::
::: \sAPI\sを利用した作成
CreateImageインターフェースを利用してカスタムイメージを作成することができます。具体的な内容については[イメージ作成API](https://intl.cloud.tencent.com/document/product/213/33276)をご参照ください。
:::
</dx-tabs>

## ベストプラクティス

### データディスクのデータ移行

新しいインスタンスを起動すると同時に、元のインスタンスデータディスクのデータを保存する必要がある場合、まずデータディスクに[スナップショット](https://intl.cloud.tencent.com/document/product/362/31638)を作成し、新しいインスタンスを起動する際に、このデータディスクのスナップショットを利用して新しいCBSデータディスクを作成することができます。
その他の関連情報については、[スナップショットを使用してクラウドディスクの作成](https://intl.cloud.tencent.com/document/product/362/5757)ドキュメントをご参照ください。
