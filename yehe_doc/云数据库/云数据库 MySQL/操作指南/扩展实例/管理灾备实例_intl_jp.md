## 操作シナリオ
サービスの継続提供、データの信頼性または監視の必要性が高いシナリオの場合、TencentDB for MySQLは、リージョンをまたがるディザスタリカバリインスタンスを提供し、ユーザーの低コストでのサービスの継続提供能力を引き上げながら、データの信頼性を向上させるお手伝いをします。
>?ディザスタリカバリインスタンスの料金はマスターインスタンスと同様です。[製品価格](https://buy.cloud.tencent.com/price/cdb)をご参照ください。

## 機能の特徴
- 独立したデータベース接続アドレスを提供します。ディザスタリカバリインスタンスは読み取りアクセス機能を提供して、最寄りサーバーへのアクセス、データ分析などのシナリオに用いて、デバイスの冗長化コストを引き下げます。
- プライマリ/スタンバイの高可用性アーキテクチャを使用することで、データベースのシングルポイントによるリスクを回避しました。
- ディザスタリカバリインスタンスは、プライベートネットワークの専用回線を介して同期され、同期遅延が少なく、高い安定性を持ち、同期リンクの品質はパブリックネットワークよりもはるかに優れています。
- 現在プロモーション期間中のため、専用回線のトラフィック料金は無料です。商品化により課金が開始される時期については、別途お知らせします。

#### 動作原理
- Tencent Cloudのクラウドデータベースがディザスタリカバリデータベースとして使用されるシナリオでは、ディザスタリカバリインスタンスは、マスターインスタンスデータベースのレプリケーションバックアップです。
- マスターインスタンスが変更されると、変更されたLog情報の記録がディザスタリカバリインスタンスにコピーされ、ログの再生がデータの同期を実現するために使用されます。
- マスターインスタンスに障害が発生した場合、ディザスタリカバリインスタンスを数秒以内にアクティブ化して、完全な読み取りおよび書き込み機能を回復させられます。

## 機能制限
- メモリ1GB、ハードディスク50GB以上の仕様で、かつMySQL 5.6およびそれ以降のバージョン、ディザスタリカバリインスタンスを購入するためのInnoDBエンジンの高可用版マスターインスタンスのみをサポートします。マスターインスタンスがこの仕様よりも低い場合は、まずマスターインスタンスの仕様をアップグレードしてください。また、マスターインスタンスでGTID機能が有効になっている必要があります。
>?GTIDが有効になっていない場合は、[コンソール](https://console.cloud.tencent.com/cdb/)のインスタンス詳細ページからGTIDを有効にすることができます。GTIDを有効にするプロセスには時間がかかり、インスタンスには数秒間の瞬断が生じます。ビジネスピークから外れた時期に操作し、データベースにアクセスするプログラムに再接続メカニズムを追加することをお勧めします。
- ディザスタリカバリインスタンスの最低仕様は、メモリ1GB、ハードディスク50GB、マスターインスタンスの使用済みストレージ仕様の1.1倍以上である必要があります。
- マスターインスタンスは、最大1つのディザスタリカバリインスタンスを作成できます。ディザスタリカバリインスタンスが隔離状態にある間は、それ以上ディザスタリカバリインスタンスを作成することはできません。
- ディザスタリカバリインスタンスは現在、以下をサポートしていません。：プロジェクトの移行、ロールバック、SQL操作、パラメータ設定、文字セットの変更、アカウント管理、ポートの変更、データインポート、ロールバックログ、読み取り専用インスタンス機能。

## 操作手順
### ディザスタリカバリインスタンスの作成
### 手順1：ディザスタリカバリインスタンスの作成
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストのインスタンスIDまたは「操作」列の【管理】をクリックし、詳細ページに進みます。
2. インスタンス詳細ページの基本情報でGTID機能が有効になっていることを確認し、インスタンスアーキテクチャ図の【ディザスタリカバリインスタンスの追加】をクリックして、ディザスタリカバリインスタンスの購入ページに進みます。
![](https://main.qcloudimg.com/raw/d41ae3d97935763b180f2e8a26cb2364.png)
3. 購入ページで、ディザスタリカバリインスタンスの「課金モード」、「リージョン」、「同期ポリシー」などの基本情報を設定します。
 - 同期ポリシーが「すぐに同期」の場合、データはディザスタリカバリインスタンスが作成された直後に同期されます。
 - 同期ポリシーが「作成後に同期」の場合、ディザスタリカバリインスタンスの作成に成功した後、ディザスタリカバリ同期リンクを設定する必要があります。詳細な操作については、以下の[同期リンクの作成](#cjtblj)をご参照ください。
>?
>- 時間の作成はデータ量の影響を受けます。その間のマスターインスタンスのコンソール操作はロックされますので、適切に調整してください。
>- 現在、インスタンス全体のデータ同期のみをサポートしています。ディスク容量を十分に確保してください。
>- マスターインスタンスのステータスが実行中であり、アップ/ダウングレードや再起動などの実行関連の変更タスクの実行がないことを確認してください。そうでない場合、同期タスクは失敗する可能性があります。  
4. 誤りのないことを確認してから、【今すぐ購入】をクリックすると、ディザスタリカバリインスタンスが出荷されます。
5. インスタンスリストに戻り、インスタンスのステータスが「実行中」に変わったら、それ以降の操作に進むことができます。

#### [手順2：同期リンクの作成（オプション）](id:cjtblj)
>?購入時に選択した「同期ポリシー」が「作成後に同期」の場合、ディザスタリカバリインスタンスの作成に成功後、リモートディザスタリカバリを実現するためにディザスタリカバリ同期リンクを設定する必要があります。

1. マスターインスタンスのインスタンス詳細ページで、ディザスタリカバリインスタンスの同期ステータスを確認し、【同期タスクの作成】をクリックすれば、ディザスタリカバリインスタンスのためにマスターインスタンスとのプライベートネットワーク同期リンクを作成することができます。
![](https://main.qcloudimg.com/raw/f2f941ccf588d54cb2687cc0a9d0a961.png)
2. タスク名を入力し、ソースライブラリ情報とターゲットライブラリ情報を確認して、【保存して次へ】をクリックします。
![](https://main.qcloudimg.com/raw/5a2b3ef40de69af903cc60396d8f1a84.png)
3. 同期するオブジェクトを選択し、インスタンス全体またはデータベーステーブルの一部のみの同期をサポートします。現在、同期タイプの選択はサポートされていません。
![](https://main.qcloudimg.com/raw/ac3f2db7c68f708ac07bb597a420ae83.png)
4. 【保存してチェック】をクリックし、【タスクのチェック】に進みます。チェックが成功したら、【タスクの起動】をクリックすると、MySQLの「ディザスタリカバリ同期」ページでタスクの詳細を確認することができます。
![](https://main.qcloudimg.com/raw/4cc319646447bb20a5a76982a0783a49.png)

### ディザスタリカバリインスタンスの管理
- **ディザスタリカバリインスタンスの確認**
ディザスタリカバリインスタンスは、所在リージョンで確認でき、インスタンスリストからそのリージョンのすべてのディザスタリカバリインスタンスをフィルタリングすることができます。
![](https://main.qcloudimg.com/raw/1ade1aa59f7c5cd74b2cf30299d31cac.png)
- **従属関係の確認**
各ディザスタリカバリインスタンスまたはマスターインスタンスの右側にあるアイコンをクリックして、従属関係を確認します。
![](https://main.qcloudimg.com/raw/4b98a6b2831c027af52a37050aa16f2d.png)
![](https://main.qcloudimg.com/raw/f08c6d3dd53a40ea544bdadc9e111ee8.png)
- **同期遅延の確認**
マスターインスタンスとディザスタリカバリインスタンス間の同期遅延は、ディザスタリカバリインスタンスのインスタンス詳細ページの上部で確認できます。
![](https://main.qcloudimg.com/raw/d06a9c821f5ebd04173ee6e453ef5ef2.png)
- **ディザスタリカバリインスタンス機能**
ディザスタリカバリインスタンスは、インスタンスの詳細、インスタンス監視、バックアップ管理およびログのスロークエリ機能を提供します。
 
### ディザスタリカバリインスタンスのマスターインスタンスへのアップグレード
ディザスタリカバリインスタンスをマスターインスタンスに切り替える必要がある場合は、コンソールでディザスタリカバリインスタンスをマスターインスタンスに自発的に切り替えることができます。
1. [インスタンスリスト](https://console.cloud.tencent.com/cdb)で、マスターインスタンスにアップグレードする必要があるディザスタリカバリインスタンスを選択して、インスタンスIDをクリックし、インスタンス管理ページに進みます。
2. インスタンス管理ページで、右上隅にある【マスターインスタンスへの切り替え】をクリックすると、ディザスタリカバリインスタンスをマスターインスタンスにアップグレードできます。切り替えた後、元のマスターインスタンスとの同期接続が切断され、インスタンスデータベースのデータ書き込み機能と完全なMySQL機能が回復します。
>!同期接続が切断された後は再接続できませんので、慎重に操作してください。
> 
![](https://main.qcloudimg.com/raw/c4e1517d56c630ff845c89060402e657.png)

