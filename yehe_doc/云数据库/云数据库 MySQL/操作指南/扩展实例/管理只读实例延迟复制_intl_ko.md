본문은 MySQL 콘솔을 통한 읽기 전용 인스턴스 딜레이 복사와 복사 활성화/비활성화 방법에 대해 소개합니다. 딜레이 복사(즉 읽기 전용 인스턴스와 마스터 인스턴스 간의 딜레이) 설정 및 딜레이 기간 중 지정 시간 혹은 GTID(전역 트랜잭션 식별)에 복구 실행을 선택하여 높은 효율의 데이터 롤백과 신속한 장애 추적이 가능합니다.
- 딜레이 복사: 사용자가 읽기 전용 인스턴스와 마스터 인스턴스 간의 딜레이 복사 시간 설정을 지원합니다.
- 복사 활성화/비활성화: 사용자가 수동으로 읽기 전용 인스턴스와 마스터 인스턴스 간의 데이터 동기화 활성화 혹은 비활성화 설정 기능을 지원합니다. 

## 딜레이 복사 설명
- 읽기 전용 인스턴스 딜레이 복사를 활성화하면 읽기 전용 인스턴스는 읽기 전용 그룹에서 제거되고 가중치가 0으로 설정됩니다. 동시에 읽기 전용 인스턴스의 제거 알람이 발송됩니다. 이 때 읽기 전용 그룹을 사용하여 VIP주소로 액세스할 경우 트래픽은 제거된 읽기 전용 인스턴스로 포워딩되지 않고 오직 읽기 전용 인스턴스의 VIP 주소로만 액세스 할 수 있습니다.
- 만약 읽기 전용 그룹이 딜레이 제거 기능을 활성화하고 읽기 전용 인스턴스 딜레이 복사를 비활성화하면 읽기 전용 인스턴스의 딜레이 시간이 읽기 전용 그룹의 딜레이 임계값보다 작을 경우에만 읽기 전용 인스턴스의 가중치가 복구됩니다. 가중치가 복구되는 동시에 읽기 전용 인스턴스의 제거 복구 알람이 발송됩니다. 
- 데이터 복사를 지정 위치까지 실행하는 중에는 재시작, 설정 변경, 버전 업그레이드, 커널 버전 업그레이드를 동시에 진행할 수 없습니다. 

## 딜레이 복사 활성화
>?읽기 전용 인스턴스의 ‘딜레이 복사’는 ‘비활성화’로 기본 설정됩니다. 활성화 후 딜레이 복사 시간이 표시 됩니다. 
>
1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인한 후, 인스턴스 리스트에서 인스턴스 ID 또는 '작업' 열의 [관리]를 클릭하여 인스턴스 상세 페이지로 이동합니다.
2. 인스턴스 상세페이지의 ‘딜레이 복사’에서 [활성화]를 클릭합니다. 
![](https://main.qcloudimg.com/raw/23a113ccd7251b379c8de124f0f945d1.png)
3. 팝업된 대화 상자에서 딜레이 시간 설정 후 [확인]을 클릭합니다.
>?딜레이 시간 범위: 1초 - 3600 * 24 * 3초 

## 딜레이 복사 수정
1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인한 후, 인스턴스 리스트에서 인스턴스 ID를 클릭하여 인스턴스 상세 페이지로 이동합니다.
2. 인스턴스 상세 페이지의 ‘딜레이 복사’에서 [수정]을 클릭합니다. 
![](https://main.qcloudimg.com/raw/83288194d58e25b6a3bd84f950a2ae5a.png)
3. 팝업된 대화 상자에서 딜레이 시간 설정 후 [확인]을 클릭합니다.
![](https://main.qcloudimg.com/raw/40045317eb248fbfdb8b507bea550bdf.png)

## 딜레이 복사 비활성화
1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인한 후, 인스턴스 리스트에서 인스턴스 ID를 클릭하여 인스턴스 상세 페이지로 이동합니다.
2. 인스턴스 상세 페이지의 ‘딜레이 복사’에서 [비활성화]를 클릭합니다. 
3. 팝업된 대화 상자에서 오류가 없는지 확인한 다음 [확인]을 클릭합니다.
>?딜레이 복사를 비활성화 하면 딜레이 복사 시간이 0으로 설정됩니다. 즉 읽기 전용 인스턴스와 마스터 인스턴스간 데이터가 실시간 동기화로 복구됩니다.  
> 

## 데이터 복사 실행
>?읽기 전용 인스턴스의 ‘복사 상태’는 ‘정상’으로 기본 설정됩니다. 만약 사용자가 딜레이 복사를 설정하고 딜레이 복사 시간 내에 실수로 데이터를 삭제했다면, 실수로 삭제했을 때의 위치와 GTID를 통해 읽기 전용 인스턴스를 이진법 로그 파일 위치나 GTID 전으로 복사할 수 있어 신속한 데이터 복구 기능을 사용할 수 있습니다. 
>
1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인한 후, 인스턴스 리스트에서 인스턴스 ID을 클릭하여 인스턴스 상세 페이지로 이동합니다.
2. 인스턴스 상세 페이지 하단의 ‘복사 상태’에서 [실행]을 클릭합니다. 
![](https://main.qcloudimg.com/raw/83288194d58e25b6a3bd84f950a2ae5a.png)
3. 팝업된 대화 상자에서 실행 방식 등을 선택한 후 [확인]을 클릭합니다. 
 – **정상 실행**: 복사 실행 후, 읽기 전용 인스턴스와 마스터 인스턴스의 데이터 동기화가 복구됩니다. 
 - **지정 위치로 복사 실행**: 구체적인 시간과 대응하는 GTID까지 복사 실행을 지원하며, 구체적인 시간 혹은 대응하는 GTID에 복구 된 후 읽기 전용 인스턴스는 정상 실행 방식으로 전환될 때 까지 복사를 중단하며, 이 후에는 복사가 다시 진행 됩니다. 
    - 시간: 선택 가능한 시간 범위는 복사가 중단된 시점부터 마스터 데이터베이스 현재 시점까지의 시간입니다. 
    - GTID: 선택 가능한 범위는 읽기 전용 인스턴스의 미완성 애플리케이션의 이진법 로그 이후의 모든 로그입니다. 인스턴스 server_uuid의 길이는 규정대로 모두 36비트여야 하며, GTID의 형식은 ‘server_uuid::transaction_id’이어야 합니다. 
   >!
   >- 입력한 이진법 로그 위치가 이미 읽기 전용 인스턴스 애플리케이션에 있거나 마스터 인스턴스의 위치보다 클 경우 복사 실행이 실패할 수 있습니다. 
   >- 복사 실행 시 이진법 로그에 중단 지점이 있다면 복사 실행이 실패할 수 있습니다. 
   >- 딜레이로 인해 읽기 전용 인스턴스의 복사 과정이 중단되고 이로 인한 읽기 전용 인스턴스의 디스크 공간 초과 사용을 방지하기 위해 읽기 전용 인스턴스의 디스크 용량이 5GB보다 적을 시 읽기 전용 인스턴스의 I0 스레드를 일시 중지합니다. 
   > 
![](https://main.qcloudimg.com/raw/2422edcaa53a5cc50089f5c3748eef28.png)

## 데이터 복사 중지
>?
>- 딜레이 복사 기능을 활성화해야만 복사 중단 기능을 사용할 수 있으며, 그렇지 않을 경우 ‘중단’ 버튼은 사용 불가한 상태가 됩니다.
>- 복사를 중단하면 동시에 io/sql 스레드도 중단됩니다. 
>
1. [MySQL 콘솔](https://console.cloud.tencent.com/cdb)에 로그인한 후, 인스턴스 리스트에서 인스턴스 ID를 클릭하여 인스턴스 상세 페이지로 이동합니다.
2. 인스턴스 상세 페이지 하단의 ‘복사 상태’에서 [중단]을 클릭합니다. 
![](https://main.qcloudimg.com/raw/8921d228b70bf42ca5120d6fcf44e92c.png)
3. 팝업된 대화 상자에서 오류가 없는지 확인한 다음 [확인]을 클릭합니다.

## 이슈 질문
#### GTID는 어떻게 획득하나요?
flush log 명령어를 통해 binlog 파일을 획득하여 실수했을 때의 위치와 GTID를 지정하는 것을 권장합니다.

#### 딜레이 시간은 어떻게 확인하나요?
[콘솔](https://console.cloud.tencent.com/cdb)의 인스턴스 상세 페이지를 통해 읽기 전용 인스턴스와 마스터 인스턴스의 딜레이 시간을 확인할 수 있습니다.
![](https://main.qcloudimg.com/raw/0b975dfca0c575735b94445f11e30d67.png)

####지정 위치로 복사하는 작업의 정보를 어디서 확인할 수 있나요?
[콘솔](https://console.cloud.tencent.com/cdb)의 작업 리스트 페이지에서 작업의 진도와 세부 사항을 확인할 수 있습니다. 
![](https://main.qcloudimg.com/raw/f3c0cb3ed4d9488c66fc02cbd96b770d.png)

