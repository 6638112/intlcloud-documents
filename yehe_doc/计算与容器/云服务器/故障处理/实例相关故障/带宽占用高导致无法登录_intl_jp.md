
このドキュメントでは、Linux と Windows CVMは帯域幅の使用量が高すぎることにより、リモートで接続できない時のトラブルシューティング方法と解決方法について説明します。

## 故障について
-  [Tencent Cloud CVMコンソール](https://console.cloud.tencent.com/cvm/index)にログインして、CVMの帯域幅監視データには、帯域幅の使用率が高すぎてCVMに接続できないことを示していることがわかります。 
<!--  -[セルフ診断](https://console.cloud.tencent.com/workorder/check)ツールで帯域幅の使用量が高すぎると診断されました。 -->

## 問題の特定とトラブルシューティング

1. [CVMコンソール](https://console.cloud.tencent.com/cvm/index)にログインします。
2. チェックするCVMを選択して、【ログイン】をクリックします。下図に示すように：
![](https://main.qcloudimg.com/raw/cc5786b9f8b57ff4057b666503729bc0.png)
3. ポップアップされた 「Windows/Linuxインスタンスにログインする」ウィンドーで、【その他の方式(VNC）】を選択し、【すぐにログインする】をクリックして、CVMにログインします。
4. ポップアップされたログインウィンドーで、左上隅の「リモートコマンドの送信」を選択し、**Ctrl-Alt-Delete** をクリックしてシステムログインインターフェースに入ります。下図に示すように：
![](https://main.qcloudimg.com/raw/2dec43fa6ddb5e442da59c75f7a34b0f.png)

###  Windows CVM
 VNCを使用してWindows CVMにログインした後、以下の操作を実行する必要があります：
>? 以下の操作では、 Windows Server 2012 システムを使用したCVMを例として説明します。
>
1. CVMで、 <img src="https://main.qcloudimg.com/raw/87d894e564b7e837d9f478298cf2e292.png" style="margin: 0;"></img>をクリックし、【タスクマネージャー】を選択して、「タスクマネージャー」を開きます。
2. 【パフォーマンス】タブを選択し、【リソースモニターを開く】をクリックすることでリソースモニターが起動します。下図に示すように：
![](https://main.qcloudimg.com/raw/3608da7a567b81dabbbaaaa2a4635c3b.png)
3. 開いた「リソースモニター」で、どのプロセスがより多くの帯域幅を消費しているかを確認します。実際の業務に基づいて、プロセスが正常に動作しているかを判断します。下図に示すように：
![](https://main.qcloudimg.com/raw/d8fc6cd4b8095110a0e4a2e73ba93559.png)
 - 帯域幅を大量に消費するプロセスが業務プロセスである場合、アクセス量の変化によるか、および容量を最適化する必要があるか、或は[CVM設定をアップグレード](https://intl.cloud.tencent.com/document/product/213/2178)する必要があるかどうかを確認します。
 - 帯域幅を大量に消費するプロセスが異常なプロセスである場合は、ウイルス或はトロイの木馬が原因である可能性があります。プロセスを自分で終了する或はセキュリティソフトウェアを使用してウイルスを駆除できます。データのバックアップ後にシステムを再インストールすることもできます。
 >! Windows システムでの多くのウイルスプログラムはシステムプロセスに偽装されています。【タスクマネージャー】>【プロセス】プロセス情報を使用して初期識別を行います：
 > 通常のシステムプロセスは完全な署名と説明があり、ほとんどはC:\Windows\System32ディレクトリにあります。ウイルスプログラムの名前はシステムプロセスの名前と同じかもしれませんが、署名や説明がなく、場所も通常ではないところにあります。
 > 
 - 帯域幅を大量に消費するプロセスがTencent Cloudコンポーネントプロセスである場合は、[チケットを送信](https://console.cloud.tencent.com/workorder/category) してお問い合わせください。問題に対処し、解決策を特定できるよう支援します。

###  Linux CVM
VNCを使用してLinux CVMにログインした後、以下の操作を実行する必要があります：
>? 以下の操作では、 CentOS 7.6 システムを使用したCVMを例として説明します。
>
1. 以下のコマンドを実行して、iftop ツール（iftop ツールはLinux CVMのトラフィック監視ツール）をインストールします。
```
yum install iftop -y
```
>?  Ubuntu システムの場合、 `apt-get install iftop -y` コマンドを実行してください。
>
2. 以下のコマンドを実行し、lsofをインストールします。
```
yum install lsof -y
```
3. 以下のコマンドを実行し、 iftopを実行します。 下図に示すように：
```
iftop
```
![](https://main.qcloudimg.com/raw/7fccea56d998a65df6ff7e9348772910.png)
 - `<=`、`=>` はトラフィックの方向を示します。
 - TX は送信トラフィックを示します。
 - RX は受信トラフィックを示します。
 - TOTALは総トラフィックを示します。
 - Cumはiftopを実行を開始した瞬間から現在までの総トラフィックを示します。
 - peak はトラフィックのピークを示します。
 - rates はそれぞれ過去2s、10sと40s間の平均トラフィックを示します。
4.  iftop で消費されたトラフィックのIPに従って、以下のコマンドを実行して、このIPに接続されているプロセスを確認します。
```
lsof -i | grep IP
```
例えば、消費されたトラフィックのIPが201.205.141.123の場合、以下のコマンドを実行します：
```
lsof -i | grep 201.205.141.123
```
次の結果が返される場合、CVM帯域幅は主にSSHプロセスによって消費されることが分ります。
```
sshd       12145    root    3u  IPV4  3294018       0t0   TCP 10.144.90.86:ssh->203.205.141.123:58614(ESTABLISHED)
sshd       12179  ubuntu    3u  IPV4  3294018       0t0   TCP 10.144.90.86:ssh->203.205.141.123:58614(ESTABLISHED)
```
5. 帯域幅を消費するプロセスを確認して、プロセスが正常に動作しているかを判断します。
 - 帯域幅を大量に消費するプロセスが業務プロセスである場合、アクセス量の変化によるか、容量を最適化する必要があるか、或は[CVM設定をアップグレード](https://intl.cloud.tencent.com/document/product/213/2178)する必要があるかどうかを確認します。
 - 帯域幅を大量に消費するプロセスが異常なプロセスである場合は、ウイルス或はトロイの木馬が原因である可能性があります。プロセスを自分で終了する或はセキュリティソフトウェアを使用してウイルスを駆除できます。データのバックアップ後にシステムを再インストールすることもできます。
 - 帯域幅を大量に消費するプロセスがTencent Cloudコンポーネントプロセスである場合は、[チケットを送信](https://console.cloud.tencent.com/workorder/category) してお問い合わせください。問題に対処し、解決策を特定できるよう支援します。 


[What is my IP address](https://whatismyipaddress.com/) で宛先IPの所有地を確認することをお勧めします。宛先IPの所有地が他の国/地域にある場合、大きなセキュリティリスクがあり、是非注意してください！

