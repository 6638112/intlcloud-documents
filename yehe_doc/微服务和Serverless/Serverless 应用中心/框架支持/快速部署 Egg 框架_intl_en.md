## Overview

This document describes how to quickly deploy a local Egg project to the cloud through a web function.

>?This document mainly describes how to deploy in the console. You can also complete the deployment on the command line. For more information, please see [Deploying Framework on Command Line](https://intl.cloud.tencent.com/document/product/1040/41597).



## Prerequisites

Before using SCF, you need to sign up for a [Tencent Cloud account](https://intl.cloud.tencent.com/register) and complete [identity verification](https://intl.cloud.tencent.com/document/product/378/3629) first.

## Directions

### Template deployment - quick deployment of Egg project

1. Log in to the [SCF console](https://console.cloud.tencent.com/scf/index?rid=1) and click **Function Service** on the left sidebar.
2. Select the region where to create a function at the top of the page and click **Create** to enter the function creation process.
3. Select **Template** for **Creation Method**, enter `Egg` in the search box to filter function templates, select **Egg Framework Template**, and click **Next** as shown below:
![](https://main.qcloudimg.com/raw/e0a04cd3cb345c6c9c8c2f229528a013.png)
4. On the **Configuration** page, you can view and modify the specific configuration information of the template project.
5. Click **Complete**. After creating the web function, you can view its basic information on the **Function Management** page.
6. You can access the deployed Egg project at the access path URL generated by API Gateway. Click **Trigger Management** on the left to view the access path as shown below:
![](https://main.qcloudimg.com/raw/e3b1e5cd072c81b14e2555468f4c9499.png)
7. Click the access path URL to access the Egg project.







### Custom deployment - quick migration of local project to cloud


#### Prerequisites

The Node.js runtime environment has been installed locally.

#### Local development

1. Refer to [Quick Start](https://eggjs.org/zh-cn/intro/quickstart.html) to quickly initialize the sample project as follows:
```shell
mkdir egg-example && cd egg-example
npm init egg --type=simple
npm i
```
2. In the root directory, run the following command to directly start the service locally.
```shell
npm run dev
open http://localhost:7001
```
3. Visit `http://localhost:7001` in a browser, and you can access the sample Egg project locally.


#### Deployment in cloud

Next, perform the following steps to make simple modifications to the initialized project, so that it can be quickly deployed through a web function. The project transformation here is usually divided into the following three steps:

- Change the listening address and port to `0.0.0.0:9000`.
- Modify the write path. Only the `/tmp` directory is readable/writable in the SCF environment.
- Add the `scf_bootstrap` bootstrap file.

The specific steps are as follows:
1. Create the `scf_bootstrap` bootstrap file in the project root directory and add the following content to it (which is used to configure environment variables and start services. Here is only a sample. Please adjust the specific operations according to your actual business scenario):
<dx-codeblock>
:::  sh
#!/var/lang/node12/bin/node

'use strict';

/**
 * Node path in docker: /var/lang/node12/bin/node
 * As only `/tmp` is readable/writable in SCF, two environment variables need to be modified at startup
 * `NODE_LOG_DIR` changes the default node write path of `egg-scripts` (~/logs) to `/tmp`
 * `EGG_APP_CONFIG` changes the default directory of the Egg application to `/tmp`
 */

process.env.EGG_SERVER_ENV = 'prod';
process.env.NODE_ENV = 'production';
process.env.NODE_LOG_DIR = '/tmp';
process.env.EGG_APP_CONFIG = '{"rundir":"/tmp","logger":{"dir":"/tmp"}}';

const { Application } = require('egg');

// If you deploy `node_modules` through layers, you need to modify `eggPath`
Object.defineProperty(Application.prototype, Symbol.for('egg#eggPath'), {
  value: '/opt',
});

const app = new Application({
  mode: 'single',
  env: 'prod',
});

app.listen(9000, '0.0.0.0', () => {
  console.log('Server start on http://0.0.0.0:9000');
});
:::
</dx-codeblock>
2. After the creation is completed, you need to run the following command to modify the executable permission of the file. By default, the permission `777` or `755` is required for it to start normally. Below is the sample code:
<dx-codeblock>
:::  sh
chmod 777 scf_bootstrap
:::
</dx-codeblock>
3. Log in to the [SCF console](https://console.cloud.tencent.com/scf/index?rid=1) and click **Function Service** on the left sidebar.
4. Select the region where to create a function at the top of the page and click **Create** to enter the function creation process.
5. Select **Custom Creation** for **Creation Method** and configure the options as prompted as shown below:
![](https://main.qcloudimg.com/raw/563fa4d0a8a3e8d098d1d2505f785e1a.png)
	- **Function Type**: select **Web function**.
	- **Function Name**: enter the name of your function.
	- **Region**: enter your function deployment region, which is **Guangzhou** by default.
	- **Runtime Environment**: select **Nodejs 12.16**.
	- **Deployment Method**: select **Code deployment** and upload your local project.
	- **Submitting Method**: select **Local folder**.
	- **Function Code**: select the specific local folder where the function code is.
6. Click **Complete**.




#### Development management
After the deployment is completed, you can quickly access and test your web service in the SCF console and try out various features of SCF, such as layer binding and log management. In this way, you can enjoy the advantages of low cost and flexible scaling brought by the serverless architecture:
