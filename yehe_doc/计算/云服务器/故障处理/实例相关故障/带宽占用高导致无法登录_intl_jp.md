
このドキュメントでは Linux と Windows CVMは帯域幅の使用量が高すぎることにより、リモートで接続できない時のトラブルシューティング方法と解決方法について説明します。

## 故障事象
-  [Tencent Cloud CVMコンソール](https://console.cloud.tencent.com/cvm/index)にログインして、CVMの帯域幅監視データには、帯域幅の使用量が高すぎることにより、Tencent CVMに接続できないことを確認しました。
<!--  -[セルフ診断](https://console.cloud.tencent.com/workorder/check)ツールで帯域幅の使用量が高すぎることを診断しました。 -->

## 障害の特定と対処

1. [CVMコンソール](https://console.cloud.tencent.com/cvm/index)にログインします。
2. チェック対象のCVMを選択して、【ログイン】をクリックします。下図に示すように：
![](https://main.qcloudimg.com/raw/cc5786b9f8b57ff4057b666503729bc0.png)
3. ポップアップされた 「Windows/Linuxインスタンスにログインする」ウィンドーで、【その他の方式(VNC）】を選択し、【今すぐログイン】をクリックして、CVMにログインします。
4. ポップアップされたログインウィンドーで、左上の「リモートコマンドの送信」を選択し、**Ctrl-Alt-Delete** をクリックしシステムログインインターフェースに入ります。下図に示すように：
![](https://main.qcloudimg.com/raw/5064251ea86085326e86884a1c13ef6b.png)

###  Windows サーバーの場合
 VNC を通して Windows CVMにログインした後、以下の操作を実行する必要があります：
>? 以下の操作では、 Windows Server 2012 システムのCVMを例として説明します。
>
1. CVMで、 <img src="https://main.qcloudimg.com/raw/87d894e564b7e837d9f478298cf2e292.png" style="margin: 0;"></img>をクリックし、【タスクマネージャー】を選択して、「タスクマネージャー」を開きます。
2. 【パフォーマンス】タブを選択し、【リソースモニターを開く】をクリックします。下図に示すように：
![](https://main.qcloudimg.com/raw/a635da7e769cc1424b225674803e5cb1.png)
3. 開いた「リソースモニター」で、多くの帯域幅を消費するプロセスを確認し、実際の業務に基づいて、プロセスが正常かを判断します。下図に示すように：
![](https://main.qcloudimg.com/raw/6a131472fc52bb4f5c4d5f57a1b7b010.png)
 - 帯域幅を大量に消費するプロセスが業務プロセスである場合、アクセス量の変化によるか、キャパシティーの最適化する必要があるか、或は[サーバー設定のアップグレード](https://intl.cloud.tencent.com/document/product/213/2178)を分析する必要があります。
 - 帯域幅を大量に消費するプロセスが異常なプロセスである場合は、ウイルス或はトロイの木馬が原因である可能性があります。プロセスを自分で終了する或はセキュリティソフトウェアを使用して駆除し、データをバックアップした後に、システムを再インストールします。
 >! Windows システムでの多くのウイルスプログラムはシステムプロセスを装います。【タスクマネージャー】>【プロセス】プロセス情報を使用して初期識別を行います：
 > 正常なシステムプロセスは完全な署名と説明があり、殆どはC:\Windows\System32ディレクトリにあります。ウイルスプログラムの名前はシステムプロセスの名前と同じかもしれませんが、署名や説明がなく、場所も通常ではないところにあります。
 > 
 - 帯域幅を大量に消費するプロセスがTencent Cloudコンポーネントプロセスである場合は、[チケットを発行](https://console.cloud.tencent.com/workorder/category) して、我々に連絡して特定処理を行います。

###  Linux サーバーの場合
 VNC を通して Linux CVMにログインした後、以下の操作を実行する必要があります：
>? 以下の操作では、 CentOS 7.6 システムのCVMを例として説明します。
>
1. 以下のコマンドを実行して、 iftop ツール（iftop ツールは Linux サーバー下のトラフィック監視ツール）をインストールします。
```
yum install iftop -y
```
>?  Ubuntu システムの場合、 `apt-get install iftop -y` コマンドを実行してください。
>
2. 以下のコマンドを実行し、  lsofをインストールします。
```
yum install lsof -y
```
3. 以下のコマンドを実行し、 iftopを実行します。 下図に示すように：
```
iftop
```
![](https://main.qcloudimg.com/raw/7fccea56d998a65df6ff7e9348772910.png)
 - `<=`、`=>` はトラフィックの方向です
 - TX は送信トラフィックです
 - RX は受信トラフィックです
 - TOTAL は総トラフィックです
 - Cum は iftop を実行して今までの総トラフィックです
 - peak はトラフィックのピーク値です。
 - rates はそれぞれ過去2s、10sと40sの平均トラフィックです
4.  iftop でトラフィックを消費するIPに基づき、以下のコマンドを実行して、 IPへの接続プロセスを確認します。
```
lsof -i | grep IP
```
例えば、トラフィックを消費する IP が201.205.141.123の場合、以下のコマンドを実行します：
```
lsof -i | grep 201.205.141.123
```
返された以下の結果によって、このサーバーの帯域幅は主に SSH プロセスによって消費されることが分ります。
```
sshd       12145    root    3u  IPV4  3294018       0t0   TCP 10.144.90.86:ssh->203.205.141.123:58614(ESTABLISHED)
sshd       12179  ubuntu    3u  IPV4  3294018       0t0   TCP 10.144.90.86:ssh->203.205.141.123:58614(ESTABLISHED)
```
5. 帯域幅を消費しているプロセスを確認して、プロセスが正常かを判断します。
 - 帯域幅を大量に消費するプロセスが業務プロセスである場合、アクセス量の変化によるか、キャパシティーの最適化する必要があるか、或は[サーバー設定のアップグレード](https://intl.cloud.tencent.com/document/product/213/2178)を分析する必要があります。
 - 帯域幅を大量に消費するプロセスが異常なプロセスである場合は、ウイルス或はトロイの木馬が原因である可能性があります。プロセスを自分で終了する或はセキュリティソフトウェアを使用して駆除し、データをバックアップした後に、システムを再インストールします。
 - 帯域幅を大量に消費するプロセスがTencent Cloudコンポーネントプロセスである場合は、[チケットを発行](https://console.cloud.tencent.com/workorder/category) して、我々に連絡して特定処理を行います。


宛先 IP 所有地を重点的に確認することをお勧めします。[What is my IP address](https://whatismyipaddress.com/) で IP 所有地を確認できます。宛先 IP 所有地が外国になっている場合は、大きなセキュリティリスクがあり、是非注意してください！

