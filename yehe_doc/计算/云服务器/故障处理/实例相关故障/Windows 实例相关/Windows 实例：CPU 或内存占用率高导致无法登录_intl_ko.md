## 작업 시나리오

본 문서는 Windows CVM이 CPU 및 메모리 점유율이 높음으로 인해 로그인할 수 없는 문제를 진단하는 방법과 솔루션에 대해 소개합니다.
>? 아래의 작업 순서는 Windows server 2012 R2 를 예시로 사용하였으며, 운영 체제 버전에 따라 세부 작업 순서에 약간의 차이가 있을 수 있습니다.

## 작업 순서

### mstsc 방식으로 CVM에 로그인

1. 로컬 컴퓨터에서 단축 키 **Windows+R**을 사용하여 실행창을 엽니다.
2. **mstsc**를 입력하고 **Enter**를 눌러 “원격 데스크탑 연결” 인터페이스를 엽니다.
3. 팝업된 “원격 데스크탑 연결” 창에서 CVM 공인 IP와 로그인 비밀번호를 입력하여 CVM에 로그인합니다.
>!  CVM 부하가 높을 경우 원격 연결을 구축할 수 없으며, **VNC 방식**으로 CVM에 로그인해야 합니다. 즉, “[CVM 콘솔](https://console.cloud.tencent.com/cvm)에 로그인하고 > 우측 작업 표시줄의 [Log In]을 클릭한 후 > VNC 방식을 선택하여 CVM에 로그인합니다”.

### 프로세스 점유율 조회

1. CVM에서 "작업 표시줄"을 우클릭하여 [작업 관리자]를 선택합니다. 아래 그림 참조
![](https://main.qcloudimg.com/raw/a795f4948fae3eab8a44ec0a3a4ee352.png)
2. 열린 "작업 관리자"에서 리소스 점유율을 조회할 수 있습니다. 아래 그림 참조
>?  사용자는 CPU 또는 메모리를 클릭하여 오름차순/내림차순으로 프로세스를 정렬할 수 있습니다.
>
![](https://main.qcloudimg.com/raw/56a4be427be5046a15a05b02abbacf66.png)

### 프로세스 분석

작업 관리자 내 프로세스를 조회하고 문제 분석 및 진단을 통해 해당하는 솔루션을 채택합니다.
 - 비즈니스 프로세스의 대량 리소스 점유. 예: IIS, httpd, PHP, Java 등.
 	- 현재 비즈니스량이 확실히 많은 경우 고부하인 것이 정상이므로 적절한 확장을 고민해야 합니다.
 	- 현재 비즈니스량이 많지 않을 경우 비즈니스 에러 로그와 결합하여 분석해야 하며, 잘못된 매개변수 설정에 의해 리소스를 허비했을 수 있습니다.
 - 시스템 프로세스의 대량 리소스 점유. 예: `svchost.exe` 등.
 	- 네트워크 조회를 통해 시스템 프로세스인지 확인할 수 있습니다.
 	- 시스템 프로세스는 대부분 `C:\windows\system32` 디렉터리에 위치해 있으며 완전한 서명과 설명이 있습니다.
 	- 시스템을 재시작하거나, 안전하지만 불필요한 시스템 프로세스를 종료합니다.
 - 비즈니스 프로세스도, 시스템 프로세스도 아닌 프로세스의 대량 리소스 점유.
	 - 프로세스 이름이 이상하고 서명 및 설명이 없으며, `C:\windows\system32` 디렉터리에 위치하지 않는 비정상 프로세스가 리소스를 소모하는 경우 CVM이 감염되었을 수 있습니다.
	 - 서버 보안 상황을 점검하고 필요 시 데이터 백업, 시스템 재설치를 고려해야 합니다.
