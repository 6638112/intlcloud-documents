このドキュメントでは、Windowsインスタンスにログインできない時に考えられる原因とそのトラブルシューティング方法について説明します。問題のトラブルシューティング、特定、および解決に役立ちます。

## 考えられる原因
Windows インスタンスにログインできない場合は、主に以下の原因が考えられます。
- [パスワードの問題によりログインできない](#CryptographicProblem)
- [帯域幅利用率が高すぎる](#BandwidthUtilization)
- [サーバーの過負荷](#HighServerLoad)
- [リモートポートの設定異常](#RemotePortConfiguration)
- [不適切なセキュリティグループ](#SafetyGroupRule)
- [ファイアウォールまたはセキュリティソフトによるログイン異常](#LoginSecuritySoftware)
- [リモートデスクトップ接続時に認証エラーが発生した](#AuthenticationError)

トラブルシューティングツールで問題を確認できない場合は、[VNCによるCVMにログイン](#VNC) し、ステップごとにトラブルシューティングすることをお勧めします。　

<span id="TroubleshootingIdeas"></span>
## トラブルシューティング

<span id="VNC"></span>
### VNCによるログイン

RDPまたはリモートログインソフトでWindowsインスタンスにログインできない場合は、Tencent Cloud VNCを介してログインし、問題の原因を特定するのに役立ちます。
1. [Tencent Cloudコンソール](https://console.cloud.tencent.com/cvm/index)にログインします。
2. インスタンスの管理ページで、ログインするインスタンスを選択し、【ログイン】をクリックします。下図に示すように、
![](https://main.qcloudimg.com/raw/d9ccf04da21f4ac86d624742c87d5628.png)
3. ポップアップされた「Windowsインスタンスにログインする」画面で、【その他の方法（VNC）】を選択し、【すぐにログインする】をクリックします。
> インスタンスのパスワードを忘れた場合は、コンソールで対象インスタンスのパスワードをリセットすることができます。操作手順の詳細については、[インスタンスパスワードのリセット](https://intl.cloud.tencent.com/document/product/213/16566)をご参照ください。
>
4. ポップアップされたログインウィンドウで、左上隅にある「Send CtrlAltDel」を選択して、Ctrl-Alt-Deleteをクリックすると、システムログイン画面に入ります。下図に示すように、
![](https://main.qcloudimg.com/raw/5064251ea86085326e86884a1c13ef6b.png)


<span id="CryptographicProblem"></span>
### パスワードの問題によりログインできない

**障害の現象**：パスワードの入力間違い、パスワードを忘れた、またはパスワードのリセット失敗によるログインできません。
**ソリューション **： [Tencent Cloudコンソール](https://console.cloud.tencent.com/cvm/index) で当該インスタンスのパスワードをリセットした後、インスタンスを再起動します。
**対処手順**：インスタンスパスワードのリセット方法については、[インスタンスパスワードのリセット](https://intl.cloud.tencent.com/document/product/213/16566)をご参照ください。

<span id="BandwidthUtilization"></span>
### 帯域幅利用率が高すぎる

**対処手順**：
1.  [VNC ログイン](#VNC)の方法でインスタンスにログインします。
2. [帯域幅の利用率が高いためログインできない](https://intl.cloud.tencent.com/document/product/213/32542)を参考にし、インスタンスの帯域幅使用量を確認し、それに応じてトラブルシューティングを行っています。

<span id="HighServerLoad"></span>
### サーバーの過負荷

**障害の現象**：クラウド監視により、サーバーのCPUの過負荷によりシステムがリモートで接続できないか、または接続が不安定であることが判明しました。
**考えられる原因**：ウィルスやトロイの木馬、サードパーティーのウイルス対策ソフトウェア、アプリケーションの異常、ドライバーの異常またはバックグラウンドでのソフトウェアの自動更新により、CPU使用率が高くなり、CVMにログインできない、アクセスの遅延が発生する可能性があります。
**対処手順**：
1.  [VNC ログイン](#VNC)の方法でインスタンスにログインします。
2.  [Windows インスタンス：CPUとメモリの使用率が高いためログインできない](https://intl.cloud.tencent.com/document/product/213/32405)を参考して、「タスクマネージャー」で高負荷になっているプロセスを特定します。

<span id="RemotePortConfiguration"></span>
### リモートポートの設定異常

**障害の現象**：リモートで接続できない、リモートアクセスポートがデフォルトポートでなく、変更されたか、ポート3389が開いていません。
**診断**：インスタンスのパブリックIPアドレスにpingしてネットワーク接続の状態を確認し、telnetコマンドでポートが開いているかどうかを確認します。
**対処手順**：操作手順の詳細については、[ポート問題によりリモートログインできない](https://intl.cloud.tencent.com/document/product/213/32540)をご参照ください。

<span id="SafetyGroupRule"></span>
### 不適切なセキュリティグループルール

**対処手順**： [セキュリティグループ（ポート）検証ツール](https://console.cloud.tencent.com/vpc/helper) で確認します。
> リモートでログインしている Windows インスタンスは、ポート3389を開く必要があります。
> 
![](https://main.qcloudimg.com/raw/27b5aa974a2263719574dfc3bb7c0c6d.png)
問題の原因がセキュリティグループのポートの問題である場合は、【ワンクリックポートオーペン】機能ですべてのポートを開くことができます。
![](https://main.qcloudimg.com/raw/bd91ec53dfd0df6bd1127a7f4f9db35c.png)
セキュリティグループルールをカスタマイズする必要がある場合は、 [セキュリティグループルールの追加](https://intl.cloud.tencent.com/document/product/213/34272)を参照して、セキュリティグループのルールを再設定してください。


<span id="LoginSecuritySoftware"></span>
### ファイアウォールまたはセキュリティソフトによるログイン異常

**障害の現象**：CVMのファイアウォールの設定、またはセキュリティソフトによるログインに失敗しました。
**診断**：VNCを介してWindowsインスタンスにログインし、ファイアウォールが有効になっているかどうか、360やセキュリティドッグ等のセキュリティソフトがサーバーにインストールされているかどうかを確認します。
> この操作はCVMのファイアウォールをシャットダウンする場合がありますので、この操作を実行するには、対応する権限があることを確認してください。
>
**対処手順**：ファイアウォールまたはセキュリティソフトを無効にし、リモート接続を再試行し、正常にリモートログインできるかどうかを確認します。下記の操作は Windows Server 2016 インスタンスのファイアウォールのオフを例として説明します。
1.  [VNC ログイン](#VNC)を使用してインスタンスにログインします。
2. OS画面で、<img src="https://main.qcloudimg.com/raw/6e36af2ceb4604b81de13cb42f30e859.png" style="margin: 0;">をクリックし、【コントロールパネル】を選択し、コントロールパネルウィンドウを開きます。
3. 【Windows ファイアウォール】をクリックして、「Windows ファイアウォール」画面に入ります。
4. 画面左側の【Windowsファイアウォールの有効化または無効化】をクリックします。「カスタマイズ設定」画面に入ります。
5. 【パブリックネットワークの場所の設定】欄の【Windowsファイアウォールを無効にする】をクリックして、【OK】をクリックします。
6. インスタンスを再起動し、リモート接続を再試行して、リモートログインが成功するかどうかを確認します。

<span id="AuthenticationError"></span>
### リモートデスクトップ接続時に認証エラーが発生した

**障害の現象**：リモートデスクトップ経由でWindows インスタンスにログインする時に、「認証エラーが発生しました。この関数に提供されたトークンは無効です。」または「認証エラーが発生しました。要求された関数はサポートされていません」 というエラーメッセージが表示されます。
**考えられる原因**：Microsoft社は2018年3月にセキュリティ更新プログラムをリリースしました。この更新プログラムは、Credential Security Supporting Program（CredSSP）が認証プロセスにおける検証リクエスト方法を修正したことにより、 CredSSPにおけるリモートコード実行の脆弱性を修復します。クライアントとサーバーの両方もこの更新プログラムをインストールする必要があります。そうしないと、上記のエラーが発生する可能性があります。
**対処手順**：セキュリティ更新プログラムをインストールすることをお勧めします。詳細については、[Windows インスタンス：認証エラーが発生しました](https://intl.cloud.tencent.com/document/product/213/32421)をご参照ください。

## その他のソリューション
上記トラブルシューティングを完了しても、Windows インスタンスに接続できない場合は、自己診断結果を保存して、[チケットを送信](https://console.cloud.tencent.com/workorder/category) してください。
