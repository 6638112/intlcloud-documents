セキュリティグループの設定は、CVMにアクセスできるかを管理するために使用され、セキュリティグループのインバウンドとアウトバウンドルールを設定することにより、お客様のサーバーにアクセスできるかまたは他のネットワークリソースにアクセスできるかどうかを設定できます。
デフォルトでは、セキュリティグループのインバウンドルールおよびアウトバウンドルールは次のとおりです：
- **データ安全のため、セキュリティグループのインバウンドルールは拒否ポリシーであり、外部ネットワークからリモートアクセスを禁止します。**外部からCVMにアクセスする必要がある場合は、対応するポートのインバウンドルールを開放する必要があります。
- セキュリティグループのアウトバウンドルールは、CVMが外部ネットワークリソースにアクセスできるかを設定するために使用されます。「すべてのポートを開放する」または「ポート22、80、443、3389およびICMPプロトコルを開放する」を選択すると、セキュリティグループのアウトバウンドルールがすべて開放します。 カスタマイズセキュリティグループルールを選択すると、デフォルトでアウトバウンドルールがすべて拒否されます。外部ネットワークリソースにアクセスするには、対応するポートのアウトバウンドルールを開放する必要があります。

## よくあるユースケース
このドキュメントでは、いくつかの一般的なセキュリティグループユースケースを紹介します。以下のシナリオでニーズを満たせる場合は、シナリオ中の推奨設定に従ってセキュリティグループを直接設定できます。

### シナリオ１：SSHリモートでLinux CVMへの接続を許可する
**事例**：Linux CVMを作成し、SSHを通してCVMにリモートで接続できるようにします。
**解決策**：セキュリティグループルールを追加する時に、「タイプ」で「Linuxログイン」を選択し、プロトコルポート22を開放し、Linux SSHログインを開放します。
実際のニーズに応じて、すべてのIPまたは指定されたIP（IPセグメント）を開放し、SSHを通してCVMのIPソース元にリモート接続できるように設定します。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>Linux ログイン</td><td><ul style="margin: 0;"><li>すべてのIP：0.0.0.0/0</li><li>IPを指定：指定したIPまたはIPセグメントを入力する</li></ul></td><td>TCP:22</td><td>許可する</td></tr>
</table>

### シナリオ2：RDPリモートでWindows CVMへの接続を許可する
**事例**：Windows CVMを作成し、RDPを通してCVMにリモートで接続できるようにします。
**解決策**：セキュリティグループルールを追加する時に、「種類」で「Windowsログイン」を選択し、プロトコルポート3389を開放し、Windowsのリモートログインを開放します。
また、実際のニーズに応じてすべてのIPまたは指定されたIP（IPセグメント）を開放し、RDPを通してCVMのIPソースにリモート接続できるように設定します。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>Windows ログイン</td><td><ul style="margin: 0;"><li>すべてのIP：0.0.0.0/0</li><li>IPを指定：指定したIPまたはIPセグメントを入力する</li></ul></td><td>TCP:3389</td><td>許可する</td></tr>
</table>

### シナリオ3：パブリックネットワークがサーバーにpingできるようにする
**事例**：CVMを作成し、このCVMと他のCVM間の通信状態が正常かどうかをテストできるようにします。
**解決策**：pingを利用してテストします。 つまり、セキュリティグループルールを追加する時に、「種類」を「Ping」に選択し、ICMPプロトコルポートを開放し、他のCVMがICMPプロトコルを通してこのCVMにアクセスできるようにします。
また、実際のニーズに応じてすべてのIPまたは指定されたIP（IPセグメント）を開放し、ICMPプロトコルを通してCVMのIPソース元にアクセスできるように設定します。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>Ping</td><td><ul style="margin: 0;"><li>すべての IP：0.0.0.0/0</li><li>IPを指定：指定したIPまたはIPセグメントを入力する</li></ul></td><td>ICMP</td><td>許可する</td></tr>
</table>

### シナリオ4：Telnetでのリモートログイン
**事例**：Telnetを通してCVMにリモートログインできるようにします。
**解決策**：Telnetを通してCVMにリモートログインしたい場合は、セキュリティグループルールを追加するときに以下のセキュリティグループルールを設定する必要があります。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド方向</td><td>カスタマイズ</td><td><ul style="margin: 0;"><li>すべての IP：0.0.0.0/0</li><li>IPを指定：指定したIPまたはIPセグメントを入力する</li></ul></td><td>TCP:23</td><td>許可する</td></tr>
</table>

### シナリオ5：WebサービスのHTTPまたはHTTPSアクセスを開放する
**事例**：一つのウェブサイトを構築し、ユーザーがHTTPまたはHTTPSを通して構築したウェブサイトにアクセスできるようにします。
**解決策**：HTTPまたはHTTPSを通してウェブサイトにアクセスしたい場合、セキュリティグループルールを追加するときに、実際の要件に従って以下のセキュリティグループルールを設定する必要があります。
- パブリックネットワーク上のすべてのIPがこのウェブサイトにアクセスできるようにする
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>HTTP（80）</td><td>0.0.0.0/0</td><td>TCP:80</td><td>許可する</td></tr>
<tr><td>インバウンド</td><td>HTTPS（443）</td><td>0.0.0.0/0</td><td>TCP:443</td><td>許可する</td></tr>
</table>
- パブリックネットワーク上の一部のIPがウェブサイトにアクセスできるようにする
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>HTTP（80）</td><td>ウェブサイトへのアクセスが許可されているIPまたはIPアドレスセグメント</td><td>TCP:80</td><td>許可する</td></tr>
<tr><td>インバウンド</td><td>HTTPS（443）</td><td>ウェブサイトへのアクセスが許可されているIPまたはIPアドレスセグメント</td><td>TCP:443</td><td>許可する</td></tr>
</table>

### シナリオ6：外部IPが指定ポートにアクセスできるようにする
**事例**：業務をデプロイした後、外部から指定された業務ポート（例えば、1101）にアクセスできるようにします。
**解決策**：セキュリティグループルールを追加する時に、「種類」で「カスタマイズ」を選択し、プロトコルポート1101を開放して、外部から指定された業務ポートへのアクセスを許可します。
また、実際のニーズに応じてすべてのIPまたは指定IP（IPセグメント）を開放し、指定した業務ポートのIPソース元へのアクセスを許可します。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>カスタマイズ</td><td><ul style="margin: 0;"><li>すべての IP：0.0.0.0/0</li><li>IPを指定：指定したIPまたはIPセグメントを入力する</li></ul></td><td>TCP:1101</td><td>許可する</td></tr>
</table>

### シナリオ7：外部IPから指定したポートへのアクセスを拒否する
**事例**：業務をデプロイした後、指定された業務ポート（例えば、1102）が外部からアクセスされないようにします。
**解決策**：セキュリティグループルールを追加する時に、「種類」で「カスタマイズ」を選択し、プロトコルポート1102を設定し、「ポリシー」を「拒否」に設定し、外部から指定した業務ポートへのアクセスを拒否します。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>カスタマイズ</td><td><ul style="margin: 0;"><li>すべての IP：0.0.0.0/0</li><li>IPを指定：指定したIPまたはIPセグメントを入力する</li></ul></td><td>TCP:1102</td><td>拒否する</td></tr>
</table>

### シナリオ8：CVMが特定の外部IPのみにアクセスできるようにする
**事例**：CVMが外部の特定のIPアドレスのみアクセスできるようにします。
**解決策**：以下の設定を参照し、次の2つのアウトバンドのセキュリティグループルールを追加します。
- インスタンスが特定のパブリックIPアドレスにアクセスできるようにする
- インスタンスが任意のプロトコルですべてのパブリックIPアドレスにアクセスするのを禁止する

>! アクセスを許可するルールは、アクセスを拒否するルールより優先する必要があります。
>
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>アウトバンド</td><td>カスタマイズ</td><td>CVMがアクセスできる特定のパブリックIPアドレス</td><td>使用したいプロトコル種類とポート</td><td>許可する</td></tr>
<tr><td>アウトバンド</td><td>カスタマイズ</td><td>0.0.0.0/0</td><td>ALL</td><td>拒否する</td></tr>
</table>

### シナリオ9：CVMが特定の外部IPにアクセスすることを拒否する
**事例**：CVMが外部の特定のIPアドレスにアクセスできないようにします。
**解決策**：次の設定を参照し、セキュリティグループルールを追加します。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>アウトバンド</td><td>カスタマイズ</td><td>インスタンスからのアクセスを拒否する特定のパブリックIPアドレス</td><td>ALL</td><td>拒否する</td></tr>
</table>

### シナリオ10：FTPを利用してファイルをアップロードまたはダウンロードする
**事例**：FTPソフトウェアを利用して、CVMにファイルをアップロードまたはダウンロードする必要がある
**解決策**：次の設定を参照し、セキュリティグループルールを追加します。
<table>
<tr><th>方向</th><th>種類</th><th>ソース元</th><th>プロトコルポート</th><th>ポリシー</th></tr>
<tr><td>インバウンド</td><td>カスタマイズ</td><td>0.0.0.0/0</td><td>TCP:20-21</td><td>許可する</td></tr>
</table>

## 複数ユースケースの組み合わせ
実際のシナリオでは、業務要件に基づいて複数のセキュリティグループルールを設定する必要があります。 例えば、同時にインバウンドルールとアウトバウンドルールを設定します。 1つのCVMを複数のセキュリティグループにバインドできます。CVMが複数のセキュリティグループをバインドしている場合、複数のセキュリティグループは上から下の順番に実行されます。 セキュリティグループの優先度はいつでも調整できます。セキュリティグループルールの優先度の説明については、[ルールの優先度の説明](https://cloud.tencent.com/document/product/213/12452#.E8.A7.84.E5.88.99.E4.BC.98.E5.85.88.E7.BA.A7)をご参照ください。 

