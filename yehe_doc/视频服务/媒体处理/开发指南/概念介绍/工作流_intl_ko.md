‘워크플로’는 소스 오디오/비디오 파일에서 수행되는 일련의 작업 작업을 의미합니다. 작업 태스크는 병렬 또는 직렬일 수 있으며 일반적으로 MPS에서 ‘태스크’라고 합니다. 워크플로는 다음과 같습니다.
<img src="https://main.qcloudimg.com/raw/f327643bd24f9aaa1dec7b9a158fbe60.gif" width = "650px">

| 부호 | 의미 |
|---------|---------|
| 원형 | 작업의 시작과 끝을 나타냅니다. |
| 다이아몬드 | 작업의 분해를 나타냅니다. |
| 직사각형 | 작업의 실행 단위를 나타냅니다. |
| 점 | 작업의 결합 또는 병합을 나타냅니다. |
| 화살표 | 다른 작업 또는 작업의 다른 단계를 실행하는 경로를 나타냅니다. |

MPS 워크플로는 트랜스코딩, 샘플링된 스크린 캡처, 시점 스크린 캡처, 애니메이션 이미지 생성, 스프라이트 이미지 생성 및 워터마킹과 같은 작업으로 구성됩니다. 다음은 일반적인 MPS 워크플로 예시입니다.
<img src="https://main.qcloudimg.com/raw/1fee8264c4804a2fa8d69423156ac870.jpg" width = "750px">
트랜스코딩 작업에 SD 및 HD로의 트랜스코딩 및 다양한 크기의 스크린샷 생성과 같은 다양한 사양이 포함된 경우, 동시에 실행될 여러 하위 작업으로 나뉩니다. 모든 하위 작업이 완료되면 MPS는 결과를 통합하고 작업을 종료합니다.

## 워크플로 작동 방식

MPS를 예로 들면 워크플로는 아래와 같이 주로 워크플로 구성, 트랜스코딩 트리거, 트랜스코딩 작업 수행, 알림 보내기와 같은 작업으로 구성됩니다.
<img src="https://main.qcloudimg.com/raw/6ece0c923755b349e470a02df3c1d683.jpg" width = "900px">

1. [**워크플로 구성**](#p1): 콘솔에서 관리자로 워크플로를 구성할 수 있습니다. 구성하기 전에 CMQ 대기열과 [COS Bucket](https://intl.cloud.tencent.com/document/product/436/32955)을 생성하고 MPS에 대한 권한을 부여해야 합니다.
2. [**트랜스코딩 트리거**](#p2): 콘솔 또는 SDK를 통해 생성된 COS Bucket에 오디오/비디오 파일을 업로드한 후 Bucket에 바인딩된 워크플로 작업(즉, 트랜스코딩 작업)이 트리거됩니다. 또한 [ProcessMedia](https://intl.cloud.tencent.com/document/product/1041/33640) API를 사용하여 단일 파일에 대한 트랜스코딩 작업을 시작할 수 있습니다.
3. [**트랜스코딩 작업 처리**](#p3): 워크플로 작업 처리 과정 중, COS에서 소스 파일 다운로드, COS로 출력 파일 업로드 등 읽기/쓰기 작업이 진행됩니다.
4. [**알림 보내기**](#p4): 워크플로가 완료되면 MPS는 생성된 CMQ 대기열에 작업 완료 알림을 보냅니다. CMQ API를 통해 알림을 받을 수 있습니다.
>?
>- 워크플로에 대한 자세한 내용은 [워크플로](https://intl.cloud.tencent.com/document/product/1041/33475)를 참고하십시오. 워크플로 설정 방법에 대한 자세한 내용은 [워크플로 설정](https://intl.cloud.tencent.com/document/product/1041/33492)을 참고하십시오. 
>- 파일이 성공적으로 트랜스코딩되면 CDN을 통해 출력 동영상 배포 등 후속 로직 단계를 진행할 수 있습니다.

[](id:p1)
### 워크플로 구성
파일 업로드 시 트랜스코딩 작업이 자동으로 실행되도록 하려면 워크플로를 미리 구성해야 합니다. 워크플로는 지정된 COS Bucket에 업로드된 파일에 대해 지정된 트랜스코딩 작업을 자동으로 시작하고 출력 파일을 동일하거나 다른 COS Bucket에 업로드합니다.

파일 업로드 시 트랜스코딩 작업을 자동으로 트리거하지 않으려면 API를 호출하여 단일 파일에 대한 트랜스코딩 작업을 수동으로 트리거할 수 있습니다. 이 경우 워크플로를 구성할 필요가 없습니다.

[](id:p2)
### 트랜스코딩 작업 트리거
트랜스코딩 작업은 자동 또는 수동으로 트리거될 수 있습니다.
_ **자동 트리거**: 구성된 워크플로를 사용하면 파일 업로드 시 트랜스코딩 작업이 자동으로 트리거됩니다.
<img src="https://main.qcloudimg.com/raw/31c0ac50ecc4a53b4eae6026b3fab6ec.jpg" width = "900px">
- **수동 트리거**: API를 호출하여 트랜스코딩 작업을 시작하고 CMQ를 통해 작업 완료 알림을 받거나 TaskId를 통해 작업 상태를 쿼리할 수 있습니다. 수동 트리거링에 대한 자세한 내용은 [수동으로 트랜스코딩 시작](https://intl.cloud.tencent.com/document/product/1041/33493)을 참고하십시오.<br>
<img src="https://main.qcloudimg.com/raw/e727f9a2703c6bde77e93945133b267f.jpg" width = "900px">

>?
>- 상기 이미지의 제 5단계는 API를 호출하여 작업 시작에서 반환된 TaskId 매개변수를 사용하여 작업 상태를 쿼리할 수 있음을 나타냅니다.
>- 빨간색 상자의 단계는 선택 사항입니다. 트랜스코딩 작업을 수동으로 트리거하면 제 5단계에 표시된 대로 CMQ를 사용하여 알림을 수신하거나 API를 통해 작업 상태를 쿼리할 수 있습니다.

[](id:p3)
### 트랜스코딩 작업 처리
트랜스코딩 작업에는 트랜스코딩, 스크린 캡처, 워터마킹과 같은 작업과 출력 파일 업로드가 포함됩니다. 작업은 처리 속도를 높이기 위해 병렬 또는 직렬 처리를 위해 여러 하위 작업으로 나뉩니다.

작업이 완료되면 MPS는 출력 파일을 지정된 COS Bucket에 업로드합니다. 업로드에 실패하면 최종 작업 상태는 실패가 됩니다.

[](id:p4)
### 이벤트 알림 발송

트랜스코딩 작업의 성공 여부에 관계없이 완료되면 알림을 받게 됩니다. 알림을 받으면 다음 단계를 진행할 수 있습니다.

