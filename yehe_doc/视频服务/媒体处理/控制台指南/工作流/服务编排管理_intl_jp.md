## 操作シナリオ
**サービスオーケストレーション**を設定すると、指定されたBucketのディレクトリ下にアップロードされたビデオはサービスオーケストレーションフローを自動的にトリガーし、出力ファイルは指定されたBucketのディレクトリに書き込まれます。サービスオーケストレーションにはオーディオビデオトランスコーディングタスク、オーディオビデオエンハンスメントタスク、ウォーターマークタスク、スクリーンキャプチャタスク、アニメーション画像生成タスク、審査タスク、コンテンツ認識タスク、およびコンテンツ分析タスクが設定できます。

## サービスオーケストレーションの作成
### 作成ページに進む[](id:create)
1. [MPSコンソール](https://console.cloud.tencent.com/mps)にログインし、 [**ワークフロー**> **サービスオーケストレーション管理** > **サービスオーケストレーション作成**](https://console.cloud.tencent.com/mps/workflows/pipeline/add)をクリックします。
2. **サービスオーケストレーション作成**ページに進み、業務シーンの具体的な必要性に応じて、使用ニーズに合ったサービスオーケストレーションフローおよび設定情報を作成することができます。
<table>
    <tr>
        <th width=15%>設定項目<a id="workflow"></a></th>
        <th>入力必須かどうか</th>
        <th>設定説明</th>
    </tr>
    <tr>
        <td>サービスオーケストレーション名</td>
        <td>はい</td>
        <td>128文字以内の中国語、英語、数字、アンダーバーとハイフン<code>（_-）</code>を組み合わせて入力できます（例：「MPS」）。</td>
    </tr>
    <tr>
        <td>トリガーBucket</td>
        <td>はい</td>
        <td>このAPPID下に作成したBucketから1つを選択し、トリガーBucketとすることができます。サービスオーケストレーションの開始後、ビデオファイルをこのBucketにアップロードすると、サービスオーケストレーションの実行を自動的にトリガーすることができます。</td>
    </tr>
    <tr>
        <td>トリガーディレクトリ</td>
        <td>いいえ</td>
        <td>スラッシュ<code>（/）</code>を末尾につけます。入力しない場合は、トリガーBucketのすべてのディレクトリが有効になります。</td>
    </tr>
    <tr>
        <td>出力Bucket</td>
        <td>はい</td>
        <td>デフォルトはトリガーBucketと同じですが、当該APPIDのトリガーBucketと同じリージョンのBucketから1つを選択し、出力Bucketとすることができます。サービスオーケストレーションの処理が完了した後、新しく生成されたビデオファイルはこのBucketに保存されます。</td>
    </tr>
    <tr>
        <td>出力ディレクトリ</td>
        <td>いいえ</td>
        <td>スラッシュ<code>（/）</code>を末尾につけます。入力しない場合、出力ディレクトリはトリガーディレクトリとの一致を維持します。</td>
    </tr>
</table>

3. 設定完了後に**サブミット**をクリックすると、サービスオーケストレーションの作成が完了します。
![](https://qcloudimg.tencent-cloud.cn/raw/f10a7ed82865537c7d024e6537f1b083.png)

### イベント通知設定
イベント通知はタスク処理フローにおいて、タスクの進捗とステータスをリアルタイムに同期できる機能です。イベント通知を有効化し、設定すると使用できます。現在は、TDMQ-CMQコールバック、HTTPコールバック、SCFコールバックの3種類のメカニズムを提供しています。詳細な説明は次のとおりです。
<table>
<tr>
<th>コールバック方式のタイプ<a id="recall"></a></th>
<th>設定説明</th>
</tr>
<tr>
<td>TDMQ-CMQコールバック</td>
<td><ol style="margin:0">
<li>TDMQ-CMQイベント通知を有効化したい場合は、<a href="https://console.cloud.tencent.com/tdmq/cmq-queue?rid=1">メッセージキューTDMQ</a> に移動してサービスをアクティブ化し、モデルを作成してください。イベント通知を有効化すると、指定したCMQがMPSのイベント通知を受信します。</br>
<li>次の設定情報を入力する必要があります：<ul style="margin:0">
			<li>CMQモデル：デフォルトではキューモデルが選択されています。</li>
			<li>CMQエリア：広州、上海、北京、上海金融、深圳金融、中国香港、成都、北アメリカエリアまたはアメリカ西部を選択可能です。</li>
			<li>キュー名：カスタマイズできます。</li>
</ul></ul></td>
</tr>
<tr>
<td>HTTPコールバック
</td>
<td>タスクのイベント通知設定インターフェース<a href="https://intl.cloud.tencent.com/document/product/1041/33690#TaskNotifyConfig">TaskNotifyConfig</a>を呼び出す際、NotifyTypeパラメータにはURLを指定し、NotifyUrlパラメータにHTTPコールバックアドレスを入力する必要があります。</td>
</tr>
<tr>
<td>SCFコールバック</td>
<td><ol style="margin:0">
	<li>関数処理サービスにより、MPSが生成したコールバックイベントに対する処理および操作を迅速に完了することができます。全体的なデータ処理フローチャートは次のとおりです。</br>
	<img src="https://main.qcloudimg.com/raw/02656fefa8e2f61f71252727747b7a02.png" /></li>
	<li>MPSトリガーによりイベントをSCF関数側にプッシュし、さらにserverlessアーキテクチャの関数計算によりコールバックイベントの処理およびレスポンスを提供します。</li>
	<li>設定ページの「SCF操作に進む」ボタンをクリックし、設定操作を行うことができます。具体的な設定方法については、<a href="https://intl.cloud.tencent.com/document/product/1041/40337">ビデオタスクコールバック通知</a>をご参照ください。注意：<ul style="margin:0">
	<li>SCFコールバック設定はすべてのサービスオーケストレーションが対象となります。現在サービスオーケストレーションでは設定状態を保存しません。</li>
	<li>データをServerless Cloud Function側に配信する場合、発生する対応課金額の詳細については、<a href="https://intl.cloud.tencent.com/document/product/583/17299"> 課金概要</a>をご参照ください。</li>
</ul></ul></td>
</tr>
</table>


### タスクフローの設定
サービスオーケストレーションの提供する可視化ツールにより、業務フローの必要性に応じてサービスオーケストレーションフローの構築と設定を行うことができます。
1. 必要な機能モジュールを選択してフローの設定を行います。追加したい機能のノードの後の**+**をクリックし、機能フローティングレイヤーから追加したいノード機能を選択します。
![](https://qcloudimg.tencent-cloud.cn/raw/ddf9374ff8d1acf88c100830b7401e8b.png)
2. 機能を選択して追加すると、フローチャートにこのノードが表示されるようになります。次に、このノードに対して詳細情報の設定を行う必要があります。
![](https://qcloudimg.tencent-cloud.cn/raw/8b65909d7defe9860bea78b84d97ec2d.png)
3. ノード上の**編集**ボタンをクリックし、編集ポップアップウィンドウに進みます。このポップアップウィンドウではこのノードに必要な詳細な機能および詳細な出力設定を選択できます。出力設定を入力しない場合は、サービスオーケストレーションの基本情報に入力した出力情報と同一となります。
>! 具体的な詳細設定ページは機能ごとに異なります。下の図は「オーディオビデオトランスコーディング」の設定の例です。

![](https://qcloudimg.tencent-cloud.cn/raw/f36828df241814cd2a529991325c7b8a.png)

## サービスオーケストレーションの管理
1. [**MPSコンソール**](https://console.cloud.tencent.com/mps)にログインし、 [**ワークフロー**> **サービスオーケストレーション管理**](https://console.cloud.tencent.com/mps/workflows/pipeline)をクリックして**サービスオーケストレーション管理**ページに進むと、サービスオーケストレーションの**有効化**、**無効化**、**編集**、**削除**、**詳細確認**などの操作を行うことができます。
2. サービスオーケストレーションリストにはサービスオーケストレーション名、トリガーBucket、リージョン、ディレクトリ、作成時間、有効状態などの情報が表示されます。作成時間によるソート、タスクフロー名検索、および指定されたサービスオーケストレーションに対する詳細確認、編集、削除操作をサポートします。
   -  **サービスオーケストレーションの有効化**
      - サービスオーケストレーションはデフォルトでは無効状態です。これに対応するステータスボタンをクリックすると、サービスオーケストレーションを有効化できます。
      - サービスオーケストレーションを有効化することで、トリガーBucket内にアップロードしたビデオファイルを自動実行できます。
   -  **サービスオーケストレーションの無効化**
      - このサービスオーケストレーションに対応するステータスボタンをクリックすると、無効化の操作を行うことができます。
      - サービスオーケストレーションを無効化すると、トリガーBucketにビデオファイルをアップロードしてもメディア処理タスクが実行されなくなります。
   -  **サービスオーケストレーションの編集**
      -対象のサービスオーケストレーション操作バーの**編集**をクリックし、「サービスオーケストレーションの編集」ページに進みます。このページではサービスオーケストレーション名、トリガーBucket、トリガーディレクトリ、出力Bucket、出力ディレクトリ、イベント通知、および設定項目などの変更を行うことができます。
      - サービスオーケストレーションが有効状態の時は、それに対する編集と削除操作を行うことができません。
   -  **サービスオーケストレーションの削除**
      - 対象のサービスオーケストレーション操作バーの**削除**をクリックすると、このサービスオーケストレーションを削除できます。
      - サービスオーケストレーションを削除すると、トリガーBucketにビデオファイルをアップロードしてもメディア処理タスクが実行されなくなります。
      - サービスオーケストレーションが有効状態の時は、それに対する編集と削除操作を行うことができません。