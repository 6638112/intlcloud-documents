## 操作シナリオ
このドキュメントは、Media Processing Service（MPS)を素早く理解し、アクセスできるようにするためのものです。MPSを使用するための主な手順は下図のとおりです。
![](https://main.qcloudimg.com/raw/aed6a4e4f8b3bb99187e0d899ac05338.png)

## 操作手順
### 手順1：登録とログイン
1. [Tencent Cloudアカウントの登録](https://intl.cloud.tencent.com/document/product/378/17985) を行い、実名認証を完了させます。
2. Tencent Cloudの公式ウェブサイトにログインし、【クラウド製品】>【Video Service】>[【ビデオ処理】](https://console.cloud.tencent.com/mps)を選択して、MPSコンソールに進みます。

### 手順2：権限承認管理
MPSは、COSバケットにアップロードしたファイルに対して、ダウンロード、トランスコード、アップロードなどの読み書き操作を行う必要があるため、サービスのロールを作成し、MPSにCOSの関連する操作権限を与える必要があります。

[MPSコンソール](https://console.cloud.tencent.com/mps)に進み、権限承認を行っていない場合は、【Cloud Access Managementに進む】をクリックして、コンソール共通の権限管理ページに移動し、権限承認操作を行う必要があります。
![]![](https://main.qcloudimg.com/raw/a3204a6470d3a9740a081849fc7324f3.png)

>!権限承認が完了していない場合、MPSコンソールで他の操作を行うことはできません。



### 手順3：Bucketの作成
MPSはCOS上にアップロードしたビデオファイルに対してトランスコードやスクリーンキャプチャなどの処理を行うサービスであるため、COSコンソールでバケット（Bucket）を作成する必要があります。

[COSコンソール](https://console.cloud.tencent.com/cos5)のバケット管理ページに進み、【バケットの作成】をクリックして、Bucketを作成します。その後、そのBucketの中にフォルダとアップロードファイルを作成します。詳細については、[バケットの作成](https://intl.cloud.tencent.com/document/product/436/13309)をご参照ください。

 

### 手順4：ワークフローの作成
ワークフローでは作成したテンプレートによって、Bucketに新しくアップロードしたビデオファイルの自動処理ができるようにしています。ワークフローの中でトランスコードタスク、スクリーンキャプチャタスク、アニメーション画像生成タスクなどを設定できます。
1. [MPSコンソール](https://console.cloud.tencent.com/mps)にログインし、【ワークフロー管理】をクリックして、「ワークフロー管理」ページに進みます。
2. 【ワークフローの作成】をクリックして、ワークフロー作成ページに進み、ここでワークフロー名、トリガーBucket、トリガーディレクトリ、出力Bucket、出力ディレクトリ、設定項目およびイベント通知を設定する必要があります。具体的な設定方法については、[ワークフロー設定の説明](#workflow)をご参照ください。
![](https://main.qcloudimg.com/raw/a2b3e7b0e7e41b68221ea1d2b874b06e.png)
ワークフロー作成ページでは、以下の情報を設定する必要があります。
<table>
<tr><th>設定項目<a id="workflow"></a></th><th>入力必須かどうか</th><th>設定説明</th></tr>
<tr>
<td>ワークフロー</td>
<td>はい</td>
<td>128文字以内の中国語、英語、数字、アンダーバーとハイフン<code>（_-）</code>を組み合わせて入力できます（例：「MPS」）。</td>
</tr><tr>
<td>トリガーBucket</td>
<td>はい</td>
<td>当該APPIDで作成したBucketの中から1つを選択し、トリガーBucketとすることができます。ワークフローを有効化した後、このBucketにビデオファイルをアップロードすると、ワークフローの実行が自動的にトリガーされます。</td>
</tr><tr>
<td>トリガーディレクトリ</td>
<td>いいえ</td>
<td>スラッシュ<code>（/）</code>を末尾につけます。入力しない場合は、トリガーBucketのすべてのディレクトリが有効になります。</td>
</tr><tr>
<td>出力Bucket</td>
<td>はい</td>
<td>デフォルトはトリガーBucketと同じですが、当該APPIDのトリガーBucketと同じリージョンのBucketから1つを選択し、出力Bucketとすることができます。ワークフローの処理が完了した後、新しく生成されたビデオファイルはこのBucketに保存されます。</td>
</tr><tr>
<td>出力ディレクトリ</td>
<td>いいえ</td>
<td>スラッシュ<code>（/）</code>を末尾につけます。入力しない場合、出力ディレクトリはトリガーディレクトリとの一致を維持します。</td>
</tr><tr>
<td>イベント通知の有効化</td>
<td>いいえ</td>
<td><ul style="margin:0"><li>デフォルトでは無効になっています。イベント通知を有効にした場合の具体的な設定方式については、<a href="#recall">コールバック方式によるタイプ設定</a>をご参照ください。</li><li>CMQイベント通知を有効化したい場合は、<a href="https://console.cloud.tencent.com/cmq">メッセージキュー（CMQ）</a>に移動してサービスをアクティブ化し、モデルを作成してください。イベント通知を有効化すると、指定したCMQがMPSのイベント通知を受信するようになります。</li></ul></td>
</tr><tr>
<td>設定項目</td>
<td>はい</td>
<td>トランスコードタスク、スクリーンキャプチャタスク、アニメーション画像生成タスク、審査タスク、コンテンツ認識タスク、コンテンツ分析タスクの中から、少なくとも1項目を選択して設定を行います。詳細については、<a href="https://intl.cloud.tencent.com/document/product/1041/33485#p1">タスク設定の説明</a>をご参照ください。</td>
</tr></table>
<table>
<tr><th>コールバック方式のタイプ<a id="recall"></a></th><th>設定説明</th></tr>
<tr>
<td>CMQコールバック</td>
<td><ul style="margin:0"><li>CMQモデル：デフォルトではキューモデルが選択されています。</li><li>CMQエリア：広州、上海、背景、上海金融、深圳金融、中国香港、成都、北米エリアまたはアメリカ西部を選択可能です。</li><li>キュー名：カスタマイズ。</li></ul></td>
</tr><tr>
<td>SCFコールバック</td>
<td>【SCF操作に進む】をクリックすると設定の操作が行えます。具体的な設定方法については、<a href="https://intl.cloud.tencent.com/document/product/1041/40337">ビデオタスクコールバック通知</a>をご参照ください。<br>SCFコールバック設定はすべてのワークフローが対象となり、現在ワークフローでは設定状態を保存しません。</td>
</tr></table>


### 手順5：ワークフローの有効化
1. ワークフローの作成が完了すると、「ワークフローの作成に成功しました」の表示が現れます。【ワークフローの管理】をクリックし、[ワークフロー管理](https://intl.cloud.tencent.com/document/product/1041/33485)に移動します。
![](https://main.qcloudimg.com/raw/81ae87468f4c99773278fd6487e39bd4.png)
2. ワークフローはデフォルトで無効になっています。ワークフローがある行のステータスボタンをクリックすると、ワークフローを有効化できます。ワークフローを有効化した後のみ、トリガーBucket内にビデオをアップロードするとワークフローの自動実行がトリガーされます。

 

### 手順6：ビデオのアップロード
1. ワークフローを有効化した後、[COSコンソール](https://console.cloud.tencent.com/cos5)に進み、左側ナビゲーションバーの【バケットリスト】をクリックして、「バケットリスト」ページに進みます。
2. ワークフローの中から設定したトリガーBucketを探し出し、対応するバケット名をクリックすると、デフォルトの状態では「ファイルリスト」ページに進みます。処理が必要なビデオファイルをアップロードすると、MPSが自動でワークフローの中の設定に基づいて新しくアップロードしたビデオを処理します。
>?ワークフローの自動実行は、ワークフローを有効化した後、トリガーBucketに新しくアップロードされたビデオファイルに対してのみ有効となり、それ以前にトリガーBucketに保存されたファイルが処理されることはありません。 


### 手順7：処理が完了したビデオの確認
1. ビデオ処理の完了後、[COSコンソール](https://console.cloud.tencent.com/cos5)に進み、左側ナビゲーションバーの【バケットリスト】をクリックして、「バケットリスト」ページに進みます。
2. ワークフローの設定項目の中から設定した出力Bucketを探し出し、対応するバケット名をクリックすると、デフォルトの状態では「ファイルリスト」ページに入ります。このページで、タスク設定に基づいて処理が完了したビデオファイルを確認することができます。





