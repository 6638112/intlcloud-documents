## 1、ミクスストリーミングトランスコードに関する質問
[](id:m1)
###  TRTCでは、どうすれば自分が使用しているのが新式のMCUミクスストリーミングか旧式のクラウドミクスストリーミングかがわかりますか。
下記の条件を満たし、クライアントログのプリントがmcumix = 1であれば、使用しているのは新式のMCUミクスストリーミングです。
- 2020年1月9日以降に新規作成したアプリケーション。
- TRTC SDKのバージョンが6.9以降。

[](id:m2)
###  TRTCがミクスストリーミングインターフェースの呼び出しに失敗し、有効化されない場合、どのように調査すればいいですか。
1.  [TRTCコンソール](https://console.cloud.tencent.com/trtc)で**Auto-Relayed Push**がオンになっていることを確認します。
2. onSetMixTranscodingConfig()インターフェースをモニタリングし、返ってきたエラー情報にもとづき修正します。
3. SDKインターフェースでバイパスストリームIDをカスタマイズしている場合、旧式のクラウドミクスストリーミングの方式ではミクスストリーミングは失敗します。
4. onSetMixTranscodingConfig()の応答があったが、CDNのプルが依然として有効化されない場合は、再生ドメイン名が設定されてないことにより起きた可能性があります。再生ドメイン名に関する設定をチェックすることをお勧めします。

## 2、クラウドレコーディングに関する質問

[](id:r1)
### シングルストリーミングのレコーディングを行うにはどうすればよいですか。
- コンソールで**Global Auto-Recording**に設定すると、プッシュ時にルーム内の全てのシングルストリーミングが自動的にレコーディングされます。具体的には[Global Auto-Recording](https://intl.cloud.tencent.com/document/product/647/35426)をご参照ください。
- コンソールで**指定ユーザーレコーディング**に設定すると、レコーディングが必要なストリームについては、入室時にTRTCParamsのuserDefineRecordIdパラメータを設定するだけで済みます。具体的には[指定ユーザーレコーディング（SDK API）](https://intl.cloud.tencent.com/document/product/647/35426)をご参照ください。
- Global Auto-Recordingを希望せず、またプラットフォームもSDK APIをサポートしていない場合は、[CSS](https://intl.cloud.tencent.com/products/css)の[CSSレコーディング](https://intl.cloud.tencent.com/document/product/267/31563)によって単独でレコーディングすることができます。

[](id:r2)
### ミクスストリーミングのレコーディングを行うにはどうすればよいですか。
- 設定が**Global Auto-Recording**の場合、ミクスストリーミングも自動的にレコーディングされます。
- 設定が**指定ユーザーレコーディング**の場合で、なおかつサーバーのREST APIを使用してミクスストリーミングをトリガーする場合は、ミクスストリーミングインターフェースでパラメータOutputParams.RecordIdを指定すると、ミクスストリーミングレコーディングを開始できます。具体的には、[ミクスストリーミングパラメータ-OutputParams](https://intl.cloud.tencent.com/document/product/647/36760)をご参照ください。
- 設定が**指定ユーザーレコーディング**の場合で、なおかつクライアントのSDK APIを使用してミクスストリーミングをトリガーする場合は、キャスターが入室時にTRTCParamsのuserDefineRecordIdを設定すると、ミクスストリーミングがレコーディングされます。具体的には[指定ユーザーレコーディング（SDK API）](https://intl.cloud.tencent.com/document/product/647/35426)をご参照ください。

[](id:r3)
### レコーディングはいつ開始されますか。
- シングルストリーミング：プッシュから数秒（ネットワーク遅延およびキーフレーム待機）後にレコーディングを開始します。
- ミクスストリーミング：ミクスストリーミング開始から数秒（ネットワーク遅延およびキーフレーム待機）後にレコーディングを開始します。

[](id:r4)
### レコーディングはいつ終了しますか。
- シングルストリーミングのレコーディングは、ストリームが切断されると終了します。連続レコーディング時間を設定している場合は、ストリーム切断と連続レコーディングタイムアウト後に終了します。
- クライアントのSDK setMixTranscodingConfig()を呼び出してトリガーしたミクスストリーミングの場合、 キャスターのストリーム退出時、または再度setMixTranscodingConfig()を呼び出し、かつパラメータ設定がnullのときに終了します。
- サーバーのREST API StartMCUMixTranscodeを呼び出してトリガーしたミクスストリーミングの場合、全ユーザーが退室すると自動的に停止します。もしくは、途中でStopMCUMixTranscodeを呼び出して手動で停止します。

[](id:r5)
### レコーディングファイルとコールバックはいつ生成されますか。
- レコーディングファイルはレコーディング完了から5分後に、[VOD](https:/intl.cloud.tencent.com/product/vod)プラットフォームに転送されて保存され、コールバックがトリガーされます。
- 連続レコーディング時間を設定している場合は、上記の待機時間にさらに連続レコーディングタイムアウト時間が追加されます。連続レコーディング時間を設定している場合は、途中でストリーム切断があってもレコーディングは終了せず、レコーディングファイルとコールバックも生成されません。
- MP4、FLVおよびAACのタイプでは1ファイルあたりの最長時間（コンソールで設定可能）の制限があり、最長時間を超えるとレコーディングファイルとコールバックが生成され、続いて新しいレコーディングファイルが生成されます。

[](id:r6)
### レコーディングファイルを取得するにはどうすればよいですか。
- VODコンソールで手動検索およびVOD REST APIで検索することができます。具体的には[レコーディングファイルの検索](https://intl.cloud.tencent.com/document/product/647/35426)をご参照ください。
- コールバック方式でレコーディングファイルのダウンロードアドレスをすぐに取得することができます。具体的には[レコーディングファイルの受け取り](https://intl.cloud.tencent.com/document/product/647/35426)をご参照ください。

[](id:r6)
### レコーディングファイルが生成されない場合はどのように調査すればよいですか。
- 通話が正常に成立しなかった場合、またはアップストリームのプッシュ時間が短すぎた場合は（プッシュは30秒以上を推奨）、レコーディングファイルが生成されないことがあります。アップストリームデータが正常かどうかはダッシュボードで確認できます。
- 設定が**指定ユーザーレコーディング**の場合で、入室時にTRTCParamsのuserDefineRecordIdが設定されていない場合、シングルストリーミングはレコーディングされません。
- 設定が**指定ユーザーレコーディング**の場合で、なおかつサーバーのREST APIを使用してミクスストリーミングをトリガーする場合、ミクスストリーミングインターフェースでパラメータOutputParams.RecordIdを指定していなければ、ミクスストリーミングはレコーディングされません。
- 設定が**指定ユーザーレコーディング**の場合で、なおかつクライアントのSDK APIを使用してミクスストリーミングをトリガーする場合、キャスターがuserDefineRecordIdを設定していなければ、ミクスストリーミングはレコーディングされません。

[](id:r7)
### レコーディングコールバックが受け取れない場合はどのように調査すればよいですか。
- まず初めに、レコーディングファイルが生成されているかどうかをコンソールで確認します。生成されていなければ、前述の方法で最初のトラブルシューティングを実施することができます。ファイルの検索については[レコーディングファイルの検索](https://intl.cloud.tencent.com/document/product/647/35426)をご参照ください。
- レコーディングファイルは生成されているのにコールバックが受け取れない場合は、まずコールバックが正しく設定されているかどうかを確認します。コールバックの設定については[レコーディングファイルの受け取り](https://intl.cloud.tencent.com/document/product/647/35426)をご参照ください。
- コールバックが正しく設定されている場合は、サーバーがコールバックを正常に処理しているかどうかを再度確認することができます。例えばCURLシミュレーションテストを行って、コールバックリクエストが正常に処理されているかどうかを確認します。

[](id:r8)
### 生成されるレコーディングファイルはなぜこんなに多いのですか。
- 設定が**Global Auto-Recording**の場合、ルーム内のすべてのストリームが自動的にレコーディングされます。
- 連続レコーディング時間を設定していない場合は、ストリームが切断され、再度プッシュされるたびに新しいレコーディングファイルが生成されます。
- MP4、FLV、AACのタイプでは1ファイルあたりの最長時間の制限があり、最長時間を超えるとレコーディングファイルとコールバックが生成され、続いて新しいレコーディングファイルが生成されます。
- ルーム内でミクスストリーミングが複数回トリガーされた場合は、複数のミクスストリーミングレコーディングファイルが生成されることがあります。

