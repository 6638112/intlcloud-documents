## 기능 소개
- 비디오 URL에 만료 시간을 지정하여 악의적인 사용자가 URL을 장기 사용을 위해 다른 웹사이트로 전송하는 것을 방지할 수 있습니다.
- 비디오 URL에 재생이 허용되는 최대 IP 수를 지정하여 악의적인 사용자가 동영상을 무제한으로 배포하는 것을 방지할 수 있습니다.
- 비디오 URL에 미리보기 시간을 지정하여 미리보기를 구현할 수 있습니다.
- 비디오 URL에 리전 얼로우리스트/블록리스트를 추가할 수 있습니다.
- 비디오 URL에 Referer 얼로우리스트/블록리스트를 추가할 수 있습니다.
- `KEY`를 사용하여 서명을 만들어 비디오 URL에 넣을 수 있습니다. 키가 공개되지 않는 한 비디오 URL은 위조될 수 없습니다.
- CDN 노드는 비디오 URL의 매개변수와 서명을 확인하여 비디오 재생 요청을 제어합니다. 요청이 검사를 통과하지 못하면 403 오류가 반환됩니다.
- 지원되는 파일 형식은 다음과 같습니다: MP4, TS, M3U8, FLV, AAC, MOV, WMV, AVI, MP3, RMVB, MKV, MPG, 3GP, WEBM, M4V, ASF, F4V, WAV, MPEG, VOB, RM, WMA, DAT, M4A, MPD, M4S.

>?Key 링크 도용 방지 활성화에 대한 자세한 내용은 [링크 도용 방지 설정](https://intl.cloud.tencent.com/document/product/266/14060)을 참고하십시오.

## 링크 도용 방지 URL을 생성하는 방법
- VOD의 모든 비디오에는 **원본 비디오 URL**이 있습니다. 링크 도용 방지가 활성화되지 않은 경우 원본 비디오 URL을 사용하여 비디오를 재생할 수 있습니다.
- Key 링크 도용 방지가 활성화된 후에는 원본 비디오 URL을 더 이상 비디오 재생에 사용할 수 없으며 비디오의 **링크 도용 방지 URL**을 생성해야 합니다.

비디오의 링크 도용 방지 URL은 다음과 같은 QueryString 형식의 원본 URL 끝에 링크 도용 방지 매개변수를 추가하여 생성할 수 있습니다.
```
http://example.vod2.myqcloud.com/dir1/dir2/myVideo.mp4?t=[t]&exper=[exper]&rlimit=[rlimit]&us=[us]&whreg=[whreg]&whref=[whref]&sign=[sign]
```
다음은 링크 도용 방지 URL의 매개변수에 대한 설명과 값입니다.

#### 링크 도용 방지 매개변수
| 매개변수 이름 | 필수 | 설명                                                         |
| ------ | ---- | ------------------------------------------------------------ |
| `KEY`    | Yes   | Key 링크 도용 방지 활성화 시 입력하는 키입니다. 8 – 20자의 알파벳(a – Z) 또는 숫자(0 – 9)를 포함해야 합니다. 콘솔에서 [Key 생성]을 클릭하여 키를 생성하는 것이 좋습니다. 자세한 내용은 [링크 도용 방지 설정](https://intl.cloud.tencent.com/document/product/266/14060)을 참고하십시오. |
| `Dir`    | Yes   | 파일 이름이 제거된 후 원본 비디오 URL에서 PATH의 나머지 부분입니다. 예를 들어 원본 URL이 `http://example.vod2.myqcloud.com/dir1/dir2/myVideo.mp4`인 경우 재생 경로는 `/dir1/dir2/`입니다. |
| `t`      | Yes   | <li>16진수 소문자 Unix 시간 형식의 재생 주소 만료 타임스탬프입니다.<br><li>만료되면 URL이 무효화되고 403 오류가 반환됩니다. 서버 간 시차가 발생할 수 있으므로 링크 도용 방지 URL의 실제 만료 시간은 일반적으로 지정된 만료 시간보다 5분 더 길며, 300초의 추가 허용 시간이 허용됩니다.<br><li>만료 타임스탬프는 전체 동영상 재생이 완료될 만큼 충분히 길어야 합니다. |
| `exper`  | No   | <li>10진수 초 단위의 미리보기 시간입니다. 이 매개변수가 비어 있거나 0이면 미리보기 모드가 비활성화됩니다(즉, 전체 비디오가 반환됨).<br><li>미리보기 시간은 원본 비디오 시간보다 짧아야 합니다. 그렇지 않으면 재생에 실패할 수 있습니다. |
| `rlimit` | No   | <li>재생에 허용된 장치 IP의 최대 십진수입니다. 이 매개변수를 비워두면 제한이 없습니다.<br><li>비디오 URL을 한 명의 사용자만 재생하도록 제한하는 경우 재연결 후 모바일 장치의 IP가 변경될 수 있으므로 rlimit를 1로 설정하지 않는 것이 좋습니다(예: 3으로 설정). |
| `us`     | No   | <li>링크 아이디. 링크의 고유성을 향상시키기 위해 링크 도용 방지 URL을 랜덤화하는 데 사용됩니다.<br><li>매번 링크 도용 방지 URL을 생성할 때 임의의 us 값을 지정하는 것이 좋습니다.|
| `whreg`  | No   | <li>동영상 재생이 허용된 리전 목록입니다. 1 - 10개 [ISO 3166-1세 글자 리전 코드](https://www.iso.org/obp/ui/#search/code/)를 지정할 수 있습니다. 코드를 쉼표로 구분합니다. |
| `bkreg`  | No   | <li>동영상 재생이 금지된 리전 목록입니다. 1-10개 [ISO 3166-1세 글자 리전 코드](https://www.iso.org/obp/ui/#search/code/)를 지정할 수 있습니다. 코드를 쉼표로 구분합니다. |
| `whref`  | No   | <li>동영상 재생이 허용된 도메인 목록입니다. 1 - 10개의 도메인을 지정할 수 있습니다. `http://` 및 `https://` 접두사를 생략하고 도메인을 쉼표로 구분합니다. `abc.com`을 입력하면 `abc.com/123` 및 `abc.com.cn`과 같은 서브 도메인을 포함합니다. 와일드카드가 지원됩니다. 예를 들어 `*.abc.com`을 입력할 수 있습니다. |
| `bkref`  | No   | <li>동영상 재생이 금지된 도메인 목록입니다. 1 - 10개의 도메인을 지정할 수 있습니다. `http://` 및 `https://` 접두사를 생략하고 도메인을 쉼표로 구분합니다. `abc.com`을 입력하면 `abc.com/123` 및 `abc.com.cn`과 같은 하위 도메인을 포함합니다. 와일드카드가 지원됩니다. 예를 들어 `*.abc.com`을 입력할 수 있습니다. |
| `sign`   | Yes   | <li>링크 도용 방지 서명. 32자 길이의 16진수로 링크 도용 방지 URL의 유효성을 확인하는 데 사용됩니다.<br><li>URL이 서명 검사를 통과하지 못하면 403 오류가 반환됩니다. 다음은 [서명 계산 공식](#formula)입니다. |

#### [](id:formula)서명 계산 공식
```
sign = md5(KEY + Dir + t + exper + rlimit + us + whref + bkref + whreg + bkreg)
```

수식에서 `+`는 문자열 스플라이싱을 나타냅니다. 옵션 매개변수는 빈 문자열일 수 있습니다.

## 링크 도용 방지 URL 생성 예시
VOD에 비디오가 있고, 원본 재생 URL이 `http://example.vod2.myqcloud.com/dir1/dir2/myVideo.mp4`이며, Key 링크 도용 방지를 활성화했고, 생성된 키는 `24FEQmTzro4V5u3D5epW`이며, 생성된 랜덤 문자열은 `72d4cd1101`일 때, 다음을 수행하려고 합니다.
1. 이 비디오에 대한 링크 도용 방지 URL을 생성하고 URL의 만료 시간을 2018년 1월 31일 20:00(Unix 시간의 경우 1517400000)으로 설정합니다.
2. 미리보기 URL을 생성하고 미리보기 시간을 비디오의 처음 5분으로 설정합니다(원본 비디오 길이 5분 초과).
3. 서로 다른 IP를 가진 최대 3개의 장치가 URL에서 비디오를 재생할 수 있도록 허용합니다.

다음은 ‘비디오 재생 주소의 유효 기간 제어’, ‘비디오 재생 주소에서 재생이 허용된 최대 IP 수’ 및 ‘비디오 재생 허용 시간 제어’ 시나리오에 대한 링크 도용 방지 URL을 생성하는 방법을 설명합니다.

### 예시1: 비디오 재생 주소의 유효 기간 제어
#### 1단계: 링크 도용 방지 매개변수 결정

| 매개변수 이름 | 값                  | 설명                                               |
| ------ | ---------------------- | -------------------------------------------------- |
| `KEY`    | `24FEQmTzro4V5u3D5epW` | Key 링크 도용 방지를 활성화할 때 선택한 키입니다.                  |
| `Dir`    | `/dir1/dir2/`          | 원본 재생 URL의 PATH에서 `myVideo.mp4`를 뺀 나머지 부분입니다. |
| `t`      | `5a71afc0`             | 만료된 타임스탬프 1517400000을 16진법으로 나타낸 결과입니다. |
| `us`     | `72d4cd1101`           | 생성된 랜덤 문자열입니다.                                   |


#### 2단계: 서명 계산

```
sign = md5("24FEQmTzro4V5u3D5epW/dir1/dir2/5a71afc072d4cd1101") = "3d8488faeb37d52d6bf63b63c1b171c3"
```

#### 3단계: 링크 도용 방지 URL 생성
링크 도용 방지 매개변수를 원본 비디오 URL의 QueryString에 연결하여 비디오의 링크 도용 방지 URL을 생성합니다.
```
http://example.vod2.myqcloud.com/dir1/dir2/myVideo.mp4?t=5a71afc0&us=72d4cd1101&sign=3d8488faeb37d52d6bf63b63c1b171c3
```

### 예시2: 재생 주소에서 재생 가능한 최대 IP 수
#### 1단계: 링크 도용 방지 매개변수 결정

| 매개변수 이름 | 값                  | 설명                                               |
| ------ | ---------------------- | -------------------------------------------------- |
| `KEY`    | `24FEQmTzro4V5u3D5epW` | Key 링크 도용 방지를 활성화할 때 선택한 키입니다.                  |
| `Dir`    | `/dir1/dir2/`          | 원본 재생 URL의 PATH에서 `myVideo.mp4`를 뺀 나머지 부분입니다. |
| `t`      | `5a71afc0`             | 만료된 타임스탬프 1517400000을 16진법으로 나타낸 결과입니다. |
| `rlimit` | `3`                    | URL에서 비디오를 재생하기 위해 최대 3개의 각기 다른 IP를 허용합니다.                  |
| `us`     | `72d4cd1101`           | 생성된 랜덤 문자열입니다.                                   |

#### 2단계: 서명 계산
```
sign = md5("24FEQmTzro4V5u3D5epW/dir1/dir2/5a71afc0372d4cd1101") = "c5214f0d5961b13acd558b4957c4dfc5"
```

#### 3단계: 링크 도용 방지 URL 생성
링크 도용 방지 매개변수를 원본 비디오 URL의 QueryString에 연결하여 비디오의 링크 도용 방지 URL을 생성합니다.
```
http://example.vod2.myqcloud.com/dir1/dir2/myVideo.mp4?t=5a71afc0&rlimit=3&us=72d4cd1101&sign=c5214f0d5961b13acd558b4957c4dfc5
```

### 예시3: 비디오 재생 허용 시간 제어
#### 1단계: 링크 도용 방지 매개변수 결정

| 매개변수 이름 | 값                  | 설명                                               |
| ------ | ---------------------- | -------------------------------------------------- |
| `KEY`    | `24FEQmTzro4V5u3D5epW` | Key 링크 도용 방지를 활성화할 때 선택한 키입니다.                  |
| `Dir`    | `/dir1/dir2/`          | 원본 재생 URL의 PATH에서 `myVideo.mp4`를 뺀 나머지 부분입니다. |
| `t`      | `5a71afc0`             | 만료된 타임스탬프 1517400000을 16진법으로 나타낸 결과입니다. |
| `exper`  | `300`                  | 처음 5분(즉, 300초)을 미리보기합니다.                                 |
| `us`     | `72d4cd1101`           | 생성된 랜덤 문자열입니다.                                   |

#### 2단계: 서명 계산

```
sign = md5("24FEQmTzro4V5u3D5epW/dir1/dir2/5a71afc030072d4cd1101") = "547d98c4b91e81b5ea55c95cef63223f"
```

#### 3단계: 링크 도용 방지 URL 생성
링크 도용 방지 매개변수를 원본 비디오 URL의 QueryString에 연결하여 비디오의 링크 도용 방지 URL을 생성합니다.
```
http://example.vod2.myqcloud.com/dir1/dir2/myVideo.mp4?t=5a71afc0&exper=300&us=72d4cd1101&sign=547d98c4b91e81b5ea55c95cef63223f
```

## Key 링크 도용 방지 URL 생성기 및 검사기
VOD는 링크 도용 방지 URL을 빠르고 정확하게 생성하고 확인할 수 있도록 Key 링크 도용 방지 URL 생성기 및 검사기를 제공합니다.

- [Key 링크 도용 방지 URL 생성 툴](https://vods.cloud.tencent.com/referer/gen_video_url.html)
- [Key 링크 도용 방지 URL 검사 툴](https://vods.cloud.tencent.com/referer/check_sign.html)

## 주의 사항
- 이 기능은 선택 사항이며 기본적으로 비활성화되어 있습니다.
- 주요 링크 도용 방지가 활성화된 후에는 원본 비디오 URL을 더 이상 비디오 재생에 사용할 수 없으며 규칙에 따라 유효한 링크 도용 방지 URL을 생성해야 합니다.
- `KEY`는 8 – 20자(a – Z) 또는 숫자(0 – 9)를 포함해야 합니다.
- 링크 도용 방지 URL이 만료되거나 서명이 검사를 통과하지 못하면 비디오를 재생할 수 없으며 403 오류가 반환됩니다.
- 링크 도용 방지 URL의 QueryString에 있는 매개변수는 `t`, `exper`, `rlimit`, `us` 및 `sign`의 순서여야 합니다. 그렇지 않으면 비디오를 재생할 수 없습니다.
- 미리보기 기능을 사용하려면 미리보기 시간이 비디오 시간보다 짧아야 합니다. 그렇지 않으면 비디오를 재생할 수 없습니다.
- 미리보기 모드에 사용할 수 있는 비디오 형식에는 엄격한 제한이 있습니다(H.264만 지원되며 비디오 메타데이터는 비디오 파일의 헤더에 있어야 함). 형식 요구 사항을 충족하지 않는 원본 비디오를 미리보기 모드에서 재생하는 경우 예외가 발생합니다. 미리보기 모드를 설정하기 전에 VOD 트랜스코딩 기능을 사용하여 이러한 비디오를 트랜스코딩하는 것이 좋습니다(모든 출력 형식이 미리보기 형식 요구 사항을 충족함).