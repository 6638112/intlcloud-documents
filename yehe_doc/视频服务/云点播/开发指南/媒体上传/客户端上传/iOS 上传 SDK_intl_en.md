VOD provides an SDK for uploading videos on iOS client. For more information on the upload process, please see [Guide - Upload from Client](https://intl.cloud.tencent.com/document/product/266/33921).

## Downloading Source Code
1. Click [here](https://liteav.sdk.qcloud.com/download/ugc/LiteAVSDK_UGC_Upload_iOS.zip) to download the iOS Upload Demo and source code.
2. You can see the `TXUGCUploadDemo` directory after decompressing the downloaded zip package. The upload source code is in the `TXUGCUploadDemo/upload` directory.

## Integrating Upload Library and Source Code

1. Copy the upload source code directory `TXUGCUploadDemo/upload` to your project directory.
2. Import the dynamic libraries `QCloudCore.framework` and `QCloudCOSXML.framework`  (in the `TXUGCUploadDemo/upload/COSSDK/` directory) into your project and add the following dependency libraries:
    ```
    1. CoreTelephony.framework
    2. Foundation.framework
    3. SystemConfiguration.framework
    4. libc++.tbd
    ``` 
3. Set "Other Linker Flags" in "Build Settings" and add the `-ObjC` parameter.

## Uploading Videos

#### Initializing upload object

```objc
TXUGCPublish *_videoPublish = [[TXUGCPublish alloc] initWithUserID:@"upload_video_userid"];
```

#### Setting upload object callback

```objc
_videoPublish.delegate = self;
```

```objc
#pragma mark - TXVideoPublishListener

- (void)onPublishProgress:(NSInteger)uploadBytes totalBytes:(NSInteger)totalBytes {
    self.progressView.progress = (float)uploadBytes/totalBytes;
    NSLog(@"onPublishProgress [%ld/%ld]", uploadBytes, totalBytes);
}

- (void)onPublishComplete:(TXPublishResult*)result {
    NSString *string = [NSString stringWithFormat:@"Upload completed; error code: [%d], error message: [%@]", result.retCode, result.retCode == 0? result.videoURL: result.descMsg];
    [self showErrorMessage:string];
    NSLog(@"onPublishComplete [%d/%@]", result.retCode, result.retCode == 0? result.videoURL: result.descMsg);
}
```

#### Constructing upload parameters

```objc
TXPublishParam *publishParam = [[TXPublishParam alloc] init];

publishParam.signature  = @"Signature generated by your business backend";
publishParam.videoPath  = @"Path to the video file";
```
For details on how to calculate `signature`, please see [Signature for Upload from Client](https://intl.cloud.tencent.com/document/product/266/33922).

#### Calling upload method

```objc
[_videoPublish publishVideo:publishParam];
```
>?
>- The upload method automatically selects simple upload or multipart upload based on the file size, eliminating your need to take care of every step in multipart upload.
>- To upload to the specified subapplication, please see [Subapplication System - Upload from client](https://intl.cloud.tencent.com/document/product/266/33987).

## Advanced Features
#### Uploading a cover image

Include the cover image in the upload parameter.

```objc
TXPublishParam *publishParam = [[TXPublishParam alloc] init];
publishParam.signature  = @"Signature generated by your business backend";
publishParam.coverPath = @"Path to the cover image file";
publishParam.videoPath  = @"Path to the video file";
```

#### Canceling and resuming upload

To cancel an upload, call the `cancelPublish` API.

```objc
[_videoPublish cancelPublish];
```

To resume an upload, call `publishVideo` of `TXUGCPublish` again using the same upload parameters and same video and cover image paths.

#### Checkpoint restart

VOD supports checkpoint restart during upload. When the upload terminated unexpectedly, you can resume the upload from the breakpoint, saving time of uploading.

Checkpoint restart is valid within one day. If the upload of a video is interrupted and then resumed within one day, the upload can be resumed; otherwise, the entire video will be uploaded again.

The upload parameter `enableResume` is the switch for checkpoint restart, enabled by default.


## Image and Media Upload

```objc
// Create object
TXUGCPublish *_imagePublish = [[TXUGCPublish alloc] initWithUserID:@"upload_image_userid"];

// Set callback
_imagePublish.mediaDelegate = self;

// Construct upload parameter
TXMediaPublishParam *publishParam = [[TXMediaPublishParam alloc] init];
publishParam.signature  = @"Signature generated by your business backend";
publishParam.mediaPath = @"Path to the image file";

// Upload image or media file
[_imagePublish publishMedia:publishParam];

```


## Video Upload API Description

Initialize upload object: `TXUGCPublish::initWithUserID`

| Parameter | Description | Type | Required |
| ------ | ------------------ | --------- | ---- |
| userID | User ID used to uniquely identify a user. | NSString | No |

Start upload: `TXUGCPublish.publishVideo`

| Parameter | Description | Type | Required |
| ----- | ---- | --------------- | ---- |
| param | Publishing parameter. | TXPublishParam | Yes |

Upload parameter: `TXPublishParam`

| Parameter | Description | Type | Required |
| ------------ | ---------------------------------- | --------- | ---- |
| signature | [Signature for upload from client](https://intl.cloud.tencent.com/document/product/266/33922). | NSString* | Yes |
| videoPath | Path to a local video file. | NSString* | Yes |
| coverPath    | Path to a local cover image, which is optional.                 | NSString*  | No    |
| fileName | Name of a video file uploaded to Tencent Cloud. If this parameter is left empty, the local filename will be used by default. | NSString* | No |
| enableResume | Whether to enable checkpoint restart, which is enabled by default. | BOOL | No |
| enableHttps | Whether to enable HTTPS, which is disabled by default. | BOOL | No |


Set upload callback: `TXUGCPublish.delegate`

| Member Variable Name | Description | Type | Required |
| -------- | ----------- | ---------------------- | ---- |
| delegate | Listener on the upload progress and result callback. | TXVideoPublishListener | Yes    |


Upload progress callback: `onPublishProgress`

| Variable Name | Description | Type |
| ----------- | -------- | --------- |
| uploadBytes | Number of uploaded bytes. | NSInteger |
| totalBytes | Total number of bytes. | NSInteger |

Upload result callback: `onPublishComplete`

| Variable Name | Description | Type |
| ------ | ---- | ---------------- |
| result | Upload result. | TXPublishResult |

Upload event callback: `onPublishEvent`

| Variable Name | Description | Type |
| ------ | ---- | ---------------- |
| evt | Event for printing debugging information. | NSDictionary |

Upload result: `TXPublishResult`

| Member Variable Name | Description | Type |
| -------- | --------- | --------- |
| retCode | Error code. | int |
| descMsg | Error description of a failed upload. | NSString |
| videoId | VOD file ID. | NSString |
| videoURL | Video storage address. | NSString |
| coverURL | Cover storage address. | NSString |

Pre-upload: `TXUGCPublishOptCenter.prepareUpload`
    
| Parameter | Description                                     | Type    | Required |
| --------- | -------------------------------------------- | ------ | ---- |
| signature | [Signature for upload from client](https://intl.cloud.tencent.com/document/product/266/33922). | NSString | Yes |


#### Error codes

The SDK listens on the video upload status through the `TXVideoPublishListener` API; therefore, you can check the video publishing status with the `retCode` in `TXPublishResult`.

| Error Code | Constant in TVCCommon | Description |
| :--: | :---------------------------- | :-------------- |
| 0 | TVC_OK | Uploaded successfully. |
| 1001 | TVC_ERR_UGC_REQUEST_FAILED | The upload request failed. This is usually because that the signature of the client has expired or is invalid. You need to apply for a signature for the app again. |
| 1002 | TVC_ERR_UGC_PARSE_FAILED | Failed to parse the request information. |
| 1003 | TVC_ERR_VIDEO_UPLOAD_FAILED | Failed to upload the video. |
| 1004 | TVC_ERR_COVER_UPLOAD_FAILED | Failed to upload the cover. |
| 1005 | TVC_ERR_UGC_FINISH_REQ_FAILED | The request to end the upload failed. |
| 1006 | TVC_ERR_UGC_FINISH_RSP_FAILED | An error occurred when responding to the upload ending request. |



## Image and Media Upload API Description

Initialize upload object: `TXUGCPublish::initWithUserID`

| Parameter | Description | Type | Required |
| ------ | ------------------ | --------- | ---- |
| userID | User ID used to uniquely identify a user. | NSString | No |

Start upload: `TXUGCPublish.publishMedia`

| Parameter | Description | Type | Required |
| ----- | ---- | --------------- | ---- |
| param | Publishing parameter. | TXMediaPublishParam | Yes |

Upload parameter: `TXMediaPublishParam`

| Parameter | Description | Type | Required |
| ------------ | ---------------------------------- | --------- | ---- |
| signature | [Signature for upload from client](https://cloud.tencent.comhttps://intl.cloud.tencent.com/document/product/266/33922). | NSString* | Yes |
| mediaPath | Path to a local image/media file. | NSString* | Yes |
| fileName | Name of an image/media file uploaded to Tencent Cloud. If this parameter is left empty, the local filename will be used by default. | NSString* | No |
| enableResume | Whether to enable checkpoint restart, which is enabled by default. | BOOL | No |
| enableHttps | Whether to enable HTTPS, which is disabled by default. | BOOL | No |


Set upload callback: `TXUGCPublish.TXMediaPublishListener`

| Member Variable Name | Description | Type | Required |
| -------- | ----------- | ---------------------- | ---- |
| mediaDelegate | Listener on the upload progress and result callback. | TXMediaPublishListener | Yes    |


Upload progress callback: `onMediaPublishProgress`

| Variable Name | Description | Type |
| ----------- | -------- | --------- |
| uploadBytes | Number of uploaded bytes. | NSInteger |
| totalBytes | Total number of bytes. | NSInteger |

Upload result callback: `onMediaPublishComplete`

| Variable Name | Description | Type |
| ------ | ---- | ---------------- |
| result | Upload result. | TXMediaPublishResult |

Upload event callback: `onMediaPublishEvent`

| Variable Name | Description | Type |
| ------ | ---- | ---------------- |
| evt | Event for printing debugging information. | NSDictionary |

Upload result: `TXMediaPublishResult`

| Member Variable Name | Description | Type |
| -------- | --------- | --------- |
| retCode | Error code. | int |
| descMsg | Error description of a failed upload. | NSString |
| mediaId  | Image/media file ID.  | NSString |
| mediaURL | Image/media storage address.    | NSString |

Pre-upload: `TXUGCPublishOptCenter.prepareUpload`
    
| Parameter   | Description                                     | Type    | Required |
| --------- | -------------------------------------------- | ------ | ---- |
| signature | [Signature for upload from client](https://intl.cloud.tencent.com/document/product/266/33922). | NSString | Yes |


#### Error codes

The SDK listens on the image/media upload status through the `TXMediaPublishListener` API; therefore, you can check the image/media publishing status with the `retCode` in `TXMediaPublishResult`.

| Error Code | Constant in TVCCommon | Description |
| :--: | :---------------------------- | :-------------- |
| 0 | MEDIA_PUBLISH_RESULT_OK | Uploaded successfully. |
| 1001 | MEDIA_PUBLISH_RESULT_UPLOAD_REQUEST_FAILED | The upload request failed. This is usually because that the signature of the client has expired or is invalid. You need to apply for a signature for the app again. |
| 1002 | MEDIA_PUBLISH_RESULT_UPLOAD_RESPONSE_ERROR | Failed to parse the request information. |
| 1003 | MEDIA_PUBLISH_RESULT_UPLOAD_VIDEO_FAILED | Failed to upload the image/media. |
| 1005 | MEDIA_PUBLISH_RESULT_PUBLISH_REQUEST_FAILED | The request of ending the upload failed. |
| 1006 | MEDIA_PUBLISH_RESULT_PUBLISH_RESPONSE_ERROR | An error occurred when responding to the upload ending request. |





