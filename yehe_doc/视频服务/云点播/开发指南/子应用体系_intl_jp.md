## 概要
VODでは、VODでリソースを隔離できるように、**サブアプリケーション機能**を提供しています。サブアプリケーションとはVODの内的概念であり、リソースを分割するための方法です。サブアプリケーションの外的パフォーマンスは、独立したVODアカウントに似ています。サブアプリケーションを作成した後のVODリソースの帰属形式を、次の図に示します。
<img src="https://main.qcloudimg.com/raw/58880e642525a040fc3bcd5e5c6d12b9.png" width="595">
>?ここでいう**リソースパック**には、VOD内のメディアファイルとその属性、メディアファイルから派生したその他のファイル、各種設定、CDNドメイン名、VODサービスの使用状況の統計情報などが含まれます。

### ユースケース
VODサブアプリケーションの一般的なユースケースは、次のとおりです。

- **複数部門/マルチサービスの隔離**：ある企業はTencent Cloudをベースとして独自の製品を開発しています。その中で部門Aは、VODを使用してUGSV Appを開発する必要があります。部門Bは、VODを使用して映画とテレビのWebサイトを開発する必要があります。これら2つのVOD業務は互いに隔離する必要がありますが、財務管理上の理由から、この会社は部門AとBに個別のTencent Cloudアカウントを作成することができません。このような場合、VODのサブアプリケーション機能を使用して、部門Aと部門Bにサブアプリケーションを割り当てることができます。
- **権限制御**：上記の複数部門/複数業務の隔離シナリオにおいて、開発者は、権制限御の要件をさらに設定する場合があります。例えば、各部門に対して自部門の業務に関連付けられたサブアプリケーションにのみアクセスを許可し、他のサブアプリケーションへのアクセス権限を持たせないといったことです。この場合、アカウント管理者は、1つのサブユーザーを部門Aと部門Bに割り当てて、対応するVODサブアプリケーションへのアクセス許可権限を付与することができます。操作の詳細については、[CAM](https://intl.cloud.tencent.com/document/product/266/33970) をご参照ください。
- **本番環境とテスト環境の分離**：開発者はあるVOD機能をテストしたいと思っていますが、それらがオンライン運用に影響を与えることを懸念しています（例えば、[イベントの通知](https://intl.cloud.tencent.com/document/product/266/33948) 方法の変更や[ホットリンク防止](https://intl.cloud.tencent.com/document/product/266/33984) を有効にすることなど）。開発者は、本番環境とテスト環境に対して、それぞれ1つのサブアプリケーションをアクティブにすることができます。新しい機能は最初にテスト環境で検証し、誤りのないことを確認してから、オンライン環境に変更します。

### ロールの定義と識別
サブアプリケーションシステムには、管理者、メインアプリケーションおよびサブアプリケーションという3種類のロールがあります。次の図を使用して、それらの定義を説明します。
<img src="https://main.qcloudimg.com/raw/c873e8cdb0eb762df5d899efc13aa7cc.png" width="724" >

1. 開発者はVODサービスをアクティブにした場合、デフォルトでは**メインアプリケーション**ロールとなります。この場合のすべてのVODリソースは、メインアプリケーションに属します。メインアプリケーションのIDは開発者のTencent Cloud APPIDであり、コンソールの[【アカウント情報】](https://console.cloud.tencent.com/developer) で確認できます。
2. 開発者がVODサブアプリケーション機能をアクティブにすると、別の**管理者**ロールが生成されます。これはVODリソースを所有せず、すべてのリソースは引き続きメインアプリケーションに属します。
3.管理者ロールを使用して**サブアプリケーション**を作成します。新規作成されたサブアプリケーションには、独立したVODリソースが含まれます。これはメインアプリケーションと対等のステータスを持ち、メインアプリケーションとは相互に隔離されているので、メインアプリケーションと同等の特殊なサブアプリケーションと考えることができます。サブアプリケーションを作成すると、VODはサブアプリケーションIDと呼ばれるプラットフォーム全体に一意のIDを割り当てます。表示方法については、[コンソールの使用説明 - アプリケーション管理](#p1)をご参照ください。
4. 管理者ロールを使用して**サブアプリケーション**を再度作成します。この新規作成されたサブアプリケーションにも、独立したVODリソースがあります。これは、メインアプリケーションや他のサブアプリケーションと対等なステータスを持ち、他のサブアプリケーションとは相互に隔離されています。以下、同様です。

>?特に説明のない限り、以下ではメインアプリケーションとサブアプリケーションを区別せず、すべて**サブアプリケーション**を使用して説明します。

### 機能
VODサブアプリケーションシステムは、次のような機能を提供します。

- サブアプリケーションの作成および設定：開発者はVODサブアプリケーション機能をアクティブにすると、コンソールで管理者ロールによってサブアプリケーションを作成し、各サブアプリケーションの名前と説明を設定することができます。
- サブアプリケーションの無効化：メインアプリケーションを除く 他のすべてのサブアプリケーションを無効にすることができます。サブアプリケーションを無効にすると、そのVODリソースはクリアされず、そのドメイン名のみが無効になります。他の機能（アップロード、トランスコードなど）は影響を受けません。
- リソースの隔離：サブアプリケーションとサブアプリケーション間のVODリソースは、相互に隔離されています。
- コンソールまたはサーバーAPIを介して、サブアプリケーションのVODリソースを操作します。
- 保存、帯域幅/トラフィック、トランスコード時間、ビデオ監査時間、再生データなど、サブアプリケーションごとに個別のデータ統計情報を生成します。
- すべてのサブアプリケーションに対して概要データ統計情報を生成します。

### <span id ="p4"></span>制限
VODサブアプリケーションシステムには、次のような制限があります。

- メインアプリケーションの名前と説明は変更できません。
- サブアプリケーションは削除できません。
- 各VODアカウントは、最大50個のサブアプリケーションを作成することができます。
- サブアプリケーションには個別の課金ロジックを設定できません（課金方法の設定、個別の課金生成、専用リソースパックの購入など）。1つのVODアカウント下のすべてのサブアプリケーションは、いずれも同じVODアカウントに属しています。すべてのサブアプリケーションのVOD使用量データ（保存、トラフィック、トランスコード時間、ビデオ監査時間などを含みますが、これらに限定されないVOD課金項目）はすべて合算され、一括で課金されます。

## <span id="p3"></span>コンソールの使用説明

### サブアプリケーションのアクティブ化

1. [VODコンソール](https://console.cloud.tencent.com/vod)にログインします。
2. 左側ナビゲーションバーの【サブアプリケーションのアクティブ化】をクリックして、アクティブ化ページに進みます。
3. このページの【今すぐ使用する】をクリックすれば、VODのサブアプリケーション機能がアクティブになります。

>?サブアプリケーションの機能が既にアクティブ化されている場合、左側ナビゲーションバーの【サブアプリケーションのアクティブ化】は表示されません。

### ロールの選択
サブアプリケーション機能をアクティブにすると、[VODコンソール](https://console.cloud.tencent.com/vod) の左上隅にロールを選択するドロップダウンリストが表示されるので、開発者はここでロールを選択できます。サブアプリケーション機能をアクティブにした直後は、ドロップダウンリストには【管理者】と【メインアプリケーション】という2つのロールしかありません。サブアプリケーションを作成すると、ドロップダウンリストに対応するロールが追加されます。
![](https://main.qcloudimg.com/raw/21a4dd738c969fae9615a77e065ffe66.png)

### 管理者
管理者ロールの場合、左側ナビゲーションバーには、【サービスの概要】、【アプリケーション管理】、【UGSV License】および【リソースパック/プラグインの管理】があります。

- サービスの概要：このページには、VOD課金方法、すべてのサブアプリケーションを集約した後の主要な業務データおよび各サブアプリケーションの主要な業務データが表示されます。
- <span id = "p1"></span>アプリケーション管理：このページでは、サブアプリケーションの表示、作成、編集および無効化を行うことができます。各サブアプリケーションIDもこのページに表示されます。
- リソースパック/プラグインの管理：このページでは、購入したリソースパックとプラグインの使用状況を確認できます。

>?月次決済のユーザーは、リソースパックを使用できません（既存のリソースパックは「フリーズ」の状態です）。日次決済方法に切り替えた後、リソースパックの有効期限が切れていない場合は自動的に解凍され、ユーザーは引き続き使用することができます。

### サブアプリケーション
サブアプリケーションロールの場合、VODコンソールの使用方法はサブアプリケーション機能が無効のときとほぼ同じです。サブアプリケーションに属するVODリソースを表示、操作することができます。2つの主な相違点は、サブアプリケーションには独自の課金設定がないところです。

## サーバーAPIの使用説明

### <span id = "p2"></span>サーバーAPIでのサブアプリケーションの指定
VODサーバーAPIは、[Tencent Cloud API 3.0](https://intl.cloud.tencent.com/zh/product/api) にアップグレードされました。各APIの```SubAppId```パラメータでアクセスしたいサブアプリケーションを指定できます。メインアプリケーションにアクセスする場合は、メインアプリケーションのIDを入力するか、空のままでもかまいません。

###サーバーAPI2017でサブアプリケーションを指定
使用する場合は、リクエストに`SubAppId`パラメータを追加する必要があります（大文字と小文字を区別して入力してください）。このパラメータとサーバーAPI 2017の[パブリックリクエストパラメータ](https://intl.cloud.tencent.com/zh/document/api/213/6976) は同じレベルであり、その値はサブアプリケーションIDです。メインアプリケーションにアクセスする場合は、メインアプリケーションIDを入力するか、空のままでもかまいません。

>?
>- サーバーAPI2017のドキュメントに`SubAppId`パラメータは公開されていませんが、このパラメータの使用には影響しません。
>- `SubAppId`パラメータはサーバーAPIの署名計算にも関与し、計算ルールは不変です。

## ファイルアップロードの説明
VODサブアプリケーション機能をアクティブにした後、メディアファイルをVODにアップロードするサブアプリケーションを指定する必要があります。

### LVBレコーディング
[LVBレコーディング](https://intl.cloud.tencent.com/document/product/267/31563) は、指定したサブアプリケーションでレコーディングを生成できます。指定方法とは、LVBプッシュパラメータに、`vod_sub_app_id=xxx`（`xxx`とはサブアプリケーションIDのこと）を追加することです。メインアプリケーションでレコーディングする場合は、このパラメータを空のままにします。

### サーバーからのアップロード
[サーバーからのアップロード](https://intl.cloud.tencent.com/document/product/266/33912) は、指定されたサブアプリケーションへのアップロードをサポートします。具体的なパラメータの設定方法については、以下のリンクをご参照ください。メインアプリケーションにアップロードする場合は、メインアプリケーションのIDを入力するか、空のままでもかまいません。

#### SDKから
* [Java SDK](https://intl.cloud.tencent.com/document/product/266/33914)
* [PHP SDK](https://intl.cloud.tencent.com/document/product/266/33916)
* [Python SDK](https://intl.cloud.tencent.com/document/product/266/33917)
* [Golang SDK](https://intl.cloud.tencent.com/document/product/266/33919)

#### サーバーAPIから
API方式を使用してアップロードする場合、[ApplyUpload](https://intl.cloud.tencent.com/document/product/266/34120) と[CommitUpload](https://intl.cloud.tencent.com/document/product/266/34119) という2つのインターフェースが関連します。具体的な使用法については、 [サーバーAPIでのサブアプリケーションを指定](#p2)をご参照ください。
SDKを使用してアップロードすることを強くお勧めします。

### クライアントからのアップロード
[クライアントからのアップロード](https://intl.cloud.tencent.com/document/product/266/33921) では指定したサブアプリケーションへのアップロードをサポートします。指定方法とは、[クライアントからのアップロードの署名](https://intl.cloud.tencent.com/document/product/266/33922) にパラメータ `vodSubAppId=xxx`（`xxx`はサブアプリケーションIDのこと）を追加することです。メインアプリケーションにアップロードする場合は、メインアプリケーションのIDを入力するか、空のままでもかまいません。

>?`vodSubAppId`パラメータはクライアントからのアップロードの署名計算にも関与し、計算ルールは不変です。

### URLからのプルアップロード
URLからのプルアップロードでは、指定したサブアプリケーションへのアップロードをサポートします。

* コンソールから：具体的な使用法については、 [コンソールの使用説明](#p3)をご参照ください。
* サーバーAPIから：[PullUpload](https://intl.cloud.tencent.com/document/product/266/34118) インターフェースを使用します。具体的な使用方法については、[サーバーAPIでのサブアプリケーションを指定](#p2)をご参照ください。

## 権限管理
VODはCAMに接続されており、サブアプリケーションレベルの権限付与をサポートしています。詳細については、 [CAM](https://intl.cloud.tencent.com/document/product/266/33970) をご参照ください。

## FAQ
#### サブアプリケーション機能をアクティブにすると、オンラインになっている既存の業務ロジックに影響を与えますか？
影響は与えません。サブアプリケーションシステムは互換性を考慮して設計されています。すべてのサーバーAPIインターフェースは、サブアプリケーションIDが指定されていない場合、デフォルトでメインアプリケーションを操作します。

#### サブアプリケーション機能をアクティブにするには料金がかかりますか？
サブアプリケーション機能自体は無料ですが、各サブアプリケーションによる消費量はVODアカウントに計上されます。

#### サブアプリケーション機能を使用して業務の隔離を実装していますが、各業務ではどのように内部決済/コストを実装するのですか？
VODは、アカウント全体を取りまとめた伝票のみを発行します。複数の内部業務にコストを割り当てる必要がある場合は、VODが提供するサブアプリケーションレベルの統計データに基づいて、内部コストの割り当てをカスタマイズし、計算することができます。

#### サービスを一時停止した場合、サブアプリケーションにどのような影響を与えますか？
VODサービスに、[料金未払いによるサービス停止]が生じたときは、そのアカウントのすべてのサブアプリケーションは一時停止されます。

#### あるサブアプリケーションのビデオを、別のサブアプリケーションに移行できますか？
サブアプリケーション間のリソースは隔離されており、移行できません。
