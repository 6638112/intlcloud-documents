タイムシフト視聴は、CSSレコーディングの機能に依存し、CSSタイムシフトとVODのアクセラレーション配信を結合させて、ライブストリーミング中にプレイバック視聴する機能を実現しています。ユーザーは、配信開始後のある過去の時間点をリアルタイムに選択してプレイバック視聴することができ、これにより、それ以前のライブストリーミングコンテンツを再生する効果を達成できます。ライブストリーミング中の試合のハイライトをプレイバック視聴するためによく利用されますが、ユーザーは、プログレスバーを直接ドラッグすればプレイバック視聴でき、ライブストリーミングの終了まで待つ必要がありません。プレイバック視聴の最中もCSSストリームは変わらず維持されます。また、プレイバックの途中で切り替え、ライブ映像に戻すことも可能です。

## 機能特性
- プレイバック視聴の相対的なタイムシフト時間（プレイバック視聴の起点と現在の時間の差）を指定することが許されています。
- CSSストリームにマルチビットレートを使用してレコーディングしているときは、指定ビットレートのビデオストリームを指定することが許されています。

## 前提条件
-Tencent Cloudアカウントを[登録](https://intl.cloud.tencent.com/register)して[ログイン](https://intl.cloud.tencent.com/login)し、アカウントの実名認証を完了していること。実名認証を完了していないユーザーは、中国大陸のCSSタイムシフトインスタンスを購入できません。
- Tencent CSSサービスをアクティブ化し、[プッシュドメイン名](https://intl.cloud.tencent.com/document/product/267/35970)を追加済みであること。

## 注意事項：
- タイムシフト視聴機能を使用する前提条件は、ターゲットとなるCSSストリームで[タイムシフト視聴](#time)機能を有効にしていることです。
- 相対的なタイムシフト時間は、現在最小90秒です。すなわち、プレイバック視聴のコンテンツは、ライブストリーミングのコンテンツに対して90秒以上のディレイがあります。
- 現在、タイムシフト機能の内部テストに対する個別の課金はありませんが、タイムシフト機能を有効にするにはCSSレコーディング機能が必要であり、[CSSレコーディング料金](https://intl.cloud.tencent.com/document/product/267/39605)、[オンデマンドストレージ料金およびビデオ再生料金](https://intl.cloud.tencent.com/document/product/266/2838)が発生します。

## 実践手順
### 手順1：VODサービスのアクティブ化[](id:step1)
1. [VODコンソール](https://console.cloud.tencent.com/vod/overview)に移動し、【今すぐアクティブにする】をクリックします。
2. サービスプロトコルのアクティブ化にチェックを入れ、【OK】を選択すると、ＶＯＤサービスは正常にアクティブ化し、VODコンソールにアクセス可能になります。


### 手順2：タイムシフト再生ドメイン名の追加[](id:step2)
タイムシフト再生に使用するVODドメイン名を追加する必要があります、具体的な操作は次のとおりです。
1. [VODコンソール](https://console.cloud.tencent.com/vod/overview)で、左側ナビゲーションバーの【配信再生管理】>【Domain Management】を選択します。
![](https://qcloudimg.tencent-cloud.cn/raw/d6fe8b0462217a702bcbf894c7bfcdc1.png)
2. 【ドメイン名の追加】を選択し、ICP登録済みのVODドメイン名を入力します。具体的な操作については、 [配信と再生の設定](https://intl.cloud.tencent.com/document/product/266/35572)をご参照ください。
![](https://qcloudimg.tencent-cloud.cn/raw/bd9c4ba9f7c0df8126cf3a49f628875b.png)

3. 新規追加ドメイン名のCNAME設定操作の完了。

### 手順3：レコーディングテンプレートとの関連付け[](id:step3)
1. [CSSコンソール](https://console.cloud.tencent.com/live/config/record)に入り、【機能設定】>【[CSSレコーディング](https://console.cloud.tencent.com/live/config/record)】をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/ec16742a6d650c4aad914e209f8a27ad.png)

2. 【レコーディングテンプレート作成】をクリックします。具体的な操作方法は、[レコーディングテンプレート設定](https://intl.cloud.tencent.com/document/product/267/34223)をご参照ください。
![](https://qcloudimg.tencent-cloud.cn/raw/ae82e19622729dcc2ca328176e0d0e71.png)
>!
>- レコーディングファイルタイプにHLS形式を選択し、HLSレコーディングを有効にします。
>- ファイル保存時間をカスタマイズします。この時間は[タイムシフト時間](https://intl.cloud.tencent.com/document/product/267/31565)より短くできません。
2. レコーディングテンプレートを設定が必要なプッシュドメイン名と関連付けします。具体的な操作方法は、[レコーディング設定](https://intl.cloud.tencent.com/document/product/267/34224)をご参照ください。

### 手順4：タイムシフトサービスのアクティブ化[](id:time)
[チケットを提出](https://console.cloud.tencent.com/workorder/category?level1_id=29&level2_id=39&source=0&data_title=%E4%BA%91%E7%9B%B4%E6%92%AD%20%20CSS&step=1)し、質問が属する製品に「CSS」を選択して、タイムシフトサービスのアクティブ化申請のリクエストを提出してください。以下のパラメータも提供します。
- [手順2](#step2)の中で追加済みのVODタイムシフト再生ドメイン名 。
- [手順3](#step3) のレコーディングテンプレートID。
- カスタマイズしたタイムシフト時間 timeshift_dur。単位：秒。

>?
> - タイムシフト時間：タイムシフトでコンテンツを視聴できる時間（現在、タイムシフトで最長で7日以内のコンテンツを設定できます）。
> - この項目は絶対的な精度を保証するものではありません。ニーズに応じて設定することを前提とし、時間に余裕を持たせることをお勧めします。
>- 7200（2時間）に設定する場合：目下、2時間前から現在までのタイムシフトされたコンテンツをリクエストできることを意味します（つまり、delayの相対的なタイムシフト時間を90秒～2時間とすることができます）。2時間以上前にタイムシフトしたコンテンツは、ライブストリーミングコンテンツが存在しても、HTTP 404が返されます。

## 再生リクエスト
### リクエストURL形式
```
http://[Domain]/timeshift/[AppName]/[StreamName]/timeshift.m3u8?delay=xxx
```

### パラメータの説明
| パラメータ | 説明 |
|---------|---------|
| [Domain] | 登録したタイムシフトサービスアクセスドメイン名。VODコンソールで追加したタイムシフト再生ドメイン名です。 |
| timeshift | 固定フィールド。修正不要|
| [AppName] | アプリケーション名。アプリケーション名がliveであれば、liveと入力してください|
| [StreamName]	 | ストリーム名。リクエストに対応するストリーム名を入力してください|
| timeshift.m3u8	 | 固定フィールド。修正不要|
| delay | 相対的なタイムシフト時間を意味し、単位は秒。現在、この値は90未満ですが、バックグラウンドで90に調整できます|

### 事例
現在のタイムシフトドメイン名を `testtimeshift.com`、タイムシフトアプリケーション名を `live`、ストリーム名を `SLPUrIFzGPE`とした場合、このアドレスの5分前のライブストリーミングコンテンツをタイムシフトしたい場合は、次のURLをリクエストします。

`http://testtimeshift.com/timeshift/live/SLPUrIFzGPE/timeshift.m3u8?delay=300`
