疑似ライブストリーミングは、VODの再生制御能力に依存し、VODファイルに「視聴時間の制限」と「視聴の進行状況の同期」の2種類のアクセス制御の機能を追加することで、VODファイルにライブストリーミングに似た効果をもたらします。ユーザーはまずVODファイルを生成してから、指定するライブストリーミング時間に、VODファイルを使用してライブストリーミングに類似する配信を行うことができ、ライブストリーミングにおけるリスク低減とコスト削減が効果的に行えるようになっています。

## 機能特性
- **低い開発コスト**：オンデマンドビデオを標準のライブストリーミングに変換して配信することを選択した場合、ユーザーはOBSを使ってビデオをライブストリーミングプラットフォームにプッシュした上で、ライブストリーミングシステムに接続する必要がありますが、高い開発コストがかかってしまいます。これと比較すると、疑似ライブストリーミングはVOD内部で実現でき、ユーザーはトランスコードしてホットリンク防止機能を有効にするだけで完了です。
- **不正コンテンツのリスク低減**：疑似ライブストリーミング機能を使用することで、ユーザーは事前に自分のVODファイルに対する審査と編集を行なうことができ、ライブストリーミング中に抵触する可能性があるコンプライアンス違反のリスクを効果的に回避できます。不正なコンテンツを回避し、ライブストリーミングの品質を向上させます。
- **シンプルでフレキシブルな作成**：
	- ライブストリーミングルームという概念はなく、あらゆるビデオでいつでも、疑似ライブストリーミングを生成できます。
	- 同時実行数の制限はなく、開始時刻を指定して、あらかじめ視聴リンクを配布することができます。

## ユースケース
- 主に事前レコーディングが必要なビデオに使用され、ユーザーはスケジュールされた時刻に、同期視聴できます。ユーザーは事前に視聴エントリーを取得することはできますが、開始予定時刻より前にビデオを視聴することはできません。
- 疑似ライブストリーミングの進行中は早送りできません。eラーニング、ライブストリーミングのパーティやラジオ・テレビなどの業種でよく用いられます。

## 利用説明

### 使用制限
疑似ライブストリーミングは本質的にはオンデマンド配信であるため、次のようなCSSの機能は備えていません。
- 「1回限り」の疑似ライブストリーミングに対するデータ統計はサポートしていません。
- 「1回限り」の疑似ライブストリーミングの場合、開始と終了を認識できません。
- 進行中の疑似ライブストリーミングに対する一時停止/終了などの操作はサポートしていません。
- 配信済みの疑似ライブストリーミングのリンクの無効化はサポートしていません。
- ビデオコンテンツの動的な変更（リアルタイムのトランスコーディング、ウォーターマークなど）はサポートしていません。

### 用語の説明
**視聴許可時間の制限**：ビデオエントリーは、視聴者に事前配布することができます。視聴者は疑似ライブストリーミングの開始前または終了後に視聴することはできません。疑似ライブストリーミングは、「進行」中のときのみ視聴することができます。
**視聴進行状況の同期**：疑似ライブストリーミングの「進行」中は、すべての視聴者の視聴進行状況が同期されます（分単位でのずれはあります）。


## 前提条件
- Tencent Cloudアカウントを[登録](https://intl.cloud.tencent.com/register)して[ログイン](https://intl.cloud.tencent.com/login/subAccount?s_url=https%3A%2F%2Fcloud.tencent.com)し、アカウントの実名認証を完了していること。実名認証を完了していないユーザーは、中国大陸の疑似ライブストリーミングインスタンスを購入できません。
- Tencent CloudのCSSとVODのサービスをアクティブ化します。まだアクティブになっていない場合は、 [CSSサービス](https://console.cloud.tencent.com/live/livestat) と [VODサービス](https://console.cloud.tencent.com/vod/overview) をアクティブ化してください。
- CSSレコーディングを行います。詳細については、[CSSレコーディングのVODへの変換](https://intl.cloud.tencent.com/document/product/266/39562)をご参照ください。

## 実践手順
### 手順1：ビデオをVODにアップロードする
[VODコンソール](https://console.cloud.tencent.com/vod/media)（非管理者）の左側ナビゲーションバーで、【メディア資産管理】>【ビデオ管理】と選択し、【ビデオのアップロード】をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/fae7f0c7f7a7fba65da7a947903b58ad.png)
業務の状況に応じて適した方法を選択し、ビデオファイルをVODにアップロードすることも可能です。その他のアップロード方法は、[メディアアップロードの概要](https://intl.cloud.tencent.com/document/product/266/9760)および[CSSレコーディングのVODへの変換](https://intl.cloud.tencent.com/document/product/266/39562)をご参照ください。

### 手順2：ビデオをHLS[](id:HLS)にトランスコードする
1. 疑似ライブストリーミングを使用するためにはHLS形式をベースにする必要があります。[トランスコードのタスクの開始](https://intl.cloud.tencent.com/document/product/266/33938)の説明にしたがって、アップロードしたビデオをHLSにトランスコーディングすることができます（具体的な[トランスコードテンプレート](https://intl.cloud.tencent.com/document/product/266/14059)は、業務にもとづき選択してください）。
2. トランスコーディングが完了したら、コンソールの[メディア資産管理](https://intl.cloud.tencent.com/document/product/266/33895)でHLSのURLを確認するか、または[イベントの通知](https://intl.cloud.tencent.com/document/product/266/33938)を受信する方式でHLSのURLを取得します。
![](https://qcloudimg.tencent-cloud.cn/raw/ca003d8a162fb814938888b5678e6f33.png)

### 手順3：Keyホットリンク防止をアクティブにする
1. 疑似ライブストリーミングを使用するには、ホットリンク防止を有効にする必要があります。[VODコンソール](https://console.cloud.tencent.com/vod)にログインして、左側ナビゲーションバーの【配信と再生の設定】>【ドメイン名管理】を選択し、ターゲットドメイン名がある行の【設定】をクリックしてください。ドメイン名関連の設定ページに入ります。
![](https://qcloudimg.tencent-cloud.cn/raw/f21443e506aab6c9020d4a98575c1e7b.png)
2. 【編集】をクリックして、Refererホットリンク防止を有効にします。
![](https://qcloudimg.tencent-cloud.cn/raw/e4fecb5f16b4157959b86acbc9d33ee0.png)
2. Refererホットリンク防止、Keyホットリンク防止を有効にします。
![](https://qcloudimg.tencent-cloud.cn/raw/7f13f03767df78e476012158fb44eebd.png)
その他の選択項目の説明については、[ホットリンク防止の設定](https://intl.cloud.tencent.com/document/product/266/14060)をご参照ください。設定が完了したら、ホットリンク防止KEYの内容を保存してください。これは以下のホットリンク防止署名の計算に使用します。

### 手順4：ホットリンク防止署名の計算
#### 署名の計算式[](id:function)
```plaintext
sign = md5(KEY + Dir + t + plive + exper + rlimit + us)
```
>!疑似ライブストリーミングのホットリンク防止パラメータは、[標準のKeyホットリンク防止](https://intl.cloud.tencent.com/document/product/266/33986)よりもパラメータ（`plive`）が1つ多くなります。ホットリンク防止の署名を計算するときは、`plive`を計算に加える必要があります。

| パラメータ名 | 値                   | 説明                                               |
| ------ | ---------------------- | -------------------------------------------------- |
| KEY    | 11111111| 開発者がKeyホットリンク防止をアクティブにするときに選択したキーです。                  |
| Dir    | /dir1/dir2/          | 元の再生URLのPATHから`myVideo.mp4`を除いた残りの部分。 |
| t      | 5a71afc0             | 期限切れタイムスタンプ（例えば1517400000）は16進数で結果が表されます。             |
|plive|5e344f00|疑似ライブストリーミングの開始時間（北京時間）は、UNIXタイムスタンプの形式で表します。例えば1577808000は、2020-01-01 00:00:00の時点を示しています。|
|exper|0|プレビュー時間の長さ。0は無制限を表します。|
|rlimit|0|視聴IP数の制限。0は無制限を表します。|
| us     | test| 生成されたランダムな文字列。                                   |


例えば、ある開発者はVODにビデオがあり、そのHLSのURL（元のビデオのURLではない）の再生アドレスは、`http://1250000000.vod2.myqcloud.com/vodtranscq125000000/12345678/v.f240.m3u8；`です。この場合、現時点で次のような要件があります。
- HLSのURLホットリンク防止KEYは、`11111111` です。
- 有効期限 t は、`5e5a8a80`（2020-03-01 00:00:00）です。
- 疑似ライブストリーミングの開始時間pliveは、`5e344f00`（2020-02-01 00:00:00）です。
- プレビュー時間の長さexperは、`0`（無制限）です。
- 視聴IP数の制限rlimitは、`0`（無制限）です。
- ランダムな文字列usは、`test`です。


1. [署名の計算式](#function)に基づいて署名を計算します。
```plaintext
sign = md5(11111111/vodtranscq125000000/12345678/5e5a8a805e344f0000test) = 0af5018df88c00e6629e0fb8939277dd
```
2. 計算された署名をHLSのURLのQueryStringにつなげて、最終的に生成されるホットリンク防止リンクは、次のとおりです。
```plaintext
http://1250000000.vod2.myqcloud.com/vodtranscq125000000/12345678/v.f240.m3u8?t=5e5a8a80&plive=5e344f00&exper=0&rlimit=0&us=test&sign=0af5018df88c00e6629e0fb8939277dd
```

>?
>- ホットリンク防止リンクQueryStringにおけるパラメータの順序は、`sign`の計算時と同じである必要があります。すなわち、`t-plive-exper-rlimit-us-sign`となります。
>- 開発者がデバッグを実行しやすいように、[ホットリンク防止署名生成ツールページ](https://vods.cloud.tencent.com/referer/gen_video_url.html)を提供しています。ページの内容に応じてパラメータを入力すると、署名計算の中間結果と最終的なホットリンク防止リンクを表示することができます。

## 疑似ライブストリーミングの体験
HLS再生をサポートするプレーヤー（例えば、Safariブラウザ、VLC、PotPlayerなど）では、上記のホットリンク防止リンクにアクセスして、直接体験することができます。
>!ChromeブラウザはデフォルトではHLSをサポートしていないため、プラグインをインストールする必要があります。
