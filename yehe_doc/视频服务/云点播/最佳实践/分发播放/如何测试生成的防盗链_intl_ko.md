## 소개
VOD는 [링크 도용 방지](https://intl.cloud.tencent.com/document/product/266/33984) 기능을 제공하며, 필요에 따라 동영상 재생 URL에 대한 링크 도용 방지를 설정할 수 있는 링크 도용 방지 기능을 제공하여 동영상 재생에 대한 제어를 구현합니다.

그러나 테스트 없이 사용 중인 도메인에 대해 링크 도용 방지를 설정하면 다음과 같은 위험이 따릅니다.

- 프로덕션 네트워크 환경에서 사용자 재생 실패.
- 재생 제어의 불만족스러운 효과.

예를 들어 동영상 재생 URL의 유효 기간을 제어해야 하는 경우 [KEY 링크 도용 방지](https://intl.cloud.tencent.com/document/product/266/33986)를 활성화해야 합니다. :

* 생성된 링크 도용 방지의 서명 매개변수 ‘sign’이 잘못 계산된 경우 **링크 도용 방지를 활성화하면 프로덕션 네트워크 환경에서 모든 동영상의 재생이 실패할 수 있습니다**.
* 생성된 링크 도용 방지의 ‘t’ 만료 시간 매개변수가 너무 크면 **링크 도용 방지가 활성화된 후 동영상 재생 URL이 예정대로 만료되지 않습니다**.

따라서 도메인에 대한 링크 도용 방지를 활성화하기 전에 원하는 결과를 얻을 수 있는지 확인하기 위한 테스트를 수행해야 합니다. 또한 링크 도용 방지 테스트는 프로덕션 네트워크 환경의 사용자에게 영향을 미치지 않아야 합니다(즉, 프로덕션 네트워크 환경에 대해 안전 보장).

## 안전한 링크 도용 방지 테스트 구현

VOD는 안전한 링크 도용 방지 테스트 체계를 제공합니다.

### 용어 사전
관련 용어는 다음과 같습니다.

* **기본 VOD 도메인**: 프로덕션 네트워크 환경에서 VOD 동영상을 재생하는 데 사용되는 공식 도메인입니다. ‘사전 설정 도메인’ 또는 ‘사용자 정의 도메인’을 기본 도메인으로 설정할 수 있습니다(설정 방법은 [사용자 정의 도메인](https://intl.cloud.tencent.com/document/product/266/35572)을 참고하십시오).
* **사전 설정 VOD 테스트 도메인**: 문제 해결을 위한 테스트 도메인(일반적으로 ‘xxx-test.vod2.myqcloud.com’)입니다. 프로덕션 네트워크 환경에서 사용하거나 기본 도메인으로 설정해서는 안 됩니다.
* **프로덕션 App 백엔드**: 프로덕션 네트워크 환경의 사용자가 동영상 재생 URL을 가져올 수 있는 비즈니스의 App 백엔드 서비스입니다.
* **테스트 App 백엔드**: 테스트 클라이언트가 동영상 재생 URL을 가져오는 비즈니스 테스트 환경의 App 백엔드 서비스입니다.

### 계획 세부 정보

일반적으로 프로덕션 네트워크 환경의 사용자는 프로덕션 App 백엔드에서 동영상 재생 URL을 가져오고, 테스트 App 백엔드에서 테스트 클라이언트를 가져옵니다. 두 URL의 도메인은 동일합니다(즉, 기본 VOD 도메인). 링크 도용 방지 테스트 중 기본 VOD 도메인은 직접 변경할 수 없습니다. 그렇지 않으면 사용자가 영향을 받습니다.

<img src="https://main.qcloudimg.com/raw/85d3b79bc4255be32804c53438bc8ec2.png" width="450">

링크 도용 방지 테스트가 프로덕션 네트워크 환경의 사용자에게 영향을 미치지 않도록 VOD는 프로덕션 네트워크 환경에서 사용되는 기본 VOD 도메인과 분리된 ‘미리 설정된 VOD 테스트 도메인’을 제공합니다. 링크 도용 방지 테스트 중에는 테스트 도메인의 링크 도용 방지 구성만 관리해야 합니다.

VOD는 ‘테스트 도메인 프록시’(IP: ‘122.152.250.73’)도 제공합니다. 기본 VOD 도메인을 이 프록시로 확인하려면 테스트 클라이언트에서 HOST 테이블을 수정하기만 하면 됩니다. 테스트 클라이언트의 동영상 재생 요청은 프록시를 통해 테스트 도메인(아래 이미지의 빨간색 경로)으로 전달되는 반면, 프로덕션 네트워크 환경의 사용자로부터의 재생 요청은 여전히 공식 도메인(아래 이미지의 검정색 경로)으로 전달됩니다.

<img src="https://main.qcloudimg.com/raw/ea7c413d0bc993554b4b5521ffc7adcf.png" width="450">

따라서 테스트 도메인의 링크 도용 방지 구성을 자유롭게 수정하고 프로덕션 네트워크 환경에서 사용자에게 미치는 영향에 대해 걱정하지 않고 테스트 App 백엔드에서 배포한 재생 URL을 테스트할 수 있습니다.

<img src="https://main.qcloudimg.com/raw/9d47fd2140a3bdc7a20aa6347407b009.png" width="450">

테스트 클라이언트 및 테스트 App 백엔드에서 링크 도용 방지의 모든 것이 올바른지 확인한 후 아래 단계를 수행할 수 있습니다.

1. 공식 App 백엔드에서 배포한 재생 URL의 규칙을 테스트 App 백엔드의 규칙으로 변경합니다.
2. 기본 VOD 도메인의 링크 도용 방지 구성을 미리 설정된 VOD 테스트 도메인으로 변경합니다.

이러한 방식으로 기본 VOD 도메인의 링크 도용 방지가 적용될 수 있으며, 테스트 후 확인된 링크 도용 방지 구성을 프로덕션 네트워크 환경에 적용할 수 있습니다.

## 예시

다음은 주요 링크 도용 방지를 활성화하여 링크 도용 방지 테스트 단계를 보여주는 예시입니다.

1. 사전 설정된 VOD 테스트 도메인에 대한 링크 도용 방지를 활성화합니다.
2. 원본 재생 URL을 가져옵니다.
3. 테스트 클라이언트는 여전히 원본 URL을 재생할 수 있습니다.
4. 테스트 클라이언트에서 HOST 테이블을 수정합니다.
5. 테스트 클라이언트는 더 이상 원본 URL을 재생할 수 없습니다.
6. 테스트 클라이언트는 링크 도용 방지 매개변수가 있는 URL을 재생할 수 있습니다.
7. 공식 App 백엔드는 링크 도용 방지 매개변수가 있는 URL을 생성합니다.
8. 기본 VOD 도메인에 대한 링크 도용 방지를 활성화합니다.

#### 상황

VOD 콘솔에 로그인한 후 사용자 (예시 중 appid는 ‘125xxx655’)는 [[도메인 관리]](https://console.cloud.tencent.com/vod/distribute-play/domain)에서 다음 두 도메인을 볼 수 있습니다.

* 사전 설정된 VOD 도메인 (‘125xxx655.vod2.myqcloud.com’).
* 사전 설정된 VOD 테스트 도메인 (‘125xxx655-test.vod2.myqcloud.com’).

초기 상태에서 사전 설정된 VOD 도메인 ‘125xxx655.vod2.myqcloud.com’은 KEY 링크 도용 방지가 활성화되지 않은 기본 VOD 도메인입니다.

#### 1. 사전 설정된 VOD 테스트 도메인에 대한 링크 도용 방지 활성화

사전 설정된 VOD 테스트 도메인(‘125xxx655-test.vod2.myqcloud.com’)을 선택하고 [설정]을 클릭하여 [Key 링크 도용 방지]로 이동한 후, Key 링크 도용 방지를 활성화합니다. 그 다음 [Key 생성]을 사용하여 링크 도용 방지 Key를 생성합니다. [확인]을 클릭하고 설정이 적용될 때까지 기다립니다.

#### 2. 원본 재생 URL 가져오기

동영상의 원본 재생 URL은 [링크 도용 방지 매개변수](https://intl.cloud.tencent.com/document/product/266/33986#.E9.98.B2.E7.9B.97.E9.93.BE.E5.8F.82.E6.95.B0)가 없는 URL입니다. 콘솔의 [미디어 자산 관리](https://console.cloud.tencent.com/vod/media)에서 가져올 수 있습니다. 예시에서 사용된 URL은 ‘https://125xxx655.vod2.myqcloud.com/ca7xxx655/cfbxxx349/PkxxxIA.mov’입니다.

#### 3. 테스트 클라이언트는 여전히 동영상 원본 URL 재생 가능

![](https://main.qcloudimg.com/raw/a991036d94d654078c94a4b0c19d778d.png)
이 때, 테스트 클라이언트는 여전히 동영상 원본 URL을 통해 동영상을 재생할 수 있습니다. ‘curl’ 명령을 실행하면 HTTP 상태 코드 200이 반환됩니다.

#### 4. 테스트 클라이언트에서 HOST 테이블 수정

레코드 ```122.152.250.73 125xxx655.vod2.myqcloud.com```을 추가하여 HOST 테이블(Windows의 ‘C:\Windows\System32\drivers\etc\hosts’ 또는 Mac OS의 ‘/private/etc/hosts’)을 수정한 다음 변경 사항을 저장합니다.

그 다음 ```ping 125xxx655.vod2.myqcloud.com```을 실행하여 변경 사항이 적용되었는지 확인합니다.

#### 5. 테스트 클라이언트는 더 이상 원본 URL에서 동영상을 재생할 수 없음

HOST 테이블을 수정한 후 테스트 클라이언트는 더 이상 기존 URL로 동영상을 재생할 수 없으며 HTTP 상태 코드는 403 Forbidden이 반환됩니다. 이는 HOST 테이블이 수정된 후 테스트 클라이언트가 시작한 동영상 재생 요청이 사전 설정된 VOD 테스트 도메인 이름에 매핑되고 동영상을 재생하기 전에 올바른 링크 도용 방지 매개변수가 URL에 포함되어야 하기 때문입니다.

#### 6. 테스트 클라이언트는 링크 도용 방지 매개변수가 있는 URL 재생 가능

Key 링크 도용 방지 [생성 규칙](https://intl.cloud.tencent.com/document/product/266/33986#.E9.98.B2.E7.9B.97.E9.93.BE-url-.E7.94.9F.E6.88.90.E6.96.B9.E5.BC.8F)에 따라 링크 도용 방지 매개변수가 있는 URL을 생성하면 동영상이 성공적으로 재생될 수 있습니다. 주소는 ‘https://125xxx655.vod2.myqcloud.com/ca7xxx655/cfbxxx349/PkxxxIA.mov?t=5bd6be00&sign=18cxxx9deb’이고 ```curl```을 실행하면 HTTP 상태 코드 200이 반환됩니다.

테스트 App 백엔드는 링크 도용 방지 생성 규칙에 따라 링크 도용 방지 매개변수가 있는 URL을 배포하고 테스트 클라이언트에서 URL을 확인합니다.

#### 7. 공식 애플리케이션 백엔드는 링크 도용 방지 매개변수가 있는 URL을 생성

테스트 후 공식 App 백엔드는 테스트 App 백엔드와 동일한 규칙에 따라 링크 도용 방지 매개변수가 있는 URL을 배포합니다.

#### 8. 기본 VOD 도메인에 대한 링크 도용 방지 활성화

콘솔에서 **사전 설정된 VOD 테스트 도메인**의 [Key 링크 도용 방지]를 열고 Key를 복사합니다. 그런 다음 **기본 VOD 도메인**의 [Key 링크 도용 방지]를 열고 테스트 도메인의 [링크 도용 방지 Key]를 Key 텍스트 상자에 붙여넣고 [확인]을 클릭해 저장합니다.

도메인 설정이 적용된 후 링크 도용 방지 설정은 프로덕션 네트워크 환경에서 사용되는 기본 VOD 도메인에 적용되어 공식적으로 적용됩니다.


