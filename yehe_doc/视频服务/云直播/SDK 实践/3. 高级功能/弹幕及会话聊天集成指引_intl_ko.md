## 개요
라이브 스트리밍 비즈니스에서 호스트와 시청자는 일반적으로 화면 댓글 및 채팅과 같은 다양한 수단을 통해 실시간으로 상호 작용해야 합니다. 그러나 이러한 기능의 통합은 복잡합니다. 본문은 라이브 스트리밍 비즈니스 및 요구 사항을 이해할 수 있도록 IM을 예로 들어 라이브 스트리밍 중 화면 댓글, 채팅, 항목 추천과 같은 요구 사항을 구현하는 방법과 가능한 문제 및 고려 사항을 설명합니다.
![](https://qcloudimg.tencent-cloud.cn/raw/f4f23f4f722c178b85488aeefd760c1b.jpg)

## 주요 기능 설명
| 기능 | 설명  |
|---------|---------|
| 실시간 화면 댓글, 선물, 좋아요 | 친근한 인터랙션 경험을 구축하기 위해 수억 개의 메시지를 동시 발송할 수 있습니다. |
| 일대일 채팅, 그룹 라이브 채팅 등 다양한 채팅 모드 | 사용자는 같은 채팅방에서 다른 구성원과 메시지를 주고받을 수 있습니다. 텍스트, 이미지, 오디오, 쇼트 비디오 등 다양한 메시지 유형을 실시간으로 푸시할 수 있어 더 많은 사용자 활동을 유도할 수 있습니다. |
| 라이브 커머스에서 상품 푸시 | 라이브 쇼핑 시나리오에서 호스트가 제품을 추천하면 화면 하단의 아이템 슬롯에 즉시 표시되고 모든 채팅방 안의 사용자에게 알려야 합니다. 신상품에 대한 알림은 일반적으로 가상 어시스턴트에 의해 트리거됩니다. |
| 라이브 룸에서 방송 | 방송 기능은 라이브 룸으로 전송되는 시스템 알림과 유사합니다. 시스템 관리자가 방송 메시지를 전달하면 SDKAppID 아래의 모든 라이브 룸이 이를 수신합니다. |


## 액세스 방법

### 1단계: 애플리케이션 생성
Tencent Cloud에서 라이브 룸을 설정하려면 아래와 같이 [콘솔](https://console.tencentcloud.com/im)에서 IM 애플리케이션을 생성해야 합니다.
![](https://qcloudimg.tencent-cloud.cn/raw/63a4addb1394488d16f4873765066f6d.png)


### 2단계: 관련 구성 완료
준비 작업에서 생성된 애플리케이션은 개발에만 적용되는 무료 버전입니다. 프로덕션 환경에서는 필요에 따라 프로 또는 플래그십 에디션을 활성화해야 합니다. 버전별 차이점에 대한 자세한 내용은 [요금 안내](https://www.tencentcloud.com/document/product/1047/34350)를 참고하십시오.
라이브 스트리밍 시나리오에서는 애플리케이션을 생성한 후 몇 가지 추가 구성이 필요합니다.
- **Key로 UserSig 계산하기**
IM 계정 시스템에서 사용자 로그인에 필요한 암호는 IM에서 제공한 키를 사용하여 서버에서 계산합니다. 자세한 내용은 [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385)를 참고하십시오. 개발 단계에서 클라이언트의 개발 지연을 방지하기 위해 아래와 같이 [콘솔에서 UserSig 계산](https://console.cloud.tencent.com/im/tool-usersig)할 수도 있습니다.
<img src="https://qcloudimg.tencent-cloud.cn/raw/12e52c2d8bde72fa76c750657ead2a10.png" width=850>
- **관리자 계정 구성**
라이브 스트리밍 중에 관리자는 라이브 룸에 메시지를 보내거나 정책을 준수하지 않는 사용자를 음소거(강제 퇴장)해야 할 수 있습니다. 이 작업은 [RESTful APIs](https://www.tencentcloud.com/document/product/1047/34621)를 통해 수행할 수 있습니다. 이러한 API를 호출하려면 [IM 관리자 계정을 생성](https://console.cloud.tencent.com/im/account-management)해야 합니다. 기본적으로 IM은 UserID가 administrator인 계정을 제공합니다. 필요에 따라 여러 관리자 계정을 만들 수도 있으며, 최대 5개의 관리자 계정을 만들 수 있습니다.
- **콜백 주소 구성 및 콜백 활성화**
라이브 룸에서 화면 댓글을 기반으로한 경품 추첨, 메시지 통계 수집, 민감한 콘텐츠 감지 등 요구 사항을 구현하려면 IM 백엔드가 특정 시나리오에서 비즈니스 백엔드를 다시 호출하는 IM 콜백 모듈을 사용해야 합니다. HTTP API를 제공하고 아래와 같이 [콘솔 > 콜백 구성](https://console.tencentcloud.com/im/callback-setting) 모듈에서 구성하기만 하면 됩니다.<br>
<img src="https://qcloudimg.tencent-cloud.cn/raw/5f6d94568152fc508fcd9b119a9f01cd.png" width=850>

### 3단계: 클라이언트 SDK 통합
준비가 끝나면 IM 및 TRTC 클라이언트 SDK를 프로젝트에 통합해야 합니다. 필요에 따라 다른 통합 옵션을 선택할 수 있습니다. 자세한 지침은 [시작하기](https://www.tencentcloud.com/document/product/1047/34552)를 참고하십시오.
다음은 라이브 룸의 일반적인 기능을 설명하고 구현 코드와 함께 모범 사례를 제공합니다.

### 4단계: 주요 라이브 룸 기능 개발
1. **그룹 유형 선택**
	라이브 스트리밍 시나리오의 사용자 채팅 섹션에는 다음과 같은 특징이 있습니다.
<ul>
<li>사용자가 자주 그룹에 가입하고 탈퇴하며 그룹 대화 정보(읽지 않은 횟수 및 lastMessage)를 관리할 필요가 없습니다.</li>
<li>사용자는 승인 없이 그룹에 가입할 수 있습니다.</li>
<li>사용자는 채팅 기록에 신경 쓰지 않고 메시지를 보냅니다.</li>
<li>일반적으로 많은 수의 그룹 구성원이 있습니다.</li>
<li>그룹 구성원 정보는 저장할 필요가 없습니다.
</ul>

따라서 그룹 시스템에서 설명한 대로 IM의 [그룹 시스템](https://intl.cloud.tencent.com/document/product/1047/33529)에 따라 라이브 룸의 그룹 유형으로 AVChatRoom을 선택할 수 있습니다. IM 라이브 방송 그룹(AVChatRoom)에는 다음과 같은 특성이 있습니다.
 - **인원 제한이 없으며, 천만 규모의 인터랙티브 라이브 방송 시나리오를 구현할 수 있습니다**.
 - 모든 온라인 사용자 대상 푸시 메시지(그룹 시스템 알림)를 지원합니다.
 - 그룹 참여 신청 후 관리자의 승인 없이 바로 참여할 수 있습니다.
>? Web용 IM SDK를 사용하면 사용자가 한 번에 하나의 오디오/비디오 그룹(AVChatRoom)에만 가입할 수 있습니다. 사용자가 클라이언트에 로그인하여 라이브 룸 A에 입장하고 [콘솔](https://console.cloud.tencent.com/im/login-message)에서 멀티 클라이언트 로그인이 활성화된 상태에서 다른 클라이언트에 로그인하여 라이브 룸 B에 입장하면 해당 사용자는 라이브 룸 A에서 제거됩니다.

2. **라이브 룸 화면 댓글, 선물하기, 좋아요 구성**
	
- **화면 댓글**
	AVChatRoom(오디오/비디오 그룹)은 친근한 인터랙션 경험을 구축하기 위해 화면 댓글, 선물하기 및 좋아요 등 다양한 메시지를 지원합니다.
	화면 댓글을 작성하려면 IM API를 사용하여 텍스트 또는 사용자 정의 메시지를 작성할 수 있습니다. 메시지가 성공적으로 전송된 후 [OnRecvNewMessage()](https://im.sdk.qcloud.com/doc/zh-cn/classV2TIMAdvancedMsgListener.html#acbd1dba3526377d88f14c2183901511c) 콜백을 수신하여 라이브 룸에서 텍스트 또는 사용자 지정 속성을 가져온 다음 원하는 UI에 표시합니다.
- **선물하기**
	- 클라이언트의 비영구적 연결 요청은 과금 로직과 관련된 비즈니스 서버로 전송됩니다.
	- 요금이 발생한 후 발신자는 XXX가 XXX 선물을 보낸 것을 볼 수 있습니다. (보내는 사람이 자신이 보낸 선물을 볼 수 있도록, 메시지가 많은 경우 메시지 폐기 정책이 트리거될 수 있음)
	- 요금 정산 후 서버 API를 호출하여 사용자 정의 메시지(선물)를 보낼 수 있습니다.
	- 여러 개의 선물을 연속으로 보낼 경우 메시지를 병합해야 합니다.
		- 99와 같이 미리 선물 개수를 선택하면 매개변수에 99가 포함된 메시지를 보낼 수 있습니다.
		     - 선물을 여러 번 보내고 총 개수가 불확실한 경우 선물 20개마다 메시지를 보내거나(값 조정 가능) 1초 이내에 클릭할 수 있습니다. 예를 들어 99개의 선물을 연속으로 클릭하면 최적화 후 5개의 메시지만 보내면 됩니다.
- **좋아요**
	- 선물 메시지와 달리 좋아요 메시지는 청구되지 않으며 고객에게 직접 전송됩니다.
	- 서버에서 집계해야 하는 좋아요 메시지의 경우 클라이언트에서 트래픽 스로틀링이 수행된 후 클라이언트에서 좋아요가 집계되고 짧은 시간 동안의 좋아요 메시지가 하나로 병합됩니다. 비즈니스 서버는 메시지를 보내기 전에 콜백에서 좋아요 수를 얻습니다.
	- 계산할 필요가 없는 유사 메시지의 경우 2단계의 로직이 사용됩니다. 여기서 비즈니스 서버는 클라이언트에서 트래픽 스로틀링이 수행된 후 메시지를 보내고 메시지를 보내기 전에 콜백에서 카운트를 가져올 필요가 없습니다.
	
3. **라이브 커머스에서 상품 푸시**
	호스트가 제품을 추천하면 화면 하단의 아이템 슬롯에 즉시 표시되고 모든 채팅방 안의 사용자에게 알려야 합니다. 신상품 알림은 일반적으로 가상 어시스턴트에 의해 트리거됩니다. 관리자가 다음과 같이 사용자 정의 그룹 필드를 수정할 수 있도록 하여 새 제품에 대한 알림을 구현하는 것이 좋습니다.
	1. **사용자 정의 그룹 필드 추가**
		
		1. [IM 콘솔](https://console.cloud.tencent.com/im)에 로그인하여 대상 애플리케이션 카드를 클릭하고 왼쪽 사이드바에서 **기능 구성** > **그룹 구성**을 선택합니다.
		2. **사용자 지정 그룹 필드** 페이지에서 ** 오른쪽 상단 모서리에 있는 **사용자 지정 그룹 필드 추가**를 클릭합니다.
		3. 그룹 레벨 사용자 정의 필드 팝업 창에서 필드 이름을 입력하고 그룹 유형과 해당 읽기 및 쓰기 권한을 설정합니다.
		>?
		>- 필드 이름은 문자, 숫자, 언더바(\_)로만 구성할 수 있으며, 숫자로 시작할 수 없고, 길이는 16자를 초과할 수 없습니다.
		>- 그룹 사용자 정의 필드 이름은 그룹 구성원 사용자 정의 필드 이름과 같을 수 없습니다.

	![](https://qcloudimg.tencent-cloud.cn/raw/5766f42c8c06e0979d0c1f2e2898f97a.png)
		4. **"사용자 지정 그룹 필드"를 추가한 후에는 추가된 그룹 유형의 읽기/쓰기 권한만 수정할 수 있으며 그룹 유형을 다시 선택하거나 삭제할 수 없음을 알고 있습니다**를 선택합니다. 이 필드는 삭제할 수 없습니다. **확인**을 클릭합니다.
   	
	 >? 사용자 지정 그룹 필드는 구성 후 약 10분 후에 적용됩니다.
	
	2. **사용자 지정 그룹 필드 사용**
어시스턴트가 그룹 관리자 신분으로 [Modifying the Profile of a Group](https://www.tencentcloud.com/document/product/1047/34962) REST API를 호출하여 그룹 사용자 정의 필드를 업데이트하고, 라이브 룸의 신상품 알림 및 라이브 방송 상태 변경 알림을 구현할 수 있습니다.
	
4. **라이브 룸에서 방송**
방송 기능은 라이브 룸의 시스템 알림 기능과 유사하지만 메시징에 속한다는 점에서 후자와 다릅니다. 시스템 관리자가 방송 메시지를 전달하면 SDKAppID 아래의 모든 라이브 룸이 이를 수신합니다.
방송 기능은 현재 플래그십 버전에서만 사용할 수 있으며 콘솔에서 활성화해야 합니다. 비즈니스 백엔드에서 방송 메시지를 보내는 방법에 대한 자세한 내용은 [Broadcast Message of Audio-Video Group](https://www.tencentcloud.com/document/product/1047/49440)을 참고하십시오.
>? 플래그십 버전 사용자가 아닌 경우 서버에서 사용자 정의 그룹 메시지를 보내 기능을 구현할 수 있습니다.

## 관련 문서
사용자 ID, 사용자 레벨, 기록 메시지, 온라인 사용자 수 표시와 같은 더 많은 라이브 룸 기능을 구현하려면 [라이브 룸 구축 가이드](https://www.tencentcloud.com/document/product/1047/49589#.E4.BA.8C.E3.80.81.E7.9B.B4.E6.92.AD.E9.97.B4.E5.90.84.E5.8A.9F.E8.83.BD.E5.BC.80.E5.8F.91.E6.8C.87.E5.BC.95)를 참고하십시오.