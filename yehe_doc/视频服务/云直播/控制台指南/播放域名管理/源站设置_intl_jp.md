## 操作シナリオ

自社で構築したオリジンサーバーとライブストリーミングソースコンテンツがあり、かつTencent Cloud経由でライブストリーミングを再生したい場合、またはMediaPackageに接続済みで、LVB CDN経由でのライブストリーミング配信を希望している場合は、LVBオリジンサーバー設定機能によってback-to-originし、ライブストリーミングコンテンツをプルすることができます。設定を成功させると、LVB経由で、独自のオリジンサーバーまたはMediaPackageにback-to-originしてライブストリーミングをプルし、コンテンツを配信することができるようになります。ここでは、オリジンサーバー情報の設定方法をお伝えします。

## 注意事項

-  関連情報の設定後、オリジンサーバー設定は、**30分**-**1時間**前後で有効になります。
-  オリジンサーバー設定機能が有効になると、当該再生ドメイン名は、StreamNameによるその他プッシュドメイン名とのマッチングでプルを行うことができなくなります。また当該ドメイン名でのウォーターマーク、トランスコーディング、レコーディング、スクリーンキャプチャ、ポルノ検出等の機能も利用できなくなります。 

## 前提条件

-  [LVBコンソール](https://console.cloud.tencent.com/live)にログイン済みであること。
- ライブストリーミングオリジンサーバーを構築済み、またはMediaPackageでチャンネルを作成済みであること。
- **再生ドメイン名**を追加済みであること。

## 操作手順

1. [【Domain Management】](https://console.cloud.tencent.com/live/domainmanage)に入り、設定したい**再生ドメイン名**または右側の【管理】をクリックしてドメイン名詳細画面に入ります。
2. 【高度な設定】を選択し、【オリジンサーバー設定】のタブを見ます。
3. オリジンサーバー設定モジュールの【編集】をクリックし、【オリジンサーバー設定】のスライドスイッチをオンにします。【オリジンサーバーのタイプ】を選択し、オリジンサーバー情報の設定を開始します。
 - **選択したオリジンサーバーのタイプが【ライブストリーミングオリジンサーバー】**の場合
		1. 【back-to-originプロトコル】を選択し、【再生プロトコル】にチェックを入れます。
		2. 【オリジンサーバーアドレスip/domain】を選択します。IPアドレス選択またはドメイン名選択の2種類のモードをサポートしています。
		3. 選択したipアドレスまたはドメイン名にもとづき、対応する【マスターソースアドレス】を入力します。
        ![](https://main.qcloudimg.com/raw/5e085f15c5cd0d09282774f40231301c.png)
  >?**back-to-originプロトコル**とは、LVBのback-to-originプルのときにサポートする形式を指します。**再生プロトコル**とはライブストリーミングのコンテンツをLVB/CDN経由で配信する時の再生プロトコルを指します。
  >
  >- back-to-originプロトコルがFLV/RTMPのとき、再生プロトコルはFLV/HLSをサポートします。
  >- back-to-originプロトコルがHLSのとき、再生プロトコルはHLSのみサポートします。
  >- back-to-originプロトコルは複数選択不可、再生プロトコルは複数選択が可能です。

   - **選択したオリジンサーバーのタイプが【MediaPackage】の場合**
     1. MediaPackageにLVBへのアクセス権限が与えられていない場合は、【サービス権限の付与】をクリックして操作権限を与えます。
     ![](https://main.qcloudimg.com/raw/43f726d167d7d5d1881fbb6902ee5660.png)
     2. MediaPackage機能を使用するには、MediaPackageリソースへのアクセス権限を許可する必要があります。【権限付与に進む】をクリックして、【ロール管理】に移動し、サービスのプリセットロールを作成して、MediaPackageに関連する権限を与えます。
     ![](https://main.qcloudimg.com/raw/a29b66065ef5c2af5bccc7c00be76404.png)
     3. 【権限付与に同意】をクリックし、MediaPackageに対するLVBアクセスのための権限付与を完了します。
     ![](https://main.qcloudimg.com/raw/8cd1d5175c0852fc6d96c52bbf185190.png)
     4. 権限付与に同意すると、オリジンサーバー設定ページに移動します。ここで、【権限付与の完了】をクリックします。
     ![](https://main.qcloudimg.com/raw/baaa2d4a8958b19cc33d1597d2440051.png)
     5. サービス権限付与が完了した後、MediaPackageのリージョンにチャンネルがない場合は、[リージョンを選択してチャンネルを作成](https://console.cloud.tencent.com/mdp/channel)します。チャンネル名を入力して、入力プロトコル（HLS/DASHをサポートしています）を選択し、HLS/DASHプロトコルの関連パラメータを入力します。【作成】をクリックしてチャンネル設定を保存し、引き続きオリジンサーバー設定を行います。
     ![](https://main.qcloudimg.com/raw/ebbcc77e970a6bd8b27421e3c84b6858.png)
		 ![](https://main.qcloudimg.com/raw/b4f1e27fa02c93b88a47a1de9a583ee9.png)
     6. チャンネルを作成すると、オリジンサーバー設定の中でMediaPackageの【リージョン】と【チャンネル】を選択できるようになります。
        ![](https://main.qcloudimg.com/raw/1cfce64cba34b65c9293a6f40d2109cd.png)
     >?
     >- back-to-originプロトコルがDASH / HLSのときは、CDNに設定を配布してサポートする必要があり、DASH、HLS設定ファイルのテンプレートを開発して提供する必要がありますが、コンソールでMediaPackageを選択して保存すると、デフォルトでCDNに設定が送信されます。
     >- MediaPackageでチャンネルを削除しても、バンドル関係は削除されていないため、ここには依然としてバンドル関係が表示されます。ただし正常にback-to-originすることはできません。
     >- リージョンの複数選択をサポートしていませんが、当該リージョン下で複数のチャンネルを選択することは可能です。back-to-originプロトコルと再生プロトコルはチャンネルに付随していますので、ユーザーが選択する必要はありません。

4. 【保存】をクリックすると設定が保存されます。
