자체 구축된 원본 서버와 라이브 스트리밍 소스가 있는 경우 CSS는 원본 서버에서 스트림을 가져와 콘텐츠를 배포할 수 있습니다. 본문은 CSS 콘솔에서 재생 도메인에 대한 원본 서버 정보를 구성하는 방법을 설명합니다.

## 주의 사항
-  원본 서버 구성은 구성이 완료된 후 약 1시간 후에 적용됩니다.
- 재생 도메인에 대해 원본 서버를 구성한 후에는 더 이상 StreamName을 지정하여 푸시 도메인을 재생 도메인에 바인딩할 수 없습니다. 재생 도메인에 대한 워터마크, 트랜스코딩, 녹화, 스크린샷 또는 음란물 감지 작업을 구성할 수도 없습니다. 

## 전제 조건
- [CSS 콘솔](https://console.cloud.tencent.com/live)에 로그인되어 있어야 합니다.
- 라이브 스트리밍 원본 서버가 구축되어 있어야 합니다.
- **재생 도메인 이름**이 추가되어 있어야 합니다.

## Origin-pull 구성
콘솔에서 기본 정보, 프로토콜, 호스트 등 도메인의 원본 서버 정보를 편집할 수 있습니다.
1. CSS 콘솔에서 왼쪽 사이드바의 [**도메인 관리**](https://console.cloud.tencent.com/live/domainmanage)를 선택합니다. **재생 도메인 이름**을 클릭하거나 오른쪽에서 **관리**를 클릭합니다.
2. 도메인 이름 옆에 있는 **원본 서버 모드**를 켭니다.
3. 원본 서버 모드가 이미 활성화된 경우 이 페이지에서 해당 설정을 수정할 수 있습니다.
![](https://qcloudimg.tencent-cloud.cn/raw/a5132b116946971febbefc1334c8fdaa.png)

## 구성
### 원본 서버 정보
| 원본 서버 정보   | 설명                                                         |
| ---------- | ------------------------------------------------------------ |
| 포워딩 프로토콜   | RTMP, HTTP-FLV, HLS 형식을 지원합니다.                          |
| HTTPS  | FLV 또는 HLS 프로토콜을 사용하는 경우 HTTPS를 활성화할 수 있습니다. <br>HTTPS를 활성화하면 포트 443이 사용됩니다. 리디렉션 이후 HTTPS도 지원됩니다. 포트 제한이 없습니다. |
| 기본 원본 서버 | 백업 원본 서버를 구성할 수도 있습니다. 주소가 폴링됩니다. IP 주소 또는 도메인일 수 있습니다.          |
| 백업 원본 서버 | 백업 원본 서버의 주소(선택 사항)입니다.                                         |

![](https://qcloudimg.tencent-cloud.cn/raw/0302a3257d93f247dd6ff9a70f779296.png)

### Host 헤더
FLV 또는 HLS 프로토콜을 사용하는 경우 원본 서버에서 가져올 때 CSS가 액세스하는 정확한 도메인을 지정하는 HTTP Host 헤더를 구성할 수 있습니다.

#### 참고 사항
원본 서버 주소와 Host 헤더의 차이는 다음과 같습니다.
 - 원본 서버 주소는 Origin-pull 요청이 전송되는 IP 주소입니다.
 - Host 헤더는 요청이 전송되는 원본 서버 주소의 도메인을 지정합니다.
 
#### 구성 예시
1.  재생 도메인 `xx001.elementtest.org`에 대해 다음과 같이 원본 서버가 구성됩니다.
![](https://qcloudimg.tencent-cloud.cn/raw/c5d4785c9d45d0bdda3b60ea23519a4c.png)
2.  원본 서버에서 풀링하는 프로세스는 다음과 같습니다.
사용자가 `http://xx001.elementtest.org/index.m3u8`을 열어 리소스에 액세스하면 리소스가 Tencent Cloud에 아직 캐시되지 않았기 때문에 CSS는 도메인 `test001.com`을 확인하여 원본 서버의 서버 주소를 가져옵니다. `1.1.1.1`이라고 가정합니다. CSS는 `1.1.1.1` 서버에 액세스하여 Web 서버 `test002.com`에서 index.m3u8 파일을 찾은 다음 리소스를 사용자에게 반환합니다.

### 리먹싱
RTMP 또는 HTTP-FLV 프로토콜을 사용하는 경우 HLS 리먹싱을 활성화할 수 있습니다. 다음은 RTMP, HTTP-FLV 및 HLS 주소의 형식입니다.
- RTMP: `rtmp://재생 도메인/AppName/StreamName`
- FLV: `http://재생 도메인/AppName/StreamName.flv`
- M3U8: `http://재생 도메인/AppName/StreamName.m3u8`

#### 참고 사항
-  M3U8 세그먼트 수: 기본적으로 3개입니다. 값 범위: 3개-10개.
-  HLS 세그먼트 크기: 기본적으로 3초입니다. 값 범위: 3초-10초. 생성된 실제 세그먼트는 GOP 크기보다 작지 않습니다.

<img src="https://qcloudimg.tencent-cloud.cn/raw/5230d04d0b13d1ce0e83dae55cbfe8b7.png" width=600>

### HTTP 구성
HLS 프로토콜을 사용하는 경우 More에서 다음 HTTP 기능을 구성할 수 있습니다.

| HTTP 관련 구성     | 설명                                                         |
| ---------------- | ------------------------------------------------------------ |
| 리디렉션       | 활성화하면 Tencent Cloud는 301/302 상태 코드를 캐시하지 않습니다. 원본 서버에서 301/302가 반환되면 Tencent Cloud는 요청된 리소스(최대 10개의 리디렉션)를 얻을 때까지 자동으로 리디렉션하고 리소스를 사용자에게 반환합니다. 사용자측은 리디렉션이 필요하지 않습니다. <br>리디렉션을 비활성화하면 Tencent Cloud는 301/302 상태 코드를 사용자 측에 반환하고 리소스를 가져오기 위해 리디렉션합니다. |
| 원본 서버 URL 매개 변수 통과  | 기본적으로 URL 매개변수는 전달되지 않습니다. 이를 활성화하면 Tencent Cloud 매개변수가 URL에 추가될 수 있습니다. |
| HTTP 요청 헤더 통과 | 기본적으로 HTTP 요청 헤더는 전달되지 않습니다. 헤더를 통과하도록 활성화할 수 있습니다. 중복 헤더(대소문자 구분 안 함)는 현재 지원되지 않습니다. |
| HTTP 응답 헤더 통과 | 기본적으로 HTTP 응답 헤더는 전달되지 않습니다. 헤더를 통과하도록 활성화할 수 있습니다. 중복 헤더(대소문자 구분 함)를 지원합니다. |

![](https://qcloudimg.tencent-cloud.cn/raw/4255b6cb743039ca7f38e8472ce0f87f.png)

### 캐시 구성
HLS 프로토콜을 사용하는 경우 More에서 리소스 캐시 시간을 구성할 수 있습니다. Tencent Cloud가 원본 서버(상태 코드 200)에서 요청된 리소스를 성공적으로 획득한 후 구성된 대로 인덱스 파일과 세그먼트를 캐시합니다.
<table id="setmess">
<tr><th width="14%">캐시 구성</th><th>설명</th>
</tr><tr>
<td>인덱스 파일 캐시 시간</td>
<td>원본 서버가 200 상태 코드를 반환할 때 인덱스 파일을 캐시하는 시간입니다. 기본 캐시 시간은 1000ms입니다. 설정할 수 있는 최대 시간은 60000ms입니다.
</ul></td>
</tr><tr>
<td>세그먼트 캐시 시간</td>
<td>원본 서버가 200 상태 코드를 반환할 때 ts/m4s/mp4 세그먼트를 캐시하는 시간입니다. 기본 캐시 시간은 1000ms입니다. 설정할 수 있는 최대 시간은 60000ms입니다.
</ul></td>
</tr><tr>
<td>상태 코드별 캐시 시간</td>
<td>원본 서버가 200이 아닌 상태 코드를 반환할 때 즉시 처리할 수 없거나, 이후의 모든 요청을 원본 서버로 전달하지 않으려면 상태 코드를 캐시하고 Tencent Cloud 노드로 사용자에게 직접 반환할 수 있습니다. 이를 통해 원본 서버의 부하를 줄일 수 있습니다.
<br>현재 파일 유형에 관계없이 다음 상태 코드를 캐시할 수 있습니다.
<li>4XX: 400, 403, 404, 405.</li>
<li>5XX: 500, 503, 504.</li>
</ul></td>
</tr></table>

![](https://qcloudimg.tencent-cloud.cn/raw/bce1ada7c00c5af0ec74bdd9a1bdd826.png)

### 원본 URL 재작성 구성
HLS 프로토콜을 사용하는 경우 More에서 URL 재작성을 구성할 수 있습니다.
Tencent Cloud를 사용하면 CSS가 가져오는 실제 URL을 원본 서버와 더 잘 일치하는 URL로 다시 작성할 수 있습니다. 현재는 URL 경로만 다시 작성할 수 있습니다.

#### 참고 사항
- **원본 URL**: 요청은 접두사로 일치합니다. 예를 들어 /test01을 입력하면 /test01 아래의 모든 요청에 재작성 규칙이 적용됩니다. 정규 표현식은 현재 지원되지 않습니다.
- **대상 URL**: 요청은 접두사로 일치됩니다. 예를 들어 /test01/test02를 입력하면 /test 아래의 모든 요청이 /test01/test02로 다시 작성됩니다. 정규 표현식은 현재 지원되지 않습니다.

![](https://qcloudimg.tencent-cloud.cn/raw/8251d53d1ef9a1ba170b161b730372f7.png)

#### 제한
- 각 재생 도메인에 대해 최대 10개의 재작성 규칙을 구성할 수 있습니다.
- 공백 및 다음 특수 문자는 지원되지 않습니다.: " ", "<", ">", """, "#", "{", "}", "|", "\", "^", "~", "[", "]", "&#96".
- 규칙을 재정렬하여 우선 순위를 조정할 수 있습니다. 상단에 있는 규칙일수록 우선 순위가 더 높습니다.

### 기타
| 아이템     | 설명                                                         |
| ------------ | ------------------------------------------------------------ |
| 타임아웃     | TCP 연결을 설정하기 위한 제한 시간입니다. 기본 시간은 10000ms이고 값 범위는 2000ms-60000ms입니다. 원본 서버 상황과 네트워크 상황에 따라 제한 시간을 설정하십시오. 제한 시간이 너무 짧으면 네트워크 문제로 인해 풀 요청이 실패했을 때 CSS가 원본 서버를 너무 자주 전환할 수 있습니다. 제한 시간이 너무 길면 CSS가 다른 원본 서버를 시도하기 전에 오랜 시간을 기다려야하므로 클라이언트 측에서 재생 실패가 발생할 수 있습니다. |
| 재시도 | 최대 재시도 횟수입니다. 여러 원본 서버 주소가 구성된 경우 요청이 실패하면 CSS는 다른 주소를 시도합니다. |
| 타임스탬프 수정   | RTMP 또는 FLV 프로토콜을 사용하는 경우 이 기능을 사용할 수 있습니다. <Br>기본적으로 타임스탬프는 전달됩니다. 이 기능을 활성화하면 CSS가 현재 프레임을 이전 프레임과 비교합니다. 둘 사이의 간격이 250ms를 초과하면 CSS는 이전 프레임의 타임스탬프에 10ms를 추가하고 그 결과를 현재 프레임의 타임스탬프로 사용합니다. |

![](https://qcloudimg.tencent-cloud.cn/raw/040fe72429056474df265bdcb44560ee.png)

