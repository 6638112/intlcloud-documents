Tencent Cloud CSSコンソールは、プルリレーツールを提供します。ライブストリーミングソースにプッシュ機能がない場合、またはオンデマンドのビデオコンテンツをライブストリーミングの形で配信する必要がある場合、プルリレーサービスはコンテンツをプルしプッシュする機能を提供します。CSSプッシュをせずに既存のビデオ/ライブストリーミングを素早くプルし、ターゲットアドレスにプッシュすることができます。
![](https://main.qcloudimg.com/raw/8f0b044ce2104efdc1ed835287b9b683.png)

##  前提条件
1. [Tencent CSSサービス](https://intl.cloud.tencent.com/product/css)をアクティブ化しており、CSSコンソールにログインしていること。
- [プッシュプルドメイン名](https://intl.cloud.tencent.com/document/product/267/35970)を追加済みであること。

## 注意事項
- 最大**20**のプルリレータスクを作成できます。
- プルリレーサービスを使用すると、**プルリレータスク時間請求書**が作成されます。料金の詳細については、[プルリレー課金説明](https://intl.cloud.tencent.com/document/product/267/41059)をご参照ください。
- プルリレー機能はコンテンツのプルサービスおよびプッシュサービスのみを提供します。**コンテンツの使用上に著作権の問題がなく、コンテンツ伝播に関する法規制に準拠していることを確認してください。著作権に問題があるまたはコンテンツが法規制に違反している場合、CSSは関連の機能サービス提供を停止し、法的責任を追及する権利を留保します**。
- プルリレーサービスは、**2022年11月23日0時**より課金を開始いたします。詳しくは、付加価値サービスの料金をご参照ください。

[](id:create)
## タスクの作成
1. **CSSツールボックス** > **[プルリレー](https://console.cloud.tencent.com/live/tools/relay)**を選択します。**タスク作成**をクリックして、プルリレータスクの作成ページに入ります。
![](https://qcloudimg.tencent-cloud.cn/raw/f41c7a329a9fed7a901bca252a973f35.png)
2. 設定するタスクの基本情報を入力します。設定は以下のとおり行います：
![](https://qcloudimg.tencent-cloud.cn/raw/d10fb06aba921e27791441a112039586.png)

<table>
<tr><th width=15%>設定項目</th><th>設定説明</th></tr>
<tr>
<td>タスク備考</td>
<td>タスクの備考を入力します。</td>
</tr><tr>
<td>タスク時間</td>
<td>デフォルトでは、<code>現在の時刻</code>から<code>現在の時刻 + 24時間</code>までとします。選択可能なタスク時間は、現在の時刻を起点として1年以内の任意の時刻からその先の7日以内の範囲です。<br>現在の時刻を2021年03月24日11:50:01とすれば、：<ul style="margin:0"><li/>選択可能な時間は2022年03月24日11:50:01から2022年03月30日11:50:01までとなり、<li/>終了時刻が2022年03月30日11:50:01を超えることはできません。</ul></td>
</tr><tr>
<td>イベントコールバック通知</td>
<td>プルリレータスクイベントの受信に使用するコールバックアドレスを入力します。</td>
</tr></table>

3. コンテンツソースを入力します。リージョンを選択できます。
      - タスクの実行対象となるリージョンは以下を選択できます。中国国内の任意リージョン、華北地区（北京）、華東地区（上海）、華南地区（広州）、アジア太平洋地区東南部（シンガポール）、アジア太平洋地区東南部（バンコク）、アジア太平洋地区東北部（ソウル）、アジア太平洋地区南部（ムンバイ）、香港・マカオ・台湾地区（中国香港）。
      - 任意リージョンを選択すると、システムは自動的に最も近いリージョンを割り当てます。
      
4. コンテンツソースのタイプを選択します。選択可能なタイプには**ライブストリーミング**、**ビデオアドレスパス**、**画像**があります。具体的な設定は以下のとおりです：
   - コンテンツのタイプが**ライブストリーミング**の場合
     - ライブストリーミングのソースアドレスを入力します（コンテンツソースのアドレスを**1つ**だけ入力できます）。
   ![](https://qcloudimg.tencent-cloud.cn/raw/6795d964f41e63fa90f0c09e3ddcf060.png)
     - 「バックアップを有効にする」を選択できます。バックアップを有効にした場合、プライマリがコンテンツをプルできなければ、自動的にバックアップに切替てコンテンツをプルします。プライマリがリカバリーした後、手動でバックアップからプライマリに切り替えてください。バックアップは、単一ビデオのループ再生のみをサポートします。
     
   - コンテンツのタイプが**ビデオアドレスパス**の場合
      - **複数の**コンテンツソースアドレスを入力することができ、その上限は30です。
      
      - ループ再生の回数は設定可能で、**無限ループ**または**ループ回数の指定**を選択できます。ループ回数の指定範囲は1～100です。
      
      - ビデオアドレスパスにMP4フォーマットのビデオがある場合、ローカルモードをオンにすれば、タスクはMP4オンデマンドファイルをタスクノードにキャッシングしてリレーしし、MP4ファイルを滑らかに安定して再生できます。
      
      - ![](https://qcloudimg.tencent-cloud.cn/raw/cc30dc26f64d17f90f3e4fc76d2d9cd0.png)
      
    - コンテンツのタイプが**画像**の場合
       - 画像をアップロードするか画像のURLを入力できます。**プレビュー**をクリックすると画像が表示されます。
       - JPEG、JPG、PNG、BMP画像フォーマットをサポートします。URL入力の場合、画像のサイズが制限されません。アップロードする画像のサイズは2Mより小さくしてください。
       
         ![](https://qcloudimg.tencent-cloud.cn/raw/506182c6890e8f357177c78b190ff6db.png)  

>? 
>- タスクが設定したループ再生回数に達する場合、またはタスクの終了時間になった場合、プルリレータスクが停止します。
>- タスク情報を変更する場合
    - ループ回数を変更した場合、更新後に新たなループ回数で再生され、現在の再生タスクは1回として記録されます。
    - ビデオアドレスパスとループ回数を変更する場合、直ちに更新するか再生後に更新するかにもかかわらず、現在の再生タスクはループ回数に計上されず、新たなループ回数で再生されます。
    - ターゲットアドレスを変更した場合、ループ回数がリセットされます。
>- ローカルモードをオンにすること自体は追加料金が発生しません。ローカルにキャッシュされたMP4ファイルをリレーすると、ローカルファイルのリレー時間に応じて付加価値機能の料金が計算されます。

5. コンテンツを受信するターゲットアドレスを入力します。
   1. ターゲットアドレス入力欄下の**アドレスジェネレーター**をクリックし、アドレスジェネレーター設定ページに移動します。
   ![](https://qcloudimg.tencent-cloud.cn/raw/9724d77727e21ba1798485d03d6e3246.png)
   2. 既存のプッシュドメイン名を選択し、 Appname、StreamName および有効期間を入力します。**OK**をクリックし、プッシュアドレスを生成します。このアドレスはターゲットアドレス欄に自動的に入力されます。
   ![](https://qcloudimg.tencent-cloud.cn/raw/b1b6f0b832bacb15b281d71fc653afb0.png)
> !アドレスの有効期間をタスクの終了時間より以降に設定する必要があります。タスク開始後にターゲットプッシュアドレスを更新すれば、タスクが中断し改めてプッシュされます。

6.![](https://qcloudimg.tencent-cloud.cn/raw/b64d8a4343b3a1e340db3adb9002db60.png)ボタンをクリックし、ウォーターマークを有効にします。ウォーターマークは、png、jpg、gifフォーマットをサポートします。

 - ウォーターマークのタイプを選択します。カスタム画像アドレスと画像アップロードを選択できます。
   - **カスタム画像アドレス**を選択した場合、画像アドレスの入力ボックスにウォーターマーク画像のURLアドレスを入力し、プレビューをクリックすると、ウォーターマークプレビューに表示されます。
   - **画像アップロード**を選択した場合、画像をクリックで選択し、ウォーターマーク画像をアップロードします。視覚的な見やすさがアップするように、ウォーターマーク画像は、フォーマットがpngで、サイズが2Mより小さい透明画像を使用することをお薦めします。
 - ウォーターマーク画像の表示位置を設定します。以下の2種類の方法で位置を調整できます：
   - ウォーターマーク画像の設定欄上で画像をドラッグします。
   - 表示位置のX軸方向とY軸方向を設定します。
 - 保存をクリックすると、ウォーターマークの設定が完了します。
![](https://qcloudimg.tencent-cloud.cn/raw/a58673819adbc0d2dff5ecf25406816f.png)
>? 
>- コンテンツソースの情報を入力します。コンテンツソースが画像の場合、ウォーターマークの設定を有効にすることができません。
>- ウォーターマークを有効にすると、[トランスコーディング料金](https://intl.cloud.tencent.com/document/product/267/39604)が発生します。

7. 入力後に、**保存**をクリックして作成を完了します。


## タスクの管理
[](id:view)
### タスク詳細の確認
[タスクリスト](https://console.cloud.tencent.com/live/tools/relay)で、確認したいプルリレータスクを選択し、対応する`タスク備考/ ID`をクリックすると、右側のポップアップウィンドウにタスクの詳細情報が表示されます。
![](https://qcloudimg.tencent-cloud.cn/raw/c2bad33a6a735a218fa79b98f3738275.png)

>?タスクの詳細情報の下で編集、入力ソースの切替、再開、無効ボタンをクリックできます。

### タスク状態の確認
[タスクリスト](https://console.cloud.tencent.com/live/tools/relay)でタスクの状態を確認できます。確認したいプルリレータスクを選択し、対応する`タスクノート/ ID`をクリックすると、右側のポップアップウィンドウにこのタスクの実行状態が表示されます。

![](https://qcloudimg.tencent-cloud.cn/raw/cd498cb1fd678e39b0942383c278e82b.png)

<table>
<thead><tr><th>タスク状態</th><th>実行状態</th><th>意味</th></tr></thead>
<tbody><tr>
<td>開始されていない</td>
<td>非アクティブ</td>
<td>このタスクはまだタスク時間になっていません</td>
</tr><tr>
<td rowspan=2>有效</td>
<td>アクティブ</td>
<td>このタスクはタスク時間になり正常に動作しています</td>
</tr><tr>
<td>インアクティブ</td>
<td>このタスクはタスク時間になったが正常に動作していません</td>
</tr><tr>
<td>無効</td>
<td>非アクティブ</td>
<td>このタスクは無効になっています</td>
</tr><tr>
<td>期間切れ</td>
<td>非アクティブ</td>
<td>このタスクは終了時間を過ぎました</td>
</tr>
</tbody></table>



[](id:change)
### タスクの変更
1.  [タスクリスト](https://console.cloud.tencent.com/live/tools/relay) で、作成したプルリレータスクを選択し、右側の操作欄で**編集**をクリックして、プルリレータスクの編集ページに遷移します。
![](https://qcloudimg.tencent-cloud.cn/raw/a0a83bf06f9b5ae9743b68b19e4c40cd.png)
2. 必要に応じてタスク情報を変更し、**保存**をクリックします。
 > - リージョンおよびコンテンツタイプは変更できません。
 > - タスク終了時間を変更する場合、タスクが終了するまで、ターゲットアドレスが有効であることを確認してください。ターゲットアドレスを変更すると、タスクが中断して、最初から実行します。
 - ウォーターマークを変更した場合、ソースがライブストリーミングのタスクは直ちに反映され、ソースがオンデマンドライブストリーミングのタスクは次のファイルを再生する時に反映されます。ウォーターマークの変更により、再生中にカクカク動くことがあります。運用シーン：ウォーターマーク機能を備えていないサードパーティオリジンサーバーへのリレーに使用することをお薦めます。例えば、CSSにリレーする場合、CSSオリジンサーバーのウォーターマーク機能を使用することをお薦めします。
![](https://qcloudimg.tencent-cloud.cn/raw/d950a8029e1944e9029445dd8e428933.png)
3.  ポップアップしたタスク変更確認ページで、修正前後の比較情報を確認します：
   - 変更内容に**タスク備考、開始時間、終了時間、バックアップアドレス**が含まれた場合、例として比較情報に以下が表示されます：
![](https://qcloudimg.tencent-cloud.cn/raw/4cadcabeef99828ab4be144040cbfd19.png)
   - 変更内容に**ビデオアドレスパス**が含まれた場合、変更前のソースがカスタムビデオパスのコンテンツであることが表示され、更新方法として**再生中のビデオが終了した後に更新**/**直ちに更新**を選択することができます。選択しない場合、デフォルトでは**再生中のビデオが終了した後に更新**とします。更新後、新しい順番で最初からプルリレーを行います。
![](https://qcloudimg.tencent-cloud.cn/raw/9591b91b7e5e307860c9ea2244b4e14e.png)
    - 変更内容に**ターゲットアドレス**が含まれた場合、変更するターゲットアドレスが表示されます。変更を確認した後、実行中のプルリレータスクが**中断して再開**します。
![](https://qcloudimg.tencent-cloud.cn/raw/0a7e04f65ae8bbdd9cb7ef3bc0ece656.png)
4. 情報が正しいことを確認し、**OK**をクリックすると、タスクの内容が正常に変更されます。

[](id:copy)

### タスクのコピー
1.  [タスクリスト](https://console.cloud.tencent.com/live/tools/relay) で、コピーするプルリレータスクを選択し、右側の操作欄で**コピー**をクリックして、プルリレータスクの作成ページに移動します。
![](https://qcloudimg.tencent-cloud.cn/raw/28a0a3542ab9ab838d26dfc565f321d1.png)
2. 選択されているタスクの情報が新たに作成されたタスクページに入力されます。自動的に入力された情報を [変更](#create)できます。
3. **保存**をクリックすると、新たなプルリレータスクが作成されます。



[](id:reboot)
### タスクの再起動
タスクを再起動した後、タスクの**ステータスは変更されません**。実行中のタスクは**最初から実行を開始します**。タスクを再起動する具体的な操作は以下のとおりです：

1.  [タスクリスト](https://console.cloud.tencent.com/live/tools/relay)で、再起動するプルリレータスクを選択し、右側の操作欄で**再起動**をクリックします。
2. 実行中のプルリレータスクを再起動するかを確認し、**再起動**をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/d1b03e226297e44cbb7504d57c54af4f.png)

[](id:disable)
### タスクの無効化
タスクを無効にすると、**タスクは直ちに停止します**。タスクを再起動するには、[有効]（＃enable）にする必要があります。タスクを無効にしする具体的な操作は以下のとおりです：

1.  [タスクリスト](https://console.cloud.tencent.com/live/tools/relay)で、無効にするプルリレータスクを選択し、右側の操作欄で**無効**をクリックします。
2. 実行中のプルリレータスクを無効にするかを確認し、**無効**をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/c3acfb89f425b50ba53a8d63075091d8.png)


[](id:enable)
### タスクの有効化
タスクを有効にすると、**タスクは最初から実行します**。タスクを有効にする具体的な操作は以下のとおりです：

1.  [タスクリスト](https://console.cloud.tencent.com/live/tools/relay)で、有効にする、無効になっているプルリレータスクを選択し、右側の操作欄で**有効**をクリックします。
2. 実行中のプルリレータスクを有効にするかを確認し、**OK**をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/77417a9c8406fe9d763c4d3960d98b21.png)

[](id:delete)
### タスクの削除
削除したタスクは**復元できません**。タスクを削除する具体的な操作は以下のとおりです：

1.  [タスクリスト](https://console.cloud.tencent.com/live/tools/relay)で、削除するプルリレータスクを選択し、右側の操作欄で**削除**をクリックします。
2. 実行中のプルリレータスクを削除するかを確認し、**削除**をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/44a15ad52bfc81f62c0aa907cdc7eb5c.png)

[](id:batch)
### バッチ処理
プルリレーはタスクの一括削除、無効化および有効化をサポートします。バッチ処理では、**最大10のタスク**を処理できます。
1.  [タスクリスト](https://console.cloud.tencent.com/live/tools/relay)で、一括処理するプルリレータスクを選択します。
2. 一括に実行する処理を選択します。選択可能な処理には、**一括削除**、**一括無効**または**一括再起動**があります。
![](https://qcloudimg.tencent-cloud.cn/raw/7401eade6f5e04b9eadf71e04211f6e0.png)
3. 実行中のプルリレータスクを削除/無効化/有効化するかを確認し、ポップアップしたウィンドウで**削除**/**無効化**/**再起動**をクリックすると、一括処理が実行されます。
![](https://qcloudimg.tencent-cloud.cn/raw/5874636c548a4733281cd33eaca35abe.png)

   
## 期間が切れたタスクのクリアの設定

プルリレーは定時的にタスクをクリアする設定をサポートします。作成上限に達してタスクの作成に失敗することを防ぐために、タスクが終了時間になると期間切れの状態になります。削除したタスクは復元できません。

1. **CSSツールボックス** > **[プルリレー](https://console.cloud.tencent.com/live/tools/relay)**を選択し、**設定**をクリックします。
2.![](https://qcloudimg.tencent-cloud.cn/raw/7ed257d05a4283dc233ef406520187b4.png)ボタンをクリックして、定時クリアを有効にします。
3.必要に応じて、クリア間隔時間を変更します。選択できるクリア間隔時間は1～24時間です。
![](https://qcloudimg.tencent-cloud.cn/raw/4d579b1d0776ea22b5d994e3b7357ea3.png)

