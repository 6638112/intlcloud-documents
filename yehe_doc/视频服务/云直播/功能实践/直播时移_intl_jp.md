CSSタイムシフトは、CSSレコーディング機能に基づいて、TS（Transport Stream）セグメントアドレスとTSファイルを個別にVODシステムに保存します。クライアントはタイムシフト再生ドメイン名を使用して時間パラメータを受け取り、鮮明なビデオコンテンツを事前再生することが可能です。

## タイムシフトの原理

一般的なHLSビデオライブストリーミングでは、プッシュビデオコンテンツは複数のTSセグメントに分割されます。ユーザーは視聴時に、m3u8ファイルをリクエストすることによって、TSセグメントアドレスにアクセスし、TSファイルを取得して、ライブストリーミングコンテンツを視聴します。この場合、TSファイルコンテンツは永続的に保存されないため、ユーザーは現時刻より前のライブストリーミングビデオコンテンツを遡って再生することはできません。

## 注意事項

タイムシフト機能を有効にすると、VODのトラフィックとVODの保存費用が発生しますので、ご注意ください。
## タイムシフトの使用

### 前提条件

-   [Tencent Cloudアカウントの登録](https://intl.cloud.tencent.com/document/product/378/17985) でアカウントを作成済みであり、かつ身分認証が完了していること。身分認証を実施していないユーザーは中国国内のCSSインスタンスを購入できません。
- Tencent CSSサービスをアクティブ化し、[プッシュドメイン名](https://intl.cloud.tencent.com/document/product/267/35970)を追加済みであること。 

<span id="step1"></span>
### 手順1：VODサービスのアクティブ化

1. [VODコンソール](https://console.cloud.tencent.com/vod/overview)に移動し、【今すぐアクティブにする】を選択する。
2. サービスプロトコルのアクティブ化にチェックを入れ、【OK】を選択すると、ＶＯＤサービスは正常にアクティブ化し、VODコンソールにアクセス可能になります。
<span id="step2"></span>
### 手順2：タイムシフト再生ドメイン名の追加

タイムシフト再生に使用するVODドメイン名を追加する必要があります、具体的な操作は次のとおりです。

1. 【VODコンソール】>【配信再生管理】>【Domain Management】に移動します。
2. 【ドメイン名の追加】を選択し、ICP登録済みのVODドメイン名を入力します。具体的な操作については、 [配信再生設定](https://intl.cloud.tencent.com/document/product/266/35572)をご参照ください。
3. 新規追加ドメイン名のCNAME設定操作の完了。
<span id="step3"></span>
### 手順3：レコーディングテンプレートとの関連付け

1. 【CSSコンソール】>【機能テンプレート】>【[レコーディング設定](https://console.cloud.tencent.com/live/config/record)】に移動します。
2. 【+】を選択し、レコーディングテンプレートを作成します。具体的な操作については、 [レコーディングテンプレート設定](https://intl.cloud.tencent.com/document/product/267/34223)をご参照ください。
   > ! 
   > - レコーディングファイルタイプは **HLS** 形式を選択して、HLSレコーディングを開始します。
   > - ファイル保存時間をカスタマイズします。この時間を[タイムシフト時間](#step4)より短くすることはできません。
3. レコーディングテンプレートをプッシュドメイン名に関連付けて設定します。具体的な操作については、 [レコーディング設定](https://intl.cloud.tencent.com/document/product/267/34224)をご参照ください。

<span id="step4"></span>
### 手順4：タイムシフトサービスのアクティブ化

[チケットを提出](https://console.cloud.tencent.com/workorder/category?level1_id=29&level2_id=39&source=0&data_title=%E4%BA%91%E7%9B%B4%E6%92%AD%20%20CSS&step=1) し、 「CSS」を選択の上、タイムシフトサービスアクティブ化のリクエストを提出すると同時に、次のパラメータを送信します。

- [手順2](#step2) で追加済みのVOD**タイムシフト再生ドメイン名**。
- [手順3](#step3) のレコーディングテンプレートID。
- カスタマイズしたタイムシフト時間 `timeshift_dur`。単位：秒。
  > ? 
  > - タイムシフト時間：タイムシフトでコンテンツを視聴できる時間（現在、タイムシフトで最長で7日以内のコンテンツを設定できます）。
  > - この項目は絶対的な精度を保証するものではありませんので、ニーズに応じて設定することを前提とし、時間に余裕を持たせることをお勧めします。
  > - 7200（2時間）に設定する場合：2時間前から現在までに生成されたコンテンツをリクエストできます（つまり、delayの相対的なタイムシフト時間を90秒～2時間とすることができます）。2時間より前に生成されたコンテンツは、ライブストリーミングコンテンツが存在しても、`HTTP 404`が返されます。 



## 再生リクエスト

### URL形式のリクエスト 

```
http://[Domain]/timeshift/[AppName]/[StreamName]/timeshift.m3u8?delay=xxx
```

### パラメータの説明

| パラメータ           | 説明                                                         |
| -------------- | ------------------------------------------------------------ |
| [Domain]       | 登録したタイムシフトサービスアクセスドメイン名、つまり、VODコンソールで追加した [タイムシフト再生ドメイン名](#step2)     |
| timeshift      | 固定フィールド。修正不要                                           |
| [AppName]      | アプリケーション名。アプリケーション名が `live`であれば、 `live`と入力してください           |
| [StreamName]   | ストリーム名。リクエストに対応するストリーム名 を入力してください                                |
| timeshift.m3u8 | 固定フィールド。修正不要                                           |
| delay          | 相対的なタイムシフト時間を意味し、単位は秒。現在、この値は90未満ですが、バックグラウンドで90に調整できます |

### 事例

現在のタイムシフトドメイン名を `testtimeshift.com`、タイムシフトアプリケーション名を `live`、ストリーム名を `SLPUrIFzGPE`とした場合、このアドレスの5分前のライブストリーミングコンテンツをタイムシフトしたい場合は、次のURLをリクエストします。

```
http://testtimeshift.com/timeshift/live/SLPUrIFzGPE/timeshift.m3u8?delay=300
```
