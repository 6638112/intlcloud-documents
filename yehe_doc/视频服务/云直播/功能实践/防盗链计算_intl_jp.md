
ホットリンク防止は、プッシュURLと再生URLのtxSecretフィールドを参照します。攻撃者がバックエンドを偽造してプッシュURLを生成したり、利益のために再生アドレスを不正に盗用したりすることを防ぐ機能があります。

## セキュリティ原理
下図に示すとおり、攻撃者がサーバーを偽造してプッシュおよび再生URLを生成するのを防止するために、CSS管理コンソールでホットリンク防止暗号化KEY（攻撃者に入手されないよう安易に開示しないでください）を設定し、攻撃者が有効なプッシュと再生URLを容易に生成できないようにします。
![](https://main.qcloudimg.com/raw/ea3a932bd9e4e35fc95560cfbc4b3241.jpg)

## 計算プロセス
### 手順1：認証キー
まず、公式サイトのコンソールで暗号化キーを設定する必要があります。この暗号化キーはサーバーでホットリンク保護署名を生成するために使用されます。Tencent Cloudは同じキーを保有しているため、生成されたホットリンク保護署名を復号化して確認できます。

 暗号化キーは、プッシュホットリンク保護KEYまたは再生ホットリンク保護KEYに区分され、前者はプッシュホットリンク保護URLの作成に使用され、後者は再生ホットリンク保護URLの生成に使用されます。【CSSコンソール】>[【Domain Management】](https://console.cloud.tencent.com/live/domainmanage)に移動し、対応するドメイン名または【管理】をクリックし、【プッシュ設定】を選択すると、下図のようなプッシュホットリンク保護KEYが自動的に設定されます。
![](https://main.qcloudimg.com/raw/0833ac9f646507a3bf1f288709dddd20.png)

再生ホットリンク保護KEY の関連情報については、[再生ホットリンク保護はどのように有効化するのですか？ ](https://intl.cloud.tencent.com/document/product/267/35598)をご参照ください。 

### 手順2 ： txTimeの生成
署名のプレーンテキスト部分はtxTimeであり、このリンクの有効期限を意味します。例えば、現在の時刻が2018-12-29 11:13:45であり、新たに生成するURLを3時間後に無効にしたい場合は、txTimeを2018-12-29 14:13:45と設定することができます。
ただし、このように長い時間文字列をURL に含めることは明らかに不合理であり、実際の使用においては、2018-12-29 14:13:45をUNIX タイムスタンプ1546064025（別の言語で時間関数を直接呼び出して変換処理することもできます）に変換し、その後、16進数文字列に変換して長さをさらに短縮します。つまり、 txTime = 1546064025（10進数） = 5C271099（16進数）であり、10進数の使用もサポートされています。

>!
>- 実際の最終終了時間は `txTime + 認証有効期間` であり、認証有効期間の変更はURLの生成に影響しません。 
>- 設定する txTime の期限切れまでの時間は長すぎず、また短すぎないことを推奨します。
	- 期限切れまでの時間が短すぎると、キャスターがライブストリーミング中にネットワークが途切れた場合に、プッシュURLの期限切れによってプッシュを再開することができません。
	- 期限切れまでの時間が長すぎると、プッシュが盗用されるリスクがあります。

### 手順3： txSecretの生成
txSecret の生成方法は = MD5（KEY + StreamName + txTime）です。ここでのKEYは第1ステップで設定した暗号化KEYです。 StreamName（ストリームIDとも呼ばれ、ランダムな数字またはユーザーIDを使用することを推奨します）は、この例ではtestであり、txTimeは直前のステップで計算された5C271099です。MD5は標準的な単方向不可逆MD5ハッシュアルゴリズムです。
例：
```
KEYはe12c46f2612d5106e2034781ab261ca3
したがって、 txSecret = MD5（e12c46f2612d5106e2034781ab261ca3test5C271099） = f85a2ab363fe4deaffef9754d79da6fe
```

### 手順4：ホットリンク防止アドレスの作成
Tencent Cloudの仕様に準拠するプッシュURLは、次の4つの部分で構成されます。
![](https://main.qcloudimg.com/raw/679602c838e8dfd3b61acefebb221d13.jpg)
このようにURLの期限切れまでの時間をTencent Cloudに通知するために使用できるプッシュ（または再生）txTimeが生成され、Tencent Cloudだけが復号化し検証できるtxSecret、StreamNameおよびプッシュドメイン名（`livepush.tcloud.com`の場合）であることから、標準的なURLを連携させることができます。この例のプッシュURLは次のとおりです：
```
rtmp://livepush.tcloud.com/live/test?txSecret=f85a2ab363fe4deaffef9754d79da6fe&txTime=5C271099
```


## プッシュサンプルコード
【CSSコンソール】>[【Domain Management】](https://console.cloud.tencent.com/live/domainmanage)で、事前に設定されたプッシュドメイン名を選択すると、【管理】>【プッシュ設定】ページの下半分にホットリンク保護アドレスの生成方法を示す【プッシュアドレスサンプルコード】（PHPとJavaの両バージョン）が表示されます。
