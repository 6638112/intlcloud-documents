## 라이브 방송 캡슐화 기능

라이브 방송 캡슐화 기능이란 라이브 방송 현장에서 푸시된 원본 스트림(일반적으로 RTMP 프로토콜을 사용하여 클라우드로 푸시)을 클라우드에서 다양한 캡슐화 포맷의 비디오 스트림으로 전환해 시청자에게 푸시하는 기능입니다. 퓨어 오디오 또는 퓨어 비디오 출력 기능도 제공하며, 다양한 DRM 암호화 솔루션을 지원해 디지털 저작권 관리 니즈를 충족시켜 줍니다.

 ### 캡슐화 출력 지원 포맷

-  RTMP
-  FLV
-  HLS
-  DASH
-  HDS
-  TS 스트림


 ### 미디어 지정 선택 출력 지원

- 퓨어 오디오 출력: 비디오 미디어를 삭제하고 오디오 미디어만 출력하며, 캡슐화 포맷은 위와 같습니다.
- 퓨어 비디오 출력: 오디오 미디어를 삭제하고 비디오 미디어만 출력하며, 캡슐화 포맷은 위와 같습니다.


 ### 미디어 암호화 솔루션 지원

- **Fairplay**
  HLS 캡슐화는 Apple fairplay drm 솔루션을 지원합니다.
- **Widevine**
  DASH 캡슐화는 Google widevine drm 솔루션을 지원합니다.
- **HLS 범용 Aes-128 암호화**
  HLS 캡슐화는 범용 Aes-128을 사용한 암호화 솔루션을 지원합니다.


## 라이브 방송 트랜스 코딩 기능

라이브 방송 트랜스 코딩 기능(비디오 트랜스 코딩 및 오디오 트랜스 코딩 포함)이란 라이브 방송 현장에서 푸시된 원본 스트림을 클라우드에서 다양한 인코딩 포맷, 해상도, 비트 레이트의 트랜스 코딩 스트림으로 전환하여 시청자에게 푸시하는 기능으로, 다양한 네트워크 환경 및 단말 디바이스 등의 시나리오에서 재생 니즈를 충족시켜 줍니다.

 ### 일반 응용 시나리오 예시

- 원본 비디오 스트림을 다양한 해상도의 트랜스 코딩 스트림으로 전환하여 사용자가 자신의 네트워크 상황에 따라 다양한 비트 레이트의 비디오 스트림을 선택하여 재생할 수 있어 더욱 원활한 재생이 가능합니다.
- 원본 비디오 스트림에 공식 사용자 정의 워터마크를 넣어 비디오에 고유한 마크를 추가함으로써 저작권을 표시할 수 있으며 홍보 마케팅 효과도 얻을 수 있습니다.
- 비디오 스트림을 인코딩 압축률이 더 높은 비디오 인코딩 포맷으로 전환할 수 있습니다. 예를 들어 시청자 수가 비교적 많은 상황인 경우, 원본 인코딩 포맷이 H264인 비디오 스트림을 압축률이 더 높은 H265 비디오 스트림으로 전환하여 대역폭을 감소시킴으로써 비용 절감 효과를 얻을 수 있습니다.
- 원본 비디오 스트림을 다른 인코딩 포맷으로 전환하여 특수 단말에서의 재생 니즈에 적용할 수 있습니다. 예를 들어 일부 특수 시나리오에서 H264 비디오를 디코딩하면 성능 문제로 실시간 재생을 할 수 없는데, 이 때 원본 H264 스트림을 Mpeg 인코딩 포맷의 비디오로 전환하면 해당 단말에서 실시간으로 디코딩해 재생할 수 있습니다.

<span id="arameter"></span>

 ### 비디오 트랜스 코딩 매개변수

<table>
    <tr><th width="20%">매개변수 유형</th><th width="80%">설명</th></tr>
    <tr>
        <td>비디오 인코딩 방식</td>
        <td>다음과 같은 비디오 인코딩 포맷을 지원합니다.<ul style="margin:0px;">
            <li>H264</li>
            <li>H265</li>
            </ul>
        </td>
    </tr><tr>
        <td>비디오 인코딩 등급</td>
        <td>다음 3가지 인코딩 등급을 지원합니다.<ul style="margin:0px;">
            <li>Baseline</li>
            <li>Main</li>
            <li>High</li>
            </ul></td>
    </tr><tr>
        <td>비디오 인코딩 비트 레이트</td>
        <td><ul style="margin:0px;">
            <li>비디오 출력 비트 레이트 지원 범위: 50kbps - 10Mbps. </li>
            <li>지정된 출력 비트 레이트가 입력 원본 비트 레이트 보다 큰 경우, 출력 비트 레이트를 원본 비트 레이트로 유지합니다. 예를 들어 지정된 출력 비트 레이트가 3000kbps인데 원본 입력 스트림의 비트 레이트는 2000kbps 밖에 되지 않는 경우, 출력 비트 레이트는 2000kbps로 유지됩니다. </li>
            </ul></td>
    </tr><tr>
        <td>비디오 인코딩 프레임 레이트</td>
        <td><ul style="margin:0px;">
            <li>비디오 출력 프레임 레이트 지원 범위: 1fps - 60fps. </li>
            <li>지정된 출력 프레임 레이트가 입력 원본 프레임 레이트 보다 큰 경우, 출력 프레임 레이트를 원본 프레임 레이트로 유지합니다. 예를 들어 출력 프레임 레이트가 30fps인데 원본 입력 스트림의 프레임 레이트가 20fps 밖에 되지 않는 경우, 출력 프레임 레이트는 20fps로 유지됩니다. </li>
            </ul></td>
    </tr><tr>
        <td>비디오 해상도</td>
        <td><ul style="margin:0px;" >
            <li>너비 지원 범위: 128 - 4096. </li>
            <li>높이 지원 범위: 128 - 4096. </li>
            <li>너비 단독 지정을 지원하며, 높이는 너비 비율에 따라 축소/확대됩니다. </li>
            <li>높이 단독 지정을 지원하며, 너비는 높이 비율에 따라 축소/확대됩니다. </li>
            </ul></td>
    </tr><tr>
        <td>비디오 GOP 길이</td>
        <td>비디오 GOP 길이 지원 범위: 1-10초, 일반적으로 2-4초를 권장합니다. </td>
    </tr><tr>
        <td>비디오 비트 레이트 제어 방법</td>
        <td>비디오 비트 레이트 제어 방법은 다음 두 가지 방법을 지원합니다. <ul style="margin:0px;">
            <li>고정 비트레이트(CBR). </li>
            <li>동적 비트레이트(VBR). </li>
            </ul></td>
    </tr><tr>
        <td>비디오 화면 회전</td>
        <td>원본 비디오 화면을 시계 방향의 3가지 각도로 회전할 수 있습니다.<ul style="margin:0px;">
            <li>시계 방향으로 90도 회전. </li>
            <li>시계 방향으로 180도 회전. </li>
            <li>시계 방향으로 270도 회전. </li>
            </ul></td>
    </tr>
</table>


 ###  오디오 트랜스 코딩 매개변수 소개


<table>
    <tr><th width="20%">매개변수 유형</th><th width="80%">설명</th></tr>
    <tr>
        <td>오디오 인코딩 방식</td>
        <td>다음과 같은 인코딩 규격을 지원합니다.<ul style="margin:0px">
                        <li>AAC-LC</li>
                        <li>AAC-HE</li>
                        <li>AAC-HEV2</li>
            </ul></td>
    </tr>
    <tr>
        <td>오디오 샘플링 레이트</td>
        <td>다음과 같이 자주 사용하는 샘플링 레이트를 지원하며, 가장 많이 사용되는 샘플링 레이트는 48000과 44100입니다.
                <ul style="margin:0px">
                    <li>96000</li>
                    <li>64000</li>
                    <li>48000</li>
                    <li>44100</li>
                    <li>32000</li>
                    <li>24000</li>
                    <li>16000</li>
                    <li>12000</li>
                    <li>8000</li>
                </ul>
                </td>
    </tr>
    <tr>
        <td>오디오 인코딩 비트 레이트</td>
        <td>오디오 비트 레이트 지원 범위: 20kbps - 192kbps, 자주 사용되는 오디오 비트 레이트는 다음과 같습니다.
                <ul style="margin:0px">
                    <li>48kbps</li>
                    <li>64kbps</li>
                    <li>128kbps</li>
                    </ul></td>
    </tr>
    <tr>
        <td>오디오 사운드 채널 수</td>
        <td>오디오는 다음과 같은 사운드 채널 수를 지원합니다.
                <ul style="margin:0px">
                    <li>싱글 사운드 채널</li>
                    <li>듀얼 사운드 채널</li>
                    </ul></td>
</tr></table>




 ### 자주 사용하는 비디오 트랜스 코딩 사전 설정 템플릿

| 해상도 | 템플릿 이름 | 비디오 해상도        | 비디오 비트 레이트 | 비디오 프레임 레이트 | 비디오 인코딩 포맷 |
| ------ | -------- | ----------------- | -------- | -------- | ------------ |
| 원활   | 550      | 비율에 따라 축소/확대 * 540  | 500kbps  | 23       | H264         |
| SD   | 900      | 비율에 따라 축소/확대 * 720  | 1000kbps | 25       | H264         |
| HD   | 2000     | 비율에 따라 축소/확대 * 1080 | 2000kbps | 25       | H264         |

## 고속 HD 트랜스 코딩 기능

Tencent 비디오 클라우드의 다년간 축적된 멀티미디어 인코딩 기술, 스마트 시나리오 식별, 동적 인코딩 기술, CTU/라인/프레임의 3단계 비트 레이트 정밀 제어 모델을 기반으로, 라이브 방송 및 VOD 등의 분야에 더 낮은 비트 레이트(평균 30% 이상 절약)를 제공해 더욱 선명한 스트림 미디어 서비스를 제공합니다.

### 시나리오 예시

라이브 방송 푸시 스트리밍 비트 레이트가 높고 화면이 복잡한 경우, 스마트 동적 기술과 비트 레이트 정밀 제어 모델을 적용해 고화질의 낮은 비트 레이트를 구현하고 동등한 수준의 화질을 보장합니다.

### 기능 및 장점

현재 각 비디오 플랫폼 사용자의 비디오를 원본 해상도로 보고자 하는 수요가 날로 높아짐에 따라 라이브 방송 업계에서는 1080P, 비트 레이트 3Mbps - 10Mbps가 주요 설정값이 되는 추세입니다. 이에 따라 대역폭 비용이 비디오 플랫폼 예산의 큰 부분을 차지하게 되었습니다. 따라서 비디오 비트 레이트를 낮추면 대역폭 비용 절감 효과를 얻을 수 있습니다.
**예시: **
LVB 비트 레이트 3Mbps, 라이브 방송 시간 4시간, 시청자 수 200명, 인코딩 방식 H.264 사용, 해상도 1080P, 고속 HD 트랜스 코딩 미사용 시, [라이브 방송 가격 계산기](https://buy.cloud.tencent.com/price/lvb/calculator)로 계산한 대역폭 비용은 127.08USD입니다.

- 고속 HD 트랜스 코딩을 사용해 비트 레이트를 낮추는 경우, 발생하는 대역폭 비용은 약 127.08 X (100% - 30%) = 88.956USD입니다.
- 고속 HD 트랜스 코딩을 사용해 발생하는 비용은 0.0443 × 240 = 10.632USD(정가, 할인 미적용)입니다.
- 총 비용은 88.956 + 10.632 = 99.588USD입니다.

따라서 고속 HD 트랜스 코딩은 사용자에게 더 우수한 품질의 시청 체험을 제공할뿐만 아니라 플랫폼의 대역폭 비용을 효과적으로 절감해 줍니다.

### 주요 매개변수

고속 HD 트랜스 코딩과 표준 트랜스 코딩의 매개변수 설정 방법은 기본적으로 동일하며 [비디오 트랜스 코딩 매개변수](#parameter)를 참조하십시오.



## 라이브 방송에 워터마크 추가 기능 소개

비디오 스트림 워터마크 추가 기능이란 원본 스트림을 기반으로 비디오 화면에 사전 설정된 다양한 마크 이미지를 넣는 것으로, 비디오에 고유의 마크를 추가함으로써 저작권을 표시할 수 있으며 홍보 마케팅 효과도 얻을 수 있습니다.

### 워터마크 관련 매개변수
워터마크의 주요 매개변수에는 워터마크 위치 및 워터마크 크기가 있으며, 워터마크 위치 및 크기는 XPosition, YPosition, Width, Height 매개변수로 결정되고, 해당 매개변수의 의미는 다음과 같습니다.
- **XPosition**: X축 오프셋으로, 워터마크의 왼쪽과 비디오 왼쪽 변이 X축을 따라 움직인 백분율 거리입니다.
- **YPosition**: Y축 오프셋으로, 워터마크의 상단과 비디오 상단 변이 Y축을 따라 움직인 백분율 거리입니다.
- **Width**: 워터마크 너비로, 라이브 방송 원본에서 차지하는 너비 백분율입니다.
- **Height**: 워터마크 높이로, 라이브 방송 원본에서 차지하는 높이 백분율입니다.

![](https://main.qcloudimg.com/raw/b7341cfb465aae7a59ff24ca6abeecb2.png)

>! 한 스트림에 여러 비트 레이트의 트랜스 코딩을 활성화한 상태에서(즉, 원본 스트림 1개를 여러 해상도의 트랜스 코딩 스트림으로 전환하는 경우) 워터마크를 추가해야 하는 경우, [CSS 콘솔](#W_control) 또는 [API](#W_api)에서 X축, Y축 백분율 위치를 설정할 수 있으며, 시스템에서 자동으로 워터마크 위치를 적용합니다.

### 워터마크 매개변수 예시

비디오 출력 화면이 1920x1080이고 워터마크 크기가 320x240이며, 백분율 계산 방식을 사용해 XPosition = 5, YPosition = 5, Width = 10인 경우,
비디오 출력 화면 해상도에 따라 계산되는 워터마크의 절대 위치와 크기는 다음과 같습니다.
```
XPosition_pixel = 1920 * 5% = 96
YPosition_pixel = 1080 * 5% = 54
Width_pixel = 1920 * 10% = 192
Height_pixel = 192 * 240 / 320 = 144
```

따라서 워터마크는 출력되는 비디오 화면 왼쪽 변에서 96픽셀, 상단 변에서 54픽셀 떨어진 곳에 위치하며, 워터마크 크기는 192픽셀 * 144픽셀이 됩니다.

### 사용 방법 개요
워터마크는 두 가지 방법으로 추가할 수 있으며, [CSS 콘솔](#W_control) 또는 [서버 API](#W_api)를 통해 추가할 수 있습니다. 사용자의 비즈니스 니즈에 따라 적합한 방식을 선택할 수 있습니다.

<span id="W_control"></span>
#### 라이브 방송 콘솔
1. [기능 설정]>[[라이브 방송 워터마크](https://console.cloud.tencent.com/live/config/watermark)] 페이지로 이동해 워터마크 설정 템플릿을 추가하여 워터마크 관련 매개변수를 설정하고, 해당 워터마크 템플릿 ID를 생성합니다. 자세한 작업 방식은 [라이브 방송 워터마크](https://intl.cloud.tencent.com/document/product/267/31073)를 참조 바랍니다.
2. [[도메인 관리]](https://console.cloud.tencent.com/live/domainmanage)에서 작업이 필요한 푸시 도메인에 대해, [관리]>[템플릿 설정]을 클릭하여 해당 도메인을 워터마크 템플릿과 연결합니다. 자세한 작업 방식은 [워터마크 설정](https://intl.cloud.tencent.com/document/product/267/31064)을 참조하십시오.

<span id="W_api"></span>
#### API 호출
1 [AddLiveWatermark](https://intl.cloud.tencent.com/document/product/267/30826) 워터마크 추가 인터페이스를 호출하여 워터마크 이름 및 매개변수 정보를 설정합니다.
2 [CreateLiveWatermarkRule](https://intl.cloud.tencent.com/document/product/267/30825) 워터마크 생성 규칙을 호출하여 푸시 도메인의 DomainName과 WatermarkId(1단계로 돌아가기) 매개변수를 설정합니다. AppName과 푸시 스트리밍 및 재생 주소의 AppName은 동일해야 하며, 기본값은 `live`입니다.

>! 워터마크 추가 기능을 사용하는 경우 표준 트랜스 코딩 비용이 발생합니다.



##  트랜스 코딩 매개변수 설정 사용 방법

### 사용 방법 개요

트랜스 코딩 매개변수는 두 가지 방법으로 설정할 수 있으며, [CSS 콘솔](#T_control) 또는 [서버 API](#T_api)를 통해 설정할 수 있습니다. 두 가지 방법 모두 주로 워터마크 템플릿, 트랜스 코딩 템플릿, 트랜스 코딩 규칙과 관련된 작업을 포함합니다.

<span id="T_control"></span>
#### 라이브 방송 콘솔
1. [기능 설정]>[[라이브 방송 트랜스 코딩](https://console.cloud.tencent.com/live/config/transcode)]으로 이동하여 트랜스 코딩 설정 템플릿을 추가합니다. [표준 트랜스 코딩](https://intl.cloud.tencent.com/document/product/267/31071), [고속 HD 트랜스 코딩](https://intl.cloud.tencent.com/document/product/267/31071), [퓨어 오디오 트랜스 코딩](https://intl.cloud.tencent.com/document/product/267/31071) 템플릿 추가를 지원합니다.
2. 필요에 따라 해당 트랜스 코딩 유형을 생성하고 트랜스 코딩 관련 매개변수를 설정합니다. 시스템의 기본 매개변수를 사용하여, 해당하는 트랜스 코딩 템플릿 ID를 생성할 수도 있습니다.
2. [[도메인 관리]](https://console.cloud.tencent.com/live/domainmanage)에서 작업이 필요한 풀 스트림 도메인을 선택해 [관리]>[템플릿 설정]을 클릭하여 해당 도메인과 트랜스 코딩 템플릿을 연결합니다. 자세한 작업 방식은 [트랜스 코딩 설정](https://intl.cloud.tencent.com/document/product/267/31062)을 참조하십시오.

<span id="T_api"></span>
#### API 호출

1. [CreateLiveTranscodeTemplate](https://intl.cloud.tencent.com/document/product/267/30790)을 호출하여 트랜스 코딩 템플릿 인터페이스를 생성하고 트랜스 코딩할 유형의 매개변수 정보를 설정합니다.
2. [CreateLiveTranscodeRule](https://intl.cloud.tencent.com/document/product/267/30791)을 호출하여 트랜스 코딩 규칙을 생성하고, 매개변수 풀 스트리밍 도메인 DomainName과 TemplateId(1단계로 돌아가기)를 설정합니다. AppName 및 StreamName에 빈 문자열을 입력하여 해당 도메인 이름으로 된 모든 풀 스트림의 트랜스 코딩이 글로빙(globbing)됨을 표시합니다. 트랜스 코딩 템플릿을 다양한 스트림 이름과 연결하여 특정 라이브 방송 스트리밍에 트랜스 코딩 효과를 적용할 수 있습니다.
3. 모든 트랜스 코딩 템플릿에는 각각의 **고유**한 **트랜스 코딩 템플릿 이름**이 있으며, 트랜스 코딩 템플릿 이름은 재생 트랜스 코딩 스트림의 유일한 식별자가 되어, 트랜스 코딩 템플릿 이름을 재생 풀 스트림 주소의 스트림 ID 이름 뒤에 추가하면 해당하는 각종 트랜스 코딩 템플릿의 트랜스 코딩 스트림을 가져올 수 있습니다.

>! 트랜스 코딩 규칙은 주로 도메인 또는 스트리밍을 제어하여 트랜스 코딩 템플릿을 활성화하는 데 사용되며, 트랜스 코딩 규칙을 생성해야만 해당 재생 도메인에 상응하는 트랜스 코딩 템플릿을 불러와 적용할 수 있습니다. 트랜스 코딩 규칙을 생성하지 않고 트랜스 코딩 템플릿 이름을 그대로 사용하여 연결한 풀 스트림 주소는 유효하지 않습니다.



### 사용 방법 예시

```
재생 주소 = 재생 도메인 + 재생 경로 + 스트림 ID 이름_트랜스 코딩 템플릿 이름 + 인증 문자열
```
푸시 스트리밍의 스트림 ID가 1234_test라고 가정할 때, 다음 3개 주소를 통해 워터마크가 추가된 서로 다른 비트 스트림을 재생할 수 있습니다.

- **원본 스트림: **`http://liveplay.tcloud.com/live/1234_test.flv?인증 문자열`
- **SD 트랜스 코딩 스트림(워터마크 추가): **`http://liveplay.tcloud.com/live/1234_test_sd.flv?인증 문자열`
- **HD 트랜스 코딩 스트림(워터마크 추가): **`http://liveplay.tcloud.com/live/1234_test_hd.flv?인증 문자열`

>! 워터마크가 추가된 스트림 재생 시 해당하는 푸시 도메인에 워터마크 템플릿을 바인딩해야 합니다.

###  인터페이스 사용
- **콘솔을 통한 트랜스 코딩 템플릿 관리**:
   콘솔에서는 트랜스 코딩 템플릿의 조회, 추가, 수정 및 삭제를 지원합니다.
- **서버 API를 통한 트랜스 코딩 템플릿 관리**:
<table>
<tr><th>기능 모듈</th><th>API 인터페이스</th>
</tr><tr>
<td rowspan=8>라이브 방송 트랜스 코딩</td>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30790">트랜스 코딩 템플릿 생성</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30784">트랜스 코딩 템플릿 설정 수정</a></td></tr>
<tr><td><a href="https://intl.cloud.tencent.com/document/product/267/30786">개별 트랜스 코딩 템플릿 획득</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30785">트랜스 코딩 템플릿 리스트 획득</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30788">트랜스 코딩 템플릿 삭제</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30791">트랜스 코딩 규칙 생성</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30787">트랜스 코딩 규칙 리스트 획득</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30789">트랜스 코딩 규칙 삭제</a></td>
</tr><tr>
<td rowspan=4>라이브 방송 워터마크</td>
<td><a href="https://cloud.tencent.com/document/api/267/30154">워터마크 추가</a></td></tr><tr>
<td><a href="https://cloud.tencent.com/document/api/267/30150">워터마크 업데이트</a></td></tr><tr>
<td><a href="https://cloud.tencent.com/document/api/267/30153">워터마크 삭제</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30820">워터마크 리스트 조회</a></td>
</tr></table>