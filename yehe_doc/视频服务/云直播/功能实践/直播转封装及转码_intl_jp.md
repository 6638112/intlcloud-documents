## CSSカプセル化トランスコード機能

CSSカプセル化トランスコード機能とは、ライブストリーミングからプッシュされたオリジナルストリーム（通常はRTMPプロトコルを使用してクラウドにプッシュ）が視聴者にプッシュされる前にクラウドでさまざまなカプセル化形式のビデオストリームに変換されるプロセスです。

 ### サポートする出力カプセル化トランスコード形式

-  RTMP
-  FLV
-  HLS
-  DASH
-  HDS
-  TSストリーム


 ### サポートする出力メディア

- オーディオのみの出力：ビデオメディアを削除し、オーディオメディアのみを出力します。カプセル化形式は上述のとおりです。
- ビデオのみの出力：オーディオメディアを削除し、ビデオメディアのみを出力します。カプセル化形式は上述のとおりです。


 ### サポートするメディア暗号化スキーム

- **Fairplay**
  HLSカプセル化はApple fairplay drmソリューションをサポートしています。
- **Widevine**
  DASHカプセル化はGoogle widevine drmソリューションをサポートしています。
- **HLSユニバーサルAes-128暗号化**
  HLSカプセル化は、ユニバーサルなAes-128を使用した暗号化スキームをサポートしています。


## CSSトランスコード機能

CSSトランスコード機能（ビデオトランスコーディングとオーディオトランスコーディングを含みます）とは、ライブストリーミングからリアルタイムでプッシュされたオリジナルストリームを視聴者にプッシュする前に、クラウドでさまざまなコーデック、解像度、ビットレートのトランスコードストリームに変換する機能です。各種インターネット環境、各種端末デバイスなど、各種シナリオでの再生ニーズを満たします。

 ### 一般的なユースケースの例

- 元のビデオストリームは、さまざまな解像度のストリームにトランスコードできます。ユーザーは、ネットワーク状態に応じてさまざまなビットレートのビデオストリームを選択し、スムーズに再生できます。
- 著作権表示とマーケティングのためにカスタマイズしたウォーターマークをオリジナルビデオストリームに挿入し、ビデオに独自のロゴを追加することができます。
- ビデオストリームを、元のエンコード形式がH264であるビデオストリームなど、さらに高い圧縮率のビデオコーデック形式に変換します。例えば、視聴する人数が多い場合は、H264のビデオストリームをさらに圧縮率の高いH265のビデオストリームに変換することによって、帯域幅とコストを節約できます。
- 特殊な端末の再生ニーズに対応するため、オリジナルビデオストリームを異なるコーデックに変換します。例えば、ある特殊なシナリオで、パフォーマンスの問題により、H264ビデオをデコードしてもリアルタイム再生できない場合は、元のH264ストリームをMpegコーデックのビデオに変換する必要があります。本手順を踏むことで、各種端末でリアルタイムのデコードと再生が利用できます。

<span id="arameter"></span>

 ### ビデオトランスコードパラメータ

<table>
    <tr><th width="20%">パラメータタイプ</th><th width="80%">説明</th></tr>
    <tr>
        <td>ビデオコーデック</td>
        <td>次のビデオコーデック形式をサポート：<ul style="margin:0px;">
            <li>H264</li>
            <li>H265</li>
            </ul>
        </td>
    </tr><tr>
        <td>ビデオプロファイル</td>
        <td>次の3種のプロファイルをサポート：<ul style="margin:0px;">
            <li>Baseline</li>
            <li>Main</li>
            <li>High</li>
            </ul></td>
    </tr><tr>
        <td>ビデオコーデックビットレート</td>
        <td><ul style="margin:0px;">
            <li>サポートするビデオ出力ビットレートの範囲：50kbps - 10Mbps。</li>
            <li>指定された出力ビットレートが入力オリジナルビットレートより大きい場合、出力ビットレートはオリジナルビットレートを維持します。例えば、指定された出力ビットレートが3000kbpsで、オリジナル入力ストリームのビットレートが2000kpbsしかない場合、出力ビットレートは2000kbpsを維持します。</li>
            </ul></td>
    </tr><tr>
        <td>ビデオコーデックフレームレート</td>
        <td><ul style="margin:0px;">
            <li>サポートするビデオ出力フレームレート範囲：1fps - 60fps。</li>
            <li>指定された出力フレームレートが入力オリジナルフレームレートより大きい場合、出力フレームレートはオリジナルフレームレートを維持します。例えば、指定された出力フレームレートが30fpsであり、オリジナル入力ストリームのフレームレートが20fpsしかない場合、出力フレームレートは20fpsを維持します。</li>
            </ul></td>
    </tr><tr>
        <td>ビデオ解像度</td>
        <td><ul style="margin:0px;" >
            <li>サポートする幅の範囲：128～4096。</li>
            <li>サポートする高さの範囲：128～4096。</li>
            <li>高さは幅に比例してスケーリングされます。</li>
            <li>幅は高さに比例してスケーリングされます。</li>
            </ul></td>
    </tr><tr>
        <td>ビデオGOP長さ</td>
        <td>サポートするビデオGOPの長さの範囲：1秒～10秒、通常、2秒～4秒を推奨。</td>
    </tr><tr>
        <td>ビデオビットレート制御方法</td>
        <td>次の2種のビットレート制御方法をサポート：<ul style="margin:0px;">
            <li>固定ビットレート（CBR）。</li>
            <li>動的ビットレート（VBR）。</li>
            </ul></td>
    </tr><tr>
        <td>ビデオ画面の回転</td>
        <td>元のビデオ画面の時計回りに3つの角度での回転をサポート：<ul style="margin:0px;">
            <li>時計回りに90度回転。</li>
            <li>時計回りに180度回転。</li>
            <li>時計回りに270度回転。</li>
            </ul></td>
    </tr>
</table>


 ###  オーディオトランスコードパラメータのご紹介


<table>
    <tr><th width="20%">パラメータタイプ</th><th width="80%">説明</th></tr>
    <tr>
        <td>オーディオコーデック</td>
        <td>次のコーデックをサポート：<ul style="margin:0px">
                        <li>AAC-LC</li>
                        <li>AAC-HE</li>
                        <li>AAC-HEV2</li>
            </ul></td>
    </tr>
    <tr>
        <td>オーディオサンプルレート</td>
        <td>次の一般的なサンプルレートをサポートします。一般的なサンプルレートは48000と44100です。
                <ul style="margin:0px">
                    <li>96000</li>
                    <li>64000</li>
                    <li>48000</li>
                    <li>44100</li>
                    <li>32000</li>
                    <li>24000</li>
                    <li>16000</li>
                    <li>12000</li>
                    <li>8000</li>
                </ul>
                </td>
    </tr>
    <tr>
        <td>オーディオコーデックビットレート</td>
        <td>サポートするオーディオビットレート範囲：20kbps～192kbps。一般的なオーディオビットレートは次のとおりです。
                <ul style="margin:0px">
                    <li>48kbps</li>
                    <li>64kbps</li>
                    <li>128kbps</li>
                    </ul></td>
    </tr>
    <tr>
        <td>オーディオサウンドチャンネル</td>
        <td>オーディオは次のサウンドチャンネルをサポート：
                <ul style="margin:0px">
                    <li>シングルサウンドチャンネル</li>
                    <li>ダブルサウンドチャンネル</li>
                    </ul></td>
</tr></table>




 ### ビデオトランスコーディングに使用される一般的なプリセットテンプレート

| 解像度 | テンプレート名 | ビデオ解像度        | ビデオビットレート | ビデオフレームレート | ビデオコーデック形式 |
| ------ | -------- | ----------------- | -------- | -------- | ------------ |
| LD   | 550      | 比例ズーム * 540  | 500kbps  | 23       | H264         |
| SD   | 900      | 比例ズーム * 720  | 1000kbps | 25       | H264         |
| HD   | 2000     | 比例ズーム * 1080 | 2000kbps | 25       | H264         |

## 高速高画質トランスコーディング機能

Tencent Video Cloudで長年にわたって蓄積されたオーディオ/ビデオコーデック技術、インテリジェントなシナリオ認識、動的コーデック技術、CTU/ライン/フレームの3レベルのビットレートによる正確な制御モデルに基づき、ライブストリーミング、オンデマンドなどの業界向けに、より低いビットレート（平均で30％以上削減）でより高解像度のストリーミングメディアサービスを提供します。

### ユースケース

CSSのプッシュビットレートが高く、画面が劣悪な場合は、インテリジェントでダイナミックなエンコード技術と正確なビットレート制御モデルを介して、高解像度と低ビットレートを実現し、視聴者には同等の画質を保証できます。

### 機能のメリット

今日の各種ビデオプラットフォームユーザーのビデオソースの解像度と視聴体験に対する要求がますます高まっている現状を受け、現在のライブストリーミングサービスは、1080P、ビットレート3Mbps - 10Mbpsが主なストリームの設定となりつつあり、帯域幅のコストがビデオプラットフォームコストの大部分を占めています。ビデオのビットレートを下げることで、帯域幅のコストを効果的に削減することができます。
**事例：**
一標準ライブストリーミングでビットレートが3Mbps、ライブストリーミングの時間は4時間、視聴者数200人、コーデックはH.264を使用し、解像度1080Pで高速高画質トランスコーディングを使用しない場合、[CSS価格計算機](https://buy.cloud.tencent.com/price/lvb/calculator)を使用して、発生した帯域幅コストを計算すると、127.08米ドルになります。

- 高速高画質トランスコーディングを使用しビットレートを下げた後に、発生する帯域幅コストは、約127.08 ×（100% - 30%）= 88.956米ドルとなります。
- 高速高画質トランスコーディングを使用して発生する費用は、0.0443 × 240 = 10.632米ドル（標準価格、いかなる値引きも含まず）です。
- コスト合計：88.956 + 10.632 = 99.588米ドル。

以上より、高速高画質トランスコーディングは、ユーザーにより良い視聴体験を提供しつつ、プラットフォームの帯域幅コストを効率的に削減します。

### 主要パラメータ

高速高画質トランスコーディングと標準的なCSSトランスコードのパラメータ設定方法は基本的に同じです。[ビデオトランスコーディングパラメータ](#parameter)をご参照ください。



## CSSウォーターマーク追加機能のご紹介

ビデオストリームウォーターマーク追加機能とは、オリジナルストリームをベースにして、各種のロゴや画像をビデオ画面に追加し、著作権を表示し、ビデオに独自のロゴを追加するためにプリセットされた機能であり、本機能を利用することでプロモーション効果を発揮することが可能です。
### ウォーターマーク関連パラメータ
ウォーターマークの主要パラメータにはサイズと位置があり、それらはパラメータXPosition、YPosition、WidthとHeightによって調整されます。各パラメータの定義は次のとおりです。
- **XPosition**：X軸オフセット。ウォーターマークの左端からビデオの左端までの距離のパーセンテージを示します。
- **YPosition**：Y軸オフセット。ウォーターマークの上端からビデオの上端までの距離のパーセンテージを示します。
- **Width**：ウォーターマークの幅。ライブストリーミングオリジナル画面の幅に占めるパーセンテージ。
- **Height**：ウォーターマークの高さ。ライブストリーミングオリジナル画面の高さに占めるパーセンテージ。

![](https://main.qcloudimg.com/raw/b7341cfb465aae7a59ff24ca6abeecb2.png)

>! ストリームが複数のビットレートトランスコードを有効にする場合（つまり、オリジナルストリームが複数の解像度のストリームに変換される場合）は、ウォーターマークを追加する必要があります。[CSSコンソール](#W_control) または[API](#W_api) でX軸、Y軸の位置をパーセンテージで設定することができ、システムが自動的にウォーターマークの位置を調整します。

### ウォーターマークのパラメータ例

ビデオ出力画面が1920×1080、ウォーターマークのサイズが320×240である場合、パーセンテージの計算方式にXPosition = 5、YPosition = 5、Width=10を使用します。
ビデオ出力画面の解像度に基づき計算されたウォーターマークの絶対位置とサイズは次のとおりです。
```
XPosition_pixel = 1920 * 5% = 96
YPosition_pixel = 1080 * 5% = 54
Width_pixel = 1920 * 10% = 192
Height_pixel = 192 * 240 / 320 = 144
```

以上より、ウォーターマークの位置はビデオ画面左端から96ピクセル、ビデオ出力画面上端から54ピクセル離れた位置となり、ウォーターマークのサイズは192ピクセル * 144ピクセルとなります。

### 使用法の概要
ウォーターマークを追加するには、[CSSコンソール](#W_control)と[サーバーAPI](#W_api)の2つの方法があります。業務ニーズに応じて対応する使用方式を選択します。

<span id="W_control"></span>
#### CSSコンソール
1. 【機能設定】>【[CSSウォーターマーク](https://console.cloud.tencent.com/live/config/watermark)】に進み、ウォーターマーク設定テンプレートを追加します。ウォーターマーク関連パラメータを設定し、さらに対応するウォーターマークテンプレートIDを発行します。具体的な操作については、[CSSウォーターマーク](https://intl.cloud.tencent.com/document/product/267/31073)をご参照ください。
2. [【Domain Management】](https://console.cloud.tencent.com/live/domainmanage)で操作が必要なプッシュドメイン名に対し、【管理】>【テンプレート設定】を選択し、このドメイン名とウォーターマークテンプレートを関連付けます。具体的な操作については、[ウォーターマーク設定](https://intl.cloud.tencent.com/document/product/267/31064)をご参照ください。

<span id="W_api"></span>
#### APIの呼び出し
1 [AddLiveWatermark](https://intl.cloud.tencent.com/document/product/267/30826) ウォーターマーク追加のインターフェースを呼び出してウォーターマーク名とパラメータ情報を設定します。
2 [CreateLiveWatermarkRule](https://intl.cloud.tencent.com/document/product/267/30825) を呼び出してウォーターマークルールを作成し、プッシュドメイン名パラメータDomainNameとWatermarkId（第1ステップに戻ります）を設定します。AppNameはプッシュと再生アドレス内のAppNameと一致させる必要があり、デフォルトは `live` です。

>! ウォーターマーク追加機能を使用すると、標準のトランスコード料金が発生します。



##  トランスコードパラメータの設定使用方法

### 使用法の概要

トランスコードパラメータの設定は、[CSSコンソール](#T_control)と[サーバーAPI](#T_api)の2つの方法があります。いずれの方式を使用しても、主にウォーターマークテンプレート、トランスコードテンプレート、トランスコードルールの関連操作が必要です。

<span id="T_control"></span>
#### CSSコンソール
1. 【機能設定】>【[CSSトランスコード](https://console.cloud.tencent.com/live/config/transcode)】に進み、トランスコード設定テンプレートを追加します。[標準トランスコーディング](https://intl.cloud.tencent.com/document/product/267/31071)、[高速高画質トランスコーディング](https://intl.cloud.tencent.com/document/product/267/31071)、[オーディオのみのトランスコーディング](https://intl.cloud.tencent.com/document/product/267/31071)のテンプレートの追加をサポートしています。
2. ニーズに応じて対応するトランスコードタイプを作成し、トランスコード関連パラメータを設定します。システムのデフォルトパラメータを使用すると、対応するトランスコードテンプレートIDが生成されます。
2. [【Domain Management】](https://console.cloud.tencent.com/live/domainmanage)で操作が必要なプルストリームドメイン名を探し、【管理】>【テンプレート設定】を選択し、このドメイン名とトランスコードテンプレートをバインドします。具体的な操作については、 [トランスコーディング設定](https://intl.cloud.tencent.com/document/product/267/31062)をご参照ください。

<span id="T_api"></span>
#### APIの呼び出し

1. [CreateLiveTranscodeTemplate](https://intl.cloud.tencent.com/document/product/267/30790)トランスコードテンプレート作成のインターフェースを呼び出し、必要なトランスコードタイプとパラメータ情報を設定します。
2. [CreateLiveTranscodeRule](https://intl.cloud.tencent.com/document/product/267/30791) トランスコード作成ルールを呼び出し、プルドメイン名DomainNameとTemplateId（第1ステップに戻ります）のパラメータを設定します。AppNameおよびStreamNameに空文字列を入力します。本操作は1つのドメイン名ですべてのプルトランスコードが共通化されたことを意味します。またトランスコードテンプレートを異なるストリーム名と関連付けて、特定のライブストリーミングのトランスコードを有効にすることもできます。
3. 各トランスコードテンプレートには対応する**唯一**の**トランスコードテンプレート名**があり、トランスコードテンプレート名はトランスコードストリームを再生するための一意の識別子として使用されます。トランスコードテンプレート名を再生プルアドレスのストリームID の末尾に追加して、各種トランスコードテンプレートに対応するトランスコードストリームをプルすることができます。

>! トランスコードルールについての操作は、主に特定のドメイン名または特定のストリームに対して特定のトランスコードテンプレートを有効にするために使用されます。トランスコードルールが作成された場合にのみ、対応する再生ドメイン名が対応するトランスコードテンプレートをプルできます。トランスコードルールが作成されていない場合は、直接スプライスされたトランスコードテンプレート名を利用してもプルストリーミングアドレスは無効になります。


### 使用方法の例

```
再生アドレス = 再生ドメイン名 + 再生パス + ストリームID名_トランスコードテンプレート名 + 認証文字列
```
プッシュでは、ストリームIDは1234_testであり、次の3つのアドレスを介してウォーターマークの挿入された各種ストリームが再生可能です。

- **オリジナルストリーム：**`http://liveplay.tcloud.com/live/1234_test.flv?認証文字列`
- **SDトランスコードストリーム（ウォーターマーク挿入）：**`http://liveplay.tcloud.com/live/1234_test_sd.flv?認証文字列`
- **HDトランスコードストリーム（ウォーターマーク挿入）：**`http://liveplay.tcloud.com/live/1234_test_hd.flv?認証文字列`

>! ウォーターマークが挿入されたストリームを再生する場合は、対応するプッシュドメイン名に作成されたウォーターマークテンプレートをバインドする必要があります。

###  インターフェースの使用
- **コンソールでトランスコードテンプレートを管理**：
   コンソールではトランスコードテンプレートのクエリー、追加、変更、削除をサポートします。
- **サーバーAPIでトランスコードテンプレートを管理**：
<table>
<tr><th>機能モジュール</th><th>APIインターフェース</th>
</tr><tr>
<td rowspan=8>CSSトランスコード</td>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30790">トランスコードテンプレートの作成</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30784">トランスコードテンプレート設定の変更</a></td></tr>
<tr><td><a href="https://intl.cloud.tencent.com/document/product/267/30786">単一トランスコードテンプレートの取得</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30785">トランスコードテンプレートリストの取得</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30788">トランスコードテンプレートの削除</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30791">トランスコードルールの作成</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30787">トランスコードルールリストの取得</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/document/product/267/30789">トランスコードルールの削除</a></td>
</tr><tr>
<td rowspan=4>CSSウォーターマーク</td>
<td><a href="https://intl.cloud.tencent.com/zh/document/product/267/30826">ウォーターマークの追加</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/zh/document/product/267/30818">ウォーターマークの更新</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/zh/document/product/267/30824">ウォーターマークの削除</a></td></tr><tr>
<td><a href="https://intl.cloud.tencent.com/zh/document/product/267/30820">ウォーターマークリストのクエリー</a></td>
</tr></table>
