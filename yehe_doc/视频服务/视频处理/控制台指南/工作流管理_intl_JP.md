## 操作シナリオ
ワークフロー設定後、指定されたBucketとディレクトリ下にアップロードされたビデオは自動的にMPSがトリガーされ、出力ファイルは指定されたBucketとディレクトリに書き込まれます。ワークフローにはトランスコードタスク、スクリーンキャプチャタスク、アニメーション画像生成タスク、審査タスク、コンテンツ認識タスク、コンテンツ分析タスク、およびウォーターマーク追加が設定できます。



## ワークフロー作成手順
1. [MPSコンソール](https://console.cloud.tencent.com/mps)にログインし、左側ナビゲーションバーの【ワークフロー管理】をクリックして、「ワークフロー管理」インターフェースに入ります。
2. 【ワークフローの作成】をクリックし、「ワークフローの作成」画面に入ります。ワークフローを作成する時は、ワークフロー名、トリガーBucket、トリガーディレクトリ、出力Bucket、出力ディレクトリ、イベント通知、および設定項目を設定する必要があります。
![](https://main.qcloudimg.com/raw/314b57f24a325fc3f4a3f4da16594006.png))
	- **ワークフロー名**
	入力必須項目は、中国語、英語、数字、アンダーバー(\_)、ハイフン(-)のみサポートし、128文字を超える長さは対応しません。タスクフロー名は重複できません。
	- **トリガーBucket**
		- 入力必須項目。APPIDに作成したBucketのうち1つを選択し、トリガーBucketとすることができます。
		- ワークフロー有効後、このBucketにアップロードされたビデオファイルはワークフローの実行を自動的にトリガーできます。
	- **トリガーディレクトリ**
	オプション項目。スラッシュ（/）を末尾につけます。未入力の場合は、トリガーBucket下のすべてのディレクトリが有効になります。
	- **出力Bucket**
		- 入力必須項目。デフォルトはトリガーBucketと同じですが、このAPPID下にトリガーBucketと同一リージョンのBucketのうち1つを選択し、出力Bucketとすることができます。
		- ワークフロー処理の完了後、新たに生成されたビデオファイルは、このBucketの中に保存されます。
	- **出力ディレクトリ**
	オプション項目。スラッシュ（/）を末尾につけます。未入力の場合は、出力ディレクトリとトリガーディレクトリが同一となります。
	- **設定項目**
	トランスコードタスク、スクリーンキャプチャタスク、アニメーション画像生成タスク、審査タスク、コンテンツ認識タスク、コンテンツ分析タスクのうち、少なくとも1項目を選択して設定します。詳細は[タスク設定の説明](#p1)をご参照ください。

## イベント通知
### 1. Cloud Message Queueによるイベント通知の完了
- イベント通知をオンにした後（イベント通知はデフォルトではオフ）、ユーザーはCloud Message Queueモデルの中からキューモデルまたはトピックモデルを選択し、選択したモデルの名前とリージョンを入力することができます。設定完了後、指定されたCMQはMPSのイベント通知を受信します。

- CMQイベント通知は、ユーザーがCMQサービスをアクティブ化し、キューモデルまたはトピックモデルを作成した後にご利用いただくことができます。詳細は [Cloud Message Queue](https://intl.cloud.tencent.com/document/product/406/8435)をご参照ください。

### 2. Serverless Cloud Functionによるイベント通知の完了
関数処理サービスにより、MPSが生成したコールバックイベントに対する処理および操作を迅速に完了することができます。全体的なデータ処理フローチャートは次のとおりです。
![](https://main.qcloudimg.com/raw/af522de2310535d55ea2d76dc4239696.png)
MPSトリガーによりイベントをSCF関数側にプッシュし、さらにserverlessアーキテクチャの関数計算によりコールバックイベントの処理およびレスポンスを提供します。

#### 関数処理シーンの実践
Cloud Log Serviceは、ログトピックの中のデータをMPSログトリガーによりServerless Cloud Functionへ配信して処理を行うことができ、ビデオに対してイベント通知、状態監視、アラーム処理などを行うユースケースの機能を満たします。

| 関数処理シーン | 説明 |
|---------|---------|
| ビデオタスクのコールバックをCOSにバックアップ | MPSが生成したコールバックタスクをSCFによってCOSに速やかにバックアップします。 |
| ビデオタスクのコールバック通知	 | MPSのデータメッセージをリアルタイムに受信し、メッセージをWeCom、メールなどにプッシュします。 |

>!データをServerless Cloud Function側に配信する場合、発生する対応課金額の詳細については、 [SCF課金概要](https://intl.cloud.tencent.com/document/product/583/17299)をご参照ください。


[](id:p1)**タスク設定の説明**

タスクのタイプ|テンプレートはプリセットまたはカスタマイズをサポートしているか|サポートしているテンプレート設定
-|-|-
 トランスコードタスク|トランスコードテンプレート：<li>プリセットテンプレートのサポート<br><li>カスタムテンプレートのサポート|<li>トランスコードテンプレート：作成済みのテンプレートリストから1個を選択して、各タスク設定に1個以上のトランスコードテンプレートの追加をサポートします。既存のテンプレートが使用要件に適合しない場合は、 [テンプレート設定 - トランスコードテンプレート](https://console.cloud.tencent.com/mps/templates?tab=video) で新しいテンプレートを作成できます。<br><li>ウォーターマークテンプレート：各トランスコードテンプレートは最大4つのウォーターマークの追加をサポートできます。既存のウォーターマークが使用要件に適合しない場合は、 [テンプレート設定 - ウォーターマークテンプレート](https://console.cloud.tencent.com/mps/templates?tab=watermark）で新しいテンプレートを作成できます。
 スクリーンキャプチャタスク|スクリーンキャプチャテンプレート：<li>プリセットテンプレートのサポート<br><li>カスタムテンプレートのサポート|<li>スクリーンキャプチャテンプレート：タイムポイントスクリーンキャプチャ、サンプリングスクリーンキャプチャ、スプライトイメージスクリーンキャプチャのスクリーンキャプチャ方式を含み、どのスクリーンキャプチャ方式も対応する方式で設定済みのテンプレートしか選択できず、タイムポイントスクリーンキャプチャはタイムポイントの選択を行う必要があります。既存のテンプレートが使用要件に適合しない場合は、 [テンプレート設定 -スクリーンキャプチャテンプレート](https://console.cloud.tencent.com/mps/templates?tab=snapshot) で新しいテンプレートを作成できます。<br><li>ウォーターマークテンプレート：各トランスコードテンプレートは最高で4つのウォーターマークの追加をサポートできます。既存のウォーターマークが使用要件に適合しない場合は、 [テンプレート設定 - ウォーターマークテンプレート](https://console.cloud.tencent.com/mps/templates?tab=watermark）で新しいテンプレートを作成できます。
アニメーション画像生成タスク|アニメーション画像生成テンプレート：<li>プリセットテンプレートのサポート<br><li>カスタムテンプレートのサポート|アニメーション画像生成のテンプレート：複数個のアニメーション画像生成テンプレートの追加およびアニメーション画像生成タイムポイントの再設定をサポートします。既存のテンプレートが使用要件に適合しない場合は、 [テンプレート設定 - アニメーション画像生成テンプレート](https://console.cloud.tencent.com/mps/templates?tab=gif) で新しいテンプレートを作成することができます。
審査タスク|審査テンプレート：<li>プリセットテンプレートのサポート<br><li>カスタムテンプレートのサポート|審査テンプレート ：1個の審査テンプレートの追加のみサポート。既存のテンプレートが使用要件に適合しない場合は、 [テンプレート設定 - 審査テンプレート](https://console.cloud.tencent.com/mps/templates?tab=audit) で新しいテンプレートを作成できます。
コンテンツ認識タスク|コンテンツ認識テンプレート：<li>プリセットテンプレートのサポート<br><li>カスタムテンプレートのサポート|コンテンツ認識テンプレート ：1個のコンテンツ認識テンプレートの追加のみサポート。既存のテンプレートが使用要件に適合しない場合は、 [テンプレート設定 - コンテンツ認識テンプレート](https://console.cloud.tencent.com/mps/templates?tab=recognization) で新しいテンプレートを作成できます。
コンテンツ分析タスク|コンテンツ分析テンプレート：<li>プリセットテンプレートのサポート<br><li>カスタムテンプレートのサポート|コンテンツ分析テンプレート ：1個のコンテンツ分析テンプレートの追加のみサポート。既存のテンプレートが使用要件に適合しない場合は、 [テンプレート設定 - コンテンツ分析テンプレート](https://console.cloud.tencent.com/mps/templates?tab=analysis) で新しいテンプレートを作成できます。



## ワークフロー管理手順

1. [MPSコンソール](https://console.cloud.tencent.com/mps)にログインし、左側ナビゲーションバーの【ワークフロー管理】をクリックして、「ワークフロー管理」インターフェースに入ります。
2. ワークフローリストにはワークフロー名、トリガーBucket、リージョン、ディレクトリ、作成時間、有効状態などの情報が表示されます。作成時間によるソート、タスクフロー名検索、および指定されたワークフローに対する詳細の確認・編集・削除操作をサポートします。
	-  **ワークフローの有効化**
		- ワークフローはデフォルトでは無効状態です。このワークフローに対応する状態ボタンをクリックすると、ワークフローを有効化できます。
		- ワークフローを有効化することで、トリガーBucket内にアップロードしたビデオファイルを自動実行できます。
	- **ワークフローの使用停止**
		- このワークフローに対応する状態ボタンをクリックすると、ワークフローを使用停止にできます。
		- ワークフローを使用停止にすると、トリガーBucketにアップロードしたビデオファイルはMPSタスクを実行することができなくなります。
	- **ワークフローの編集**
		-対象のワークフロー操作バーの【編集】をクリックし、「ワークフローの編集」画面に入ります。この画面でワークフロー名、トリガーBucket、トリガーディレクトリ、出力Bucket、出力ディレクトリ、イベント通知、および設定項目などの変更を行うことができます。
		- ワークフローが有効状態の時は、それに対する編集と削除操作を行うことができません。
	- **ワークフローの削除**
		- 対象のワークフロー操作バーの【削除】をクリックすると、このワークフローを削除できます。
		- ワークフローを削除すると、トリガーBucketにアップロードしたビデオファイルはMPSタスクを実行することができなくなります。
		- ワークフローが有効状態の時は、それに対する編集と削除操作を行うことができません。

