## ユースケース
Appがバックグランドに切り替え、またはプロセスがkillされた場合、新しいメッセージをユーザに通知する必要があれば、オフラインプッシュ機能を使用します。iOS側ではAPNsプッシュがあり、Android側では、ユーザがオフラインメッセージのコールバックを登録する必要があります。

## iOS APNsプッシュ
### プッシュ形式について

![](https://main.qcloudimg.com/raw/8bb11ef0a0ff210c1b0a1ab65da63c2f.png)


上の図は、1対1チャットメッセージとグループチャットメッセージの例です。

### 基本インターフェースについて
APNsは次のインターフェースを呼び出す必要があります。
- Tokenを設定する。
- バックグラウンドに切り替えて未読の旨を送信する。
- フォアグラウンドに切り替えて通知する。

### Ext拡張設定
場合によっては、アプリケーションはプッシュされたExt拡張フィールドを設定する必要があります。ユーザがジャンプなどの操作を容易に実行するため、TIMCustomElemのExtフィールドに記入することができます。プッシュ時にインスタントメッセージIMバックグラウンドでこのフィールドがExtに記入されます。

### プッシュ音声を設定する
場合によっては、アプリケーションは単一メッセージのプッシュ音声を設定する必要があります。特定のメッセージの通知を容易に実行するため、TIMCustomElemのsoundフィールドに記入することができます。プッシュ時にIMバックグラウンドでこのフィールドがExtに記入されます。

## Androidオフラインプッシュ
Android 1.8.0以降のバージョンはサービスとプロセスの分離をサポートし、Appプロセスがkillされていても、サービスは生き続けて、オフラインプッシュ機能を受信することができます。

## バックグラウンドでのメッセージ送信
バックグラウンドでメッセージを送信する際には、iOS側では、APNsプッシュの表示形式を設定し、Android側では、[OfflinePushInfoのオフラインプッシュ](https://intl.cloud.tencent.com/document/product/1047/33527)を参照しながら設定することができます。
