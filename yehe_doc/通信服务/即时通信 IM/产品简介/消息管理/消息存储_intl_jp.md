## オフラインメッセージの保存

インスタントメッセージIMはオフラインメッセージキャッシュをサポートしています。つまり、ユーザがオンラインでない場合でも、次回ログインするときにオフラインメッセージがプルされます。オフラインメッセージはデフォルトで7日間保存されます。ユーザが7日間ログインしなかった場合、再度ログインしたときに7日前のオフラインメッセージを取得することはできません。1対1チャットメッセージの場合、各ユーザのオフラインメッセージキャッシュに1対1チャットセッションの未読メッセージが最大100件、各1対1チャットセッションに最大100件保存されます。制限を超えた部分は未読数にカウントされませんが、これらのメッセージはメッセージローミングに保存されます。グループメッセージの場合、このような件数の制限はありません。

デフォルトでは、端末がSDKを介してオフラインメッセージをローカルにプルすると、インスタントメッセージIMサーバーはこれらのオフラインメッセージを削除します。多端末をサポートする必要がある場合、または端末を切り替えた後も未読のオフラインメッセージをプルしようとする場合、ユーザは自らこれらのオフラインメッセージを管理する必要があります。SDKの既読自動報告機能が無効になっている場合、インスタントメッセージIMサーバーは、ユーザが既読報告インターフェースを明示的に呼び出した場合にのみこれらのオフラインメッセージを削除します。そうでない場合、これらのオフラインメッセージは期限切れ後に自動的に削除されます。ユーザが既読報告インターフェースを明示的に呼び出していない場合でも、端末を切り替えた後も、未読のオフラインメッセージがプルされることができます。

## ローミングメッセージの保存

インスタントメッセージIMはメッセージローミングをサポートしています。つまり、ユーザが端末を切り替えた場合でも、他のユーザやあるグループのチャット記録を取得することができます。
1対1チャットメッセージとグループチャットメッセージはデフォルトで7日間のローミング期間に保存され、ローミング期間を超えるメッセージは削除されます。インスタントメッセージIMは、コンソールでのメッセージローミング期間の変更をサポートしています。メッセージローミング時間の延長は付加価値サービスです。具体的な課金方法については、[価格の説明](https://intl.cloud.tencent.com/document/product/1047/34350)をご参照ください。
<span id="MsgType"></span>
次の表に示すように、履歴メッセージの保存時間を延長できるメッセージのタイプは、SDKのバージョンによって異なります。

| SDKバージョン | テキスト | カスタムクラスメッセージ | 画像 | ファイル | ショート音声 | ショート動画 | リッチメディアメッセージ | 
|---------|---------|---------|---------|---------|---------|---------|---------|
| Android 4.X | &#10003; | &#10003;  | &#10003;| &#10003; | &#10003; | &#10003; | &#10003; |
| Android 3.X | &#10003; | &#10003;  | × | × | × | × | × |
| Android 2.X | &#10003; |  &#10003; | × | × | × | × | × |
| iOS 4.X | &#10003; | &#10003;  | &#10003;| &#10003; | &#10003; | &#10003; | &#10003; |
| iOS 3.X | &#10003; |  &#10003; | × | × | × | × | × |
| iOS 2.X | &#10003; |  &#10003; | × | × | × | × | × |
| PC SDK 2.X | &#10003; |  &#10003; | × | × | × | × | × |
| WebとミニプログラムSDK 2.Xバーション| &#10003; | &#10003;  | &#10003;| &#10003; | &#10003; | &#10003; | &#10003; |
| WebとミニプログラムSDK 1.Xバーション| &#10003; |  &#10003; | × | × | × | × | × |

>よりよいユーザエクスペリエンスを得るために、SDKの最新バージョンにアップグレードすることをお勧めします。

## 最近使用した連絡先メッセージ

最近使用した連絡先メッセージ：QQのような最近使用した連絡先リストには、最近ユーザと連絡した方と最後のメッセージが表示されます。

クライアントはデフォルトで、ログイン時にSDKを介して最近使用した連絡先メッセージを取得します。ローカルに保存されていない場合は、onNewMessageコールバックを介して取得します。

最近使用した連絡先を使用すると、ログイン時にトラフィックを消費し、サーバー内の関連連絡先の最後1件のメッセージを取得します。この機能が必要でない場合、SDKを使用して無効にすることができます。最近使用した連絡先は、デフォルトで最近100件の連絡先を保存しますが、保存期間は最近使用した連絡先の最後のメッセージの保存期間と同じです。例えば、デフォルトで7日以上連絡先とのメッセージがない場合、最後1件のメッセージが期限切れになると、最近使用した連絡先からこのユーザを取得することはできません。

## Appローカル保存

SDK内部はデフォルトで受信したメッセージを保存するため、ユーザが保存する必要はありません。ユーザはインタフェースを呼び出してローカルメッセージを取得できます（ネットワーク操作なし）。また、getMessageインターフェースを介してもローカルメッセージを取得できます。ローカルメッセージに欠落部分がある場合、ローミングメッセージで補完されます。
SDKはデフォルトでユーザメッセージを削除しませんが、特別なニーズに応じてローカルメッセージを削除する機能を提供しています。
>ローカル保存を使用すると、ディスクとCPUのパフォーマンスが消費されます。履歴メッセージよりもメッセージ処理パフォーマンスが重要であるライブ配信など、保存を必要とされない場合、ローカル保存を無効にすることもできます。





