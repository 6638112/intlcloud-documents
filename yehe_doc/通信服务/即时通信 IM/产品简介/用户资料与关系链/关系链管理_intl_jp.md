## リレーショナルチェーンシステムの紹介

インスタントメッセージIMはユーザのリレーショナルチェーンのホスティング機能をオープンにし、リレーショナルチェーンに関係する完全なソリューション一式を提供しています。Appにおいてユーザ間での友だち関係を自身で開発または維持することを希望せず、更に友だちを追加/削除するなどの一連の機能を気軽に楽しみたい場合、インスタントメッセージIMのリレーショナルチェーンのホスティングサービスを選択できます。

- インスタントメッセージIMはリレーショナルチェーンの保存機能を提供し、かつお客様のデータがリモートによる災害復帰、複数の場所への展開および自動拡張/縮小の機能を有することを確保し、お客様がサーバーのクラッシュ、マルチコピー、マスタースレーブレプリケーションと拡張/縮小などの複雑な処理フローから完全に解放されるようサポートします。
- インスタントメッセージIMは業界で一般的なサービス処理フローを提供し、お客様がユーザリレーショナルチェーンのロジックにおいて完全に解放されるようサポートします。
- インスタントメッセージIMは専門的な運用フローと運営チームを提供し、年間99.99%の安定したサービス品質で、お客様がユーザに安定した口コミのサービスを提供するようサポートします。
- インスタントメッセージIMは簡単で使いやすいサービスインターフェースとクイックアクセスのヘルプガイドを提供し、トータルでお客様にトップクラスのサービスを提供します。

リレーショナルチェーンはユーザとその他のユーザの関係を説明するために使用されるデータで、インスタントメッセージIMが現在サポートしているリレーショナルチェーンには友だちリストとブラックリストがあります。

## リレーショナルチェーンフィールド
インスタントメッセージIMのリレーショナルチェーンシステムはスタンダード仕様のリレーショナルチェーンフィールドとカスタムのリレーショナルチェーンフィールドをサポートしており、リレーショナルチェーンフィールドには以下の特性があります。

- リレーショナルチェーンフィールドはKey-Value形式により表されます。
- KeyはStringタイプで、その命名はアルファベットの大文字小文字、数字、アンダーバーのみをサポートしています。
- Valueには以下の数種類のタイプがあります。
 a. uint64_tタイプの整数（カスタムのリレーショナルチェーンフィールドはサポートしません）。
 b. stringタイプの文字列（stringの長さは500バイトを超えてはいけません）。
 c. bytesタイプのbuffer（bufferの長さは500バイトを超えてはいけません）。
 d. stringタイプの文字列配列（各stringの長さは500バイトを超えてはならず、友だちリストのTag_SNS_IM_Groupフィールドのみに使用します）。

## 友だちリスト
インスタントメッセージIMの友だちリストは最大で3000人の友だちを追加することができます。
友だちリストはスタンダード仕様の友だちフィールドとカスタムの友だちフィールドをサポートしています。

### スタンダード仕様の友だちフィールド
現在、インスタントメッセージIMがサポートするスタンダード仕様の友だちフィールドは以下の通りです。

| フィールド名 | タイプ | 説明 |
|---------|---------|---------|
|Tag_SNS_IM_Group | Array  |友だちの分類：<br />1. 最大で32分類をサポート；<br />2. 分類名を空欄にすることはできない；<br />3. 分類名の長さは30バイトを超えてはならない；<br />4. 同じ友だちは複数の異なる分類を有することが可能 |
|Tag_SNS_IM_Remark|string|友だちの備考：<br />1. 備考の長さは96バイトを超えてはならない|
|Tag_SNS_IM_AddSource|string|友だちソースの追加：<br />1. 友だち追加ソースフィールドにはプレフィックスとキーワードの2つの部分を含む。<br />2. 友だち追加ソースフィールドのプレフィックスはAddSource_Type_。<br />3. キーワードはアルファベットでなければならず、かつ長さが8バイトを超えてはならない。1つの英単語または英単語の略称を使用することを推奨。<br />4. 例：友だち追加ソースのキーワードはAndroidの場合、友だち追加ソースフィールドはAddSource_Type_Android<br />|
|Tag_SNS_IM_AddWording|string|友だち追加の但し書き：<br />1. 友だち追加の但し書きの長さは256バイトを超えてはならない<br />|


### カスタムの友だちフィールド

カスタムの友だちフィールドは、各Appがそれぞれのサービスのニーズに基づき設定する友だちデータです。カスタムの友だちフィールドにより、各Appはいくつかの規定外のデータを友だちに追加し、かつ既存のインターフェースにより読み取り/書き込み操作を行うことができます。
Appの管理者はインスタントメッセージIMの[コンソール](https://console.cloud.tencent.com/im)＞【アプリケーションの構成】＞【機能の構成】によりカスタムの友だちフィールドを申請でき、申請のサブミット後、カスタムの友だちフィールドは5分以内に有効になります。

カスタムの友だちフィールドの命名規則は以下の通りです。
- カスタムの友だちフィールドの名称はプレフィックス、キーワードの2つの部分に分かれます。
- カスタムの友だちフィールドのプレフィックスはTag_SNS_Customです。
- キーワードはアルファベットでなければならず、長さは8バイトを超えてはならず、英単語または英単語の略称を使用することをお勧めします。
- 例：とあるAppが申請するカスタムの友だちフィールドのキーワードがTestの場合、カスタムの関係フィールドの名称はTag_SNS_Custom_Testになります。

カスタムの友だちフィールドを申請する時、それぞれのカスタムの友だちフィールドに以下のデータを提出する必要があります。
- カスタムの友だちフィールドの名称（Key）。
- カスタムの友だちフィールドのタイプ（Value）：詳細は<a href="https://intl.cloud.tencent.com/document/product/1047/33521">リレーショナルチェーンフィールド</a>をご参照ください。



### 友だちの追加

インスタントメッセージIMがサポートする友だち追加のモードには一括追加、1ターン追加、2ターン追加があります。

双方向の友だち：ユーザAの友だちリストにユーザBがいて、Bの友だちリストにAがいます。
一方向の友だち：ユーザAの友だちリストにはユーザBがいますが、Bの友だちリストにはAがいません。
友だち追加の検証方法：各ユーザは自身がどの方法で他のユーザに友だちとして追加されるか選択できます。
1ターン追加：アカウントAの設定する友だち追加の検証方法がAllowType_Type_AllowAnyの場合、Aを友だちとして追加するすべての人が直接正常に追加できます。この1回のリクエストで正常に友だちを追加できるケースを1ターン追加と呼びます。
2ターン追加：アカウントAの設定する友だち追加の検証方法がAllowType_Type_NeedConfirmの場合、すべての人がAを追加する時に、Aは友だち追加リクエストの検証メッセージを受け取り、これが1回目のターンです。その後、Aがこの友だち追加リクエストの検証メッセージに対して同意の操作を行った時が2回目のターンで、この検証が必要な友だち追加のケースを2ターン追加と呼びます。

### 友だちの削除
インスタントメッセージIMは、一方向の友だち削除と双方向の友だち削除という、2種類の友だち削除方法をサポートします。


| 削除方法 | DeleteType | 説明 |
|---------|---------|---------|
| 一方向の友だち削除 | Delete_Type_Single | To_AccountをFrom_Accountの友だちリストからのみ削除できますが、From_AccountはTo_Accountの友だちリストから削除されません |
| 双方向の友だち削除 | Delete_Type_Both | To_AccountをFrom_Accountの友だちリストから削除すると同時に、From_AccountをTo_Accountの友だちリストから削除します |


インスタントメッセージIMはまた、友だちの一括削除もサポートします。

### 友だちのプル
インスタントメッセージIMは、友だちなしの増分プル方法、完全ページングプル方法および友だちありのプル方式の3種類の友だちをプルする方法をサポートします。

### 友だちの検証

インスタントメッセージIMは、一方向の友だち関係の検証、双方向の友だち関係の検証の2種類の友だち検証方法をサポートします。

| 検証方法 | CheckType | 説明 |
|---------|---------|---------|
| 一方向の友だち関係の検証 | CheckResult_Type_Single | From_Accountの友だちリストの中にTo_Accountがあるかどうかのみを検査し、To_Accountの友だちリストの中にFrom_Accountがあるかどうかは検査しない |
| 双方向の友だち関係の検証 | CheckResult_Type_Both | From_Accountの友だちリストの中にTo_Accountがあるかどうかを検査し、To_Accountの友だちリストの中にFrom_Accountがあるかどうかも検査する |


一方向の友だち関係の検証を行う時に、以下の結果があり得ます。

| Relation | 説明 |
|---------|---------|
| CheckResult_Type_NoRelation | From_Accountの友だちリストの中にTo_Accountはないが、To_Accountの友だちリストの中にFrom_Accountがあるかどうかは確定できない |
| CheckResult_Type_AWithB | From_Accountの友だちリストにTo_Accountがあるが、To_Accountの友だちリストにFrom_Accountがあるかどうかは確定できない |


双方向の友だち関係の検証を行う時に、以下の結果があり得ます。

| Relation | 説明 |
|---------|---------|
| CheckResult_Type_BothWay |From_Accountの友だちリストにTo_Accountがあり、To_Accountの友だちリストにもFrom_Accountがある|
|CheckResult_Type_AWithB|From_Accountの友だちリストにTo_Accountがあるが、To_Accountの友だちリストにはFrom_Accountがない|
|CheckResult_Type_BWithA|From_Accountの友だちリストにTo_Accountがないが、To_Accountの友だちリストにFrom_Accountがある|
|CheckResult_Type_NoRelation|From_Accountの友だちリストにTo_Accountがないし、To_Accountの友だちリストにもFrom_Accountがない|

## ブラックリスト
それぞれのユーザにブラックリストがあり、このユーザにブロックされたアカウントを保存するために用いられます。
ユーザAはユーザBをブラックリストに追加した後、AとBの間の友だち関係は解除され（友だち関係があった場合）、かつAとBの間では再び友だち追加リクエストを行うことができなくなります。
インスタントメッセージIMのブラックリストにはデフォルトで1000件のブラックリストアカウントを追加することができます。ブラックリストのサイズに特別な要求がある場合、Tencent Cloudカスタマサービスまでご連絡ください。

### ブラックリストへの追加
インスタントメッセージIMは、ブラックリストへの一括追加をサポートします。

### ブラックリストからの削除
インスタントメッセージIMは、ブラックリストからの一括削除をサポートします。

### ブラックリストのプル
インスタントメッセージIMは、ページング方法による完全なブラックリストのプルをサポートします。

### ブラックリストの検証
インスタントメッセージIMは、一方向のブラックリスト関係の検証、双方向のブラックリスト関係の検証の2種類のブラックリスト検証方法をサポートします。


| 検証方法 | CheckType | 説明 |
|---------|---------|---------|
| 一方向のブラックリスト関係の検証 | BlackCheckResult_Type_Single | From_Accountのブラックリストの中にTo_Accountがあるかどうかのみを検査し、To_Accountのブラックリストの中にFrom_Accountがあるかどうかは検査しない|
| 双方向のブラックリスト関係の検証 | BlackCheckResult_Type_Both | From_Accountのブラックリストの中にTo_Accountがあるかどうかを検査し、To_Accountのブラックリストの中にFrom_Accountがあるかどうかも検査する |

一方向のブラックリスト関係の検証を行う時に、以下の結果があり得ます。

| Relation | 説明 |
|---------|---------|
| BlackCheckResult_Type_AWithB | From_AccountのブラックリストにTo_Accountがあるが、To_AccountのブラックリストにFrom_Accountがあるかどうかは確定できない |
| BlackCheckResult_Type_NO | From_Accountのブラックリストの中にTo_Accountはないが、To_Accountのブラックリストの中にFrom_Accountがあるかどうかは確定できない |

双方向のブラックリスト関係の検証を行う時に、以下の結果があり得ます。

| Relation | 説明 |
|---------|---------|
| BlackCheckResult_Type_BothWay | From_AccountのブラックリストにTo_Accountがあり、To_AccountのブラックリストにもFrom_Accountがある |
| BlackCheckResult_Type_AWithB | From_AccountのブラックリストにTo_Accountがあるが、To_AccountのブラックリストにはFrom_Accountがない |
| BlackCheckResult_Type_BWithA | From_Accountのブラックリストの中にTo_Accountはないが、To_Accountのブラックリストの中にFrom_Accountがある |
| BlackCheckResult_Type_NO | From_AccountのブラックリストにTo_Accountがなく、To_AccountのブラックリストにもFrom_Accountがない |

