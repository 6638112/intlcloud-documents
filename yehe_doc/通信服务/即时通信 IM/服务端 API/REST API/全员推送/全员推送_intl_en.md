## Feature Description
- Supports pushing to all users.
- Supports pushing by user attribute.
- Supports pushing by user tag.
- For messages pushed by the admin, the sender visible to the recipient is the admin.
- When the admin specifies an account to send a message to another account, the sender visible to the recipient is not the admin but the account specified by the admin.
- Supports offline storage of messages, but not roaming.
- As pushing to all users involves a large number of target accounts, it takes some time (usually no more than one minute, depending on the total number of accounts) to complete this operation.

## API Call Description
This feature **can only be applied for by Ultimate Edition users (but not by Pro Edition users). You can apply for this feature by submitting a ticket, and we will evaluate your needs for approval. If we determine that this feature suits your needs, we will approve your application so that you can use the feature**.

### Sample request URL
```
https://console.tim.qq.com/v4/all_member_push/im_push?usersig=xxx&identifier=admin&sdkappid=88888888&random=99999999&contenttype=json
```
### Request parameters

| Parameter | Description |
| ------------------ | ------------------------------------ |
| https | The request protocol is HTTPS, and the request method is POST. |
| console.tim.qq.com | Fixed domain name |
| v4/all_member_push/im_push | Request API |
| usersig | Signature generated by the app admin account. For more information, see the [UserSig backend API](https://intl.cloud.tencent.com/document/product/1047/34385). |
| identifier | The value must be the app admin account. |
| sdkappid | SDKAppID assigned by the IM console when the app is created |
| random | A random 32-bit unsigned integer |
| contenttype | Fixed value: JSON |

### Call frequency
This API supports pushing to all users/by attribute/by tag. By default, every day you can make up to 100 API calls at an interval of greater than 1 second. If you want to apply for unlimited calls or have other frequency requirements, please submit a ticket.

### Sample request packets
- **Example of pushing to all users**
The admin initiates pushing to all users:
```
{
	"From_Account": "admin",
    "MsgRandom": 56512,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```
The admin specifies an account to perform pushing to all users (in this example, the sender account is xiaoming):
```
{
	"From_Account": "xiaoming",
    "MsgRandom": 3674128,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```
The admin pushes a message to all users, and the message is stored offline for 120 seconds (2 minutes):
```
{
	"From_Account": "admin",
    "MsgRandom": 21302570,
    "MsgLifeTime": 120,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```
- **Example of pushing by user tag**
The admin pushes a message to users with the "stock A" and "stock B" tags:
```
{
	"From_Account": "admin",
	"MsgRandom": 214,
	"Condition": {
		"TagsAnd": ["stock A","stock B"]
	},
	"MsgBody": [
		{
			"MsgType": "TIMTextElem",
			"MsgContent": {
				"Text": "hi, beauty"
			}
		}
	]
}
```
The admin pushes a message to users with the "stock A" or "stock B" tag:
```
{
	"From_Account": "admin",
	"MsgRandom": 103698523,
	"Condition": {
		"TagsOr": ["stock A","stock B"]
	},
	"MsgBody": [
		{
			"MsgType": "TIMTextElem",
			"MsgContent": {
				"Text": "hi, beauty"
			}
		}
	]
}
```
The admin pushes a message to users with the "stock A" or "stock B" tag, and the message is stored offline for 120 seconds (2 minutes):
```
{
	"From_Account": "admin",
	"MsgRandom": 124032,
	"MsgLifeTime": 120,
	"Condition": {
		"TagsOr": ["stock A","stock B"]
	},
	"MsgBody": [
		{
			"MsgType": "TIMTextElem",
			"MsgContent": {
				"Text": "hi, beauty"
			}
		}
	]
}
```
- **Pushing by user attribute**
The admin pushes a message to platinum members in Shenzhen:
```
{
	"From_Account": "admin",
    "MsgRandom": 389475,
    "Condition": {
        "AttrsAnd": {
            "Member level": "Platinum member",
            "city": "Shenzhen"
        }
    },
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```
The admin pushes a message to users in Shenzhen or to male users:
```
{
	"From_Account": "admin",
    "MsgRandom": 9657,
    "Condition": {
        "AttrsOr": {
            "sex": "Male",
            "city": "Shenzhen"
        }
    },
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```
The admin pushes a message to platinum members in Shenzhen, and the message is stored offline for 120 seconds (2 minutes):
```
{
	"From_Account": "admin",
    "MsgRandom": 9312457,
	"MsgLifeTime": 120,
    "Condition": {
        "AttrsAnd": {
            "Member level": "Platinum member",
            "city": "Shenzhen"
        }
    },
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```


### Request packet fields

| Field | Type | Attribute | Description |
|---------|---------|---------|---|
| Condition | Object | Optional | There are four possible condition types: <ul style="margin:0;"><li >AttrsOr<li >AttrsAnd<li >TagsOr<li>TagsAnd</ul>AttrsOr and AttrsAnd can coexist, as can TagsOr and TagsAnd. However, tag conditions and attribute conditions cannot coexist. If no condition is specified, the message is pushed to all users. |
| MsgRandom | Integer | Required | A random number assigned to the message, which is generated by the random function and is used to deduplicate push tasks. For different push requests, MsgRandom cannot be repeated within 7 days. Otherwise, they will be considered to be the same push task (if you fail to call the push API, you can use the same MsgRandom to retry.) |
| MsgBody | Object | Required | Message body. For more information on the format, see the [MsgBody description](https://intl.cloud.tencent.com/document/product/1047/33527) (as one message can contain multiple message elements, MsgBody is of the Array type.) |
| MsgContent | Object | Required | Different MsgTypes have different MsgContent formats. For more information, see the definitions of [TIMMsgElement objects](https://intl.cloud.tencent.com/document/product/1047/33527#text-message-element). |
| MsgLifeTime | Integer | Optional | Offline message storage period in seconds. Maximum value: 7 days (604,800 seconds). Default value: 0 (no offline message storage) |
| From_Account | String | Required | Account of the push sender |
| AttrsOr | Object | Optional | ORed attribute conditions. Note that attributes and tags cannot coexist as push conditions. |
| AttrsAnd | Object | Optional | ANDed attribute conditions. Note that attributes and tags cannot coexist as push conditions. |
| TagsOr | Object | Optional | ORed attribute conditions. A tag is a string of up to 50 bytes. Note that attributes and tags cannot coexist as push conditions. The number of tags in TagsOr cannot exceed 10. |
| TagsAnd | Object | Optional | ANDed attribute conditions. A tag is a string of up to 50 bytes. Note that attributes and tags cannot coexist as push conditions. The number of tags in TagsAnd cannot exceed 10. |

### Sample response packet

```
{
    "ActionStatus": "OK",
    "ErrorInfo": "",
    "ErrorCode": 0,
    "TaskId": "1400123456_144115212910570789_4155518400_15723514"
}
```

### Response packet fields

| Field | Type | Description |
|---------|---------|---------|
| ActionStatus | String | Processing result of the request. Valid values: OK for succeeded, and FAIL for failed |
| ErrorCode | Integer | Error code |
| ErrorInfo | String | Error information |
| TaskId | String | Push task ID |

## Error Codes
The HTTP return code for this API is always 200 unless a network error (such as error 502) occurs. **The actual error code and error message are indicated by ErrorCode and ErrorInfo in the response packet, respectively.** For public error codes 60000 to 79999, see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The error codes specific to this API are as follows:

| Error Code | Description |
|---------|---------|
| 90001 | Failed to parse the JSON format. To correct it, check whether the JSON request packet meets JSON specifications. |
| 90002 | The MsgBody in the JSON request packet does not meet message format requirements or is not of the Array type. For more information, see the definitions of [TIMMsgElement objects](https://intl.cloud.tencent.com/document/product/1047/33527). |
| 90005 | The MsgRandom field is missing in the JSON request packet or the MsgRandom field is not of the Integer type. |
| 90007 | The MsgBody field in the JSON request packet is not of the Array type. To correct it, change the type of the MsgBody field to Array. |
| 90009 | The request requires the app adminâ€™s permissions. |
| 90010 | The JSON request packet does not meet message format requirements. For more information, see the definitions of [TIMMsgElement objects](https://intl.cloud.tencent.com/document/product/1047/33527#text-message-element). |
| 90020 | The length of the tag exceeds the limit of 50 bytes. |
| 90022 | TagsOr and TagsAnd in the push conditions contain repeated tags. |
| 90024 | Push operations are too frequent. The interval between pushes must be greater than 1 second. |
| 90026 | The offline message storage period is invalid. This period cannot exceed 7 days. |
| 90032 | Push conditions contain more than 10 tags, or the tag addition request contains more than 10 tags. |
| 90039 | Pushing by attribute and pushing by tag cannot co-occur. |
| 90040 | A tag in push conditions is empty. |
| 90045 | Pushing to all users is not enabled. |
| 90047 | The number of pushes exceeds the quota of the day (the default quota is 100.) |
| 91000 | An internal service error occurred. To correct it, try again. |

## API Debugging Tool
To debug this API, you can use the [online debugging tool for RESTful APIs](https://avc.qcloud.com/im/APITester/APITester.html#v4/all_member_push/im_push).

## References
- [API for Pushing to All Users](https://intl.cloud.tencent.com/document/product/1047/37165) 
- [Setting App Attribute Names](https://intl.cloud.tencent.com/document/product/1047/37167) 
- [Obtaining App Attribute Names](https://intl.cloud.tencent.com/document/product/1047/37168) 
- [Setting User Attributes](https://intl.cloud.tencent.com/document/product/1047/37170)  
- [Deleting User Attributes](https://intl.cloud.tencent.com/document/product/1047/37171)  
- [Obtaining User Attributes](https://intl.cloud.tencent.com/document/product/1047/37169)  
- [Adding User Tags](https://intl.cloud.tencent.com/document/product/1047/37173)  
- [Obtaining User Tags](https://intl.cloud.tencent.com/document/product/1047/37172)  
- [Deleting User Tags](https://intl.cloud.tencent.com/document/product/1047/37174)  
- [Deleting All Tags of a User](https://intl.cloud.tencent.com/document/product/1047/37175)  
