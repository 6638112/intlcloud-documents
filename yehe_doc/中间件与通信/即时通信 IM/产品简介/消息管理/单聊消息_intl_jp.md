## ユースケース
- **Appでの2人チャット**
シングルチャットメッセージは、QQフレンドやWeChatフレンドのチャットモードのように、アプリで2人チャットをするのに適しています。
- **App管理者のメッセージ送信**
シングルチャットメッセージは、App管理者がバックエンドで送信できます。また、他のユーザーをシミュレーションしてメッセージを送信することもできます。
- **App管理者によるシステムメッセージのシミュレーション**
App管理者がバックエンドでメッセージを送信することによって、システムメッセージをシミュレーションし、システムメッセージの形式でユーザーに通知することができます。App端末は、App管理者からカスタムメッセージを受信すると、特殊処理を行うことができます。

Instant Messagingは、パーフェクトなシングルチャットメッセージング機能を提供します。同時に、シングルチャットメッセージのアクセス権限制御および拡張機能も提供して、お客様によるメッセージの記録、複数端末の同期、オフラインメッセージのプッシュおよび送信者情報の伝達といった機能の実装をお手伝いします。


## シングルチャットメッセージタイプ

| 機能タイプ     | 機能の説明                                                     |
| ------------ | ------------------------------------------------------------ |
| テキストメッセージ     | メッセージの内容は通常のテキストです                                           |
| 顔文字     |顔文字は開発者向けにカスタマイズされています                                       |
| 地理的位置メッセージ | メッセージの内容は、地名、経度、緯度の情報です                       |
| 画像メッセージ     | メッセージの内容は、画像のURLアドレス、サイズ、画像サイズなどの情報であり、サポートする最大の画像サイズは28Mです                |
| 音声メッセージ     | メッセージの内容は、音声ファイルのURLアドレス、サイズ、長さなどの情報であり、サポートする最大の音声ファイルサイズは28Mです                         |
| ファイルメッセージ     | メッセージの内容は、ファイルのURLアドレス、サイズ、形式などの情報であり、形式に制限はなく、サポートする最大のファイルサイズは100Mです                |
| UGSVメッセージ   | メッセージの内容は、UGSVファイルのURLアドレス、長さ、サイズ、形式などの情報であり、サポートする最大のUGSVメッセージのファイルサイズは100Mです |
| カスタムメッセージ   | Red Packetメッセージ、ジャンケンなど、開発者がカスタマイズしたメッセージタイプです |
| システム通知メッセージ | 内蔵されているシステム通知メッセージと開発者がカスタマイズしたシステム通知メッセージがあります             |


## シングルチャットメッセージ機能

| シングルチャットメッセージ機能 | 機能の説明                        | ユースケース                                                     |
| ------------ | ------------------------------- | ------------------------------------------------------------ |
| シングルチャットメッセージの送信 | シングルチャットメッセージはSDKとREST APIを使用して送信できます | App内の2人チャット<br>App管理者によるメッセージの送信<br>App管理者によるシステムメッセージのシミュレーション |
| シングルチャットメッセージの受信 | シングルチャットメッセージはSDKを使用して受信できます           | オンラインメッセージの受信<br>オフラインメッセージの受信<br>メッセージ履歴のクエリー             |


## シングルチャットメッセージ権限制御

| シングルチャットメッセージ権限制御                   | 機能の説明                               | ユースケース                                                    |
| ---------------------------------- |------------------------------------- | -------------------------------------------------------- |
| App内の任意のユーザー2人の間でシングルチャットメッセージを送信 | 任意の知らない2人へのメッセージ送信をサポートします             | 知らない人へのメッセージの送信                                              |
| App管理者のシングルチャットメッセージの送信             | App管理者は任意のユーザーにシングルチャットメッセージを送信できます | App管理者による他のユーザーとしてのメッセージ送信のシミュレーション <br> App管理者によるシステムメッセージのシミュレーション |
| 友達にのみメッセージの送信を許可               | 友達へのメッセージ送信のみをサポートします                    | 友達へのメッセージの送信                                              |
| 特定の相手からのメッセージの拒否                 | ブラックリストによって特定のユーザーから来たメッセージを拒否できます       | フレンドシップの解除  <br>     特定の相手からのメッセージの拒否                           |


## シングルチャットメッセージ拡張機能

| シングルチャットメッセージ拡張機能 | 機能の説明                        | ユースケース                                                     |
| ------------------------ | ----------------------------------------------------------- | --------------------------------------- |
| チャットレコードの取得             | SDKまたはREST APIを使用してメッセージ履歴を取得できます                        | リアルタイムチャットレコードの取得    <br>  メッセージログを定期的にダウンロード |
| マルチターミナルの同期               | シングルチャットメッセージのマルチターミナルの同期をサポートします                                      | ユーザーのマルチターミナルのメッセージ同期                        |
| シングルチャットメッセージのオフラインプッシュ         | Apple、Huawei、Xiaomi、OPPO、vivo、Meizuといったブランドの携帯電話のオフラインプッシュをサポートします | メッセージのオフラインプッシュ                            |
| シングルチャットメッセージに付帯する送信者情報 |  シングルチャットメッセージに送信者情報を付帯させることができます                                  | 送信者のニックネーム、プロフィール画像などの表示                  |

## シングルチャットオフラインメッセージ処理フロー
![](https://main.qcloudimg.com/raw/d28999fa32da4e5e6750f34117e116bb.png)

#### シングルチャットメッセージのオフラインキャッシュおよびローミング処理フロー

1. ユーザーAが`sendMessage`を呼び出してユーザーBにメッセージを送信します。ユーザーBはオフライン状態です。
  - ユーザーAをユーザーBの最新の連絡先に追加します。キャッシュサイズは100エントリです。
  - メッセージをオフラインキャッシュに保存します(期限は7日)。
  - メッセージをローミングサーバーに保存します(期限は7日)。
2. ユーザーBが`login`インターフェースを呼び出してIMにログインします。
3. SDKはオフラインキャッシュ内のメッセージを自動的にプルし、`OnNewMessage`を介してメッセージをスローします。
4. SDKは最新の連絡先を自動的にプルし、`OnNewMessage`インターフェースを介してスローします。
5. メッセージ同期プロセスが完了すると、`OnRefresh`インターフェースを介してメッセージの同期が完了したことをユーザーに通知します。
6. ユーザーが`getMessage`を呼び出します。ローカルメッセージが不完全な場合、SDKは自動的にローミングサーバーをプルします。

