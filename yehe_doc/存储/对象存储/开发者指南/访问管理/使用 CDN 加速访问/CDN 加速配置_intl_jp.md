## 適用ケース
- レスポンス遅延およびダウンロード速度に対する要件が比較的厳しいケース。
- 地域、国、大陸を越えて数GBから数TBのデータを転送する必要があるケース。
- 同一のコンテンツを集中的に繰り返しダウンロードする必要があるケース。

>!ダウンロードリクエストがTencent Cloud VPC内（例えばTencent Cloud CVMを使用したバケットへのアクセスなど）の場合は、COSの標準ドメイン名をそのまま使用することをお勧めします。CDNアクセラレーションドメイン名を使用すると、ユーザーはパブリックネットワークを経由してCDNノードにアクセスしたことになり、CDN back-to-originトラフィック料金、CDNトラフィック料金などが追加で発生します。
>

## 関連説明

ドメイン名の定義、CDN back-to-origin認証およびCDN認証設定に関しては、[CDNアクセラレーションの概要](https://intl.cloud.tencent.com/document/product/436/18669)のドキュメントでご紹介しているため、ここには記載しません。

CDN back-to-origin認証、CDN認証設定はCDNアクセラレーションドメイン名およびCOSドメイン名のオリジンサーバーバケットへのアクセス方式に影響する場合があります。具体的には下表のとおりです。

| バケットへのアクセス権限       | CDN back-to-origin認証を有効にしているか | CDN認証設定を有効にしているか | CDNアクセラレーションドメイン名によって<br>オリジンサーバーにアクセス可能か | COSオリジンサーバードメイン名によって<br>オリジンサーバーにアクセス可能か | 適用ケース     |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| パブリック読み取り              | 無効         | 無効         | アクセス可          | アクセス可          | 全サーバーパブリックアクセス |
| パブリック読み取り              | 有効         | 無効         | アクセス可          | アクセス可          | 非推奨       |
| パブリック読み取り              | 無効         | 有効         | URLを使用した認証が必要 | アクセス可          | 非推奨       |
| パブリック読み取り              | 有効         | 有効         | URLを使用した認証が必要 | アクセス可          | 非推奨       |
| プライベート読み取り+CDNサービス権限承認 | 有効         | 有効         | URLを使用した認証が必要 | COSを使用した認証が必要 | 全リンク保護   |
| プライベート読み取り+CDNサービス権限承認 | 無効         | 有効         | URLを使用した認証が必要       | COSを使用した認証が必要 | 非推奨       |
| プライベート読み取り+CDNサービス権限承認 | 有効         | 無効         | アクセス可          | COSを使用した認証が必要 | オリジンサーバー保護    |
| プライベート読み取り+CDNサービス権限承認 | 無効         | 無効         | アクセス不可        | COSを使用した認証が必要 | 非推奨       |
| プライベート読み取り              | 無効         | 有効または無効   | アクセス不可        | COSを使用した認証が必要 | CDN利用不可 |

>!上記の表中の**オリジンサーバー保護**のケースでは、CDN認証設定を有効にしていない場合、CDNエッジノードにキャッシュしたデータが悪意をもってプルされるおそれがあるため、同時にCDN認証設定を有効にすることでデータの安全性を保障するよう、強く推奨します。

## CDNアクセラレーションの設定

COSコンソールではデフォルトCDNアクセラレーション、カスタムCDNアクセラレーションという2つの方式をご提供しています。

### デフォルトCDNアクセラレーション

デフォルトのCDNアクセラレーションドメイン名は、COSがバケットに自動的に割り当てるCDNアクセラレーションドメイン名であり、形式は`BucketName-APPID.file.myqcloud.com`です。CDNアクセラレーションドメイン名を有効にすると、このドメイン名によってアクセスのアクセラレーションを体験できます。

>!2022年5月9日より、Cloud Object Storage（COS）サービスではデフォルトのCDNアクセラレーションドメイン名の新規追加をサポートしないことになりました。すでに有効化している、または過去に有効化したことのあるデフォルトのCDNアクセラレーションドメイン名には影響はなく、引き続きご利用いただけますが、デフォルトのCDNアクセラレーションドメイン名の代わりにカスタムCDNアクセラレーションドメイン名を使用することをお勧めします。カスタムCDNアクセラレーションドメイン名の操作ガイドについては、[カスタムCDNアクセラレーションドメイン名の有効化](https://intl.cloud.tencent.com/document/product/436/31506)のドキュメントをご参照ください。

#### 操作手順

#### 1. バケットの選択
[COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側ナビゲーションバーの**バケットリスト**をクリックし、アクセラレーションしたいバケットをクリックして、バケット管理ページに進みます。

#### 2. 設定ページに進む
>!Tencent Cloud CDNサービスをまだご利用でないユーザーは**ドメイン名管理**に進むことができません。先に[CDNコンソール](https://console.cloud.tencent.com/cdn)でCDNサービスをアクティブ化する必要があります。

左側の**ドメイン名と伝送管理>デフォルトのCDNアクセラレーションドメイン名**をクリックし、**デフォルトのCDNアクセラレーションドメイン名**設定項目を見つけます。デフォルトのCDNアクセラレーションドメイン名は初期ステータスでは**無効**になっています。**編集**をクリックし、現在のステータスを**有効**に設定した後、次の設定項目説明に従って設定を行います。
![](https://main.qcloudimg.com/raw/a027d3ae128de8349db903b8f1833019.png)

 - **アクセラレーションドメイン名**：デフォルトのCDNアクセラレーションドメイン名は、COSがバケットに自動的に割り当てるCDNアクセラレーションドメイン名であり、形式は`BucketName-APPID.file.myqcloud.com`です。CDNアクセラレーションドメイン名を有効にすると、このドメイン名によってアクセスのアクセラレーションを体験できます。
 - **アクセラレーションリージョン**：中国本土、中国本土以外およびグローバルアクセラレーションをサポートしています。グローバルアクセラレーションとは、すべてのリージョン間でのバケットアクセラレーションをサポートすることを指します。
 - **オリジンサーバーのタイプ**：デフォルトでは**デフォルトオリジンサーバー**です。オリジンサーバーにしているバケットで静的ウェブサイトを有効にし、かつ静的ウェブサイトのアクセラレーションを行いたい場合は、オリジンサーバーのタイプを**静的ウェブサイトのオリジンサーバー**に設定することができます。具体的には、[CDNアクセラレーションの概要](https://intl.cloud.tencent.com/document/product/436/18669)をご参照ください。
 - **オリジンサーバードメイン名**：COSオリジンサーバーのドメイン名であり、バケットの作成時に、システムがバケット名およびリージョンに基づいて自動的に生成するもので、デフォルトのCDNアクセラレーションドメイン名と区別する必要があります。

#### 3. back-to-origin認証の有効化（オプション）

>!プライベート読み取りバケットに対して、back-to-origin認証とCDNサービス権限承認を有効化すると、CDNエッジノードがオリジンサーバーへアクセスする際に署名を必要としないため、CDNキャッシュリソースがパブリックネットワーク配信を行い、データセキュリティに影響する場合があります。このためCDN認証を有効化することを強く推奨します。

back-to-origin認証は、CDNエッジノードのサービスIDを検証し、不正アクセスを阻止するために用いられます。具体的には次のとおりです。
- パブリック読み取りバケット：CDNエッジノードに何の権限承認を行わなくても、バケットに直接アクセスできるため、back-to-origin認証を有効にする必要はありません。
- プライベート読み取りバケット：CDNエッジノードはback-to-origin認証によるサービスIDの検証を受ける必要があり、検証に合格したCDNエッジノードのみがバケット内のオブジェクトにアクセスできます。


（1）CDNサービス権限承認の完了

>?back-to-origin認証を有効にする前に、CDNサービス権限承認を追加しておく必要があります。

操作手順は次のとおりです。
CDNサービス権限承認の追加とは、CDNエッジノードに対し、バケットの操作を行えるサービスIDを付与することを指します。具体的には次のとおりです。
- パブリック読み取りバケット：CDNエッジノードに何の権限承認も行わなくても、バケットに直接アクセスできるため、CDNサービス権限承認を追加する必要はありません。
- プライベート読み取りバケット：CDNエッジノードに特別なサービスIDを付与しなければバケットにアクセスすることはできません。**CDNサービス権限承認の追加**をクリックして、CDNエッジノードに対しサービスIDを付与し、**上記の権限承認に同意します**を選択し、**OK**をクリックします。

CDNサービス権限承認を完了すると、CDNエッジノードはバケットに対しGet Object、Head Object、Options Objectの3つの操作を行えるようになります。システムはバケットアクセスポリシーを自動的に書き込みます。ポリシーの例は次のとおりです。これ以降、CDNノードはback-to-originが必要な場合にその他の操作を行う必要がなくなります。

```xml
  {
    "Statement": [
      {
        "Action": [
          "name/cos:GetObject",
          "name/cos:HeadObject",
          "name/cos:OptionsObject"
        ],
        "Effect": "allow",
        "Principal": {
          "qcs": [
            "qcs::cam::uin/100000000001:service/cdn"
          ]
        },
        "Resource": [
          "qcs::cos:ap-chengdu:uid/1250000000:examplebucket-1250000000/*"
        ]
      }
    ],
    "version": "2.0"
  }
```

（2）権限承認が完了したことを確認後、**back-to-origin認証**をクリックして有効化できるようになります。

![](https://main.qcloudimg.com/raw/58c92ca577ca99d1fd5d9523e25dcec4.png)


#### 4. CDNアクセラレーションの有効化
**保存**をクリックすると、デフォルトのCDNアクセラレーションドメイン名がデプロイ中と表示されます（設定は約5分で完了します）。

#### 5. CDN認証の設定

>!デフォルトのCDNアクセラレーションを有効化すると、このドメイン名によって誰でもオリジンサーバーに直接アクセスできるようになります。データに一定のプライバシーが存在する場合は、必ず**認証設定を有効**にして、オリジンサーバーデータを保護してください。

 - デフォルトのCDNアクセラレーションドメイン名とback-to-origin認証を有効にすると、デフォルトのCDNアクセラレーションドメイン名管理画面の下にCDN認証ステータスの表示があらわれます。表示された**認証設定**から、対応するドメイン名の**アクセス制御**ページに直接ジャンプして設定を行うことができます。
![](https://main.qcloudimg.com/raw/a878861f79ea47e27c127c5b5dff4eb4.png)
 - もしくは、[CDNコンソール](https://console.cloud.tencent.com/cdn)に進み、**ドメイン名管理**をクリックした後、デフォルトのCDNアクセラレーションドメイン名をクリックして選択し、最後に**アクセス制御**>**認証設定**をクリックします。具体的な設定手順については[認証設定](https://intl.cloud.tencent.com/document/product/228/35237)をご参照ください。

#### 6. 機能の無効化

上記の手順が完了すると、 デフォルトのCDNアクセラレーションの有効化が完了します。デフォルトのCDNアクセラレーションを無効化したい場合は、次の方法で行うことができます。

- デフォルトのCDNアクセラレーションドメイン名管理画面で**編集**をクリックし、ステータスを**有効**から**無効**に変更し、**保存**をクリックします。デプロイには約5分かかります。デプロイの完了後、CDNコンソール上でそのドメイン名のステータスは**有効化済み**から**無効化済み**に変わります。
- [CDNコンソール](https://console.cloud.tencent.com/cdn)でドメイン名の無効化/削除操作を行うことができます。詳細については、[ドメイン名の操作](https://intl.cloud.tencent.com/document/product/228/5736)をご参照ください。

>!CDNコンソールで削除するのは、デフォルトのCDNアクセラレーションドメイン名がCDNアクセラレーションを行った際のレコードのみであり、デフォルトのCDNアクセラレーションドメイン名自体を完全に抹消するわけではありません。CDNアクセラレーションを再度有効化したい場合は、COSコンソール上でデフォルトのCDNアクセラレーションドメイン名を再び有効化することができます。



### カスタムCDNアクセラレーション


ユーザーはCOSコンソール上でバケットにカスタムドメイン名をバインドした後、カスタムドメイン名でCDNアクセラレーションを有効にし、最後にカスタムドメイン名によってバケットへのアクセスをアクセラレーションすることができます。カスタムドメイン名をバインドする際、ユーザーはご自身でカスタムドメイン名のサービスプロバイダにCNAME解決の追加を依頼する必要があります。

>! 現在COSでカスタムアクセラレーションドメイン名を使用している場合はCDNを有効にする必要があります。ご自身の状況に応じて判断してください。
1. ドメイン名で国内のCDNにアクセスするには、ICP登録が必要です。ただしICP登録はTencent Cloudを通じて行わなくてもよく、アクセスするドメイン名が確実にICP登録されていればアクセスできます。
2. ドメイン名で海外のCDNにアクセスする場合は、ICP登録の必要はありません。ただし、Tencent Cloud上で保存するデータおよび操作行為については、関係国の法律法令、ならびに[『Tencent Cloudサービス契約』](https://intl.cloud.tencent.com/document/product/301/12905)を遵守する必要があることに必ずご注意ください。

#### 前提条件

#### カスタムドメイン名の取得とICP登録

1. ドメイン名を登録していること。Tencent Cloudの[ドメイン名登録](https://console.cloud.tencent.com/domain)またはその他のサービスプロバイダを通じてドメイン名を登録できます。
2. ドメイン名のICP登録を行っていること。ドメイン名で国内のCDNにアクセスするには、ドメイン名のICP登録を完了していることが必要です。具体的な説明はICP登録ガイドをご参照ください。

#### 操作手順

>!カスタムドメイン名の追加およびCDNアクセラレーションの有効化は、COSコンソールとCDNコンソールのどちらでも行うことができます。CDNコンソールからカスタムドメイン名を追加したい場合は、 [ドメイン名へのアクセス](https://intl.cloud.tencent.com/document/product/228/5734)をご参照ください。

#### 1. バケットの選択
[COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側ナビゲーションバーの**バケットリスト**をクリックし、アクセラレーションしたいバケットをクリックして、バケットに進みます。

#### 2. カスタムCDNアクセラレーションドメイン名の追加
**ドメイン名と伝送管理>カスタムCDNアクセラレーションドメイン名**をクリックし、**カスタムCDNアクセラレーションドメイン名**の設定項目で**ドメイン名の追加**をクリックし、設定可能な状態にします。
- **ドメイン名**：購入済みのドメイン名を入力します（例：`www.example.com`）。
- **アクセラレーションリージョン**：中国本土、中国本土以外およびグローバルアクセラレーションをサポートしています。グローバルアクセラレーションとは、すべてのリージョン間でのバケットアクセラレーションをサポートすることを指します。
**オリジンサーバータイプ**：デフォルトでは**デフォルトオリジンサーバー**ですが、選択したバケットで静的ウェブサイト機能が有効化されており、なおかつ静的ウェブサイトアクセラレーションを希望する場合は、オリジンサーバーのタイプを**静的ウェブサイトオリジンサーバー**に設定することができます。

#### 3. back-to-origin認証の有効化（オプション）
back-to-origin認証は、CDNエッジノードのサービスIDを検証し、不正アクセスを阻止するために用いられます。具体的には次のとおりです。

- パブリック読み取りバケット：CDNエッジノードに何の権限承認を行わなくても、バケットに直接アクセスできるため、back-to-origin認証を有効にする必要はありません。
- プライベート読み取りバケット：CDNエッジノードはback-to-origin認証によるサービスIDの検証を受ける必要があり、検証に合格したCDNエッジノードのみがバケット内のオブジェクトにアクセスできます。**back-to-origin認証**の有効化を選択します。
![](https://main.qcloudimg.com/raw/da5fe7285a8a2932cfb015c361472202.png)
>!プライベート読み取りバケットに対して、back-to-origin認証を有効化すると、CDNエッジノードがオリジンサーバーへアクセスする際に署名を必要としないため、CDNキャッシュリソースがパブリックネットワーク配信を行い、データセキュリティに影響する場合があります。このためCDN認証を有効化することを強く推奨します。

**back-to-origin認証**を有効化した後、右側の**保存**をクリックし、約5分待つと、カスタムドメイン名の追加とCDNアクセラレーションのデプロイが完了します。

#### 4. CDN認証の設定
>!カスタムドメイン名でCDNアクセラレーションを有効化すると、このドメイン名によって誰でもオリジンサーバーに直接アクセスできるようになります。データに一定のプライバシーが存在する場合は、必ず認証設定を有効にして、オリジンサーバーデータを保護してください。

カスタムドメイン名のデプロイが完了すると、CDN認証欄にCDN認証機能設定リンクが表示されます。**設定**をクリックすると、CDNコンソールに直接進んでCDN認証設定を行うことができます。具体的な操作方法については、[認証設定](https://intl.cloud.tencent.com/document/product/228/35237)をご参照ください。

#### 5. CDNキャッシュの自動更新の設定
有効化すると、COSバケットのファイル更新ルールをトリガーした際にCDNキャッシュを自動更新します。COSの関数の計算で設定できます。操作ガイドは[CDNキャッシュ更新の設定](https://intl.cloud.tencent.com/document/product/436/37273)をご参照ください。


#### 6. ドメイン名の解決

カスタムドメイン名でCDNにアクセスすると、システムから自動的にCNAMEドメイン名（`.cdn.dnsv1.com`を拡張子とするもの）が割り当てられます。お客様はドメイン名サービスプロバイダにCNAME設定を完了するよう依頼する必要があります。具体的には[CNAME設定](https://intl.cloud.tencent.com/document/product/228/3121)をご参照ください。

>!CNAMEドメイン名には直接アクセスできません。


#### 7. 証明書の設定（オプション）

カスタムドメイン名にHTTPS証明書を追加する必要がある場合は、[CDNコンソール](https://console.cloud.tencent.com/cdn/certificate)で設定できます。 

#### 8. 機能の無効化

上記の手順が完了すると、 カスタムドメイン名によってバケット内のリソースにアクセスできるようになります。カスタムCDNアクセラレーションを無効化したい場合は、次の方法で行うことができます。

カスタムCDNアクセラレーションドメイン名管理画面で、**編集**をクリックするとドメイン名のステータスを変更できます。ドメイン名のステータスを**オンライン**から**オフライン**に変更し、**保存**をクリックしてデプロイされるまで待ちます。約5分で機能が無効化されます。CDNコンソール上では対応するカスタムアクセラレーションドメイン名のステータスが**有効化済み**から**無効化済み**に変わります。

>!カスタムドメイン名を削除したい場合、カスタムドメイン名のステータスが**オンライン**の場合は、ドメイン名を直接削除することはできません。ステータスを必ず**オフライン**にしてからドメイン名を削除してください。無効化または削除の操作は[CDNコンソール](https://console.cloud.tencent.com/cdn)で行うことができます。詳細については、[ドメイン名の操作](https://intl.cloud.tencent.com/document/product/228/5736)をご参照ください。


