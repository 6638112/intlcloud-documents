
## メタデータアクセラレーターの概要

メタデータアクセラレーターはTencent Cloud COS（Cloud Object Storage）サービス向けにハイパフォーマンスなファイルシステム機能をご提供します。メタデータアクセラレーターの基盤にはCloud HDFSの優れたメタデータ管理機能を採用し、ユーザーがファイルシステムのセマンティクスによってCOSサービスにアクセスできるようサポートします。システム設計指標は帯域幅2.4Gb/s、10万レベルのQPSおよびミリ秒レベルの遅延を実現可能です。バケットでメタデータアクセラレーターを有効にすることで、ビッグデータ、ハイパフォーマンスコンピューティング、機械学習、AIなどのシーンに幅広く応用できます。メタデータアクセラレーターの詳細な説明に関しては、[メタデータアクセラレーター](https://intl.cloud.tencent.com/document/product/436/43305)をご参照ください。

## HDFSプロトコルを使用したアクセスのメリット

これまでのCOSをベースにしたビッグデータアクセスには主にHadoop-COSツールが使用されてきました。Hadoop-COSツールの内部ではHCFSインターフェースをCOSのRestfulインターフェースに適用することで、COS上のデータへのアクセスを可能にしています。COSとファイルシステムではメタデータの構成方法に違いがあるため、メタデータの操作性能にも差異があり、ビッグデータの分析性能に影響を及ぼしています。メタデータアクセラレーターを有効にしたBucketは、HCFSプロトコルとの間に完全な互換性を有し、ネイティブのHDFSインターフェースを使用して直接アクセスできます。HDFSプロトコルをオブジェクトのプロトコルに変換するコストが不要なだけでなく、高効率なディレクトリのアトミックRename、ファイルのAtime、Mtime更新、高効率なディレクトリのDU統計、Posix ACL権限サポートなどの、ネイティブHDFSのいくつかの機能もご提供可能です。


## 準備作業

1. 下図のように、COSバケットを作成し、メタデータアクセラレーターを有効にします。

2. 下図のように、Bucketの作成完了後、バケットの**ファイルリスト**のページに進み、コンソール上でファイルのアップロードおよびダウンロード操作を行うことができます。

3. 下図のように、左側メニューバーの**パフォーマンス設定 > メタデータアクセラレーション機能**をクリックすると、メタデータアクセラレーション機能が有効になっていることを確認できます。**メタデータアクセラレーションを有効にしたい**バケットを初めて作成した場合は、表示に従って対応する権限承認操作を行う必要があります。クリックして権限承認を完了すると、HDFSプロトコルが自動的に有効化され、デフォルトのBucketマウントポイント情報を見ることができるようになります。

>?対応するHDFSファイルシステムが見つからないと表示される場合は、[チケットを提出](https://console.cloud.tencent.com/workorder/category)をクリックしてお問い合わせいただければ、サポートを受けることができます。
>
4. HDFSプロトコルスイッチをオンにした後、VPCのアクセス権限を設定する必要があります。下図のように、HDFS権限設定タグページで、権限設定追加ボタンをクリックし、VPCネットワーク名の列でコンピューティングクラスターのあるVPCネットワークアドレスを選択し、ノードのIPアドレス列に、VPCネットワークセグメント下で開放したいIPアドレスまたはIPセグメントを入力します。アクセスのタイプは読み取り/書き込みまたは読み取り専用を選択し、設定完了後に保存をクリックします。

>? HDFSの権限設定とネイティブのCOS権限システムとの間には違いがあります。HDFSプロトコルを使用してアクセスする際は、ネイティブHDFSと同じ権限を取得するのに便利なため、HDFS権限設定によってVPC内のマシンを指定してCOSバケットにアクセスすることをお勧めします。
5. HDFSプロトコルはデフォルトではネイティブPOSIX ACL方式の認証を使用します。Ranger認証を使用したい場合は、下図のように、HDFS認証モデルの下でRanger認証モデルを選択し、Rangerに対応するアドレス情報を設定することができます。

>?[HDFSranger認証](https://intl.cloud.tencent.com/document/product/1106/41973)のドキュメントを参照してRangerサービスを設定し、RangerサービスによってHDFSプロトコルでCOSにアクセスすることができます。
>
6. 環境を作成後、コンピューティングクラスターで`core-site.xml`を設定する必要があります。具体的には、[HDFSプロトコルの設定](https://intl.cloud.tencent.com/document/product/1106/41965)のドキュメントを参照して設定してください。Tencent Cloud EMRをご利用の場合は、EMRのデフォルト設定をそのまま使用することができ、別途設定する必要はありません。
>!`fs.ofs.bucket.region`は必ず設定する必要があります。このパラメータは、`ap-shanghai`のようなバケットの所在COSリージョンを指定するために用いられます。
>
7. HDFSプロトコルアクセスの[クライアントインストールパッケージ](https://github.com/tencentyun/chdfs-hadoop-plugin/tree/master/jar)をダウンロードします。インストールパッケージのバージョンが2.7以上であることをご確認ください。ダウンロード後、インストールパッケージをHadoopクラスター内の各サーバーの正確な`classpath`パスに配置します（例： `/usr/local/service/hadoop/share/hadoop/common/lib/`。コンポーネントによって配置する位置が異なる可能性があるため、実際の状況に応じて配置してください）。その後、`Yarn`、`Hive`、`Presto`、`Impala`などの常駐サービスを再起動します。
8. すべての環境設定が完了後、下図のように、クライアントでHadoopコマンドラインを使用してマウントが成功したかどうかを確認できます。
![](https://qcloudimg.tencent-cloud.cn/raw/90264cdfe35753b95d48db5ab6675629.png)
9. また、下図のように、[COSコンソール](https://console.cloud.tencent.com/cos)にログインしてバケットファイルリストを確認し、ファイルとディレクトリが一致しているかどうかを明らかにすることもできます。


## HDFSプロトコルを使用したCOSへのアクセス

ビッグデータのシーンでは、次の手順を参照して、メタデータアクセラレーション機能を有効にしたバケットにHDFSプロトコルを使用してアクセスすることができます。

1. 準備作業の中で示したように、`core-stie.xml`でHDFSプロトコルに関連するマウントポイントの情報を設定します。
2. Hive、MR、Sparkなどのコンポーネントによってバケットにアクセスします。[コンピューティングクラスターにおけるCOSバケットのマウント](https://intl.cloud.tencent.com/document/product/436/46199)をご参照ください。
3. デフォルトでは、ネイティブ`POSIX ACL`方式の認証を使用します。`Ranger1認証`を使用したい場合は、`Ranger`の関連原理および実践を参照してアクセスできます。 [CDHクラスター上でのHDFSプロトコルによるCOSアクセス](https://intl.cloud.tencent.com/document/product/436/46200)をご参照ください。


