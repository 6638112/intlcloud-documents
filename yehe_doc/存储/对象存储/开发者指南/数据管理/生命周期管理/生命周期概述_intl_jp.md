## 概要

Cloud Object Storage（COS）はオブジェクトベースのライフサイクル設定をサポートしています。これはバケットに対して指定の記述言語を送信することで、ルールに該当するオブジェクトに、指定の条件下でいくつかのアクションを自動的に実行させることができるものです。

>?
>- ライフサイクルの設定は最長3650日までサポートしています。
>- 各バケットに追加できるライフサイクルルールは1000個までです。

## ユースケース

### ログの記録

ユーザーがCOSを使用してログデータを保存している場合は、ライフサイクルの設定によって、ログデータを30日後に自動的にアーカイブしたり、2年後に自動的に削除したりすることができます。

### コールドデータとホットデータの階層分離

ホットデータはアップロード後、短時間のうちに大量にアクセスされ注目度が高まりますが、一定期間が過ぎると注目度が徐々に低下したり、リアルタイムでのアクセスが必要なくなったりします。ライフサイクルルールによって、30日前のデータを低頻度ストレージに切り替えることや、さらに60日前のデータをアーカイブストレージに切り替えることができます。このプロセスはデータの移行と呼ばれます。

### アーカイブ管理

COSを使用してファイルアーカイブを管理する際、しばしば金融、医療などのコンプライアンス要件に基づき、ファイルのすべての過去バージョンを長期保存する必要が生じます。このような場合、ライフサイクル機能を使用することで、過去バージョンのファイルをアーカイブに移行するアクションを実行できます。

## 設定の要素

### 操作

- データ移行：作成したオブジェクトを、指定の時間以降、低頻度ストレージ、INTELLIGENT_TIERINGストレージ、アーカイブストレージ、ディープアーカイブストレージタイプに移行します。
- 期限切れの削除：オブジェクトの有効期限を設定し、オブジェクトが期限切れとなった後に自動的に削除します。

### リソース

- プレフィックス区分に基づく：プレフィックスルールにマッチするオブジェクトはすべてルールに従って処理を実行します。
- バージョン管理に基づく：現在のバージョンではないオブジェクトはルールに従って処理を実行します。
- 削除マーカーに基づく：オブジェクトの過去のバージョンをすべて消去する際、削除マーカーの除去を指定することができます。
- 未完了のマルチパートアップロードに基づく：未完了のマルチパートアップロードタスクに対し処理を実行します。

### 時間条件

- 日数に基づく計算：ルールに対応する動作を、オブジェクトの最終変更日から何日後に実行するかを明確に指定します。
- 日付に基づく計算：ルールに対応する動作を、指定の日付に実行することを明確に指定します。

## 利用説明

>?ライフサイクルの使用方法に関しては、[ライフサイクルの設定](https://intl.cloud.tencent.com/document/product/436/17031)をご参照ください。

### データ移行

#### サポートするリージョン

パブリッククラウドリージョンでサポートしています。金融クラウドリージョンでは低頻度ストレージタイプへのデータ移行のみサポートしています。

#### 単方向性の原則

データ移行は単方向性であり、標準ストレージ > 低頻度ストレージ > INTELLIGENT_TIERINGストレージ > アーカイブストレージ > ディープアーカイブストレージの順序のみ許容されます。階層をスキップしての移行（標準ストレージ > アーカイブストレージ）も可能ですが、逆方向への移行はできません。[PUT Object - Copy](https://intl.cloud.tencent.com/document/product/436/10881)（アーカイブストレージ/ディープアーカイブストレージタイプ以外）、または[POST Object restore ](https://intl.cloud.tencent.com/document/product/436/12633)（アーカイブストレージ/ディープアーカイブストレージタイプにのみ適用）を呼び出すことでのみ、コールドストレージタイプのデータをホットストレージタイプに復元することができます。

#### 最終的な整合性

同一グループのオブジェクトに複数のルールを設定していて、競合が生じている場合（期限切れ削除設定は含まない）、COSは最もコールドなストレージタイプへの移行ルールを優先的に実行します。例えば、同一グループのオブジェクトに**低頻度ストレージへの移行**と**アーカイブストレージへの移行**のルールが設定されている場合は、**アーカイブストレージへの移行**のルールが優先的に実行されます。
>! Tencent Cloud COSでは、同一グループのオブジェクトに対し、複数の競合条件を含むライフサイクルルールを設定しないよう強く注意喚起しています。競合がある状態で実行すると、料金が変わる可能性があります。
>

### 期限切れの削除

#### 処理ロジック

オブジェクトが指定された期限切れ削除のライフサイクルルールにマッチした場合、Tencent Cloudはオブジェクトを非同期の削除キューに追加します。実際に削除される時間は作成時間から一定程度遅延する場合があります。GETまたはHEAD Object操作によってオブジェクトの現在のステータスを取得することができます。

#### 最終的な整合性
同一グループのオブジェクトに複数のルールを設定していて、競合が生じている場合、COSは最短の有効期限に準じて実行します。また、**期限切れ削除の実行エフェクトはストレージタイプの切り替えより強いものになります**。

>! Tencent Cloud COSでは、同一グループのオブジェクトに対し、複数の競合条件を含むライフサイクルルールを設定しないよう強く注意喚起しています。競合がある状態で実行すると、料金が変わる可能性があります。
>

### コストの注意点

#### 実行の説明

任意の時刻に送信された設定について、Tencent Cloud COSは北京時間（GMT+8）の翌日0時を基準として操作の実行を開始します。非同期キューでの実行のため、設定後にアップロードしたオブジェクトがルールにマッチしている場合は、通常遅くとも翌日の24時までに操作が完了します。

例えば、1日の午後3時に、ファイルを変更から1日後に削除するというライフサイクルルールを設定したとします。その場合、ライフサイクルタスクは2日0時から、2日0時以前の時点で最終変更時刻から1日以上過ぎているファイルのスキャンを開始し、削除タスクを実行します。1日当日にアップロードしたファイルは、最終変更時刻から1日経っていないため削除されず、3日0時になってからスキャンと記録が行われ、削除が実行されます。

ライフサイクル実行のエフェクトには予期しない状況や、バケットに大量の既存オブジェクトが含まれる状況は含まれません。他の状況が原因で完了していない場合は、GETまたはHEAD Object操作によってオブジェクトの現在のステータスを取得することができます。

現在Tencent Cloudはライフサイクルの実行エフェクトについて請求書の承諾をご提供していません。すなわち、オブジェクトの料金はライフサイクルの実行が完了した時点で変更されます。

#### 時間に対するあいまいさ

低頻度ストレージとINTELLIGENT_TIERINGストレージタイプは30日以上、アーカイブストレージタイプは90日以上、ディープアーカイブストレージタイプは180日以上の保存期間がそれぞれ必要であることにご注意ください。データ移行または削除を実行する際に追加のストレージ料金は発生しません。Tencent Cloud COSは30/90/180日未満のライフサイクル設定をチェックしないため、正しい設定をお客様ご自身の必要性に応じて実行する必要があります。

例えば、ある低頻度ストレージのオブジェクトについて、保存期間が30日に達する前に移行が実行された場合、これによってその当日にオブジェクトのアーカイブストレージタイプ料金が発生すると同時に、低頻度ストレージの料金も30日目まで引き続きかかります。あるアーカイブストレージオブジェクトについて、保存期間が90日に達する前に削除が実行された場合、そのオブジェクトのアーカイブストレージタイプ料金は90日目まで継続して課金されます。データがディープアーカイブストレージに移行された場合も同様です。

#### サイズ制限

低頻度ストレージ、アーカイブストレージおよびディープアーカイブストレージにはそれぞれ、オブジェクトの最小占有容量の制限が設けられています。例えば、低頻度ストレージに64KB未満のファイルをアップロードした場合は、64KBとして計算されます。ユーザーコストを抑えるため、ライフサイクルは64KB未満のオブジェクトに対してはストレージタイプ切り替えの操作を実行しません。 

>? ライフサイクルは64KB未満のオブジェクトに対しては切り替え操作を実行しません。
>
