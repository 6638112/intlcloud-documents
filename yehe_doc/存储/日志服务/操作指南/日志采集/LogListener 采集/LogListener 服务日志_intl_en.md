## Overview
LogListener service logs are used to monitor running status, working status and traffic of collection. It can record the logs of the operation, collection, and monitoring activities of LogListener, and it can also configure visualized graphs of such data for users to view.

### Default Settings

| Default Setting | Description |
| ------------ | ------------------------------------------------------------ |
| Log topic | When LogListener service log is enabled, the logset `cls_service_logging` will be created for you automatically, and all log data generated by all associated machine groups will be categorized and stored in corresponding log topics. The following three log topics are created by default: <li>loglistener_status: the heartbeat status logs for the corresponding LogListener. </li><li>loglistener_alarm: logs corresponding to LogListener's metrics/error type monitoring logs. </li><li>loglistener_business: logs corresponding to LogListener's collections operations, with each log corresponds to one request. </li> |
| Region        | When the LogListener log service is enabled, log sets and log topics will be created under the machine groups of the corresponding regions.|@
| Log storage duration | The default storage duration is 7 days, and the value cannot be modified.                            |
| Indexing | Enables full-text indexing and key-value indexing for all log data collected by default. Support to modify index configuration, please refer to [Configure Index](https://intl.cloud.tencent.com/document/product/614/39594) for details. |
| Dashboard | One dashboard `service_log_dashboard` will be created corresponding to one region. |

>?
> - LogListener Service Logging is used exclusively by LogListener to collect logs generated by monitoring, and does not support writing other data.
> - Log data generated by the LogListener service logging feature does not incur costs.
> - cls_service_logging is a unified LogListener service logging log set.

## Use Cases

- **View LogListener status**
With the LogListener service log feature is enabled, you can view LogListener run status and collection statistics. Users can view the number of active LogListener, LogListener status distribution and other statistics through the service_log_dashboard dashboard.

- **Capture-side monitoring configuration**
You can configure capture-side monitoring metrics by metrics/error types, such as
  - Monitoring based on metrics such as MEM, CPU, acquisition speed, acquisition latency, etc.
   - Monitoring based on the dimension of the number of errors parsed by LogListener.

- **File-level monitoring**
With the Loglistener service logging feature enabled, you can view the monitoring logs of files and directories, for example
  - Collection statistics files for all files on a certain IP.
  - The amount of logs collected under a certain path on a certain IP, such as app1 application logs located in /var/log/app1/, statistics of logs collected under this path.
   - The collection statistics of a topic.


## Prerequisites

Configuring machine IP/identifying machine group only supports monitoring service log collection in LogListener version 2.5.4 and above, you can upgrade to [latest version](https://intl.cloud.tencent.com/document/product/614/17414).

## Directions
### Enabling the service log

1. Log in to the [CLS console](https://console.cloud.tencent.com/cls).
2. Click [Machine Group Management] in the left navigation bar to enter the machine group list page.
3. On the machine group list page, select the target machine group and click ! [](https://main.qcloudimg.com/raw/f49ecfc95ee483de28fb0928a4ada2dd.png) to turn on the LogListener service log.


### To turn off service logging

1. Log in to the [CLS console](https://console.cloud.tencent.com/cls).
2. Click [Machine Group Management] in the left navigation bar to enter the machine group list page.
3. On the machine group list page, select the target machine group and click ! [](https://main.qcloudimg.com/raw/b9a30517065edbe87527257fcc100184.png) to turn off LogListener service logging.

>? After closing the service logging function, the log data saved in the log set cls_service_logging will not be deleted automatically. If you need to delete this part of log data, you can manually delete the log set where the service logs are saved.
>

## Service Logging Dashboard

When LogListener service logging is turned on, the logging service system automatically creates a visual dashboard, search_log_dashboard, to display LogListener collection monitoring statistics based on the type of logs recorded.

#### Collection Statistics Dashboard
You can view LogListener acquisition-related statistics, including LogListener status display, LogListener parsing failure rate, LogListener logging statistics, and LogListener logging statistics, by clicking the ID of the target dashboard on the [Dashboard](https://console.cloud.tencent.com/cls/dashboard) page of the Log Service Console. LogListener parsing failure rate, LogListener sending success rate, and other metrics information.


Log Type

### LogListener Status Log
The fields of the log topic Loglistener_status are specified as follows:
<table>
	<tr><th>Item</th><th>Limit</th></tr>
	<tr><td>InstanceId</td><td>LogListener unique identifier value</td></tr>
	<tr><td>IP</td><td>Machine Group IP</td></tr>
	<tr><td>Label</td><td>Machine Label array</td></tr>
	<tr><td>Version</td><td>Version number</td></tr>
	<tr><td>MemoryUsed</td><td>Component memory usage</td></tr>
	<tr><td>MemMax</td><td>Memory usage threshold set by the Agent on this machine</td></tr>
	<tr><td>CpuUsage</td><td>Component CPU usage</td></tr>
	<tr><td>Status</td><td>LogListener running status</td></tr>
	<tr><td>TotalSendLogSize</td><td>Send Log Size</td></tr>
	<tr><td>SendSuccessLogSize</td><td>SendSuccessLogSize</td></tr>
	<tr><td>SendFailureLogSize</td><td>SendFailureLogSize</td></tr>
	<tr><td>SendTimeoutLogSize</td><td>SendTimeoutLogSize</td></tr>
	<tr><td>TotalParseLogCount</td><td>Total Logs Parsed</td></tr>
	<tr><td>ParseFailureLogCount</td><td>ParseFailureLogCount</td></tr>
	<tr><td>TotalSendLogCount</td><td>Total Logs Sent</td></tr>
	<tr><td>SendSuccessLogCount</td><td>Number of successful logs sent</td></tr>
	<tr><td>SendFailureLogCount</td><td>Number of failed logs sent</td></tr>
	<tr><td>SendTimeoutLogCount</td><td>SendTimeoutLogCount</td></tr>
	<tr><td>TotalSendReqs</td><td>Total number of send requests</td></tr>
	<tr><td>SendSuccessReqs</td><td>Number of successful requests sent</td></tr>
	<tr><td>SendFailureReqs</td><td>Number of failed requests sent</td></tr>
	<tr><td>SendTimeoutReqs</td><td>SendTimeoutReqs</td></tr>
	<tr><td>TotalFinishRsps</td><td>Rsp series received</td></tr>
	<tr><td>TotalSuccessFromStart</td><td>Total successes from LogListener start to date</td></tr>
	<tr><td>AvgReqSize</td><td>Average request packet size</td></tr>
	<tr><td>SendAvgCost</td><td>Average send time consumed</td></tr>
	<tr><td>AvailConnNum</td><td>Number of available connections</td></tr>
	<tr><td>QueueSize</td><td>Queueue Request Size</td></tr></table>
</table>





### LogListener alert log
The fields of the log topic Loglistener_alarm are specified as follows.

| Monitoring Metrics Categories      |Fields    |
| :----------- | :-------------------- |
| InstanceId | LogListener Unique Identifier |
| Label | Machine label array |
| IP | Machine group IP |
| Version | LogListener version |
| AlarmMessage | The original log sample that triggered the alarm  |
| Alarmcount | Number of alarms
| HostName | host hostname |
| AlarmType |AlarmType

&AlarmType=1

| alarm type | type ID | description
| :------------------------ | :------ | :---------------------------------------- |
| UnknownError | 0 | Initialize alarm type |
| UnknownError | 1 | Failed to parse |
| CredInvalid | 2 | Authentication failure |
| SendFailure | 3 | Send failure |
 RunException | 4 | LogListener RunException
| MemLimited | 5 | Triggered mem limited limit
| FileProcException | 6 | File handling exceptions
| FilePosGetError | 7 | Failed to get file pos
| HostIpException | 8 | Host IP thread exception |
| StatException| 9 | Get process-related information exception
| UpdateException | 10 | cls update function exception |
| DoSendError | 11 | dosend failure
| FileAddError          | 12      | addFileToReadyList get file realpath fail |
| FileMetaError         | 13      | addFileToReadyList metadata not found     |











| ReadFileInodeChange | 25      | file inode changed                        |
| ReadFileTruncate     | 26      | file truncated                            |



### LogListener collects logs
The fields of the log topic Loglistener_business are described as follows.

<table>
	<tr><th>Field</th><th>Description</th></tr>
	<tr><td>InstanceId</td><td>LogListener unique identifier value</td></tr>
	<tr><td>Label</td><td>Machine label array</td></tr>
	<tr><td>IP</td><td>Machine group IP</td></tr>
	<tr><td>Version</td><td>LogListener version</td></tr>
	<tr><td>TopicId</td><td>The target topic that the file was collected from</td></tr>
	<tr><td>FileName</td><td>File pathname</td></tr>
	<tr><td>RealPath</td><td>Actual path of the file</td></tr>
	<tr><td>FileInode</td><td>File inode</td></tr>
	<tr><td>FileSize</td><td>File size</td></tr>
	<tr><td>LastReadTime</td><td>Last read time of file</td></tr>
	<tr><td>ParseFailLines</td><td>Time window, number of failed log entries parsed</td></tr>
	<tr><td>ParseFailSize</td><td>Time window, size of failed parse logs</td></tr>
	<tr><td>ParseSuccessLines</td><td>Time window, number of successful logs parsed</td></tr>
	<tr><td>ParseSuccessSize</td><td>Time window, parse success log size</td></tr>
	<tr><td>ReadOffset</td><td>Offset of read file in bytes</td></tr>
	<tr><td>TruncateSize</td><td>File size of truncate within time window</td></tr>
	<tr><td>ReadAvgDelay</td><td>Average time delay for reads within time window</td></tr>
	<tr><td>TimeFormatFailuresLines</td><td>Timestamp match error counts within time window</td></tr>
	<tr><td>SendSuccessSize</td><td>Send Success Log Size within Time Window</td></tr>
	<tr><td>SendSuccessCount</td><td>Number of successful logs sent in the time window</td></tr>
	<tr><td>SendFailureSize</td><td>Size of failed logs sent in the time window</td></tr>
	<tr><td>SendFailureCount</td><td>Number of failed logs sent in the time window</td></tr>
	<tr><td>SendTimeoutSize</td><td>Send Timeout Log Size in Time Window</td></tr>
	<tr><td>SendTimeoutCount</td><td>Number of timeout logs sent within the time window</td></tr>
	<tr><td>DroppedLogSize</td><td>Dropped log size within time window</td></tr>
	<tr><td>DroppedLogCount</td><td>Dropped logs in time window</td></tr>
	<tr><td>ProcessBlock</td><td>Mark whether the current file has triggered a collection block in a statistical period (a file is triggered if its sliding window has not moved in 10 minutes)</td></tr></table>
</table>

