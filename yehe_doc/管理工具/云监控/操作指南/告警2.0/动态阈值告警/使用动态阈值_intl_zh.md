本文主要介绍动态阈值的使用方法和使用场景。

## 创建动态阈值告警

1. 登录 [云监控控制台-告警策略](https://console.cloud.tencent.com/monitor/policylist)。
2. 进入告警策略管理页，单击【新建】。
3. 在配置告警规则模块中，选择“手动配置”。阈值类型选择为“动态"。所有项目配置完后，单击【保存】即可。
![](https://main.qcloudimg.com/raw/6eb6ad792dd9dbc6cd9b8151c32359c4.png)
 - **灵敏度**
告警阈值敏感度是从用户对指标灵敏度的感知出发的阈值设置，用于控制指标异常检测的偏差相对大小。可用选项包括：
	 - 高：阈值比较严格，并且与指标系列模式接近。 告警规则将在偏差最小时触发，因此会生成更多的警报。
	 - 中：不太严格且比较均衡的阈值，生成的告警比使用高敏感度（默认设置）时更少。
	 - 低：阈值比较宽松，与指标系列模式的偏差更大。 只会在偏差较大时触发告警规则，因此生成的告警较少。
 - **条件设置**
动态阈值的告警规则可以使用相同的告警规则，基于指标行为的上限和下限创建定制的阈值。 可供选项包括：
	- 大于或小于动态阈值，例如等平稳型指标，希望在一定范围内不会太高也不会太低，则设定大于或小于动态阈值。
	- 大于动态阈值上边界，例如 CPU 使用率只关注超出动态阈值上边界即可。
	- 小于动态阈值下边界，例如业务成功数或成功率只关注小于动态阈值下边界即可。


**图表元素解析：**

- 蓝线：一段时间内实际测量的指标值监控曲线。
- 灰色阴影区域：显示指标值浮动的允许范围。 只要指标值停留在此范围内，就不会出现告警。
- 蓝点：使用鼠标左键单击图表的其中一部分，然后将鼠标悬停在蓝线上，则会看到光标下出现一个蓝点，显示单个聚合指标值。
- 红线：某段时间指标值超出允许范围。 它们不会触发其他指标告警，但该告警会保持活动状态。

## 动态阈值使用场景

**场景一：指标呈现周期性波动** 
当指标呈现周期性波动时，设置较高的静态阈值，则无法检测出图中明显异常点；设置较低的静态阈值时，则大量的时间段会被错误检测为异常。该场景适合使用动态阈值检测，既能保证检测的准确性，也能避免重复告警对用户的骚扰。 
![](https://main.qcloudimg.com/raw/7c06b74e495c0000e8e9bc0fefc29695.png)

**场景二：指标呈现趋势性增长或下降**
当指标呈现合理的增长或下降趋势时，如果使用静态阈值，将会在持续下降的时间内被检测是异常；如果使用动态阈值，合理范围会随着趋势自适应调整，当且仅当指标变化幅度明显过大时会被检测为异常。
![](https://main.qcloudimg.com/raw/e56837283ba565fa10668bf76726247f.png)

**场景三：指标呈现突增或突降趋势**
当指标呈现突然增长或下降的变化时，如果使用静态阈值，则难以设置合理的恒定阈值，且当指标超出设定的阈值才被检测为异常；如果使用动态阈值，则可自动捕捉不同程度的突增或突降变化，对于指标变化幅度明显过大时会被检测为异常。

设置不同的灵敏度进而自动捕捉不同程度的变化幅度，进而触发告警。 
![](https://main.qcloudimg.com/raw/b4623fcf4ad14a61e71da53aca558133.png)



**建议使用动态阈值的指标：**

| 场景     | 指标                                                         | 特点                                                         |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 饱和度   | 成功率、失败率、丢包率、流量命中率、出流使用率、查询拒绝率、带宽使用率 | 指标范围确定，通常位于0 - 100%之间。值具有特殊的场景意义，用户往往只关注阈值。例如磁盘使用率往往超过95%，用户才会真正的关心。该场景适合静态阈值或静态阈值结合动态阈值。 |
| 网络流量 | 网络入带宽、网络出带宽、网络入包量、网络出包量               | 指标通常随着时间变化而变化，指标范围不确定，一般指标波动幅度较大。该场景适合动态阈值。 |
| 延时     | 延时次数、延时距离、延时时长                                 | 指标波动幅度通常较小，指标范围不确定。该场景适合动态阈值。   |
| 其它     | 慢查询数、云数据库的线程数、redis 连接数、tcp 连接数、QPS 硬盘、IO 等待时间、临时表数量、全表扫描数、kafka 未消费信息数 | 该场景适合动态阈值。                                         |


