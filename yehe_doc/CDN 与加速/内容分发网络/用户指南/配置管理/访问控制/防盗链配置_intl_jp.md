## 設定シナリオ
ビジネスリソースへのアクセスのソースを制御する場合、Tencent Cloud CDNはreferer リンク不正アクセス防止設定機能を提供しています。

HTTP Request Header中のrefererフィールドの値にアクセス制御ポリシーを設定することにより、アクセスソースを制御して、悪意のあるユーザーによる盗用を防ぐことができます。

## 設定ガイド
### 設定の確認
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションメニューバーで【ドメイン管理】を選択して、ドメイン名の右側にある【管理】をクリックすると、ドメイン名設定ページに入ります。第2欄の【アクセス制御】タブで、リンク不正アクセス防止設定を確認できます。デフォルトでは、リンク不正アクセス防止設定が無効になっています。
![](https://main.qcloudimg.com/raw/8e59f293e9b2c5023094bd23ecc5242c.png)

### 設定の変更
#### 1. 設定の変更
切り替えスイッチをクリックし、リンク不正アクセス防止のタイプを選択し、対応する情報を入力し、空白のreferを許可するかどうかを選択し、【OK】をクリックして、リンク不正アクセス防止設定を有効にすることができます。
![](https://main.qcloudimg.com/raw/a8fadec0fb388be40e3b3c6253c27fc4.png)
**referer ブラックリスト**
- リクエストされたrefererフィールドがブラックリストに設定されている内容にマッチしている場合、CDNノードはリクエストされた情報を返さず、403ステータスコードが返されます。
- リクエストされたrefererフィールドがブラックリストに設定されている内容にマッチしていない場合、CDNノードはリクエストされた情報を正常に返します。
- **空のrefererを含む**というオプションが選択された場合、refererフィールドが空であるか、refererフィールド（たとえば、ブラウザリクエスト）がない場合、CDNノードはリクエストされた情報を返さず、403ステータスコードが返されます。

**refererホワイトリスト：**
- リクエストされたrefererフィールドがホワイトリストに設定されている内容にマッチしている場合、CDNノードはリクエストされた情報を正常に返します。
- リクエストされたrefererフィールドがホワイトリストに設定されている内容にマッチしていない場合、CDNノードはリクエストされた情報を返さず、403ステータスコードが返されます。
- ホワイトリストを設定する場合、CDNノードはホワイトリストで設定された文字列に一致するリクエストのみを返すことができます。
- **空のrefererを含む**というオプションが選択された場合、refererフィールドが空であるか、refererフィールド（たとえば、ブラウザリクエスト）がない場合、CDNは正常にリクエストされた情報を返します。

**設定ルール：**
+ リンク不正アクセス防止は、ドメイン名/IPルールをサポートしています。IPルールが使用されている場合、プレフィックスマッチングが利用可能です。ドメイン名ルールが使用されている場合、プレフィックスマッチングはサポートされていません。即ち、`www.abc.com`が設定されている場合、`www.abc.com/123`がマッチしますが、`www.abc.com.cn`がマッチしません。`127.0.0.1`が設定されている場合、`127.0.0.1/123`もマッチします。
+ リンク不正アクセス防止は、ワイルドカードマッチングをサポートします。つまり、`*.qq.com`が設定されている場合、`www.qq.com`と`a.qq.com`の両方がマッチします。

#### 2. 設定を無効にする
リンク不正アクセス防止機能を無効に切り替えることができます。スイッチがオフの場合、以下の既存の設定があっても、この機能は実稼働環境では有効になりません。スイッチがオンの場合、設定がネットワーク全体で有効になる前に、先に設定の再確認を行っています。
![](https://main.qcloudimg.com/raw/c2ce6f4cb7f7852e5751f6118469c2d6.png)

#### 3.地域の特別な設定
アクセラレーションドメイン名がグローバルアクセラレーション用に設定されており、中国本土と中国本土以外のアクセラレーションリージョンに異なるrefererリンク不正アクセス防止を設定する場合は、設定の下にある【特別な設定の追加】をクリックして設定できます。
![](https://main.qcloudimg.com/raw/71a4f6e404fec9d84056a46abda5e6fb.png)

>地域の特別な設定が追加された後、現在では削除することはできません。設定をオフにして無効にできます。

## 設定例

アクセラレーションドメイン名`www.test.com`のリンク不正アクセス防止が次のように設定されている場合、
![](https://main.qcloudimg.com/raw/1b32c584506929d4229eb1c534c00a07.png)
実際のアクセス状況は次のとおりです。
1. refererが1.1.1.1である中国本土のユーザーがリクエストを開始すると、中国本土用に設定されたホワイトリストがヒットし、リクエストされたコンテンツが直接返されます。
2. refererが空である中国本土以外のユーザーがリクエストを開始すると、中国本土以外用に設定されたブラックリストがヒットし、403コードが返されます。

