## 설정 시나리오
서비스 리소스의 액세스 출처를 제어할 수 있도록, Tencent Cloud CDN은 referer 링크 도용 방지 설정 기능을 제공하고 있습니다.

사용자의 HTTP Request Header 중 referer 필드 값에 대해 액세스 제어 정책을 설정하여, 액세스 출처를 제한하고 악성 사용자의 도용을 막을 수 있습니다.

## 설정 가이드
### 설정 조회
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하여 메뉴에서 [Domain Management]를 선택하고 도메인 오른쪽의 [Manage]를 클릭하면 도메인 설정 페이지로 이동할 수 있습니다. 그중 두 번째 탭인 [Access Control]에서 링크 도용 방지 설정을 확인할 수 있으며, 링크 도용 방지 설정은 비활성화 상태로 기본 설정되어 있습니다.
![](https://main.qcloudimg.com/raw/8e59f293e9b2c5023094bd23ecc5242c.png)

### 설정 수정
#### 1. 설정 수정
on-off 스위치를 클릭하여 링크 도용 방지 유형을 선택하고 리스트를 작성한 후 비어 있는 refer 허용 여부를 선택한 다음 [OK]를 클릭하면 링크 도용 방지 설정을 활성화할 수 있습니다.
![](https://main.qcloudimg.com/raw/a8fadec0fb388be40e3b3c6253c27fc4.png)
**referer 블랙리스트:**
- 요청한 referer 필드가 블랙리스트에 설정된 내용과 일치하면, CDN 노드가 해당 요청 정보의 리턴을 거절하고 403 상태 코드를 바로 리턴합니다.
- 요청한 referer가 블랙리스트에 설정된 내용과 일치하지 않으면, CDN 노드가 해당 요청 정보를 정상적으로 리턴합니다.
- **비어 있는 referer 포함** 옵션을 선택할 때, referer 필드가 비어 있거나 referer 필드가 없으면(예: 브라우저 요청), CDN 노드가 해당 요청 정보의 리턴을 거절하고 403 상태 코드를 리턴합니다.

**referer 화이트리스트:**
- 요청한 referer 필드가 화이트리스트에 설정된 내용과 일치하면, CDN 노드가 해당 요청 정보를 정상적으로 리턴합니다.
- 요청한 referer 필드가 화이트리스트에 설정된 내용과 일치하지 않으면 CDN 노드가 해당 요청 정보의 리턴을 거절하고 403 상태 코드를 바로 리턴합니다.
- 화이트리스트를 설정할 때, CDN 노드는 화이트리스트 내 문자열의 내용과 일치하는 요청만 리턴할 수 있습니다.
- **비어 있는 referer 포함** 옵션을 선택할 때, referer 필드가 비어 있거나 referer 필드가 없으면(예: 브라우저 요청), CDN이 요청 정보를 정상적으로 리턴합니다.

**규칙 설정:**
+ 링크 도용 방지는 도메인 이름 / IP 규칙을 지원하고 접두사를 통해 매칭합니다(경로만 지원하는 경우 도메인 이름을 접두사로 매칭할 수 없음). 즉, 설정 리스트가 `www.abc.com`이라고 가정할 때, `www.abc.com/123`은 매칭되지만, `www.abc.com.cn`은 매칭되지 않습니다. 설정 리스트가 `127.0.0.1`이라고 가정할 때, `127.0.0.1/123` 또한 설정됩니다.
+ 링크 도용 방지는 와일드카드 캐릭터 설정을 지원합니다. 즉, 리스트가 `*.qq.com`이라고 가정할 때, `www.qq.com`과 `a.qq.com` 모두 매칭됩니다.

#### 2. 설정 비활성화
링크 도용 방지 on-off 스위치를 통해 원클릭으로 링크 도용 방지 설정을 비활성화할 수 있습니다. 비활성화 상태일 때 아래에 기존 설정이 존재하더라도 현재 네트워크에 적용되지 않습니다. 다음 차례 활성화 시 전체 네트워크에 적용되도록 즉시 배포하지 않고 설정한 2차 확인을 먼저 진행합니다:
![](https://main.qcloudimg.com/raw/c2ce6f4cb7f7852e5751f6118469c2d6.png)

#### 3. 리전 특수 설정
사용자의 가속 도메인 서비스 지역이 글로벌 가속이고 중국 내, 중국 외 가속 구역에 각기 다른 referer 링크 도용 방지를 설정하고자 한다면 설정 하단의 [Add Special Configuration]를 클릭하여 설정할 수 있습니다:
![](https://main.qcloudimg.com/raw/71a4f6e404fec9d84056a46abda5e6fb.png)

>리전 특수 설정을 추가한 후 현재로서는 직접 삭제할 수 없으니 비활성화를 통해 사용 안 함으로 설정할 수 있습니다.

## 설정 예시

가속 도메인 `www.test.com`의 링크 도용 방지 설정이 아래와 같을 경우
![](https://main.qcloudimg.com/raw/1b32c584506929d4229eb1c534c00a07.png)
실제 액세스 상황은 다음과 같습니다
1. 중국 내 사용자의 요청 referer 정보가 `1.1.1.1`인 경우, 중국 내로 설정된 화이트리스트에 히트하여 내용을 직접 리턴할 수 있습니다.
2. 중국 외 사용자의 요청 referer가 비어 있는 경우, 중국 외로 설정된 블랙리스트에 히트하여 403을 바로 리턴합니다.

