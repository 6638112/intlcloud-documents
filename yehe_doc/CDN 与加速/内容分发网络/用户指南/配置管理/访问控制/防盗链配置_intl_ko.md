## 설정 시나리오
서비스 리소스의 액세스 출처를 제어할 수 있도록 Tencent Cloud CDN은 referer 링크 도용 방지 설정 기능을 제공합니다.

HTTP Request Header의 referer 필드값에 액세스 제어 정책을 설정함으로써 액세스 출처를 제한하고, 악성 사용자의 도용을 막을 수 있습니다.

## 설정 가이드
### 설정 조회
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하여 메뉴에서 [도메인 관리]를 선택하고 도메인 오른쪽의 [관리]를 클릭하면 도메인 설정 페이지로 이동할 수 있습니다. 그중 두 번째 탭인 [액세스 제어]에서 링크 도용 방지 설정을 확인할 수 있습니다. 링크 도용 방지 설정은 기본적으로 비활성화 상태입니다.
![](https://main.qcloudimg.com/raw/53cfa056e5574aae9c912db36fcbf67b.png)

### 설정 활성
on-off 스위치를 클릭하여 링크 도용 방지 유형을 선택하고 리스트를 작성한 후, 비어 있는 refer 허용 여부를 선택한 다음 [확인]을 클릭하면 링크 도용 방지 설정을 활성화할 수 있습니다.
![](https://main.qcloudimg.com/raw/951eb25d77110a01fcd91ab9bfcd1cad.png)
**referer 블랙리스트: **

- 요청된 referer 필드가 블랙리스트에 설정된 콘텐츠와 일치하는 경우, CDN 노드는 요청 정보 반환을 거부하고 403 상태 코드를 직접 반환합니다.
- 요청된 referer가 블랙리스트에 설정된 내용과 일치하지 않는 경우, CDN 노드는 요청 정보를 정상적으로 반환합니다.
- **빈 referer 포함**옵션을 선택하는 경우, referer 필드가 비어 있거나 referer 필드가 없는 경우(예: 브라우저 요청)에 CDN 노드는 요청 메시지 반환을 거부하고 403 상태 코드를 반환합니다.

**referer 화이트리스트: **
- 요청된 referer 필드가 화이트리스트 설정의 내용과 일치하는 경우, CDN 노드는 일반적으로 요청 정보를 반환합니다.
- 요청된 referer 필드가 화이트리스트 설정의 내용과 일치하지 않는 경우, CDN 노드는 요청 정보를 반환하지 않고 상태 코드 403을 직접 반환합니다.
- 화이트리스트를 설정할 때, CDN 노드는 화이트리스트의 문자열 내용과 일치하는 요청만 반환할 수 있습니다.
- **빈 referer 포함**옵션을 선택할 때, referer 필드가 비어 있거나 referer 필드가 없는 경우(예: 브라우저 요청)에 CDN은 요청 정보를 정상적으로 반환합니다.

**설정 제한: **
+ 링크 도용 방지는 도메인 네임/IP 규칙을 지원합니다. 구성 방법은 접두사 구성법입니다(경로만 지원되는 경우 도메인 네임의 접두사 일치가 지원되지 않음). 즉, 구성 목록이 `www.abc.com`인 경우, `www.abc.com/123`은 구성되지만, `www.abc.com.cn`은 구성되지 않습니다. 구성 목록이 `127.0.0.1`인 경우 `127.0.0.11/123`도 구성됩니다.
+ 링크 도용 방지는 와일드카드 캐릭터 설정을 지원합니다. 즉, 리스트가 `*.qq.com`이라고 가정할 때, `www.qq.com`과 `a.qq.com` 모두 매칭됩니다.

### 설정 비활성화
링크 도용 방지 스위치를 통해 클릭 한 번으로 설정을 비활성화할 수 있습니다. 스위치가 비활성화 상태일 때 하단에 기존 설정이 존재하더라도 현재 네트워크에 적용되지 않습니다. 이후에 활성화를 클릭하면 전체 네트워크에 적용되도록 즉시 배포하지 않으며, 설정에 대한 2차 확인을 먼저 진행합니다.
![](https://main.qcloudimg.com/raw/0eff7fac96363892b1b95f53fbadf47d.png)

### 리전 특수 설정
사용자의 가속 도메인 서비스 지역이 글로벌 가속이고, 중국 내/중국 외 가속 구역에 각기 다른 referer 링크 도용 방지를 설정하고자 한다면 설정 하단의 [특수 설정 추가]을 클릭하여 설정할 수 있습니다.
![](https://main.qcloudimg.com/raw/31d414d5adf37f8a2deadce688962645.png)

>!지역 특수 설정을 추가한 후에는 현재 직접 삭제할 수 없습니다. 비활성화를 통해 사용하지 않도록 설정할 수 있습니다.

## 설정 예시

가속 도메인 `www.test.com`의 링크 도용 방지 설정이 아래와 같을 경우
![](https://main.qcloudimg.com/raw/027832bf7f5df50370257cce662105d8.png)
실제 액세스 상황은 다음과 같습니다.

1. 중국 내 사용자의 요청 referer 정보가 `1.1.1.1`인 경우, 중국 내로 설정된 화이트리스트에 히트하여 내용을 직접 반환할 수 있습니다.
2. 중국 외 사용자의 요청 referer가 비어있을 경우, 중국 외로 설정된 블랙리스트에 히트하여 403으로 직접 반환합니다.

