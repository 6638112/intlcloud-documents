## 設定シナリオ

Tencent Cloud CDNがリソースをキャッシュする際に、ストレージ効率を改善するために、ファイルを分割して格納し、Rangeリクエストもサポートします。リクエストにHTTPヘッダー `Range: bytes = 0-999`が含まれている場合、ファイルの最初の1,000バイトをユーザーに返されます。

Range back-to-origin設定を有効にした後、ユーザーがリクエストしたファイルの一部が期限切れの場合、CDNはユーザーのリクエストに従ってback to originします。ユーザーが必要とするファイルのみをキャッシュして、ユーザーに返します。Range back-to-origin設定を無効にすると、ユーザーが一部のファイルをリクエストした場合でも、CDNはback to originするときにファイル全体を取り出して、キャッシュして、リクエストされた一部のファイルをユーザーに返します。

Range back-to-origin設定を有効にすると、大容量ファイルの配信効率が大幅に向上し、応答時間が大幅に改善され、オリジンサーバーの負荷が軽減されます。

> 説明：
>
> Range back-to-origin設定を有効にすると、リソースはノードのシャードにキャッシュされます。各シャードのキャッシュの有効期限が同じです、ユーザーが指定したキャッシュ有効期限ルールに従います。

## 設定ガイド

### 設定の確認

[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションメニューバーで【ドメイン管理】を選択して、ドメイン名の右側にある【管理】をクリックすると、ドメイン名設定画面に入ります。【back to origin設定】タブで、Range back-to-origin設定を確認できます。デフォルトでは無効になっています。COSオリジンサーバードメイン名の場合、デフォルトでは有効になっています。
![img](https://main.qcloudimg.com/raw/432dd0c9c4e89a1a7ebcd0fe51cbf704.png)

### 設定の変更

Range back-to-origin設定スイッチを切り替えて、この機能を有効または無効にできます。Range back-to-origin設定を有効にする場合、オリジンサーバーがRangeリクエストをサポートしていることを確認する必要があります。そうしないと、back-to-originが失敗する可能性があります。
![img](https://main.qcloudimg.com/raw/725ae7fabccfb1a3de205968c56a2951.png)

> 注意：
>
> アクセラレーションドメイン名がグローバルアクセラレーション用に設定されている場合、設定されたRange back-to-origin設定はグローバルに有効になり、中国本土と中国本土以外との異なる設定に対応しません。

## 設定例

ドメイン名 `cloud.tencent.com`のRange back-to-origin設定は、次のようになります。
![img](https://main.qcloudimg.com/raw/432dd0c9c4e89a1a7ebcd0fe51cbf704.png)
ユーザーAがリソース`http://cloud.tencent.com/test.apk`をリクエストしてから、ノードがリクエストを受信し、キャッシュされている`test.apk`ファイルがすでに期限切れであることを検出すると、back-to-originリクエストを送信します。ノードback-to-originはRangeリクエストを使用し、シャードでリソースを取得してからキャッシュします。この時に、ユーザーBもRangeリクエストを送信し、ノードに保存されているシャードがRangeリクエストで指定されたバイトセグメントと一致する場合、直接にユーザーに戻し、すべてのシャードの取得完了を待つ必要がありません。