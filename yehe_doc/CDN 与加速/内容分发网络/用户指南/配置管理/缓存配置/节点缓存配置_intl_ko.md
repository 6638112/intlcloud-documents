
## 설정 시나리오
Tencent Cloud CDN 캐시 리소스는 트리거형으로 사용자가 어느 한 리소스에 액세스하려 할 때 요청한 CDN 노드에 해당 리소스를 캐싱하지 않으면 사용자의 원본 서버로 돌아가 리소스를 가져옵니다. 리소스(2XX 상태 코드)를 성공적으로 가져온 후에 노드에서 캐싱하고 사용자에게 리턴합니다.

CDN 노드에 캐시된 리소스를 사용자가 직접 관리할 수 없으므로, 원본 서버 리소스가 변경되었음에도 CDN 노드에서 여전히 기존 리소스를 캐시하여 리턴할 우려가 있다면, 노드 캐시 규칙 설정을 통해 관리할 수 있습니다.

각 CDN 노드의 캐시 리소스에는 "만료 시간"이라는 개념이 있습니다. 요청한 캐시 리소스가 만료되었을 경우, 노드에 캐시가 있음에도 없다고 판정하여 다시 원본 서버로부터 가져오게 됩니다. 노드 캐시 규칙 설정으로 어느 유형, 어느 디렉터리 또는 경로의 리소스의 노드 내 캐시 만료 시간을 지정할 수 있어, 실제 비즈니스 시나리오에 맞게 설정할 수 있습니다.

## 설정 가이드
### 설정 조회
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하여 메뉴에서 [Domain Management]를 선택하고 도메인 오른쪽의 [Manage]를 클릭하면 도메인 설정 페이지로 이동할 수 있습니다. 그중 세 번째 탭인 [Cache Configuration]에서 캐시 만료 설정을 확인할 수 있습니다.
가속 도메인 접속 시:
+ 정적 가속 유형을 선택하면 일반 동적 파일(예 .php .jsp .asp .aspx)의 기본 캐시 만료 시간이 0(캐시하지 않고 직접 원본을 가져옴)이고, 기타 모든 파일 유형의 기본 만료 시간이 30일입니다.
+ 다운로드 가속, 온디맨드 스트리밍 가속 유형을 선택하면 모든 파일의 기본 캐시 만료 시간이 30일입니다.

![](https://main.qcloudimg.com/raw/ea544580fa0912774ba73235a5c935b8.png)

### 설정 수정
#### 1. 설정 수정
현재 CDN은 다음 4가지 유형의 캐시 만료 규칙을 설정할 수 있습니다.
+ 파일 유형: 작성한 파일의 확장자에 따라 캐시 만료 시간을 설정합니다. 형식은 `.jpg`이고 서로 다른 확장자 사이는 `;` 부호로 구분합니다.
+ 폴더: 작성한 디렉터리 경로에 따라 캐시 만료 시간을 설정합니다. 형식은 `/test`이고 `/` 부호를 마지막에 입력하지 않아도 되며, 서로 다른 디렉터리 사이는 `;` 부호로 구분합니다.
+ 전체 경로 파일: 완전한 파일 경로를 지정하여 캐시 만료 시간을 설정합니다. 형식은 `/index.html`이고 `/test/*.jpg`와 같이 완전한 경로와 파일 유형으로 이루어진 매칭 방식을 지원합니다.
+ 첫 페이지: 루트 디렉터리의 캐시 만료 시간을 설정합니다.

![](https://main.qcloudimg.com/raw/eaf7940e3d3ead143d7b6d487ae257d9.png)
**규칙 설정:**
+ 캐시 만료 규칙은 최대 10건까지 설정할 수 있습니다.
+ 여러 건의 캐시 만료 규칙 중 우선순위는 아래부터 시작입니다.
+ 캐시 만료 시간은 최대 365일까지 설정할 수 있습니다.

>사용자의 가속 도메인 서비스 지역이 글로벌 가속이면 설정한 캐시 만료 시간이 글로벌 범위에 적용되며 중국 내, 중국 외를 다르게 설정할 수 없습니다.

#### 2. 플랫폼 정책
사용자로부터 서비스 리소스를 요청받았을 때, 원본 서버에 해당하는 HTTP Response Header 에 Cache-Control 필드가 존재한다면 기본 플랫폼 정책은 다음과 같습니다.
- Cache-Control 필드를 Max-Age로 설정하면, 해당 리소스의 캐시 시간은 Max-Age가 지정한 시간을 상속받지 않고 설정된 노드 캐시 만료 시간을 기준으로 합니다.
- Cache-Control 필드를 no-cache, no-store 또는 private으로 설정하면, CDN 노드는 해당 리소스를 캐시하지 않습니다.
- Cache-Control 필드가 없는 경우, CDN이 `Cache-Control:max-age = 600` 헤더를 추가하도록 기본 설정되어 있습니다.

#### 3. 고급 캐시 설정
고급 캐시 설정을 활성화하면 원본 서버의 HTTP Response Header Cache-Control 에서 Max-Age 값을 조정하여 노드의 캐시 시간을 동적으로 조정할 수 있습니다.

활성화 후 CDN이 설정한 노드의 캐시 시간을 Max-Age 값과 대조하여 더 작은 값을 실제 노드의 캐시 시간으로 적용합니다:
+ 사용자 원본 서버에서 `/index.html`의 Max-Age를 200초로 설정하고, CDN에서 설정된 캐시 시간이 600초일 경우, 노드에서의 파일 실제 만료 시간은 200초입니다.
+ 사용자 원본 서버에서 `/index.html`의 max-age를 800초로 설정하고, CDN에서 설정된 캐시 시간이 600초일 경우, 노드에서의 파일 실제 만료 시간은 600초입니다.

>고급 캐시 설정 활성화 후, 원본 서버가 Last-Modified 필드를 리턴하지 않으면 CDN이 Last-Modified 필드를 추가하고 10분마다 한 번씩 변하도록 기본 설정되어 있습니다.

## 설정 예시
가속 `cloud.tencent.com`의 캐시 만료 시간 규칙 설정이 아래와 같을 경우
![](https://main.qcloudimg.com/raw/92990b8fdc69a94646b7b2e8f304b7a4.png)
실제 캐시 시간은 다음과 같습니다.
1. `/test/abc.jpg` 파일 노드의 캐시 만료 시간은 200초입니다.
2. `/test/def.jpg` 파일 노드의 캐시 만료 시간은 400초입니다.
3. `/test/1.png` 파일 노드의 캐시 만료 시간은 300초입니다.

