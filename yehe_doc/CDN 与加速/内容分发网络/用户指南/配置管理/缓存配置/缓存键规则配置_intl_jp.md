
>? 元のフィルタリングパラメータ設定と大文字小文字を区別しないキャッシュは、すでにキャッシュキールール設定に統合され、よりきめ細かな設定がサポートされています。

## 設定シナリオ

Tencent Cloud CDNは、キャッシュ時にKey-Value形式を使用して、リソースをマッピングします。Keyはキャッシュキーであり、キャッシュリソースの一意の識別子です。キャッシュキールールの設定を介して、異なるファイルタイプのコンテンツにフィルタリングパラメータと大文字と小文字を区別しないことを設定して、キャッシュキーを最適化できます。



### フィルタリングパラメータ

- ユーザーがURLを介してリソースにアクセスする場合、次のリンクを使用して2つの異なる画像を表すなど、特別な役割を持ったいくつかのパラメータを保持するとがあります。
`http://cloud.tencent.com/1.jpg?version=1`
`http://cloud.tencent.com/1.jpg?version=2`
このシナリオでは、フィルタリングパラメータをオフにする必要があり、完全なURLをキャッシュキーとして使用して、画像内容を個別にキャッシュしてリソースを区別します。

- オーディオ・ビデオのシナリオで、タイムスタンプ署名パラメータがアクセス認証に使用される場合：
`http://cloud.tencent.com/1.mp4?sign=XXXXXX`
このシナリオでは、フィルタリングパラメータを有効にする必要があります。「？」の前のリンク `http://cloud.tencent.com/1.mp4`はキャッシュキーとして使用されます。タイムスタンプ署名が変化し続けても、ノードは1つのリソースのみをキャッシュします。署名検証後、キャッシュに直接命中できます。

### 大文字小文字を区別しない

サービスシナリオにおいて、リソースのURLパスの大文字と小文字の違いがリソースの内容に関連している場合は、大文字小文字を区別しない設定を無効にすることができます。
サービスシナリオにおいて、リソースのURLパスの大文字と小文字の違いがリソースの内容に関係ない場合は、大文字と小文字を区別しない設定を有効にすることで、命中率を向上させることができます。
>! プラットフォームのアップグレードの場合は、現在、大文字と小文字を区別しない設定を有効にすることができません。

## 設定ガイド

### 設定の確認

[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のメニューバーで【ドメイン名管理】を選択し、ドメイン名操作列の【管理】をクリックして、ドメイン名設定画面に入ります。タブを【キャッシュ設定】に切り替えると、【キャッシュキールールの設定】が表示されます。

アクセラレーションドメイン名を追加する際に、サービスタイプに応じて、フィルタリングパラメータがデフォルトで無効または有効になります。

- アクセラレーションドメイン名は、静的アクセラレーションサービスタイプが選択された場合、フィルタリングパラメータはデフォルトで有効になりません。キャッシュキールールの設定では、すべてのファイルルールの【フィルタリングパラメータ】が「フィルタリングしない」に同期されます。
- アクセラレーションドメイン名は、ダウンロードやストリーミングメディアのVoDサービスタイプが選択された場合、フィルタリングパラメータはデフォルトで有効になります。キャッシュキールールの設定では、すべてのファイルルールの【フィルタリングパラメータ】が「すべてフィルタリング」に同期されます。


![](https://main.qcloudimg.com/raw/1f53ed863618b442233dd3e1bba6229b.png)

### 新しいルール

必要に応じてキャッシュキールールを追加できます。
<img src="https://main.qcloudimg.com/raw/48becf925518b2595097eddf7b4ec6d5.png" height="250" width="438" />

#### 制約の設定

- 1つのドメイン名で、最大20件までキャッシュキールール（デフォルトルールを含む）を追加できます。
- 複数のルールの場合、優先順位は変更可能です。下部の優先順位が上部よりも高くなります（デフォルトではルールの優先順位を変更できません）。
- 1つのファイルタイプ/フォルダ/フルパスファイルルールでは、最大100グループのコンテンツを入力でき、異なるコンテンツ間に「;」で区切ります。例：ファイルタイプ - jpg;png。
- フィルタリングパラメータ- 指定されたパラメータを保持する
  - すべてのファイル：最大6つのパラメータを入力でき、1つのパラメータは20文字を超えることはできません。
  - ファイルタイプ/フォルダ/フルパスファイル：最大5つのパラメータを入力でき、1つのパラメータは20文字を超えることはできません。


### ルールの変更

追加されたキャッシュキールールは変更できます。キャッシュキールール操作欄の【変更】をクリックして変更します

>! デフォルトでは、ルールは、フィルタリングパラメータと大文字と小文字を区別しない設定のみを変更でき、タイプとコンテンツを変更はできません。

### ルールの削除

追加されたキャッシュキールールは削除できます。 キャッシュキールール操作列の【削除】をクリックして削除できます (デフォルトではルールを削除できません)。


## 設定例

アクセラレーションドメイン名 `www.test.com`の【キャッシュキールール設定】が次の場合、
![](https://main.qcloudimg.com/raw/8c3f7f534c5fa849ca1594a0a244d840.png)

実際のアクセス状況は次のとおりです。

クライアントがリソース `www.test.com/abc.jpg?version=1&colour=red`と`www.test.com/abc.JPG?version=1&colour=red`をリクエストすると、リクエストがすべてCDNノードXにアクセスして、ノードXに上記の2つのリソースのキャッシュがない場合、

- オリジンサーバーに戻って、画像`abc.jpg`のリソースを取得して、CDNノードXにキャッシュするようにリクエストします。「フィルタリングパラメータ：すべてフィルタリング」がすでに有効になっているため、「？」以前のリンク`www.test.com/abc.jpg`はキャッシュキーとされます。
- クライアントが`www.test.com/abc.JPG?version=1&colour=red`をリクエストする場合、大文字と小文字を区別しない設定が有効になっていないため、以前にキャッシュされた`www.test.com/abc.jpg`リソースに命中できません。オリジンサーバーに戻って、画像`abc.JPG`のリソースを取得して、CDNノードXにキャッシュするようにリクエストします。対応するキャッシュキーは`www.test.com/abc.JPG`になります。



