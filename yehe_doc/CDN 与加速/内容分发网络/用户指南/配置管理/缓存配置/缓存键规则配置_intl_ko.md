
>? 기존 필터링 매개변수 설정과 대소문자 캐시 생략을 캐시 키 값 규칙으로 통합 설정할 경우, 더 세분화된 설정이 가능합니다.

## 설정 시나리오

Tencent Cloud CDN은 캐시할 때 Key-Value 포맷으로 리소스를 매핑하며, 이 중 key는 캐시 키 값을 가리키는 캐시 리소스의 유일한 표식입니다. 캐시 키 값 규칙 설정을 통해 서로 다른 파일 유형의 콘텐츠에 필터링 매개변수와 대소문자 생략을 설정해 캐시 키 값을 최적화할 수 있습니다.



### 필터링 매개변수

- 사용자가 URL을 통해 리소스에 액세스하는 경우 특수한 작용을 하는 매개변수를 가지고 있을 수 있습니다. (예: 다음 링크를 사용해 서로 다른 두 가지 이미지 표시)
`http://cloud.tencent.com/1.jpg?version=1`
`http://cloud.tencent.com/1.jpg?version=2`
해당 두 시나리오에서 필터링 매개변수를 비활성화해야 하는 경우 전체 URL을 캐시 키 값으로 하여 각 이미지 콘텐츠를 캐시해 리소스를 구분합니다.

- 멀티미디어 시나리오에서 타임스탬프 서명 매개변수를 사용해 액세스를 인증하는 경우:
`http://cloud.tencent.com/1.mp4?sign=XXXXXX`
해당 시나리오에서 필터링 매개변수를 활성화해야 하는 경우 “?” 앞 링크 `http://cloud.tencent.com/1.mp4`가 캐시 키 값이 됩니다. 노드는 1개의 리소스만 캐시하며 타임스탬프 서명이 지속적으로 변경되어도 서명을 통해 인증한 후 직접 캐시를 히트합니다.

### 대소문자 생략

비즈니스 시나리오에서 리소스 URL 경로의 대소문자 구분이 리소스 콘텐츠와 관련이 있는 경우 대소문자 생략 설정을 비활성화합니다.
비즈니스 시나리오에서 리소스 URL 경로의 대소문자 구분이 리소스 콘텐츠와 관련이 없는 경우 대소문자 생략 설정을 활성화하여 히트율을 향상시킬 수 있습니다.
>! 현재는 플랫폼 업그레이드 중으로, 대소문자 생략 활성화를 지원하지 않습니다.

## 설정 가이드

### 설정 조회

[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후, 왼쪽 메뉴바에서 [Domain Management]를 선택한 뒤 도메인 작업 열의 [Manage]를 클릭하여 도메인 설정 페이지로 들어갑니다. Tab을 [Cache Configuration]로 전환하면 [Cache Key Rule Configuration]을 찾을 수 있습니다.

가속 도메인 추가 시, 서비스 유형별로 필터링 매개변수를 기본적으로 비활성화 또는 활성화할 수 있습니다.

- 가속 도메인에서 정적 가속 서비스 유형을 선택하는 경우 필터링 매개변수는 기본적으로 비활성화됩니다. 캐시 키 값 규칙 설정의 모든 파일 규칙의 [필터링 매개변수]가 “필터링하지 않음”으로 동기화됩니다.
- 가속 도메인에서 다운로드, 스트리밍 미디어 VOD 서비스 유형을 선택하는 경우 필터링 매개변수는 기본적으로 활성화됩니다. 캐시 키 값 규칙 설정의 모든 파일 규칙의 [필터링 매개변수]가 “모두 필터링”으로 동기화됩니다.


![](https://main.qcloudimg.com/raw/b82450778493e5b45c714c426e507c3f.png)

### 규칙 추가

필요에 따라 캐시 키 값 규칙을 추가할 수 있습니다.
<img src="https://main.qcloudimg.com/raw/0956da1c99754636da7a5d1f0115a5f7.png" height="250" width="438" />

#### 설정 제한

- 도메인당 최대 20개까지 캐시 키 값 규칙(기본 규칙 포함)을 추가할 수 있습니다.
- 다수 규칙에 우선순위 변경 지원: 하위 우선순위가 상위 우선순위보다 높습니다. (기본 규칙의 우선순위는 조정할 수 없음)
- 단일 파일 유형/폴더/전체 경로 파일 규칙에는 최대 100개까지 내용을 입력할 수 있으며, 각 내용 사이에 “;” 부호를 사용하여 분리합니다. 예: 파일 유형 - jpg;png
- 필터링 매개변수 - 지정 매개변수 보관
  - 모든 파일: 매개변수는 최대 6개까지 추가할 수 있으며, 단일 매개변수는 20자를 초과할 수 없습니다.
  - 파일 유형/폴더/전체 경로 파일: 매개변수는 최대 5개까지 입력할 수 있으며 모든 매개변수는 20자를 초과할 수 없습니다.


### 규칙 수정

캐시 키 값 규칙 작업 열의 [수정]을 클릭하여 추가한 캐시 키 값 규칙을 수정할 수 있습니다.

>!기본 규칙은 필터링 매개변수와 대소문자 생략 설정만 수정할 수 있으며, 유형과 내용은 수정할 수 없습니다.

### 규칙 삭제

캐시 키 값 규칙 작업 열의 [삭제]를 클릭하여 추가한 캐시 키 값 규칙을 삭제할 수 있습니다. (기본 규칙은 삭제 불가)


## 설정 예시

가속 도메인 `www.test.com`의 [캐시 키 값 규칙 설정]이 다음과 같은 경우,
![](https://main.qcloudimg.com/raw/2dc21d4d41c678b277be26589ea96bca.png)

실제 액세스 상황은 다음과 같습니다.

클라이언트 요청 리소스가 `www.test.com/abc.jpg?version=1&colour=red`와 `www.test.com/abc.JPG?version=1&colour=red`인 상태에서, 모두 CDN 노드 X에 액세스를 요청하고 노드 X에 상기 두 리소스의 캐시가 없는 경우:

- 원본 서버에 요청하여 `abc.jpg` 이미지 리소스를 획득하고 CDN 노드 X에 캐시하면 이미 필터링 매개변수: 모두 필터링으로 설정되어 있어 “?” 앞에 있는 링크 `www.test.com/abc.jpg`가 캐시 키 값이 됩니다.
- 클라이언트에서 `www.test.com/abc.JPG?version=1&colour=red`를 요청하는 경우, 대소문자 생략이 활성화되어 있지 않아 이전에 캐시한 `www.test.com/abc.jpg` 리소스를 히트할 수 없습니다. 원본 서버에 요청하여 `abc.JPG` 이미지 리소스를 획득하고 CDN 노드 X에 캐시하면 상응하는 캐시 키 값은 `www.test.com/abc.JPG`가 됩니다.



