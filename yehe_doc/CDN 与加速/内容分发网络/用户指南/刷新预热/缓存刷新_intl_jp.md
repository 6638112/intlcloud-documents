## 機能の説明
Content Delivery Network（CDN）は基本的なキャッシュ設定機能を提供しています。指定されたビジネスタイプやディレクトリ、具体的なURL等各種のルールにより、キャッシュの有効期限を設定することにより、定期的にノードのキャッシュリソースをクリアし、オリジンサーバーから最新のリソースを再度プルしキャッシュする目的を果たします。

また、CDNサービスはキャッシュ更新機能を提供しています。URLまたはディレクトリを一括指定して更新操作を行うことができます。
- URLの更新：CDNのすべてのノードにおける対応するリソースのキャッシュを削除します。
- ディレクトリの更新：「リソース変更ジョブを更新」モードを選択すると、ユーザーがマッチングしているディレクトリ配下のリソースにアクセスする時に、リソースの最終変更情報がオリジンサーバーから取得されます。現在のキャッシュされているリソースと一致している場合、キャッシュされたリソースが直接返されます。それ以外の場合、変更されたリソースはオリジンサーバーからプルされ、再度キャッシュされます。「すべてのリソースを更新」モードを選択すると、ユーザーがマッチングしているディレクトリ配下のリソースにアクセスする時に、新しいリソースがオリジンサーバーから直接プルされ、再度キャッシュされます。

>更新が完了した後に、ノード上に対応するリソースに有効なキャッシュがありません。ユーザーが再度アクセスする時に、ノードは必要なリソースをオリジンサーバーからプルし、ノードに再度キャッシュします。そのため、大量の更新タスクを送信することにより、比較的に多くのキャッシュがクリアされるため、back-to-originリクエストが激増し、オリジンサーバーに大きな負荷がかかってしまいます。

## ユースケース
### 新しいリソースのリリース
オリジンサーバーで新しいリソースで同名の古いリソースに上書きされた後、ネットワーク全体におけるユーザーがノードのキャッシュが影響を受け、古いリソースにアクセスしてしまうことを避けるために、対応するリソースのURL / ディレクトリを送信し更新して、ネットワーク全体のキャッシュをクリアすることにより、ネットワーク全体におけるユーザーは最新のリソースに直接アクセスすることが可能となります。

### 不正なリソースのクリーンアップ
オリジンサーバーに不正なリソース（エロチック関連、麻薬関連、ギャンブル関連など）が見つかった場合は、ノードキャッシュが原因で、オリジンサーバーでそれらを削除した後でも引き続きアクセスできる可能性があります。ネットワーク環境を守るために、URL更新によりキャッシュのリソースを削除することにより、タイムリーな排除を確保することが可能です。　

## 操作ガイド
### 利用方法
[CDN コンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションメニューバーで【パージとプリフェッチ】をクリックし、画面に入ってから必要に応じ【URL 更新】または【ディレクトリ更新】タスクを送信できます。
![](https://main.qcloudimg.com/raw/a5b308a925feb7d7cc6931320be000a1.png )
![](https://main.qcloudimg.com/raw/8de0518fec393a6519fa53d75fdc5471.png )
<span ID = "notes"></span>
【操作履歴】セクションでは、期間、キーワード、更新タスクタイプを指定してクエリーすることができます。キーワードは指定されたドメイン名のクエリー、または完全なURL更新/ディレクトリのクエリーのみをサポートします。
![](https://main.qcloudimg.com/raw/1dbb73160a79162e423c83edc9b9cf40.png )

> コンソールは一度に最大10,000の操作レコードを返すことができ、完全なexcel形式のファイルにエクスポートすることができます。更新タスクが多い場合は、分けてクエリーしてエクスポートしてください。

### 注意事項

**URLの更新**：
- アカウントごとに1日あたり最大10,000個のURLを更新でき、一度に最大1,000個のURLを送信できます。中国本土以外アクセラレーションをアクティブにしているお客様にとっては、中国本土以外に1日あたり最大10,000個のURLを更新でき、中国本土の割り当てと相互に独立します。
- 更新タスクを送信する際に、`http://`または`https://`プロトコル識別子を追加する必要があります。
- `http://*.test.com/`形式のURLは更新できません。ワイルドカードドメイン名をCDNに接続する場合でも、更新する際に対応するサブドメイン名を送信する必要があります。
- 更新を送信する際に、URL中のドメイン名はアクセラレーションサービスに接続する必要があります。そうしないと、送信が失敗することがあります。
- パスに漢字を含むURLは更新できません。
- デフォルトでは、URL更新タスクを送信すると、URL内のドメイン名のアクセラレーションリージョンはリージョン全体で更新されます。

**ディレクトリの更新**：
- アカウントごとに1日あたり最大100個のディレクトリを更新でき、一度に最大20個のディレクトリを送信できます。中国本土以外アクセラレーションをアクティブにしているお客様にとっては、中国本土以外に1日あたり最大100個のディレクトリを更新でき、中国本土の割り当てと相互に独立します。
- 更新タスクを送信する際に、`http://`または`https://`プロトコル識別子を追加する必要があります。
- `http://*.test.com/`形式のディレクトリは更新できません。ワイルドカードドメイン名をCDNに接続する場合でも、更新する際に対応するサブドメイン名を送信する必要があります。
- 更新を送信する際に、URL中のドメイン名はアクセラレーションサービスに接続する必要があります。そうしないと、送信が失敗することがあります。
- パスに漢字を含むURLは更新できません。

**サブユーザー権限の設定**：
- ディレクトリの更新、URLの更新、更新記録のクエリーは、現在すでに最新の権限システムに接続されています。リソース（ドメイン名）の権限設定を対応しています。
- 権限の割り当て方法については、[権限設定](https://cloud.tencent.com/document/product/228/12722)をご覧ください。

## 利用事例

### ディレクトリ更新-リソース変更ジョブを更新
アクセラレーションドメイン名がpurge-test-1251991073.file.myqcloud.comであり、オリジンサーバーがTencent CloudのCloud Object Storage（COS）、オリジンサーバーのリソースが下記の通りです。
![](https://main.qcloudimg.com/raw/91739f8f9315e1e5be36980d0af248e4.png)
1. それぞれリソース1.txt と2.txtのアクセスリクエストを送信し、X-Cache-Lookup: Hit From Distank3およびServer: NWS_SPMid によりヒットされたノードを判定することができます。リソースはノードによって直接返されます。
![](https://main.qcloudimg.com/raw/8e5e1d55743f83340b6801942011a951.jpg)
![](https://main.qcloudimg.com/raw/dc50a49f1177c0a671c0f10f874b0a0b.jpg)
2. オリジンサーバーで、1.txtを同じ名前のファイルに置き換え、ファイルの最終変更時刻が変更されますが、2.txtはそのままにします。
![](https://main.qcloudimg.com/raw/5602a365abf57124b31bd24516c9f362.png)
![](https://main.qcloudimg.com/raw/f2f45c7bf3fd86c5a4b307143c9a6a6f.png)
3. この際に、再度リクエストを送信します。キャッシュの有効期限が切れていないため、1.txtリソースのレガシーコンテンツにアクセスします。
![](https://main.qcloudimg.com/raw/f08fcfe681ff6684ef9ebf96d7a7b5ab.jpg)
4. ディレクトリ更新タスクを送信し、【リソース変更ジョブを更新】を選択し、更新が完了するまで待ちます。
![](https://main.qcloudimg.com/raw/6638c5d781b9d41a0b11ee5c4c6ea3af.png)
5. 更新した後に、ファイル1.txt の最終更新日が変更されているため、リクエストはオリジンサーバーに転送されます。ファイル2.txtは変更されていないため、ディレクトリ更新タスクが送信された後でも、ノードにヒットして返されます。
![](https://main.qcloudimg.com/raw/d1e83b5357fc878d6f1df56f0f1cd84b.jpg)
![](https://main.qcloudimg.com/raw/29e68b2f6207731a689e9c11ee1bf849.jpg)

