## 기능 소개
CDN은 기본 캐시 설정 기능으로 지정된 서비스 유형, 디렉터리 및 특정 URL과 같은 다양한 규칙에 따라 캐시 만료 시간을 설정함으로써, 주기적으로 노드 캐시 리소스를 정리하고 원본 서버에서 최신 리소스를 가져와 다시 캐싱할 수 있습니다.

그 외에도 CDN은 캐시 제거 기능을 제공하여, URL과 디렉터리를 일괄 지정하여 Purge(퍼지) 작업을 진행할 수 있습니다.
- URL 퍼지: CDN의 모든 노드에서 해당하는 리소스의 캐시를 삭제합니다.
- 디렉터리 퍼지: "변경 리소스 퍼지" 모드를 선택합니다. 사용자가 관련 디렉터리의 리소스에 액세스하면 원본 리소스의 Last-Modify 정보를 가져오는데, 해당 정보가 현재 캐시 리소스와 일치하면 캐싱한 리소스라고 리턴하고, 일치하지 않으면 원본 서버에서 리소스를 가져온 다음 다시 캐싱합니다. "전체 리소스 퍼지"를 선택한 경우, 관련 디렉터리 리소스에 액세스하면 원본 서버에서 리소스 가져오기라고 리턴한 후 새 리소스를 다시 캐싱합니다.

>퍼지에 성공한 후에는 노드에 대응하는 리소스에 유효한 캐시가 제거되고, 사용자가 다시 액세스하면 노드가 원본 서버로부터 필요한 리소스를 가져와 다시 노드로 캐싱합니다. 따라서 대량의 퍼지 작업을 제출하면 더 많은 양의 캐시가 삭제되어 Origin-pull 요청이 급증하게 되므로 원본 서버에 부담이 더 가중됩니다.

## 적용 시나리오
### 새로운 리소스 배포
원본 서버에서 새 리소스로 같은 이름의 이전 리소스를 덮어쓰기 한 후, 전체 네트워크 사용자가 노드 캐시에 의해 이전 리소스에 액세스하지 않도록 해당하는 리소스의 URL/ 디렉터리를 제출하여 퍼지할 수 있습니다. 또한 전체 네트워크 캐시를 제거한 후에는 전체 네트워크 사용자 모두 최신 리소스에 바로 액세스할 수 있습니다.

### 불법 리소스 삭제
사이트에 불법 리소스(음란물, 마약, 도박 등)가 발견된 경우, 원본 서버 리소스를 삭제해도 노드 캐시 리소스로 인해 계속해서 액세스 될 수 있습니다. 이와 같은 상황에서 네트워크 환경을 보호하기 위해 URL 퍼지를 통해 즉시 캐시 리소스를 제거할 수 있습니다.

## 작업 가이드
### 사용 방법
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하고, 왼쪽 메뉴에서 [Purge and Prefetch]를 클릭하여 접속한 후, 필요에 따라 [Purge URL] 및 [Purge Directory]를 제출할 수 있습니다.
![](https://main.qcloudimg.com/raw/a5b308a925feb7d7cc6931320be000a1.png )
![](https://main.qcloudimg.com/raw/8de0518fec393a6519fa53d75fdc5471.png )
<span ID = "notes"></span>
[History]에서 시간 주기, 키워드, 퍼지 작업 유형 등을 기준으로 조회할 수 있습니다. 키워드는 특정 도메인 혹은 정확한 퍼지 URL / 디렉터리를 조회할 때만 사용할 수 있습니다.
![](https://main.qcloudimg.com/raw/1dbb73160a79162e423c83edc9b9cf40.png )

> 콘솔은 한 번에 최대 10000 개의 작업 기록을 리턴할 수 있고, 정확한 Excel 형식으로 내보내기를 지원합니다. 퍼지 작업이 많을 경우 단락을 나누어 일괄 조회하여 내보내시기를 바랍니다.

### 주의사항

**URL 퍼지**:
- 각 계정당 URL 퍼지는 1일 10000개로 제한되고, 매회 1000개의 URL 퍼지를 제출할 수 있습니다. 중국 외 가속을 활성화한 경우, 중국 내 쿼터와 분리되며 1일 10000개의 URL을 퍼지 할 수 있습니다.
- 퍼지 작업 제출 시 `http://` 또는 `https://` 프로토콜 식별자를 포함하고 있어야 합니다.
- http://*. test.com/` 형식의 URL 퍼지는 지원되지 않습니다. 와일드카드 서브도메인으로 가속한 서비스에 액세스하더라도 퍼지 하려면 해당 서브도메인을 제출해야 합니다.
- 퍼지 제출 시 URL의 도메인이 가속 서비스에 액세스해야 하며, 그렇지 않으면 제출에 실패합니다.
- 경로에 중국어가 포함된 URL은 퍼지 할 수 없습니다.
- 제출을 기준으로 URL 퍼지를 디폴트로 설정할 경우, URL의 도메인 가속 리전 전체를 퍼지 해야 합니다.

**디렉터리 퍼지**：
- 각 계정당 디렉터리 퍼지는 1일 100개로 제한되고, 매회 20개의 디렉터리 퍼지를 제출할 수 있습니다. 중국 외 가속을 활성화한 경우, 중국 내 쿼터와 분리되며 1일 100개의 디렉터리를 퍼지 할 수 있습니다.
- 퍼지 작업 제출 시 `http://` 또는 `https://` 프로토콜 식별자를 포함하고 있어야 합니다.
- http://*. test.com/` 형식의 디렉터리 퍼지는 지원되지 않습니다. 와일드카드 서브도메인으로 가속한 서비스에 액세스하더라도 퍼지 하려면 해당 서브도메인을 제출해야 합니다.
- 퍼지 제출 시 URL의 도메인이 가속 서비스에 액세스해야 하며, 그렇지 않으면 제출에 실패합니다.
- 경로에 중국어가 포함된 URL 및 디렉터리는 퍼지할 수 없습니다.

**서브 계정 권한 설정**:
- 현재 디렉터리 퍼지, URL 퍼지 및 퍼지 기록 조회는 최신 권한 시스템에 액세스하여 리소스(도메인) 단위의 권한 설정을 지원합니다.
- 설정 방법은 [권한 설정](https://cloud.tencent.com/document/product/228/12722)을 참조 바랍니다.

## 사용 사례

### 디렉터리 퍼지-변경 리소스 퍼지
가속 도메인이 purge-test-1251991073.file.myqcloud.com이고, 원본 서버가 Tencent Cloud Object Storage일 때의 원본 서버 리소스는 다음과 같습니다.
![](https://main.qcloudimg.com/raw/91739f8f9315e1e5be36980d0af248e4.png)
1. 리소스 1.txt 및 2.txt에 각각 액세스 요청을 보냅니다. X-Cache-Lookup: Hit From Distank3 와 Server: NWS_SPMid으로 캐시 히트 여부를 확인하면, 노드가 리소스를 리턴합니다.
![](https://main.qcloudimg.com/raw/8e5e1d55743f83340b6801942011a951.jpg)
![](https://main.qcloudimg.com/raw/dc50a49f1177c0a671c0f10f874b0a0b.jpg)
2. 같은 이름의 파일 1.txt를 원본 서버에서 덮어씌우면, 파일 수정 시간은 변경되고 2.txt는 변경되지 않습니다.
![](https://main.qcloudimg.com/raw/5602a365abf57124b31bd24516c9f362.png)
![](https://main.qcloudimg.com/raw/f2f45c7bf3fd86c5a4b307143c9a6a6f.png)
3. 이때 요청을 다시 보내면, 캐시가 만료되지 않았으므로 리소스 1.txt에 액세스 시 그대로 수정 전의 콘텐츠로 남아 있습니다.
![](https://main.qcloudimg.com/raw/f08fcfe681ff6684ef9ebf96d7a7b5ab.jpg)
4. 디렉터리 퍼지를 제출하고 [변경 리소스 퍼지]를 선택한 후, 완료될 때까지 기다리세요.
![](https://main.qcloudimg.com/raw/6638c5d781b9d41a0b11ee5c4c6ea3af.png)
5. 퍼지 완료 후, 1.txt Last-Modified 파일이 수정되었으므로 원본 가져오기를 바로 요청하고, 2.txt 파일은 수정하지 않았으므로 디렉터리 퍼지를 제출하지만 노드에 의해 발견되어 리턴됩니다.
![](https://main.qcloudimg.com/raw/d1e83b5357fc878d6f1df56f0f1cd84b.jpg)
![](https://main.qcloudimg.com/raw/29e68b2f6207731a689e9c11ee1bf849.jpg)

