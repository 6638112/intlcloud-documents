### アクセス監視の帯域幅データはどのように統計されていますか。
各CDNノードはリアルタイムでトラフィックデータを収集し、コンピューティングセンターに報告してドメイン名の総トラフィックデータに集計します。総トラフィックを使用時間で割って帯域幅データに変換して表示します。
**例：**
- 1分間に発生したトラフィックの合計は6MBである場合、対応する帯域幅は（6 * 8）/60 = 0.8Mbpsとなります。
- 帯域幅課金には5分の粒度での統計に基づいて計算されるため、対応する帯域幅の値=5分の粒度の総トラフィック÷300秒となります。

### 監視情報のトラフィックとログによって計算されたトラフィックに違いがあるのはなぜですか、違いは何ですか。
アクセラレーションドメイン名ログに記録されているダウンストリームバイトによって統計されたトラフィックデータは、アプリケーション層のデータです。ネットワークを介した実際のデータ転送によって生成されるトラフィックは、純粋なアプリケーション層のトラフィックより5%〜15%多くなります。
- TCP/IPヘッダーによる消費：TCP/IPプロトコルに基づくHTTPリクエストでは、各パケットのサイズは最大1500バイトであり、TCPとIPプロトコルの40バイトのヘッダーが含まれます。ヘッダは転送中にトラフィックを生成しますが、アプリケーション層に統計されません。この部分のオーバーヘッドは約3%です。
- TCP再送信：通常のネットワーク転送中、送信されるネットワークパケットの約3%～10%がインターネット上で廃棄されます。サーバーは廃棄された部分を再送信しますが、アプリケーション層はこの部分にかかったトラフィックを統計できません。その比率は約3%～7%です。

業界標準として、課金対象のトラフィックは、一般的にアプリケーション層のトラフィックと上記のオーバーヘッドの合計です。Tencent Cloud CDNはオーバーヘッドの割合として10％を占めるため、監視トラフィックがログによって計算されるトラフィックの約110％です。

### トラフィックのヒット率はどのように計算しますか。
CDNサービスはデフォルトではユーザーにL2キャッシュ(エッジレイヤー、中間レイヤー)を有効にし、CDNのいずれかのレベルのレイヤーにヒットされ、リクエストに応答すると、CDNノードにヒットしていること見なされます。
トラフィックヒット率=（合計ダウンストリームトラフィック-back-to-originトラフィック）/合計ダウンストリームトラフィック。

### トラフィックヒット率が低い場合の対処方法とは。
- キャッシュ更新が行われたかどうかを確認します。キャッシュ更新により、ノードで指定された内容がクリアされ、一時的にトラフィックヒット率が低下します。
- 新しいリソースがオリジンサーバーに配置されているかどうかを確認します。オリジンサーバーに新しいリソースが多い場合、CDNノードでback-to-originが発生して、トラフィックヒット率が低くなる可能性があります。
- オリジンサーバーが正常に動作するかどうかを確認します。オリジンサーバーに障害が発生すると、5XXまたは4XXエラーが多くなった場合、トラフィックヒット率に影響を与えます。
- キャッシュの有効期限ポリシーが正しく設定されているかどうかを確認します。コンソールのキャッシュ設定ページで「キャッシュ有効期限の設定」セクションを確認します。キャッシュの有効期限ポリシーは、優先順位は上から下へ、低から高へであり、即ち、下部のキャッシュポリシーが上部のキャッシュポリシーを上書きします。
- Range back-to-originが有効になっているかどうかを確認します。コンソールのback-to-origin設定ページの「Range back-to-origin」セクションを確認します。Range back-to-originが無効になっている場合、back-to-origin時にファイル全体をプルされるため、back-to-originのトラフィックが高くなり、トラフィックヒット率に影響を与えます。
- フィルターパラメーターが有効になっているかどうかを確認します。コンソールの[アクセス制御]タブにある「フィルターパラメーター」セクションを確認します。フィルターパラメーターが無効になっている場合、フルパスに基づいてキャッシュが実行されます。この場合、同じリソースが異なるパラメーターによって要求された場合、マッチングできないと複数回がキャッシュされるため、トラフィックヒット率に影響を与えます。　　

### ステータスコードの統計にはすべてのステータスコードが含まれますか。

はい。新しいバージョンのCDN統計分析では、オリジンサーバーによって生成されたすべてのステータスコードのモニタリング曲線が描画されるため、トラブルシューティングが簡単になります。

### 省別、キャリアの統計データはどのように計算しますか。
省別、キャリアの統計データは、アクセスログのクライアントIPに基づいて計算されます。単純なログ計算を採用しているので、その合計数値は、「すべての省」、「すべてのキャリア」を選択したときに適用される課金データと差があります。詳細については、上記の2番目の質問をご参照ください。


### CDN back-to-originトラフィックはどのように発生しますか。

次の3つの状況では、CDN back-to-originトラフィックが発生します。
1. 要求されたリソースはCDNノードにキャッシュされず、オリジンサーバーからプルされます。
2. オリジンサーバーとノードの同期を手動で更新する場合。
3. オリジンサーバーが自動更新になった場合。

### CDNトラフィックに異常があるか、DDOSまたはCC攻撃を受けている場合はどうすればよいですか。

ビジネストラフィックがそれほど量に到達しないと思われる場合は、ログをダウンロードして、ビジネスのアクセス状況を確認し、それに応じてアクセス制限を設定できます。CDNではご利用のビジネスロジックを認識しないため、デフォルトではアクセス要求を制限することがありません。ビジネス状況に応じて制限を設定する必要があります。詳細については、[ログのダウンロード](https://intl.cloud.tencent.com/document/product/228/6316)をご参照ください。

悪意のあるリクエストやWebサイトへのCC / DDOS攻撃を回避するために、次の設定を行うことを強くお勧めします。
1. リンク不正アクセス防止の設定：ビジネスリソースへのアクセスを制御できます。ユーザーのHTTPリクエストヘッダーのrefererフィールドの値にアクセス制御ポリシーを設定することで、アクセス元を制限して、悪意のあるユーザーからの盗用を防ぐことができます。詳細については、[リンク不正アクセス防止の設定](https://intl.cloud.tencent.com/document/product/228/6292)をご参照ください。
2. IPブラックリスト/ホワイトリストの設定：ビジネスニーズに基づいて、悪意のあるIPからの盗用や攻撃などの問題を解決するために、ユーザーリクエストのソースIPにフィルタリングポリシーを設定できます。詳細については、[IPブラックリスト/ホワイトリストの設定](https://intl.cloud.tencent.com/document/product/228/6298)をご参照ください。
3. IPアクセス頻度制限の設定：クライアントIPに対して、ノードごとの1秒あたりのアクセス回数を制限することで、CC攻撃から防御できます。設定を有効にすると、QPS制限を超えるリクエストに対しは直接514エラーが返されます。頻度制限を低く設定すると、通常の高頻度ユーザーの利用に影響する場合があるため、実際の業務状況や使用状況に応じて、適切なしきい値を設定してください。詳細については、[IPアクセス頻度制限の設定](https://intl.cloud.tencent.com/document/product/228/6420)をご参照ください。
4. 帯域幅上限の設定：ドメイン名に対して、帯域幅の上限しきい値を設定できます。特定の統計期間（5分）内にドメイン名によって発生した帯域幅が指定されたしきい値を超えると、ユーザーの設定に従って、すべてのアクセス要求がオリジンサーバーに転送されるか、直接CDNサービスを無効にして、すべてのアクセス要求が404エラーが返されます。詳細については、[帯域幅上限の設定](https://intl.cloud.tencent.com/document/product/228/7541)をご参照ください。
