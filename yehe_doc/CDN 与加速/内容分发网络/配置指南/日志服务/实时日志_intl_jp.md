## 機能の概要

Content Delivery Network（CDN）は、アクセスログをリアルタイムで収集してプッシュすることにより、ログデータをすばやく検索して分析できます。ユーザーはCDNコンソールからワンストップですばやくアクセスして、ログの収集、ログの保存からログの検索など、安定した高信頼性の包括的なログサービスを利用することができます。

>? 
>- 現在、CDNのリアルタイムログサービスがリリースされました。コンソールでルートアカウントを使用してサービスをアクティブにして使用できます。使用する前に権限を付与して、[Cloud Log Service（CLS）](https://console.cloud.tencent.com/cls/search?region=ap-shanghai)をアクティブにする必要があります。
>- リアルタイムログサービスは現在、中国本土以外のログ配信をサポートしていません。
>- リアルタイムログサービスは、ルートアカウントでのアクティベーションのみをサポートします。

## ユースケース
この機能を使用すると、ユーザーアクセスをリアルタイムで表示および分析できます。

## 基本概念
### ログセット
ログセット（Logset）は、ログサービスのプロジェクト管理単位であり、異なるプロジェクトのログを区別するために使用されます。1つのログセットは、1つのプロジェクトまたはアプリケーションに対応します。CDNログセットには、以下の基本的な属性情報があります。
+ ログセット名:cdn_logset
+ リージョン：ログセットが属する [リージョン](https://intl.cloud.tencent.com/document/product/614/18940)
+ 保存時間:現在のログセット内のデータの保存期間
+ 作成日時:ログセットの作成日時

### ログトピック
ログトピック（Topic）は、ログサービスの基本的な管理単位です。1つのログセットには、複数のログトピックを含めることができます。1つのログトピックは、1種類のアプリケーションまたはサービスに対応します。異なる端末上の同種類のログを同じログトピックに収集することをお勧めします。たとえば、1つのビジネスプロジェクトには、操作ログ、アプリケーションログ、アクセスログの3種類のログがある場合、ログの種類ごとにログトピックを作成できます。

ログサービスシステムは、ログトピックを単位として、ユーザーの異なるログデータを個別に管理します。各ログトピックには、異なるデータソース、インデックスルール、および配信ルールを設定できるため、ログトピックはログサービスがログデータをを構成および管理するための基本単位です。ログトピックを作成した後、ログを効果的に収集し、検索、分析、配信などの機能を利用するには、関連ルールを設定する必要があります。

ログトピックの機能は次のとおりです。
- ログを収集してトピックを記録します。
- ログトピックに基づいてログを保存および管理します。
- ログトピックに基づいてログを検索および分析します。
- ログトピックに基づいてログを他のプラットフォームに配信します。
- ログトピックからログをダウンロードして使用します。

## 操作ガイド
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションメニューバーで【ログサービス】をクリックして、【リアルタイムログ】を選択すると、リアルタイムログのページに入り、リアルタイムログ配信の作成を開始します。
![](https://main.qcloudimg.com/raw/d6f22b7194f2e3433f9bbee4f4e4a1dc.png)

### ログトピックの新規作成
【新規作成】をクリックして、ログ トピックを作成します。
>! 1つのログセットに最大10個のログトピックを作成できます。

![](https://main.qcloudimg.com/raw/94136aa047219848f82948e19cd8dc06.png)

### ログトピックの設定
新しいログトピックの名前を記入し、ドメイン名をログトピックにバインドします。
>!
>- 新規作成するログトピックの名前は、既存のログトピックの名前と同じにすることはできません。
>- 1つのドメイン名は1 つのログトピックにのみバインドできます。
>- 設定情報が保存されてから、設定が有効になるまで約15分間かかります。

![](https://main.qcloudimg.com/raw/6e820577732ecc679aae25386683c57e.png)

### ログトピックの管理
ログトピックを設定した後は、ログトピックを管理できるようになります。ログトピックへのログ配信の停止/開始、当該ログトピックでのログの検索、ログトピックの管理、およびログトピックの削除を行うことができます。
![](https://main.qcloudimg.com/raw/46d8293f0819b693b4b17fa6a79ca78c.png)

#### ログ配信の停止/開始
ログトピックへのログ配信を手動で停止/開始することができます。
>!
>- 停止すると、当該ログトピックにバインドされているドメイン名のすべてのログは当該トピックに配信されなくなり、すでに配信されているログは保持されます。有効になるまで約5～15分かかります。
>- 開始すると、当該ログトピックにバインドされているドメイン名のすべてのログは引き続き当該トピックに配信され、有効になるまで約5～15分かかります。

#### 検索
ログトピックでログを検索します。検索するログトピックを選択し、【検索】をクリックすると、ログ検索画面に入ります。
+ 期間の選択：本日、24時間（過去7日間から1日を選択）、および過去7日間に記録されたログデータを検索できます。
+ ソート: ログ時間に基づいて、ログを昇順または降順で並べ替えることができます。
+ 検索：全文検索、Key-Value検索、およびファジー検索をサポートします。詳細については、[検索構文](https://intl.cloud.tencent.com/document/product/614/37882)をご参照ください。もっと多くの検索および分析機能を利用するには、[Cloud Log Service（CLS）](https://console.cloud.tencent.com/cls/search?region=ap-shanghai)に進んでください。

![](https://main.qcloudimg.com/raw/dbc8e4aa6ae93062c22cadf4b9373e64.png)


#### 管理
作成したログトピックを管理し、それにバインドされているドメイン名のリストを更新できます。
>? 新しい設定が有効になるまで、15分程度かかります。
>
![](https://main.qcloudimg.com/raw/ce1f6df0d8bde8ce66f7ebfb4a233e6e.png)

#### 削除
ログトピックを手動で削除することができます。
>! ログトピックが削除されると、当該ログトピックにバインドされているドメイン名のすべてのログは当該トピックに配信されなくなり、すでに配信されているすべてのログは消去されます。有効になるまで、15分程度かかります。

### ログデータの説明

| ログフィールド      | 生ログのタイプ | ログサービスタイプ | 説明                                                         |
| ------------- | ------------ | ------------ | ------------------------------------------------------------ |
| app_id        | Integer      | long         | Tencent Cloudアカウント APPID                                             |
| client_ip     | String       | text         |クライアント IP                                                    |
| file_size     | Integer      | long         | ファイルサイズ                                                   |
| hit           | String       | text         | キャッシュのヒット/ミス。CDNエッジサーバーと親ノードの両方でのヒットがヒットとしてマークされます。  |
| host          | String       | text         | ドメイン名                                                         |
| http_code     | Integer      | long         | HTTPステータスコード                                              |
| isp           | String       | text         |キャリア                                                       |
| method        | String       | text         | HTTP Method                                                  |
| param         | String       | text         | URLに付けるパラメータ                                     |
| proto         | String       | text         | HTTP プロトコル識別子                                         |
| prov          | String       | text         | キャリア所在省                                                   |
| referer       | String       | text         | Referer 情報、つまりHTTPソースアドレス                               |
| request_range | String       | text         | Rangeパラメータ、つまりリクエスト範囲                                      |
| request_time  | Integer      | long         | 応答時間（ms）。ノードがリクエストを受信してからすべてのパケットに応答してクライアントに到達するまでの時間を示します。|
| rsp_size      | Integer      | long         | 返されるバイト数                                                  |
| time          | Integer      | long         | UNIX形式のタイムスタンプリクエスト                                    |
| ua            | String       | text         | User-Agent情報                                           |
| url           | String       | text         | リクエストパス                                                    |
| uuid          | String       | text         | 一意のリクエスト ID                                             |
| version       | Integer      | long         | CDN リアルタイムログのバージョン                                                   |
