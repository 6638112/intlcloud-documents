## 機能の説明

Content Delivery Network（CDN）はCDNアクセスログをリアルタイムで収集してプッシュすることにより、ログデータの素早い検索と分析を実現します。CDNコンソールからワンストップで素早くアクセスでき、ログの収集、ログの保存からログの取得まで、あらゆる方面で安定的で信頼性の高いログサービスを受けることができます。

>? 
>- リアルタイムログサービスはすでにすべてリリースされています。コンソールからルートアカウントを用いてセルフアクティベーションすることで使用できます。使用前に、まず [Cloud Log Service（CLS）](https://console.cloud.tencent.com/cls/search?region=ap-shanghai)をアクティブ化する権限を付与する必要があります。
>- リアルタイムログサービスは、現時点では、中国本土以外でのログの配信をサポートしていません。
>- リアルタイムログサービスは、ルートアカウントのアクティブ化のみをサポートしています。
>- CDNとECDNドメイン名を同じログトピックの下に混在させることはできません。

## 適用ケース
この機能を使用すると、ユーザーアクセスをリアルタイムで表示および分析できます。

## 基本概念
### ログセット
ログセット（Logset）はログサービスのプロジェクト管理ユニットであり、各プロジェクトのログを識別するために使用されます。1つのログセットは、1つのプロジェクトまたはアプリケーションに対応します。CDNログセットには次の基本的な属性情報があります。
+ ログセット名：cdn_logset
+ 地域：- ログセットは[リージョン](https://intl.cloud.tencent.com/document/product/614/18940)に所属しています
+ 保存時間：現在のログセット内のデータ保存期間サイクル
+ 作成時間：ログセット作成時間

### ログトピック
ログトピック（Topic）はログサービスの基本管理ユニットであり、1つのログセットに複数のログトピックを含めることができます。1つのログトピックは1種のアプリケーションまたはサービスに対応しています。異なるマシン上の同種のログを同じログトピックに収集することをお勧めします。例えば、1つの業務プロジェクトに、操作ログ、アプリケーションプログラムログ、アクセスログの3種類のログがある場合、タイプごとに1つのログトピックを作成できます。

ログサービスシステムは、ログトピックを単位としてユーザーの各種ログデータを識別し管理します。ログトピックごとに、それぞれ個別のデータソース、インデックスルールおよび配信ルールを設定できます。以上より、ログトピックはログサービス設定、ログデータ管理の基本ユニットであり、スケジュールどおりに効果的にログを収集し、かつ検索、分析、配信などの機能を使用するには、ログトピック作成後に関連のルールを設定する必要があります。

シーン機能の観点から、ログトピックは主に次の機能を提供します。
- ログを収集してトピックを記録します。
- ログトピックに基づいてログを保存および管理します。
- ログトピックに基づいてログを検索および分析します。
- ログトピックに基づいてログを他のプラットフォームに配信します。
- ログトピックからログをダウンロードして使用します。

## 操作ガイド
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のディレクトリの【ログサービス】をクリックして【リアルタイムログ】を選択すると、リアルタイムログページに移動し、リアルタイムログ配信の作成を開始することができます。
![](https://main.qcloudimg.com/raw/d6f22b7194f2e3433f9bbee4f4e4a1dc.png)

### ログトピックの作成
【新規作成】をクリックし、ログトピックを作成します。
>! 1つのログセットに最大10個のトピックを作成できます。
>
![](https://main.qcloudimg.com/raw/94136aa047219848f82948e19cd8dc06.png)

### ログトピックの設定
新しいログトピックの名前を記入し、ドメイン名をログトピックにバインドします。
>!
>- 新規作成するログトピックの名前は、既存のログトピックの名前と同じにすることはできません。
>- 1つのドメイン名は1 つのログトピックにのみバインドできます。
>- 設定情報を保存した後、設定が有効になるまでに約15分かかります。
>
![](https://main.qcloudimg.com/raw/6e820577732ecc679aae25386683c57e.png)

### ログトピックの管理
ログトピックの設定に成功したら、次のログトピックの管理を実行できます。ログトピックへのログ配信の停止/開始、ログトピックをユニットとするログの検索、ログトピックの管理とログトピックの削除。
![](https://main.qcloudimg.com/raw/46d8293f0819b693b4b17fa6a79ca78c.png)

#### ログトピックへのログ配信の停止/開始
ログトピックへのログ配信を手動で停止/開始できます。
>!
>- 停止後、ログトピックのドメイン名にバインドされているすべてのログは、このトピックに配信されなくなりますが、配信済みのログは引き続き保存されます。有効になるまでに約5〜15分かかります。
>- 開始後、ログトピックのドメイン名にバインドされているすべてのログはこのトピックに引き続き配信されます。有効になるまでに約5〜15分かかります。

#### 検索
ログトピックをユニットとしてログ検索を実行します。検索したいログトピックを選択し、【検索】をクリックして、ログ検索ページに移動します。
+ 時間間隔の選択：今日、24時間（オプションで直近7日間のいずれか1日）、および直近7日間のログデータの検索をサポートしています。
+ 並べ替え表示：ログ時間に基づく降順 / 昇順の並べ替えをサポートしています。
+ 検索：全文検索、キー値検索、あいまい検索をサポートしています。詳細については、[検索構文](https://intl.cloud.tencent.com/document/product/614/37882)をご参照ください。[Cloud Log Service（CLS）](https://console.cloud.tencent.com/cls/search?region=ap-shanghai) では、さらに多くの検索および分析機能をご利用いただけます。

![](https://main.qcloudimg.com/raw/dbc8e4aa6ae93062c22cadf4b9373e64.png)


#### 管理
作成したログトピックを管理し、それにバインドされているドメイン名のリストを更新できます。
>? 新設定が有効になるまでに約5〜15分かかります。
>
![](https://main.qcloudimg.com/raw/ce1f6df0d8bde8ce66f7ebfb4a233e6e.png)

#### 削除
手動でログトピックを削除できます。
>!削除後、ログトピックにバインドされているドメイン名のすべてのログがこのトピックに配信されなくなり、配信済みのすべてのログがクリアされます。有効になるまでに約5〜15分かかります。

### ログデータの説明

| ログフィールド      | 元のログタイプ | ログサービスのタイプ | 説明                                                         |
| ------------- | ------------ | ------------ | ------------------------------------------------------------ |
| app_id        | Integer      | long         | Tencent Cloudアカウント APPID                                             |
| client_ip     | String       | text         |クライアント IP                                                    |
| file_size     | Integer      | long         | ファイルサイズ                                                   |
| hit           | String       | text         | キャッシュヒット/ミス。CDNエッジサーバーと親ノードの両方のヒットがヒットとしてマークされます。  |
| host          | String       | text         | ドメイン名                                                         |
| http_code     | Integer      | long         | HTTPステータスコード                                              |
| isp           | String       | text         |キャリア                                                       |
| method        | String       | text         | HTTP Method                                                  |
| param         | String       | text         | URLが保持するパラメータ                                               |
| proto         | String       | text         | HTTP プロトコル識別子                                         |
| prov          | String       | text         | キャリア所在省                                                   |
| referer       | String       | text         | Referer 情報、つまりHTTPソースアドレス                               |
| request_range | String       | text         | Rangeパラメータ、つまりリクエスト範囲                                      |
| request_time  | Integer      | long         | 応答時間（ms）。ノードがリクエストを受信してからすべてのパケットに応答してクライアントに到達するまでの時間を示します。|
| rsp_size      | Integer      | long         | 返されるバイト数                                                   |
| time          | Integer      | long         | リクエスト時間、UNIX タイムスタンプ、単位：秒。                                        |
| ua            | String       | text         | User-Agent情報                                              |
| url           | String       | text         | リクエストパス                                                    |
| uuid          | String       | text         | 一意のリクエスト ID                                             |
| version       | Integer      | long         | CDNリアルタイムログバージョン                                                    |
