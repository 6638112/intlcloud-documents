
## 설정 시나리오

Tencent Cloud CDN 캐시 리소스가 트리거 방식이고 사용자가 특정 리소스에 액세스하는 경우, 요청을 받은 CDN 노드에서 해당 리소스를 캐시하지 않으면 사용자 원본 서버로 돌아와 리소스를 가져옵니다. 리소스(2XX 상태 코드) 가져오기에 성공하면 노드에서 캐시하고 사용자에게 리턴합니다.

CDN 노드에 캐시하는 리소스는 직접 관리할 수 없습니다. 원본 서버 리소스가 변경되었는데도 CDN 노드가 기존 리소스를 캐시해 사용자에게 반환하는 것이 우려되는 경우, 노드 캐시 규칙 설정을 통해 일정 수준의 제어가 가능합니다.

>!  현재 캐시의 파일 크기 제한은 32G 이내입니다. 이 제한을 초과하면 정상적으로 캐시되지 않고 리소스가 Origin-pull됩니다.

## 설정 가이드

### 설정 조회

[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후, 왼쪽 메뉴바에서 [도메인 이름 관리]를 선택한 뒤 도메인 작업 열의 [관리]를 클릭하여 도메인 설정 페이지로 들어갑니다. Tab을 [캐시 구성]으로 전환하면 [노드 캐시 만료 설정]을 찾을 수 있습니다.

가속 도메인 액세스 시, 서비스 유형별로 CDN에서 기본 노드 캐시 만료 규칙을 추가하며, 필요에 따라 변경할 수 있습니다.
- 정적 가속 서비스 유형을 선택하는 경우 일반적인 동적 파일(예: php, jsp, asp, aspx)은 기본적으로 캐시하지 않으며, 기타 모든 문서는 원본 서버를 따릅니다.
![](https://main.qcloudimg.com/raw/5f48bc5246397975544baadf5ac81f4e.png)
- 가속 다운로드, 스트림 미디어 VOD 서비스 유형을 선택하는 경우 모든 파일의 기본 캐시 만료 시간은 30일입니다.
![](https://main.qcloudimg.com/raw/cdd00154330b8cb217287874f4f40693.png)

### 규칙 추가

다음과 같이 지정 파일 접미사(예: jpg, png), 파일 디렉토리(예: /test) 및 전체 경로 파일(예: /test/1.jpg)에 노드 캐시 설정 지원.
<img src="https://main.qcloudimg.com/raw/5454a77683dca1cfb491eccdae839aa4.png" height="207" width="408" />


- 원본 서버 준수: 원본 서버의 Cache-Control 헤더를 따릅니다.
 - 원본 서버에 상응하는 HTTP Response Header에 Cache-Control 필드가 있는 경우,
 Cache-Control 필드가 max-age면 CDN 노드에서 리소스를 캐싱하는 시간은 max-age 값을 따릅니다.
 Cache-Control 필드가 no-cache/no-store/private면 CDN 노드는 리소스를 캐싱하지 않습니다.
 - 원본 서버에 상응하는 HTTP Response Header에 Cache-Control 필드가 없는 경우, CDN 노드는 리소스를 캐싱하지 않습니다.
**참고:** 해당 경우와 관련하여 일부 플랫폼에는 다음과 같은 정책이 있습니다. 첫 번째 요청은 원본을 불러와 CDN 노드에서 해당 리소스를 캐싱하고, 재요청이 노드 캐시에 히트되는 경우, CDN은 기본적으로 Cache-Control: Max-age=600 의 헤더를 추가합니다.
- 캐싱: CDN 노드에서의 리소스 캐싱 시간을 설정합니다.
- 강제 캐싱: ‘캐싱’을 선택하는 경우, 강제 캐싱 여부를 추가 설정(즉, 원본 서버의 Cache-Control: no-cache/no-store/private 생략 여부)할 수 있으며, 기본적으로 ‘아니오’로 설정되어 있습니다.
**참고:** ‘강제 캐싱’을 ‘예’로 선택할 경우, CDN 노드에서의 리소스 캐싱 시간은 해당 설정 시간을 따릅니다.
　　‘강제 캐싱’을 ‘아니오’로 선택하고 원본 서버의 Cache-Control 필드가 no-cache/no-store/private인 경우, 캐싱 시간을 설정했다 하더라도 CDN 노드는 리소스를 캐싱하지 않습니다.
- 캐싱하지 않음: CDN 노드에서 리소스를 캐싱하지 않습니다.






#### 설정 제한

- 도메인당 최대 100개까지 캐시 규칙을 추가할 수 있습니다.
- 다수 규칙에 우선순위 변경 지원: 하단의 우선순위가 상위보다 높습니다.
**참고: **max-age 없음 기능은 업데이트 중으로 지금은 사용할 수 없습니다. 업데이트 완료 후 사용하십시오. 해당 규칙을 이미 설정한 경우 규칙을 삭제하거나 모든 파일 규칙으로 수정할 것을 권장합니다.
- 단일 파일 확장자/폴더 디렉터리/전체 경로 파일 규칙에는 최대 100개까지 콘텐츠를 입력할 수 있으며, 각 콘텐츠 사이에 “;” 부호를 사용하여 분리합니다. 예: 파일 확장자 - jpg;png


>! 인벤토리가 노드 캐시 만료 설정(Old)(즉, 기본 모드)인 경우 고급 모드 설정에 따라 제출 후 전체 업그레이드하며, 기존의 기본 모드로 복구할 수 없습니다.



### 플랫폼 기본 정책

규칙을 설정하지 않았거나 요청이 설정된 규칙을 미스한 경우, 기본적으로 다음과 같은 플랫폼 정책을 따릅니다.
- 사용자가 특정 서비스 리소스 요청 시, 원본 서버에 해당하는 HTTP Response Header에 Cache-Control 필드가 있는 경우, 해당 Cache-Control을 따릅니다.
- 원본 서버에 해당하는 HTTP Response Header에 Cache-Control 필드가 없는 경우, CDN 노드는 기본적으로 해당 리소스를 600초 동안 캐싱합니다.

## 설정 예시

가속 도메인 'www.test.com'의 [노드 캐시 만료 설정]이 다음과 같은 경우,
![](https://main.qcloudimg.com/raw/c1402003c4549d2e6035420921f67bd0.png)

실제 캐시 상황은 다음과 같습니다.

- 원본 서버의 Cache-Control 필드가 no-cache/no-store/private으로 설정되어 있어도 'www.test.com/abc.jpg' 리소스 노드 캐싱 시간은 10일이 됩니다.
- 'www.test.com/def.php' 리소스가 노드에 캐싱되지 않습니다.



