ドメイン名がCDNに接続されると、システムは自動的にCNAMEドメイン名`.cdn.dnsv1.com` を割り当てます。詳細はCDNコンソールの[ドメイン名管理ページ]https://console.cloud.tencent.com/cdn/domainsで確認できます。CNAMEドメイン名は直接アクセスできないため、ドメイン名のサービスプロバイダにてCNAME設定を完了する必要があります。設定が有効になると、CDNアクセラレーションサービスが利用可能になります。
![img](https://main.qcloudimg.com/raw/073b948565743f7947aae8503eef995d.png)

## 設定手順

このセクションではTencent CloudとAlibaba CloudのCNAME設定手順について説明します。ドメイン名が存在するサービスプロバイダに基づき設定することができます。

- [Tencent Cloudの設定方法](#m1)
- [Alibaba Cloudの設定方法](#m2)

[](id:m1)
### Tencent Cloudの設定方法

> !ドメイン名の解析では、各種のレコードタイプの間で優先順位に差異があります。同じホストレコードで、同一配線で数種類の異なるレコードタイプは共有できません。競合が生じるからです。CNAMEレコードは、CNAMEレコード以外のすべてのレコードタイプと競合するので、先にその他のレコードタイプは削除してから構成します。


1. [ドメイン名サービス](https://console.cloud.tencent.com/domain)コンソールにログインし、リストから、CNAMEレコードを追加するドメイン名がある行を見つけて、アクションバーの【解決】をクリックします。

2. リダイレクトしたDNSPOD画面で、【レコードの追加】をクリックし、以下の手順によってCNAMEレコードを追加します。
   ![img](https://main.qcloudimg.com/raw/36f84a0d21b51bc56d79544943f0f752.png)
	
	- **ホストレコード**：サブドメイン名を入力します。例えば、`www.dnspod.com`のドメイン名の解決の追加は，「ホストレコード」において「www」を選択します。`dnspod.com`のドメイン名の解決だけを追加する場合は、「ホストレコード」において「@」を選択します。
	- **レコードタイプ**：「CNAME」を選択します。
	- **回線タイプ**：「デフォルト」タイプを選択します。DNSPodは複数の方法で回線の区分をサポートします。指定ユーザーが当該レコードにアクセスするようにします。詳細は[解決回線の説明](https://docs.dnspod.cn/dns/5f4775898ae73e11c5b01afc/)をご参照ください。
	- **レコード値**：指定のドメイン名で、一般的にアクセラレーションドメイン名のCNAME値xxx.xxx.com.cdn.dnsv1.comを入力します。レコードが生成されると、自動的にドメイン名の後ろに「.」が追加されます。
	- **重み**：同一のホストレコードで同じ回線の場合、異なるレコード値に対して重みを設定できます。解決時は、設定した重みを基に比例して返送します。入力範囲は
		0～100の整数です。
	- ** MXの優先度**:入力する必要はありません。
	- ** TTL**:キャッシュ時間です。数値が小さいほど、変更レコードの有効時間は速まります。デフォルトは600秒。
3. 入力が完了してから、【確定】をクリックすると、直ちにCNAME設定が完了します。

   

####  拡張設定
- 1つのホストレコードの「回線タイプ」を「デフォルト」に設定すると、すべてのサーバーのアクセラレーションサービスが有効になります。
例えば、すべてのユーザーを`1.com`に指定する必要がある場合に、回線タイプをデフォルト、レコード値を`1.com`とする1個のCANMEレコードを追加することで実現できます。
![img](https://main.qcloudimg.com/raw/0c146a23008acc3c0e4884aa1c4d3a3c.png)

-回路を分けてアクセラレーションサービスを有効にもできます。
モバイルユーザーに`1.com`を指定し、ユニコムユーザーには`2.com`を指定する必要がある場合、【回線タイプ】が「モバイル」でレコード値が`1.com`、【回線タイプ】が「チャイナユニコム」でレコード値が`2.com`の2回線のCNAMEレコードを追加して実現できます。
 ![](https://main.qcloudimg.com/raw/ecf4d1ad94eaf897473647459b923209.png)

>?回線設定の詳細については[解決回線の説明](https://docs.dnspod.cn/dns/5f4775898ae73e11c5b01afc/)をご参照ください。


[](id:m2)
### Alibaba Cloud設定方法

DNSプロバイダがAlibaba Cloudの場合は、下記の手順でCNAMEレコードを追加できます。

1. Alibaba Cloudコンソールのクラウド解決DNSにログインします。
2. 解決するドメイン名をクリックし、解決レコードページに入ります。
3. 解決レコードページに入ってから、【レコードの追加】ボタンをクリックし、解決レコードの設定を始めます。
4. CNAME解決レコードを設定する場合は、レコードタイプをCNAMEに選んでください。ホストレコードはドメイン名のプレフィックスで、任意に入力できます（例えば：`www`）。レコード値は現在のドメイン名のリンク先となる別のドメイン名を入力してください。解決回線とTTLは、デフォルト値のままでかまいません。
![img](https://main.qcloudimg.com/raw/6b8bb9ce4f998b8d17ca27fd10512dc6.png)
5. 入力後に【確定】をクリックすると、直ちに解決の設定が完了します。



## CNAMEのアクティブ化状態を確認

最後に、DNSプロバイダが異なると、CNAMEが有効になるまでの時間もわずかに異なりますが、通常は30分以内に有効になります。nslookupまたはdigを使用してCNAMEが有効かどうかを確認することもできます。応答するCNAMEレコードが自分の設定したCNAMEである場合は、設定が成功しており、アクセラレーションサービスの起動に成功したことを示します。

- `nslookup -qt=cname <アクセラレーションドメイン名>`
  ![img](https://main.qcloudimg.com/raw/89faaf228a2b88e23b82d0a839367c76.png)
- `dig <アクセラレーションドメイン名>`
  ![img](https://main.qcloudimg.com/raw/2ba5ec76f1671c3b8ee345cef896de10.png)
