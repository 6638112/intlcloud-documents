## Feature Description
- Admins can query one-to-one chat messages based on a specified time range.
- From_Account and to_Account in the request specify the one-to-one chat to be queried. The query result includes the messages sent between both parties. From_Account and to_Account in each message specify the specific sender and recipient of each message.
- If the values of the From_Account and to_Account fields in the request are exchanged, the query result will remain unchanged.
- The query result includes recalled messages, which are marked by the MsgFlagBits field.
- To recall a message by using the [Recalling One-to-One Messages](https://intl.cloud.tencent.com/document/product/1047/35015) API, first use this API to query the MsgKey of the message.

## Call Description
### Example request URL
```
https://console.tim.qq.com/v4/openim/admin_getroammsg?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```

### Request parameters

The following table only describes the parameters that are modified when this API is called. For more information about other parameters, see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| -------------------------- | ------------------------------------------------------------ |
| v4/openim/admin_getroammsg | The request API. |
| sdkappid | The SDKAppID assigned by the IM console when an app is created. |
| identifier | The value of this parameter must be an app admin account. For more information, see [App Admin](https://intl.cloud.tencent.com/document/product/1047/33517#app-.E7.AE.A1.E7.90.86.E5.91.98). |
| usersig | The signature generated by the app admin account. For details on the operation, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | A random 32-bit unsigned integer ranging from 0 to 4294967295. |

### Maximum call frequency

200 times/second

### Example request and response

#### All data is returned through one request. (Continued pull is not needed.)
For example, there is a chat between user1 and user2, and two messages were sent between them in the time range of 2020-03-20 10:00:00 - 2020-03-20 11:00:00. Now we want to query the chat record in this time range.

##### Example request
```
{
    "From_Account":"user2",
    "To_Account":"user1",
    "MaxCnt":2,
    "MinTime":1584669600,
    "MaxTime":1584673200
}
```
##### Example response
```
{
    "ActionStatus":"OK",
    "ErrorInfo":"",
    "ErrorCode": 0,
    "Complete": 1,
    "MsgCnt": 2,
    "LastMsgTime": 1584669680,
    "LastMsgKey": "549396494_2578554_1584669680",
    "MsgList": [
        {
            "From_Account": "user1",
            "To_Account": "user2",
            "MsgSeq": 549396494,
            "MsgRandom": 2578554,
            "MsgTimeStamp": 1584669680,
            "MsgFlagBits": 0,
            "MsgKey": "549396494_2578554_1584669680",
            "MsgBody": [
                {
                    "MsgType": "TIMTextElem",
                    "MsgContent": {
                        "Text": "1"
                    }
                }
            ]
        },
        {
            "From_Account": "user2",
            "To_Account": "user1",
            "MsgSeq": 1054803289,
            "MsgRandom": 7201,
            "MsgTimeStamp": 1584669689,
            "MsgFlagBits": 0,
            "MsgKey": "1054803289_7201_1584669689",
            "MsgBody": [
                {
                    "MsgType": "TIMTextElem",
                    "MsgContent": {
                        "Text": "2"
                    }
                }
            ]
        }
    ]
}
```

#### All data is returned through multiple requests (Continued pull is needed.)
For example, there is a chat between user1 and user2, and 100 messages were sent between them in the time range of 2020-03-20 10:00:00 - 2020-03-20 11:00:00. Now we want to query the chat record in this time range.
##### Example first request
```
{
    "From_Account":"user2",
    "To_Account":"user1",
    "MaxCnt":100,
    "MinTime":1584669600,
    "MaxTime":1584673200
}
```

##### Example response
```
{
    "ActionStatus":"OK",
    "ErrorInfo":"",
    "ErrorCode": 0,
    "Complete": 0,
    "MsgCnt": 17,
    "LastMsgTime": 1584672269,
    "LastMsgKey": "1259_93754093_1584672269",
    "MsgList": [ ... ] //To show the continued pull process, the MsgList result is not listed here.
}
```

In the response, `"Complete": 0` indicates that not all messages in the time range have been pulled, so continued pull is needed.
In the continued pull request, MaxTime should be changed to the value of the LastMsgTime field in the response, and the LastMsgKey field in the response should be entered, as shown below:

<span id="example"></span>
##### Continued pull request
```
{
    "From_Account":"user2",
    "To_Account":"user1",
    "MaxCnt":100,
    "MinTime":1584669600,
    "MaxTime":1584672269,
    "LastMsgKey": "1259_93754093_1584672269"
}
```

#### Request packet fields

| Field | Type | Attribute | Description |
| ------------ | ------- | ---- | ------------------------------------------------------------ |
| From_Account | String | Required | UserID of one party in the chat |
| To_Account | String | Required | UserID of one party in the chat |
| MaxCnt | Integer | Required | Number of messages requested |
| MinTime | Integer | Required | Minimum value of the requested message time |
| MaxTime | Integer | Required | Maximum value of the requested message time |
| LastMsgKey | String | Optional | MsgKey of the last message pulled in the last pull. This field needs to be specified for continued pull. For more information, see [Example](#example). |

### Example response packet
- Normal response
```
{
    "ActionStatus":"OK",
    "ErrorInfo":"",
    "ErrorCode": 0,
    "Complete": 1,
    "MsgCnt": 1,
    "LastMsgTime": 1584669680,
    "LastMsgKey": "549396494_2578554_1584669680",
    "MsgList": [
        {
            "From_Account": "user1",
            "To_Account": "user2",
            "MsgSeq": 549396494,
            "MsgRandom": 2578554,
            "MsgTimeStamp": 1584669680,
            "MsgFlagBits": 0,
            "MsgKey": "549396494_2578554_1584669680",
            "MsgBody": [
                {
                    "MsgType": "TIMTextElem",
                    "MsgContent": {
                        "Text": "1"
                    }
                }
            ]
        }
    ]
}
```

- Exceptional response
```
{
    "ActionStatus": "FAIL", 
    "ErrorInfo": "Fail to Parse json data of body, Please check it", 
    "ErrorCode": 90001
}
```

### Response packet fields

| Field | Type | Description |
| ------------ | ------- | ------------------------------------------------------------ |
| ActionStatus | String | The request processing result. OK: succeeded. FAIL: failed. |
| ErrorCode | Integer | The error code. 0: succeeded. Other values: failed. |
| ErrorInfo | String | The error information. |
| Complete | Integer | Indicates whether all messages have been pulled. 0: no, and continued pull is needed. 1: yes. |
| MsgCnt | Integer | Number of messages pulled this time |
| LastMsgTime | Integer | Time of the last message pulled this time |
| LastMsgKey | Integer | Key of the last message pulled this time |
| MsgList | Array | Message list returned |
| MsgFlagBits | Integer | Attribute of the message. 0: normal message. 8: recalled message. |
| MsgBody | Object | The message content. For more information, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527)(One message can contain multiple message elements, with MsgBody set to Array). |
| MsgKey | String | This field marks the message as applicable for the [Recalling One-to-One Chat Messages](https://intl.cloud.tencent.com/document/product/1047/35015) API. |

## Error Codes

Unless a network error (such as error 502) occurs, the HTTP return code for this API is always 200. ErrorCode and ErrorInfo in the response packet represent the actual error code and error information.
For public error codes (60000 to 79999), see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The following table describes the error codes specific to this API.

| Error Code | Description |
| ------ | ------------------------------------------------------------ |
| 90001 | Failed to parse JSON. Make sure that the format of the request packet is valid. |
| 90003 | The To_Account field is not contained in the JSON request packet, or To_Account is not a String. |
| 90008 | The From_Account field is not contained in the JSON request packet, or the account it specifies does not exist. |
| 90009 | The app admin permissions are required for the request. |
| 91000 | Internal server error. Please try again. |


## References
- Sending a one-to-one chat message ([v4/openim/sendmsg](https://intl.cloud.tencent.com/document/product/1047/34919))
- Batch sending one-to-one chat messages ([v4/openim/batchsendmsg](https://intl.cloud.tencent.com/document/product/1047/34920))
- Recalling one-to-one chat messages ([v4/openim/admin_msgwithdraw](https://intl.cloud.tencent.com/document/product/1047/35015))