## Feature Description
- This API is used to send one-to-one messages to up to 500 users at a time.
- Compared with the API for sending a one-to-one message, this API is more suitable for time-sensitive messages, such as marketing messages and system notifications.
- When the admin specifies an account to batch send a message to target accounts, the sender displayed to the recipients is not the admin, but is the account specified by the admin.
- This API does not trigger callback requests.
- This API does not check whether the sender and the recipient are friends or blacklisted by either party or whether the recipient is muted.

> When calling the server-end integrated RESTful API to batch send a message, you must specify whether to synchronize the message to the sender, which is the admin account or the account specified by the admin. Synchronization can be implemented via online terminals and the roaming server. The RESTful API provides the SyncOtherMachine parameter to specify whether to synchronize the message. For more information, see Sample request packet.

## API Call Description
### Sample request URL
```
https://console.tim.qq.com/v4/openim/batchsendmsg?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```
### Request parameters

The following is a list of the parameters commonly used when calling this API and their descriptions. For more parameters, see the [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| v4/openim/batchsendmsg | The request API that is used. |
| sdkappid | The SDKAppID assigned through the IM console when the application is created. |
| identifier | The value must be the app admin account. For more information, see [App Admin](https://intl.cloud.tencent.com/document/product/1047/33517). |
| usersig | The signature generated by the app admin account. For more information on the operation, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | The value must be a random 32-bit unsigned integer. Value range: 0 to 4294967295. |

### Maximum call frequency

This API can be called up to 200 times per second.

### Sample request packets
Here, we use the request for sending text messages as an example. To send messages of other types, set MsgBody to the corresponding message type. For more information, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527).

#### The admin batch sends messages to target accounts

> If you do not want to synchronize messages to From_Account, set SyncOtherMachine to 2.
> To synchronize messages to From_Account, set SyncOtherMachine to 1.

```
{
    "SyncOtherMachine": 2, // Do not synchronize messages to the sender.
    "To_Account": [ // List of target accounts.
        "bonnie",
        "rong"
    ],
    "MsgRandom": 19901224, // The random number of the message.
    "MsgBody": [ // The body of the message.
        {
            "MsgType": "TIMTextElem", // The type of the message. The value TIMTextElem indicates text messages.
            "MsgContent": {}
                "Text": "hi, beauty" // The text of the message.
            }
        }
    ]
}
```

#### The admin specifies an account to batch send messages to target accounts and enables offline information push
The From_Account parameter is the sender specified by the admin. The sender displayed to the recipients is not the admin, but is the account specified by the admin. The following JSON request indicates that dave sends a message to the accounts bonnie and rong. When bonnie and rong receive the message, the message sender displayed to them is dave.
> If you do not want to synchronize messages to From_Account, set SyncOtherMachine to 2.
> To synchronize messages to From_Account, set SyncOtherMachine to 1.

```
{
    "SyncOtherMachine": 1, // Synchronize messages to the sender.
    "From_Account": "dave",
    "To_Account": [
        "bonnie",
        "rong"
    ],
    "MsgRandom": 19901224,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {}
                "Text": "hi, beauty"
            }
        }
    ],
    "OfflinePushInfo": {
        "PushFlag": 0,
        "Desc": "The content that is pushed offline",
        "Ext": "The passthrough content",
        "AndroidInfo": {
            "Sound": "android.mp3",
        },
        "ApnsInfo": {
            "Sound": "apns.mp3",
            "BadgeMode": 1, // If this parameter is not specified or is set to 0, the message is counted. If this parameter is set to 1, the message is not counted, that is, the icon number in the upper-right corner does not increase by 1.
            "Title":"apns title", // apns title
            "SubTitle":"apns subtitle", // apns subtitle
            "Image":"www.image.com" // Image URL
        }
    }
}
```

### Request packet fields

| Field | Type | Property | Description |
|---------|---------|---------|---------|
| SyncOtherMachine | Integer | Optional | 1: synchronize messages to the online terminal and roaming server of the From_Account. <br/>2: do not synchronize messages to From_Account. If this parameter is not specified, messages are synchronized to the roaming server of the From_Account by default. |
| From_Account | String | Optional | The message sender account specified by the admin. If you want to specify the information on From_Account, you must specify this parameter. |
| To_Account | Array | Required | The UserID of the recipient of the message. |
| MsgRandom | Integer | Required | The random number of the message. The value is generated by the random function and used by the IM backend to locate issues. |
| MsgBody | Object | Required | TIM message. For more information, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |
| MsgType | String | Required | The object type of the TIM message. Supported message objects include TIMTextElem (text messages), TIMFaceElem (emoji messages), TIMLocationElem (location messages), and TIMCustomElem (custom messages). |
| MsgContent | Object | Required | The object of the TIM message. For more information, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |
| OfflinePushInfo | Object | Optional | The information to be pushed offline. For more information, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |



### Sample response packet body

- Sample response packet when the message was sent to all the target accounts
```
 {
    "ErrorInfo":"",
    "ActionStatus":"OK",
    "ErrorCode": 0
    "MsgKey": "128493_903762_1572870301"
}
```

- Sample response packet when the message failed to be sent to some target accounts
```
{
    "ActionStatus": "SomeError",
    "ErrorCode": 0
    "ErrorInfo":"",
    "MsgKey": "4852_28135_1579678877",
    "ErrorList": [ // List of target accounts to which messages failed to be sent
        {
            "To_Account": "rong", // The target account to which the message failed to be sent
            "ErrorCode":  70107 // The error code returned for the request. Error code 70107 indicates that the account does not exist.
        }
    ]
}
```

- Sample response packet when the message was sent to none of the target accounts
```
{
    "ActionStatus": "FAIL",
    "ErrorInfo": "invalid To_Account",
    "ErrorCode": 90012
}
```

### Response packet fields

| Field | Type| Description |
|---------|---------|---------|
| ActionStatus | String | The processing result of the request. OK: succeeded. FAIL: failed. |
| ErrorCode | Integer | The error code returned for the request. <li>If the message was sent to any account, the value is 0.</li><li>If the message was sent to none of the target accounts, the value is not 0.</li> |
| ErrorInfo | String | Detailed information on the error. |
| ErrorList | Array | List of target accounts to which the message failed to be sent or that do not exist. If the message was sent to all the target accounts, the value is blank. |
| ErrorList.To_Account | String | The target account to which the message failed to be sent. |
| ErrorList.ErrorCode | Integer | The error code indicating that the message failed to be sent. If the error code for a target account is 70107, the account does not exist. |
| MsgKey | String | The unique identifier of the message. This parameter is used to recall a message. The value is a string of up to 50 characters. |

## Error Codes

The HTTP return code for this API is 200 unless an network error such as error 502 occurs. The actual error code and error information are indicated by ErrorCode and ErrorInfo respectively in the response packet body.
For public error codes 60000 to 79999, see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The private error codes for this API are as follows:

| Error Code | Description |
| ------------- | ------------------------------------------------------------ |
| 70107 | The requested UserID does not exist. |
| 70169 | The server timed out. Try again later. |
| 90001 | Failed to parse the JSON format. Check whether the JSON request packet meets JSON specifications. |
| 90002 | The MsgBody in the JSON request packet does not meet message format requirements, or the MsgBody is not of the Array type. For more information, see the definition in [Message Element TIMMsgElement](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90007 | The MsgBody field in the JSON request packet is not of the Array type. Change the type of the MsgBody field to Array. |
| 90008 | The JSON request packet does not contain the From_Account field or the account specified by the From_Account field does not exist. |
| 90009 | The request requires the app admin’s permissions. |
| 90010 | The JSON request packet does not meet message format requirements. For more information, see the definition in [Message Element TIMMsgElement](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90011 | The number of target accounts to which the message is to be sent exceeds 500. Reduce the number of target accounts in To_Account. |
| 90012 | The To_Account does not exist or has not been registered. Check whether the To_Account has been imported into the IM or is spelled correctly. |
| 90026 | The offline storage time of the message is incorrect. Messages cannot be stored offline for more than 7 days. |
| 90048 | The requested UserID does not exist. |
| 90992 | An internal service error occurred. Please try again. If this error code is returned for all requests and third-party callback is enabled, ensure that the app server returns callback results to the IM backend properly. |
| 91000 | An internal service error occurred. Please try again. |
| 93000 | The JSON packet exceeded the maximum length. The message body cannot exceed 8 KB in length. |


## API Debugging Tool
To debug this API, you can use the [Online RESTful API Debugging Tool](https://avc.cloud.tencent.com/im/APITester/APITester.html#v4/openim/batchsendmsg).

## References
- Sending a One-to-one Chat Message ([v4/openim/sendmsg](https://intl.cloud.tencent.com/document/product/1047/34919))
- Sending Ordinary Messages in a Group ([v4/group_open_http_svc/send_group_msg](https://intl.cloud.tencent.com/document/product/1047/34959))
- Sending System Messages in a Group ([v4/group_open_http_svc/send_group_system_notification](https://intl.cloud.tencent.com/document/product/1047/34958))
- [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527)
