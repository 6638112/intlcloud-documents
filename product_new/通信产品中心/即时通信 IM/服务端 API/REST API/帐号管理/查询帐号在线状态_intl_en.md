## Feature Description
This API is used to query the current login state of a user.

## Call Description
### Example request URL
```
https://console.tim.qq.com/v4/openim/querystate?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```
### Request parameters

The following table only describes the parameters that are modified when this API is called. For more information on other parameters, see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| v4/openim/querystate | The request API. |
| sdkappid | The SDKAppID assigned by the IM console when an app is created. |
| identifier  | The value of this parameter must be an app admin account. For more information, see [App Admin](https://intl.cloud.tencent.com/document/product/1047/33517#app-.E7.AE.A1.E7.90.86.E5.91.98). |
| usersig | The signature generated by the app admin account. For details on the operation, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | A random 32-bit unsigned integer ranging from 0 to 4294967295. |

### Maximum call frequency

200 times/second

### Example request packet
#### When detailed login platform information is not required
```
{
    "To_Account": ["id1", "id2", "id3"]
}

```

#### When detailed login platform information is required
```
{
    "IsNeedDetail": 1,
    "To_Account": ["id1", "id2"]
}
```

### Request packet fields

| Field | Type | Attribute | Description |
|---------|---------|---------|---------|
| To_Account | Array | Required | The UserIDs whose login status needs to be queried. This API can be used to query the login status of a maximum of 500 UserIDs at a time. |
| IsNeedDetail | Integer | Optional | Specifies whether detailed login platform information needs to be returned. 0: Not required. 1: Required. |

### Example response packet
#### When detailed login platform information is not required

```
{
    "ActionStatus":"OK",
    "ErrorInfo":"",
    "ErrorCode": 0,
    "QueryResult": [
        {
            "To_Account": "id1",
            "State": "Offline"
        },
        {
            "To_Account": "id2",
            "State": "Online"
        },
        {
            "To_Account": "id3",
            "State": "PushOnline"
        }
    ]
}

```
#### When detailed login platform information is required
```
{
    "ActionStatus":"OK",
    "ErrorInfo":"",
    "ErrorCode": 0,
    "QueryResult": [
        {
            "To_Account": "id1",
            "State": "Online",
            "Detail": [
                {
                    "Platform": "IPhone",
                    "Status": "PushOnline"
                },
                {
                    "Platform": "Web",
                    "Status": "Online"
                }
            ]
        },
        {
            "To_Account": "id2",
            "State": "Offline",
        }        
    ]
}
```

#### Request error
```
{
    "ActionStatus": "FAIL",
    "ErrorInfo": "Fail to Parse json data of body, Please check it",
    "ErrorCode": 90001
}
```

### Response packet fields

| Field | Type | Description |
|---------|---------|---------|
| ActionStatus | String | The request processing result. OK: succeeded. FAIL: failed. |
| ErrorCode | Integer | The error code. 0: succeeded. Other values: failed. |
| ErrorInfo | String | Detailed error information. |
| QueryResult | Array | The returned structured information on the user’s login status. |
| To_Account | String | The returned UserID. |
| State | String | The returned login status. Valid values: <ul style="margin:0;"><li>Online: after the user logs in to the client, the client stays in a persistent connection with the IM console.</li><li>PushOnline: the client enters the PushOnline state when the iOS or Android process is disconnected due to a network error or is terminated by the operating system. In this state, the client can still receive offline push messages. However, after the client is switched to the backend, if the client’s process is not killed by the operating system of the mobile phone, the client is in Online state.</li><li>Offline: the client proactively exits or has not been logged in for at least 7 days since last login.</li></ul>If the user logs in to the client on multiple devices and the client is in Online state on any device, the returned value is Online. |
| Detail | Object | Detailed login platform information. |
| Platform | String | The type of the login platform. |
| Status | String | The status of the login platform. |

> The IM backend stores the PushOnline state for only seven days. If a user does not log in to the client within seven days since the previous login, the user enters the Offline state.

## Error Codes
Unless a network error (such as error 502) occurs, the HTTP return code for this API is always 200. ErrorCode and ErrorInfo in the response packet represent the actual error code and error information.
For public error codes (60000 to 79999), see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The following table describes the error codes specific to this API.

| Error Code | Description |
|---------|---------|
| 90001 | JSON format parsing failed. Check whether the request packet meets the JSON specification or whether To_Account is a null array. |
| 90003 | The value of the To_Account field in the JSON format request package does not meet the message format requirements. Check whether the type of the To_Account field is String. |
| 90009 | The request requires app admin permissions. |
| 90011 | The number of target accounts to which messages will be sent exceeds 500. Reduce the number of target accounts in To_Account. |
| 90992 | The backend server timed out. Please try again. |
| 90994 | An internal server error occurred. Please try again. |
| 90995 | An internal server error occurred. Please try again. |
| 91000 | An internal server error occurred. Please try again. |

## Debugging Tool
Use the [RESTful API online debugging tool](https://avc.qcloud.com/im/APITester/APITester.html#v4/openim/querystate) to debug this API.

## References

- Importing an account ([v4/im_open_login_svc/account_import](https://intl.cloud.tencent.com/document/product/1047/34953))
- Importing multiple accounts ([v4/im_open_login_svc/multiaccount_import](https://intl.cloud.tencent.com/document/product/1047/34954))
- Deleting accounts ([v4/im_open_login_svc/account_delete](https://intl.cloud.tencent.com/document/product/1047/34955))
- Querying accounts ([v4/im_open_login_svc/account_check](https://intl.cloud.tencent.com/document/product/1047/34956))
- Invalidating the login state of an account ([v4/im_open_login_svc/kick](https://intl.cloud.tencent.com/document/product/1047/34957))